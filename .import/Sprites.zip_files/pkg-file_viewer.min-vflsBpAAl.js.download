define("file-viewer/components",["require","exports","file-viewer/components/rapid_fire"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RapidFire=n.RapidFire}),define("file-viewer/components/rapid_fire",["require","exports","tslib","react"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var o=(function(e){function t(){var t=e.apply(this,arguments)||this;return t.keepFiring=!1,t.clearTimer=function(){clearTimeout(t.lastTimer)},t.stopFiring=function(){t.clearTimer(),t.keepFiring=!1},t.startFiring=function(){t.clearTimer();var e=t.props,n=e.callback,i=e.onFirstFire,o=e.initialDelay,r=e.repeatDelay;i&&i(),n();var a=function(){n(),t.keepFiring&&(t.lastTimer=setTimeout(a,r))};t.keepFiring=!0,t.lastTimer=setTimeout(a,o)},t}return n.__extends(t,e),t.prototype.componentWillUnmount=function(){this.clearTimer()},t.prototype.render=function(){return this.props.render(this.startFiring,this.stopFiring)},t})(i.Component);t.RapidFire=o,o.defaultProps={initialDelay:400,repeatDelay:100}}),define("intersection-observer",["require","exports"],function(e,t){"use strict";(function(e,t){function n(e){this.time=e.time,this.target=e.target,this.rootBounds=e.rootBounds,this.boundingClientRect=e.boundingClientRect,this.intersectionRect=e.intersectionRect||u(),this.isIntersecting=!!e.intersectionRect;var t=this.boundingClientRect,n=t.width*t.height,i=this.intersectionRect,o=i.width*i.height;this.intersectionRatio=n?Number((o/n).toFixed(4)):this.isIntersecting?1:0}function i(e,t){var n=t||{};if("function"!=typeof e)throw new Error("callback must be a function");if(n.root&&1!=n.root.nodeType)throw new Error("root must be an Element");this._checkForIntersections=r(this._checkForIntersections.bind(this),this.THROTTLE_TIMEOUT),this._callback=e,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(n.rootMargin),this.thresholds=this._initThresholds(n.threshold),this.root=n.root||null,this.rootMargin=this._rootMarginValues.map(function(e){return e.value+e.unit}).join(" ")}function o(){return e.performance&&performance.now&&performance.now()}function r(e,t){var n=null;return function(){n||(n=setTimeout(function(){e(),n=null},t))}}function a(e,t,n,i){"function"==typeof e.addEventListener?e.addEventListener(t,n,i||!1):"function"==typeof e.attachEvent&&e.attachEvent("on"+t,n)}function s(e,t,n,i){"function"==typeof e.removeEventListener?e.removeEventListener(t,n,i||!1):"function"==typeof e.detatchEvent&&e.detatchEvent("on"+t,n)}function l(e,t){var n=Math.max(e.top,t.top),i=Math.min(e.bottom,t.bottom),o=Math.max(e.left,t.left),r=Math.min(e.right,t.right),a=r-o,s=i-n;return a>=0&&s>=0&&{top:n,bottom:i,left:o,right:r,width:a,height:s}}function c(e){var t;try{t=e.getBoundingClientRect()}catch(e){}return t?(t.width&&t.height||(t={top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.right-t.left,height:t.bottom-t.top}),t):u()}function u(){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}function d(e,t){for(var n=t;n;){if(n==e)return!0;n=p(n)}return!1}function p(e){var t=e.parentNode;return t&&11==t.nodeType&&t.host?t.host:t}if("IntersectionObserver"in e&&"IntersectionObserverEntry"in e&&"intersectionRatio"in e.IntersectionObserverEntry.prototype)return void("isIntersecting"in e.IntersectionObserverEntry.prototype||Object.defineProperty(e.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}}));var m=[];i.prototype.THROTTLE_TIMEOUT=100,i.prototype.POLL_INTERVAL=null,i.prototype.USE_MUTATION_OBSERVER=!0,i.prototype.observe=function(e){if(!this._observationTargets.some(function(t){return t.element==e})){if(!e||1!=e.nodeType)throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:e,entry:null}),this._monitorIntersections(),this._checkForIntersections()}},i.prototype.unobserve=function(e){this._observationTargets=this._observationTargets.filter(function(t){return t.element!=e}),this._observationTargets.length||(this._unmonitorIntersections(),this._unregisterInstance())},i.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorIntersections(),this._unregisterInstance()},i.prototype.takeRecords=function(){var e=this._queuedEntries.slice();return this._queuedEntries=[],e},i.prototype._initThresholds=function(e){var t=e||[0];return Array.isArray(t)||(t=[t]),t.sort().filter(function(e,t,n){if("number"!=typeof e||isNaN(e)||e<0||e>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return e!==n[t-1]})},i.prototype._parseRootMargin=function(e){var t=e||"0px",n=t.split(/\s+/).map(function(e){var t=/^(-?\d*\.?\d+)(px|%)$/.exec(e);if(!t)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(t[1]),unit:t[2]}});return n[1]=n[1]||n[0],n[2]=n[2]||n[0],n[3]=n[3]||n[1],n},i.prototype._monitorIntersections=function(){this._monitoringIntersections||(this._monitoringIntersections=!0,this.POLL_INTERVAL?this._monitoringInterval=setInterval(this._checkForIntersections,this.POLL_INTERVAL):(a(e,"resize",this._checkForIntersections,!0),a(t,"scroll",this._checkForIntersections,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in e&&(this._domObserver=new MutationObserver(this._checkForIntersections),this._domObserver.observe(t,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))))},i.prototype._unmonitorIntersections=function(){this._monitoringIntersections&&(this._monitoringIntersections=!1,clearInterval(this._monitoringInterval),this._monitoringInterval=null,s(e,"resize",this._checkForIntersections,!0),s(t,"scroll",this._checkForIntersections,!0),this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null))},i.prototype._checkForIntersections=function(){var e=this._rootIsInDom(),t=e?this._getRootRect():u();this._observationTargets.forEach(function(i){var r=i.element,a=c(r),s=this._rootContainsTarget(r),l=i.entry,u=e&&s&&this._computeTargetAndRootIntersection(r,t),d=i.entry=new n({time:o(),target:r,boundingClientRect:a,rootBounds:t,intersectionRect:u});l?e&&s?this._hasCrossedThreshold(l,d)&&this._queuedEntries.push(d):l&&l.isIntersecting&&this._queuedEntries.push(d):this._queuedEntries.push(d)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)},i.prototype._computeTargetAndRootIntersection=function(n,i){if("none"!=e.getComputedStyle(n).display){for(var o=c(n),r=o,a=p(n),s=!1;!s;){var u=null,d=1==a.nodeType?e.getComputedStyle(a):{};if("none"==d.display)return;if(a==this.root||a==t?(s=!0,u=i):a!=t.body&&a!=t.documentElement&&"visible"!=d.overflow&&(u=c(a)),u&&(r=l(u,r),!r))break;a=p(a)}return r}},i.prototype._getRootRect=function(){var e;if(this.root)e=c(this.root);else{var n=t.documentElement,i=t.body;e={top:0,left:0,right:n.clientWidth||i.clientWidth,width:n.clientWidth||i.clientWidth,bottom:n.clientHeight||i.clientHeight,height:n.clientHeight||i.clientHeight}}return this._expandRectByRootMargin(e)},i.prototype._expandRectByRootMargin=function(e){var t=this._rootMarginValues.map(function(t,n){return"px"==t.unit?t.value:t.value*(n%2?e.width:e.height)/100}),n={top:e.top-t[0],right:e.right+t[1],bottom:e.bottom+t[2],left:e.left-t[3]};return n.width=n.right-n.left,n.height=n.bottom-n.top,n},i.prototype._hasCrossedThreshold=function(e,t){var n=e&&e.isIntersecting?e.intersectionRatio||0:-1,i=t.isIntersecting?t.intersectionRatio||0:-1;if(n!==i)for(var o=0;o<this.thresholds.length;o++){var r=this.thresholds[o];if(r==n||r==i||r<n!=r<i)return!0}},i.prototype._rootIsInDom=function(){return!this.root||d(t,this.root)},i.prototype._rootContainsTarget=function(e){return d(this.root||t,e)},i.prototype._registerInstance=function(){m.indexOf(this)<0&&m.push(this)},i.prototype._unregisterInstance=function(){var e=m.indexOf(this);e!=-1&&m.splice(e,1)},e.IntersectionObserver=i,e.IntersectionObserverEntry=n})(window,document)}),define("file-viewer/polyfills",["require","exports","smoothscroll-polyfill","intersection-observer","url-polyfill"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.polyfill()}),define("file-viewer/preview_image/container",["require","exports","tslib","react","file-viewer/core","file-viewer/preview_image/preview_image","file-viewer/preview_image/preview_image_toolbar"],function(e,t,n,i,o,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),t.PreviewImageContainer=function(e){function t(e){n(o.updateMinScaleFactor({fileViewerId:l,fileIdOrRevisionId:s.file_id,minScaleFactor:e}))}var n=e.dispatch,s=e.fileMetadata,l=e.id,c=e.intl,u=e.filePreviewUiData;return i.createElement("div",null,i.createElement(r.PreviewImage,Object.assign({},e,{onMinScaleFactorChanged:t})),i.createElement(a.PreviewImageToolbar,{dispatch:n,fileId:s.file_id,fileViewerId:l,intl:c,minScaleFactor:u.minScaleFactor||0,scaleFactor:void 0!==u.scaleFactor?u.scaleFactor:u.minScaleFactor,theme:"osx"}))}}),define("file-viewer/preview_image/data_transform",["require","exports"],function(e,t){"use strict";function n(e){return{thumbnailUrl:e.default_src||"",fullSizeUrl:e.full_size_src||"",srcSet:e.src_set||"",alt:""}}Object.defineProperty(t,"__esModule",{value:!0}),t.transform=n}),define("file-viewer/preview_image/img_layer",["require","exports","tslib","react","file-viewer/preview_image/layer_event_actions"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var r={viewport:"_1qfmN8XukH",loader:"_10XzzxD2-Q _3fqREDOmbd",smallImg:"LbSAq7r5DB",fullSizeImg:"_19VoPo7qJu",sizer:"_3JPQLClVw4",zoomFit:"_2G_smAf1kF",layer:"_3jv_DqNZ9O",verticalPadding:"40px",horizontalPadding:"36px"},a=(function(e){function t(){var t=e.apply(this,arguments)||this;return t.state={fullSizeImgLoaded:!1,loading:!0},t.handleSmallImgLoad=function(e){var n=e.currentTarget,i=n.naturalWidth,r=n.naturalHeight;t.setState({loading:!1}),t.props.dispatch(o.smallImgLoadedAction({naturalWidth:i,naturalHeight:r}))},t.onFullSizeImgLoad=function(e){var n=e.currentTarget,i=n.naturalWidth,r=n.naturalHeight;t.setState({fullSizeImgLoaded:!0,loading:!1}),t.props.dispatch(o.fullSizeImgLoadedAction({naturalWidth:i,naturalHeight:r}))},t.handleSmallImgError=function(){return t.props.dispatch(o.smallImgErrorAction())},t.handleContextMenu=function(e){return t.props.config.contextMenuDisabled?e.preventDefault():null},t.handleDoubleClick=function(){return t.props.dispatch(o.doubleClickedAction())},t}return n.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){e.fileMetadata.file_id!==this.props.fileMetadata.file_id&&this.setState({fullSizeImgLoaded:!1,loading:!0})},t.prototype.render=function(){var e,t={},n=this.props,o=n.data,a=o.alt,s=o.fullSizeUrl,l=o.thumbnailUrl,c=o.srcSet,u=n.className,d=this.state,p=d.fullSizeImgLoaded,m=d.loading;return p||(e=i.createElement("img",{src:l,srcSet:c,onLoad:this.handleSmallImgLoad,className:r.smallImg+" "+u,onError:this.handleSmallImgError,onContextMenu:this.handleContextMenu,alt:a})),p||(t={display:"none"}),i.createElement("div",{className:r.layer},!p&&m&&i.createElement("i",{className:r.loader}),i.createElement("img",{alt:a,className:r.fullSizeImg+" "+u,src:s,style:t,onLoad:this.onFullSizeImgLoad,onDoubleClick:this.handleDoubleClick,onContextMenu:this.handleContextMenu,"data-test":"fv-sdk-img-preview-full-size"}),e)},t})(i.PureComponent);t.ImageLayer=a}),define("file-viewer/preview_image",["require","exports","file-viewer/preview_image/img_layer","file-viewer/preview_image/preview_image","file-viewer/preview_image/data_transform","file-viewer/preview_image/layers","file-viewer/preview_image/container"],function(e,t,n,i,o,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageLayer=n.ImageLayer,t.PreviewImage=i.PreviewImage,t.transform=o.transform,t.defaultLayerRenderFn=r.defaultLayerRenderFn,t.PreviewImageContainer=a.PreviewImageContainer}),define("file-viewer/preview_image/layer_event_actions",["require","exports"],function(e,t){"use strict";function n(e){return{type:"@@previews/img/img_layer/smallImgLoaded",payload:e}}function i(e){return{type:"@@previews/img/img_layer/fullSizeImgLoaded",payload:e}}function o(){return{type:"@@previews/img/img_layer/smallImgError",payload:{}}}function r(){return{type:"@@previews/img/img_layer/doubleClicked",payload:{}}}Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e.SmallImgLoaded="@@previews/img/img_layer/smallImgLoaded",e.FullSizeImgLoaded="@@previews/img/img_layer/fullSizeImgLoaded",e.SmallImgError="@@previews/img/img_layer/smallImgError",e.DoubleClicked="@@previews/img/img_layer/doubleClicked"})(t.Action||(t.Action={})),t.smallImgLoadedAction=n,t.fullSizeImgLoadedAction=i,t.smallImgErrorAction=o,t.doubleClickedAction=r}),define("file-viewer/preview_image/layers",["require","exports","tslib","react","file-viewer/preview_image/img_layer"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),t.defaultLayerRenderFn=function(e){return function(t){return[i.createElement(o.ImageLayer,Object.assign({key:"imgLayer"},e,t))]}}}),define("file-viewer/preview_image/preview_image",["require","exports","tslib","react","file-viewer/preview_image/viewport","file-viewer/preview_image/data_transform"],function(e,t,n,i,o,r){"use strict";function a(e,t,n,i,o){return Math.min((n-(o.vertical||0))/e,(i-(o.horizontal||0))/t,1)}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var s={viewport:"_1qfmN8XukH",loader:"_10XzzxD2-Q _3fqREDOmbd",smallImg:"LbSAq7r5DB",fullSizeImg:"_19VoPo7qJu",sizer:"_3JPQLClVw4",zoomFit:"_2G_smAf1kF",layer:"_3jv_DqNZ9O",verticalPadding:"40px",horizontalPadding:"36px"},l=(function(e){function t(){var t=e.apply(this,arguments)||this;return t.state={},t.minScaleFactor=0,t.dispatch=function(e){switch(e.type){case"@@previews/img/img_layer/smallImgLoaded":return t.setState({aspectRatio:e.payload.naturalWidth/e.payload.naturalHeight}),t.props.onInteractive(),t.props.onRenderSucceeded();case"@@previews/img/img_layer/fullSizeImgLoaded":return t.handleFullSizeImgLoad(e.payload.naturalWidth,e.payload.naturalHeight),t.props.onRenderSucceeded();case"@@previews/img/img_layer/smallImgError":return t.props.onRenderFailed();case"@@previews/img/img_layer/doubleClicked":return void(t.props.onDoubleClick&&t.props.onDoubleClick())}return t.props.dispatch(e)},t}return n.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){e.fileMetadata.file_id!==this.props.fileMetadata.file_id&&(this.setState({originalHeight:void 0,originalWidth:void 0,aspectRatio:void 0}),this.minScaleFactor=0)},t.prototype.componentDidUpdate=function(e,t){var n=this.props,i=n.width,o=n.height,r=n.onMinScaleFactorChanged,l=this.state,c=l.originalWidth,u=l.originalHeight;c&&u&&"function"==typeof r&&(e.width===i&&e.height===o&&t.originalWidth===c&&t.originalHeight===u||r(a(c,u,i,o,{vertical:2*parseInt(s.verticalPadding,10),horizontal:2*parseInt(s.horizontalPadding,10)})))},t.prototype.handleFullSizeImgLoad=function(e,t){var n=this.props,i=n.width,o=n.height,r=n.onMinScaleFactorChanged;this.setState({originalHeight:t,originalWidth:e,aspectRatio:e/t}),"function"==typeof r&&r(a(e,t,i,o,{vertical:2*parseInt(s.verticalPadding,10),horizontal:2*parseInt(s.horizontalPadding,10)}))},t.prototype.render=function(){var e=this.props.filePreviewUiData.scaleFactor,t=this.props,n=t.className,a=t.contextMenuDisabled,s=t.fileMetadata,l=t.filePreviewUiData,c=t.height,u=t.intl,d=t.layerRenderFn,p=t.previewMetadata,m=t.resolveAsset,f=t.sizerClassName,h=t.width,_=this.state,v=_.originalWidth,g=_.originalHeight,y=_.aspectRatio;return e=e||this.minScaleFactor,p&&p.content?i.createElement(o.Viewport,{className:n,id:s.file_id,data:r.transform(p.content),sizerClassName:f,originalWidth:v,originalHeight:g,scaleFactor:e,aspectRatio:y,width:h,height:c,contextMenuDisabled:a},d({dispatch:this.dispatch,fileMetadata:s,filePreviewUiData:l,intl:u,previewMetadata:p,resolveAsset:m})):null},t})(i.PureComponent);t.PreviewImage=l}),define("file-viewer/preview_image/preview_image_toolbar",["require","exports","tslib","react","file-viewer/components","file-viewer/core","file-viewer/toolbar","file-viewer/toolbar/toolbar"],function(e,t,n,i,o,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var l=(function(e){function t(){var t=e.apply(this,arguments)||this;return t.onZoomIn=function(){var e=t.props,n=e.dispatch,i=e.fileViewerId,o=e.fileId;n(r.zoomIn({fileViewerId:i,fileIdOrRevisionId:o,sourceContext:"toolbar"}))},t.onZoomOut=function(){var e=t.props,n=e.dispatch,i=e.fileViewerId,o=e.fileId;n(r.zoomOut({fileViewerId:i,fileIdOrRevisionId:o,sourceContext:"toolbar"}))},t.onZoomOriginalOrFit=function(){var e=t.props,n=e.dispatch,i=e.fileViewerId,o=e.fileId;n(r.zoomOriginalOrFit({fileViewerId:i,fileIdOrRevisionId:o,sourceContext:"toolbar"}))},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.intl,n=e.minScaleFactor,r=e.scaleFactor;return i.createElement(s.PreviewToolbar,{containerClassName:"_1p8mJnfi0V"},i.createElement(o.RapidFire,{callback:this.onZoomOut,render:function(e,o){return i.createElement(a.ZoomOutButton,{buttonClassName:"_1k72OJBfkI",className:"ihogYuDhuE",disabled:null!=r&&null!=n&&r<=n,formatMessage:t.formatMessage,onMouseDown:e,onMouseLeave:o,onMouseUp:o})}}),i.createElement(a.ZoomToFitButton,{formatMessage:t.formatMessage,formatNumber:t.formatNumber,onClick:this.onZoomOriginalOrFit,zoomPercent:r||n}),i.createElement(o.RapidFire,{callback:this.onZoomIn,render:function(e,n){return i.createElement(a.ZoomInButton,{buttonClassName:"_1k72OJBfkI",className:"ihogYuDhuE",disabled:null!=r&&r>=16,formatMessage:t.formatMessage,onMouseDown:e,onMouseLeave:n,onMouseUp:n})}}))},t})(i.PureComponent);t.PreviewImageToolbar=l}),define("file-viewer/preview_image/viewport",["require","exports","tslib","classnames","react","file-viewer/core"],function(e,t,n,i,o,r){"use strict";function a(e,t,n,i){var o=e.left,r=e.top,a=t.w,s=t.h,l=n.w,c=n.h,u=[.5,.5];if(!a||!s||!i)return u;var d=a*i,p=s*i;return d>l&&(u[0]=(o+l/2)/d),p>c&&(u[1]=(r+c/2)/p),u}function s(e,t,n,i){var o=n.w,r=n.h,a=i.w,s=i.h,l=t*o,c=t*r;return[e[0]*l-a/2,e[1]*c-s/2]}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importStar(o);var l={viewport:"_1qfmN8XukH",loader:"_10XzzxD2-Q _3fqREDOmbd",smallImg:"LbSAq7r5DB",fullSizeImg:"_19VoPo7qJu",sizer:"_3JPQLClVw4",zoomFit:"_2G_smAf1kF",layer:"_3jv_DqNZ9O",verticalPadding:"40px",horizontalPadding:"36px"};t._calculateFocusPoint=a,t._calculateScrollPosition=s;var c=(function(e){function t(){var t=e.apply(this,arguments)||this;return t.viewportEl=null,t.focusPoint=[.5,.5],t.onScroll=function(e){var n=e.currentTarget,i=n.scrollLeft,o=n.scrollTop,r=t.props,s=r.originalWidth,l=r.originalHeight,c=r.scaleFactor,u=r.height,d=r.width;t.focusPoint=a({left:i,top:o},{w:s,h:l},{w:d,h:u},c)},t}return n.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){e.id!==this.props.id&&(this.focusPoint=[.5,.5])},t.prototype.componentDidUpdate=function(e){var t,n=this.props,i=n.scaleFactor,o=n.originalWidth,r=n.originalHeight,a=n.width,l=n.height;this.viewportEl&&i&&o&&r&&(e.scaleFactor!==i||e.originalWidth!==o||e.originalHeight!==r||e.height!==l||e.width!==a)&&(t=this.viewportEl).scrollTo.apply(t,s(this.focusPoint,i,{w:o,h:r},{w:a,h:l}))},t.prototype.render=function(){var e,t=this,n=this.props,a=n.width,s=n.height,c=n.scaleFactor,u=n.originalWidth,d=n.originalHeight,p=n.className,m=n.aspectRatio,f=n.sizerClassName,h=n.contextMenuDisabled,_=n.data,v=0,g=0,y={width:u,height:d};if(c&&u&&d){var b=u*c,w=d*c;b<a&&(v=(a-b)/2),w<s&&(g=(s-w)/2),y.width=b,y.height=w,y.transform="translate("+v+"px, "+g+"px)"}else if(m){var C=r.calculateFitBox(a-2*parseInt(l.horizontalPadding||"0",10),s-2*parseInt(l.verticalPadding||"0",10),m),S=C[0],E=C[1];y.width=S,y.height=E}else y.visibility="hidden";return o.createElement("div",{className:i.default(p,l.viewport,(e={},e[l.zoomFit||""]=!c,e)),style:{width:a,height:s},onScroll:this.onScroll,ref:function(e){return t.viewportEl=e}},o.createElement("div",{className:l.sizer+" "+f,style:y},this.props.children({config:{contextMenuDisabled:!!h},originalWidth:u||0,originalHeight:d||0,data:_})))},t})(o.PureComponent);t.Viewport=c}),define("smoothscroll-polyfill",["require","exports","module"],function(e,t,n){(function(){"use strict";function e(){function e(e){var t=["MSIE ","Trident/","Edge/"];return new RegExp(t.join("|")).test(e)}function t(e,t){this.scrollLeft=e,this.scrollTop=t}function n(e){return.5*(1-Math.cos(Math.PI*e))}function i(e){if(null===e||"object"!=typeof e||void 0===e.behavior||"auto"===e.behavior||"instant"===e.behavior)return!0;if("object"==typeof e&&"smooth"===e.behavior)return!1;throw new TypeError("behavior member of ScrollOptions "+e.behavior+" is not a valid value for enumeration ScrollBehavior.")}function o(e,t){return"Y"===t?e.clientHeight+h<e.scrollHeight:"X"===t?e.clientWidth+h<e.scrollWidth:void 0}function r(e,t){var n=u.getComputedStyle(e,null)["overflow"+t];return"auto"===n||"scroll"===n}function a(e){var t=o(e,"Y")&&r(e,"Y"),n=o(e,"X")&&r(e,"X");return t||n}function s(e){var t;do e=e.parentNode,t=e===d.body;while(t===!1&&a(e)===!1);return t=null,e}function l(e){var t,i,o,r=f(),a=(r-e.startTime)/468;a=a>1?1:a,t=n(a),i=e.startX+(e.x-e.startX)*t,o=e.startY+(e.y-e.startY)*t,e.method.call(e.scrollable,i,o),i===e.x&&o===e.y||u.requestAnimationFrame(l.bind(u,e))}function c(e,n,i){var o,r,a,s,c=f();e===d.body?(o=u,r=u.scrollX||u.pageXOffset,a=u.scrollY||u.pageYOffset,s=m.scroll):(o=e,r=e.scrollLeft,a=e.scrollTop,s=t),l({scrollable:o,method:s,startTime:c,startX:r,startY:a,x:n,y:i})}var u=window,d=document;if(!("scrollBehavior"in d.documentElement.style&&u.__forceSmoothScrollPolyfill__!==!0)){var p=u.HTMLElement||u.Element,m={scroll:u.scroll||u.scrollTo,scrollBy:u.scrollBy,elementScroll:p.prototype.scroll||t,scrollIntoView:p.prototype.scrollIntoView},f=u.performance&&u.performance.now?u.performance.now.bind(u.performance):Date.now,h=e(u.navigator.userAgent)?1:0;u.scroll=u.scrollTo=function(){if(void 0!==arguments[0])return i(arguments[0])===!0?void m.scroll.call(u,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:u.scrollX||u.pageXOffset,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:u.scrollY||u.pageYOffset):void c.call(u,d.body,void 0!==arguments[0].left?~~arguments[0].left:u.scrollX||u.pageXOffset,void 0!==arguments[0].top?~~arguments[0].top:u.scrollY||u.pageYOffset)},u.scrollBy=function(){if(void 0!==arguments[0])return i(arguments[0])?void m.scrollBy.call(u,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:0,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:0):void c.call(u,d.body,~~arguments[0].left+(u.scrollX||u.pageXOffset),~~arguments[0].top+(u.scrollY||u.pageYOffset))},p.prototype.scroll=p.prototype.scrollTo=function(){if(void 0!==arguments[0]){if(i(arguments[0])===!0){if("number"==typeof arguments[0]&&void 0===arguments[1])throw new SyntaxError("Value could not be converted");return void m.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left:"object"!=typeof arguments[0]?~~arguments[0]:this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top:void 0!==arguments[1]?~~arguments[1]:this.scrollTop)}var e=arguments[0].left,t=arguments[0].top;c.call(this,this,void 0===e?this.scrollLeft:~~e,void 0===t?this.scrollTop:~~t)}},p.prototype.scrollBy=function(){if(void 0!==arguments[0])return i(arguments[0])===!0?void m.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left+this.scrollLeft:~~arguments[0]+this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top+this.scrollTop:~~arguments[1]+this.scrollTop):void this.scroll({left:~~arguments[0].left+this.scrollLeft,top:~~arguments[0].top+this.scrollTop,behavior:arguments[0].behavior})},p.prototype.scrollIntoView=function(){if(i(arguments[0])===!0)return void m.scrollIntoView.call(this,void 0===arguments[0]||arguments[0]);var e=s(this),t=e.getBoundingClientRect(),n=this.getBoundingClientRect();e!==d.body?(c.call(this,e,e.scrollLeft+n.left-t.left,e.scrollTop+n.top-t.top),"fixed"!==u.getComputedStyle(e).position&&u.scrollBy({left:t.left,top:t.top,behavior:"smooth"})):u.scrollBy({left:n.left,top:n.top,behavior:"smooth"})}}}"object"==typeof t&&void 0!==n?n.exports={polyfill:e}:e()})()}.bind(Object.create(null))),define("file-viewer/toolbar",["require","exports","file-viewer/toolbar/sidebar_toggle_button","file-viewer/toolbar/toolbar_button","file-viewer/toolbar/toolbar_controls","file-viewer/toolbar/toolbar_flip_buttons","file-viewer/toolbar/toolbar_page_indicator","file-viewer/toolbar/zoom_to_fit_button"],function(e,t,n,i,o,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SidebarToggleButton=n.SidebarToggleButton,t.PreviewToolbarButton=i.PreviewToolbarButton,t.FullScreenButton=o.FullScreenButton,t.PageDownButton=o.PageDownButton,t.PageUpButton=o.PageUpButton,t.ZoomInButton=o.ZoomInButton,t.ZoomOutButton=o.ZoomOutButton,t.ToolbarFlipButtons=r.ToolbarFlipButtons,t.PageIndicator=a.PageIndicator,t.ZoomToFitButton=s.ZoomToFitButton}),define("file-viewer/toolbar/sidebar_toggle_button",["require","exports","tslib","react","file-viewer/core","file-viewer/toolbar/toolbar_button"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var a=(function(e){function t(){var t=e.apply(this,arguments)||this;return t.handleClick=function(e){var n=t.props,i=n.isSidebarOpen,o=n.onClick,r=n.onSidebarClose,a=n.onSidebarOpen;i&&r?r():a&&a(),o&&o(e)},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.buttonClassName,n=e.className,o=e.disabled,a=e.formatMessage,s=e.isSidebarOpen;return i.createElement(r.PreviewToolbarButton,{buttonClassName:t||"",className:n||"",disabled:o,formatMessage:a,iconName:s?"sidebarHide":"sidebarShow",id:"preview-toolbar-sidebar-toggle-button",tooltipText:a(s?{id:"380FK",defaultMessage:"Hide sidebar"}:{id:"1-hY4",defaultMessage:"Show sidebar"}),onClick:this.handleClick})},t})(i.PureComponent);t.SidebarToggleButton=a,a.defaultProps={formatMessage:o.dummyFormatMessage,isSidebarOpen:!1}}),define("file-viewer/toolbar/toolbar",["require","exports","tslib","react","classnames"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),o=n.__importDefault(o);var r={previewToolbarContainer:"_35Ij7yT3Fw",elevated:"OouqNZeGZl",previewToolbarOverlayContainer:"_3ZTICG-ip5",hide:"_1EYMNuP6H6",fadeout:"_18p4mhrs4N",previewToolbarOverlay:"_2VeuolpYsx",previewToolbarContent:"_23iY3-L6yK",toolbarButton:"_3MS_sSk8v2",previewToolbarContainerDesktop:"_1p8mJnfi0V",toolbarButtonWrapperDesktop:"ihogYuDhuE",toolbarButtonDesktop:"_1k72OJBfkI",arrowLeft:"_2ITlwxtTc0",arrowRight:"JfmmWYGWiP",fullscreen:"_1BXWzdKZcg",pageDown:"_1_6p5OEl7w",pageUp:"_3jVU5iQ-xK",sidebarHide:"_230L9B_VOu",sidebarShow:"_2Ht3Oh1zrp",zoomIn:"RkgEctpAaM",zoomOut:"_2P1wnPKDti",flipButtons:"_1Xy4vmCrmv",pageIndicator:"_2UCcY_L_ut",focus:"fFd_Ukn_Rn",pageInputWrapper:"_2lAAAHouQ7",pageInput:"_2XAzYxu3_c",withText:"_1OQ3or8fKn",pageIndicatorText:"_1f0fWYhQct",hidden:"_1uX-Yvcuyj",pageIndicatorDesktop:"o4F4ePgOMu",zoomToFitBtn:"BwAKgVnIAr",toolbarTooltip:"_2AS2IpIvyj"},a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=e.containerClassName;return i.createElement("div",{className:o.default(n,r.previewToolbarContainer)},i.createElement("div",{className:r.previewToolbarOverlayContainer},i.createElement("div",{className:r.previewToolbarOverlay},i.createElement("div",{className:o.default(t,r.previewToolbarContent)},this.props.children))))},t})(i.PureComponent);t.PreviewToolbar=a}),define("file-viewer/toolbar/toolbar_button",["require","exports","tslib","classnames","react","spectrum/tooltip","file-viewer/core"],function(e,t,n,i,o,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importStar(o);var s={previewToolbarContainer:"_35Ij7yT3Fw",elevated:"OouqNZeGZl",previewToolbarOverlayContainer:"_3ZTICG-ip5",hide:"_1EYMNuP6H6",fadeout:"_18p4mhrs4N",previewToolbarOverlay:"_2VeuolpYsx",previewToolbarContent:"_23iY3-L6yK",toolbarButton:"_3MS_sSk8v2",previewToolbarContainerDesktop:"_1p8mJnfi0V",toolbarButtonWrapperDesktop:"ihogYuDhuE",toolbarButtonDesktop:"_1k72OJBfkI",arrowLeft:"_2ITlwxtTc0",arrowRight:"JfmmWYGWiP",fullscreen:"_1BXWzdKZcg",pageDown:"_1_6p5OEl7w",pageUp:"_3jVU5iQ-xK",sidebarHide:"_230L9B_VOu",sidebarShow:"_2Ht3Oh1zrp",zoomIn:"RkgEctpAaM",zoomOut:"_2P1wnPKDti",flipButtons:"_1Xy4vmCrmv",pageIndicator:"_2UCcY_L_ut",focus:"fFd_Ukn_Rn",pageInputWrapper:"_2lAAAHouQ7",pageInput:"_2XAzYxu3_c",withText:"_1OQ3or8fKn",pageIndicatorText:"_1f0fWYhQct",hidden:"_1uX-Yvcuyj",pageIndicatorDesktop:"o4F4ePgOMu",zoomToFitBtn:"BwAKgVnIAr",toolbarTooltip:"_2AS2IpIvyj"},l=(function(e){function t(){var t=e.apply(this,arguments)||this;return t.onClick=function(e){var n=t.props.onClick;n&&n(e)},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.buttonClassName,a=e.className,l=e.disabled,c=(e.formatMessage,e.iconName),u=e.id,d=e.tooltipText,p=e.onMouseLeave,m=n.__rest(e,["buttonClassName","className","disabled","formatMessage","iconName","id","tooltipText","onMouseLeave"]),f=s[c];return o.createElement("div",{className:a,onMouseLeave:p},o.createElement(r.Tooltip,{positionOffset:16,positioning:"above",tooltipContent:d},o.createElement("button",Object.assign({"aria-label":d,className:i.default(s.toolbarButton,t,f),"data-test":u,disabled:l,onClick:this.onClick},m))))},t})(o.PureComponent);t.PreviewToolbarButton=l,l.defaultProps={disabled:!1,formatMessage:a.dummyFormatMessage,iconName:"fullscreen",id:"",onClick:function(){},tooltipText:""}}),define("file-viewer/toolbar/toolbar_controls",["require","exports","tslib","react","file-viewer/toolbar/toolbar_button"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var r=function(e){var t=e.className,r=e.disabled,a=e.formatMessage,s=e.onClick,l=n.__rest(e,["className","disabled","formatMessage","onClick"]);return i.createElement(o.PreviewToolbarButton,Object.assign({},l,{className:t,id:"fullscreen",disabled:r||!1,formatMessage:a,iconName:"fullscreen",onClick:s,tooltipText:a({id:"3r1su",defaultMessage:"Fullscreen"})}))};t.FullScreenButton=r;var a=function(e){var t=e.className,r=e.disabled,a=e.formatMessage,s=e.onClick,l=n.__rest(e,["className","disabled","formatMessage","onClick"]);return i.createElement(o.PreviewToolbarButton,Object.assign({},l,{className:t,disabled:r||!1,formatMessage:a,iconName:"pageDown",id:"page-down",onClick:s,tooltipText:a({id:"1crUg",defaultMessage:"Page down"})}))};t.PageDownButton=a;var s=function(e){var t=e.className,r=e.disabled,a=e.formatMessage,s=e.onClick,l=n.__rest(e,["className","disabled","formatMessage","onClick"]);return i.createElement(o.PreviewToolbarButton,Object.assign({},l,{className:t,disabled:r||!1,formatMessage:a,iconName:"pageUp",id:"page-up",onClick:s,tooltipText:a({id:"30U9L",defaultMessage:"Page up"})}))};t.PageUpButton=s;var l=function(e){var t=e.className,r=e.disabled,a=e.formatMessage,s=e.onClick,l=n.__rest(e,["className","disabled","formatMessage","onClick"]);return i.createElement(o.PreviewToolbarButton,Object.assign({},l,{className:t,disabled:r||!1,formatMessage:a,iconName:"zoomIn",id:"zoom-in",onClick:s,tooltipText:a({id:"yOZ5I",defaultMessage:"Zoom in"})}))};t.ZoomInButton=l;var c=function(e){var t=e.className,r=e.disabled,a=e.formatMessage,s=e.onClick,l=n.__rest(e,["className","disabled","formatMessage","onClick"]);return i.createElement(o.PreviewToolbarButton,Object.assign({},l,{className:t,disabled:r||!1,formatMessage:a,iconName:"zoomOut",id:"zoom-out",onClick:s,
tooltipText:a({id:"2dTGQ",defaultMessage:"Zoom out"})}))};t.ZoomOutButton=c}),define("file-viewer/toolbar/toolbar_flip_buttons",["require","exports","tslib","classnames","react","file-viewer/toolbar/toolbar_button"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importStar(o);var a={previewToolbarContainer:"_35Ij7yT3Fw",elevated:"OouqNZeGZl",previewToolbarOverlayContainer:"_3ZTICG-ip5",hide:"_1EYMNuP6H6",fadeout:"_18p4mhrs4N",previewToolbarOverlay:"_2VeuolpYsx",previewToolbarContent:"_23iY3-L6yK",toolbarButton:"_3MS_sSk8v2",previewToolbarContainerDesktop:"_1p8mJnfi0V",toolbarButtonWrapperDesktop:"ihogYuDhuE",toolbarButtonDesktop:"_1k72OJBfkI",arrowLeft:"_2ITlwxtTc0",arrowRight:"JfmmWYGWiP",fullscreen:"_1BXWzdKZcg",pageDown:"_1_6p5OEl7w",pageUp:"_3jVU5iQ-xK",sidebarHide:"_230L9B_VOu",sidebarShow:"_2Ht3Oh1zrp",zoomIn:"RkgEctpAaM",zoomOut:"_2P1wnPKDti",flipButtons:"_1Xy4vmCrmv",pageIndicator:"_2UCcY_L_ut",focus:"fFd_Ukn_Rn",pageInputWrapper:"_2lAAAHouQ7",pageInput:"_2XAzYxu3_c",withText:"_1OQ3or8fKn",pageIndicatorText:"_1f0fWYhQct",hidden:"_1uX-Yvcuyj",pageIndicatorDesktop:"o4F4ePgOMu",zoomToFitBtn:"BwAKgVnIAr",toolbarTooltip:"_2AS2IpIvyj"};t.ToolbarFlipButtons=function(e){var t=e.buttonClassName,n=e.className,s=e.count,l=e.formatMessage,c=e.index,u=e.onClickNext,d=e.onClickPrevious,p=l({id:"3A0DU",defaultMessage:"Previous"}),m=l({id:"1XG6i",defaultMessage:"Next"}),f=l({id:"1LWb5",defaultMessage:"{file_number} of {file_count}"},{file_number:c+1,file_count:s});return o.createElement("div",{className:i.default(n,a.flipButtons)},o.createElement(r.PreviewToolbarButton,{className:t,formatMessage:l,iconName:"arrowLeft",id:"preview-toolbar-flip-previous",tooltipText:p,onClick:d}),o.createElement("span",null,f),o.createElement(r.PreviewToolbarButton,{className:t,formatMessage:l,iconName:"arrowRight",id:"preview-toolbar-flip-next",tooltipText:m,onClick:u}))}}),define("file-viewer/toolbar/toolbar_page_indicator",["require","exports","tslib","react","classnames","external/lodash","spectrum/tooltip"],function(e,t,n,i,o,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),o=n.__importDefault(o);var s={previewToolbarContainer:"_35Ij7yT3Fw",elevated:"OouqNZeGZl",previewToolbarOverlayContainer:"_3ZTICG-ip5",hide:"_1EYMNuP6H6",fadeout:"_18p4mhrs4N",previewToolbarOverlay:"_2VeuolpYsx",previewToolbarContent:"_23iY3-L6yK",toolbarButton:"_3MS_sSk8v2",previewToolbarContainerDesktop:"_1p8mJnfi0V",toolbarButtonWrapperDesktop:"ihogYuDhuE",toolbarButtonDesktop:"_1k72OJBfkI",arrowLeft:"_2ITlwxtTc0",arrowRight:"JfmmWYGWiP",fullscreen:"_1BXWzdKZcg",pageDown:"_1_6p5OEl7w",pageUp:"_3jVU5iQ-xK",sidebarHide:"_230L9B_VOu",sidebarShow:"_2Ht3Oh1zrp",zoomIn:"RkgEctpAaM",zoomOut:"_2P1wnPKDti",flipButtons:"_1Xy4vmCrmv",pageIndicator:"_2UCcY_L_ut",focus:"fFd_Ukn_Rn",pageInputWrapper:"_2lAAAHouQ7",pageInput:"_2XAzYxu3_c",withText:"_1OQ3or8fKn",pageIndicatorText:"_1f0fWYhQct",hidden:"_1uX-Yvcuyj",pageIndicatorDesktop:"o4F4ePgOMu",zoomToFitBtn:"BwAKgVnIAr",toolbarTooltip:"_2AS2IpIvyj"};t.PAGE_UPDATE_DEBOUNCE=300;var l=(function(e){function l(n){var i=e.call(this,n)||this;return i.textInput=null,i.textInputRef=function(e){return i.textInput=e},i.handleBlur=function(e){i.setState({focused:!1,isEditing:!1}),i.props.onBlur&&i.props.onBlur(e)},i.debouncedOnChange=r.debounce(i.props.onPageNumberUpdated,t.PAGE_UPDATE_DEBOUNCE),i.handleChange=function(e){var t=e.target.value,n=i.parsePageNumber(t);if(!n)return void i.setState({value:""},i.debouncedOnChange.cancel);i.isPageNumberInRange(n)&&i.setState({value:n},function(){i.debouncedOnChange(n-1)})},i.handleFocus=function(e){i.setState({focused:!0,isEditing:!0,value:""}),i.props.onFocus&&i.props.onFocus(e)},i.handleSubmit=function(e){e.preventDefault();var t=i.state.value,n=i.parsePageNumber(t);n&&i.isPageNumberInRange(n)&&i.debouncedOnChange(n-1),i.textInput&&i.textInput.blur()},i.handleWrapperClick=function(){i.setState({isEditing:!0},function(){i.textInput&&i.textInput.focus()})},i.parsePageNumber=function(e){if(!e||""===e)return null;var t=parseInt(e,10);return isNaN(t)?null:t},i.isPageNumberInRange=function(e){var t=i.props,n=t.currentPageIndex,o=t.pageCount;return!(void 0===n||!o)&&(e>0&&e<=o)},i.state={focused:!1,isEditing:!1,value:n.currentPageIndex+1||""},i}return n.__extends(l,e),l.prototype.render=function(){var e,t,n,r,l=this.props,c=l.className,u=l.disabled,d=l.formatMessage,p=l.id,m=l.pageCount,f=l.shouldShowPageCount,h=this.state,_=h.focused,v=h.isEditing,g=h.value,y=m&&f?" / "+m+" ":"",b=d({id:"3Dloj",defaultMessage:"Page..."}),w=d({id:"Z4LHJ",defaultMessage:"Click to jump to a page"});return i.createElement("div",{className:o.default(c,s.pageIndicator,(e={},e[s.focus]=_,e)),onClick:this.handleWrapperClick,style:{marginLeft:0,marginRight:0}},i.createElement(a.Tooltip,{positionOffset:24,positioning:"above",tooltipContent:w},i.createElement("div",null,i.createElement("form",{className:s.pageInputWrapper,onSubmit:this.handleSubmit},i.createElement("label",{"aria-label":w,htmlFor:p},i.createElement("input",{autoComplete:"off",className:o.default(s.pageInput,(t={},t[s.focus]=_,t[s.hidden]=!v,t[s.withText]=!!g&&_,t)),disabled:u,id:p,onBlur:this.handleBlur,onChange:this.handleChange,onFocus:this.handleFocus,placeholder:b,ref:this.textInputRef,type:"text",value:g}))),i.createElement("span",{className:o.default(s.pageIndicatorText,(n={},n[s.hidden]=v,n))},this.props.currentPageIndex+1),i.createElement("span",{className:o.default((r={},r[s.hidden]=!g&&_,r))},y))))},l.prototype.componentWillReceiveProps=function(e){e.currentPageIndex!==this.props.currentPageIndex&&(this.debouncedOnChange.cancel(),this.setState({value:e.currentPageIndex+1}))},l})(i.PureComponent);t.PageIndicator=l}),define("file-viewer/toolbar/zoom_to_fit_button",["require","exports","tslib","react","classnames","spectrum/tooltip"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),o=n.__importDefault(o);var a={previewToolbarContainer:"_35Ij7yT3Fw",elevated:"OouqNZeGZl",previewToolbarOverlayContainer:"_3ZTICG-ip5",hide:"_1EYMNuP6H6",fadeout:"_18p4mhrs4N",previewToolbarOverlay:"_2VeuolpYsx",previewToolbarContent:"_23iY3-L6yK",toolbarButton:"_3MS_sSk8v2",previewToolbarContainerDesktop:"_1p8mJnfi0V",toolbarButtonWrapperDesktop:"ihogYuDhuE",toolbarButtonDesktop:"_1k72OJBfkI",arrowLeft:"_2ITlwxtTc0",arrowRight:"JfmmWYGWiP",fullscreen:"_1BXWzdKZcg",pageDown:"_1_6p5OEl7w",pageUp:"_3jVU5iQ-xK",sidebarHide:"_230L9B_VOu",sidebarShow:"_2Ht3Oh1zrp",zoomIn:"RkgEctpAaM",zoomOut:"_2P1wnPKDti",flipButtons:"_1Xy4vmCrmv",pageIndicator:"_2UCcY_L_ut",focus:"fFd_Ukn_Rn",pageInputWrapper:"_2lAAAHouQ7",pageInput:"_2XAzYxu3_c",withText:"_1OQ3or8fKn",pageIndicatorText:"_1f0fWYhQct",hidden:"_1uX-Yvcuyj",pageIndicatorDesktop:"o4F4ePgOMu",zoomToFitBtn:"BwAKgVnIAr",toolbarTooltip:"_2AS2IpIvyj"},s=(function(e){function t(){var t=e.apply(this,arguments)||this;return t.handleClick=function(e){t.props.onClick(e)},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,n=e.className,s=e.formatMessage,l=e.formatNumber,c=e.zoomPercent,u=s(c&&1===c?{id:"1BXqX",defaultMessage:"Zoom to fit"}:{id:"2iKGa",defaultMessage:"View actual size"});return i.createElement(r.Tooltip,{positionOffset:24,positioning:"above",tooltipContent:u},i.createElement("button",{"aria-label":u,className:o.default(n,a.toolbarButton,a.zoomToFitBtn),onClick:this.handleClick},t.getFormattedZoomPercentage(c,l)))},t})(i.PureComponent);t.ZoomToFitButton=s,s.getFormattedZoomPercentage=function(e,t){return e?t(Math.round(100*e)):""}}),define("url-polyfill",["require","exports"],function(e,t){"use strict";(function(e){var t=function(){try{return!!Symbol.iterator}catch(e){return!1}},n=t(),i=function(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t},o=function(e){return encodeURIComponent(e).replace(/%20/g,"+")},r=function(e){return decodeURIComponent(e).replace(/\+/g," ")},a=function(){var t=function(e){Object.defineProperty(this,"_entries",{writable:!0,value:{}});var n=typeof e;if("undefined"===n);else if("string"===n)""!==e&&this._fromString(e);else if(e instanceof t){var i=this;e.forEach(function(e,t){i.append(t,e)})}else{if(null===e||"object"!==n)throw new TypeError("Unsupported input's type for URLSearchParams");if("[object Array]"===Object.prototype.toString.call(e))for(var o=0;o<e.length;o++){var r=e[o];if("[object Array]"!==Object.prototype.toString.call(r)&&2===r.length)throw new TypeError("Expected [string, any] as entry at index "+o+" of URLSearchParams's input");this.append(r[0],r[1])}else for(var a in e)e.hasOwnProperty(a)&&this.append(a,e[a])}},r=t.prototype;r.append=function(e,t){e in this._entries?this._entries[e].push(String(t)):this._entries[e]=[String(t)]},r.delete=function(e){delete this._entries[e]},r.get=function(e){return e in this._entries?this._entries[e][0]:null},r.getAll=function(e){return e in this._entries?this._entries[e].slice(0):[]},r.has=function(e){return e in this._entries},r.set=function(e,t){this._entries[e]=[String(t)]},r.forEach=function(e,t){var n;for(var i in this._entries)if(this._entries.hasOwnProperty(i)){n=this._entries[i];for(var o=0;o<n.length;o++)e.call(t,n[o],i,this)}},r.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),i(e)},r.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),i(e)},r.entries=function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),i(e)},n&&(r[Symbol.iterator]=r.entries),r.toString=function(){var e=[];return this.forEach(function(t,n){e.push(o(n)+"="+o(t))}),e.join("&")},e.URLSearchParams=t};"URLSearchParams"in e&&"a=1"===new URLSearchParams("?a=1").toString()||a();var s=URLSearchParams.prototype;"function"!=typeof s.sort&&(s.sort=function(){var e=this,t=[];this.forEach(function(n,i){t.push([i,n]),e._entries||e.delete(i)}),t.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}),e._entries&&(e._entries={});for(var n=0;n<t.length;n++)this.append(t[n][0],t[n][1])}),"function"!=typeof s._fromString&&Object.defineProperty(s,"_fromString",{enumerable:!1,configurable:!1,writable:!1,value:function(e){if(this._entries)this._entries={};else{var t=[];this.forEach(function(e,n){t.push(n)});for(var n=0;n<t.length;n++)this.delete(t[n])}e=e.replace(/^\?/,"");for(var i,o=e.split("&"),n=0;n<o.length;n++)i=o[n].split("="),this.append(r(i[0]),i.length>1?r(i[1]):"")}})})("undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this),(function(e){var t=function(){try{var e=new URL("b","http://a");return e.pathname="c%20d","http://a/c%20d"===e.href&&e.searchParams}catch(e){return!1}},n=function(){var t=e.URL,n=function(t,n){"string"!=typeof t&&(t=String(t));var i,o=document;if(n&&(void 0===e.location||n!==e.location.href)){o=document.implementation.createHTMLDocument(""),i=o.createElement("base"),i.href=n,o.head.appendChild(i);try{if(0!==i.href.indexOf(n))throw new Error(i.href)}catch(e){throw new Error("URL unable to set base "+n+" due to "+e)}}var r=o.createElement("a");if(r.href=t,i&&(o.body.appendChild(r),r.href=r.href),":"===r.protocol||!/:/.test(r.href))throw new TypeError("Invalid URL");Object.defineProperty(this,"_anchorElement",{value:r});var a=new URLSearchParams(this.search),s=!0,l=!0,c=this;["append","delete","set"].forEach(function(e){var t=a[e];a[e]=function(){t.apply(a,arguments),s&&(l=!1,c.search=a.toString(),l=!0)}}),Object.defineProperty(this,"searchParams",{value:a,enumerable:!0});var u=void 0;Object.defineProperty(this,"_updateSearchParams",{enumerable:!1,configurable:!1,writable:!1,value:function(){this.search!==u&&(u=this.search,l&&(s=!1,this.searchParams._fromString(this.search),s=!0))}})},i=n.prototype,o=function(e){Object.defineProperty(i,e,{get:function(){return this._anchorElement[e]},set:function(t){this._anchorElement[e]=t},enumerable:!0})};["hash","host","hostname","port","protocol"].forEach(function(e){o(e)}),Object.defineProperty(i,"search",{get:function(){return this._anchorElement.search},set:function(e){this._anchorElement.search=e,this._updateSearchParams()},enumerable:!0}),Object.defineProperties(i,{toString:{get:function(){var e=this;return function(){return e.href}}},href:{get:function(){return this._anchorElement.href.replace(/\?$/,"")},set:function(e){this._anchorElement.href=e,this._updateSearchParams()},enumerable:!0},pathname:{get:function(){return this._anchorElement.pathname.replace(/(^\/?)/,"/")},set:function(e){this._anchorElement.pathname=e},enumerable:!0},origin:{get:function(){var e={"http:":80,"https:":443,"ftp:":21}[this._anchorElement.protocol],t=this._anchorElement.port!=e&&""!==this._anchorElement.port;return this._anchorElement.protocol+"//"+this._anchorElement.hostname+(t?":"+this._anchorElement.port:"")},enumerable:!0},password:{get:function(){return""},set:function(e){},enumerable:!0},username:{get:function(){return""},set:function(e){},enumerable:!0}}),n.createObjectURL=function(e){return t.createObjectURL.apply(t,arguments)},n.revokeObjectURL=function(e){return t.revokeObjectURL.apply(t,arguments)},e.URL=n};if(t()||n(),void 0!==e.location&&!("origin"in e.location)){var i=function(){return e.location.protocol+"//"+e.location.hostname+(e.location.port?":"+e.location.port:"")};try{Object.defineProperty(e.location,"origin",{get:i,enumerable:!0})}catch(t){setInterval(function(){e.location.origin=i()},100)}}})("undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this)}),define("modules/clean/activity/activity_user",["require","exports","tslib","modules/core/i18n","modules/core/user_i18n","modules/clean/em_string"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var a=(function(){function e(e){var t=void 0===e?{}:e,n=t.id,i=void 0===n?null:n,o=t.fname,r=void 0===o?null:o,a=t.lname,s=void 0===a?null:a,l=t.display_name,c=void 0===l?null:l,u=t.email,d=void 0===u?null:u,p=t.photo_url,m=void 0===p?null:p,f=t.photo_circle_url,h=void 0===f?null:f,_=t.initials,v=void 0===_?null:_,g=t.is_email_verified,y=void 0!==g&&g,b=t.is_signed_in,w=void 0!==b&&b;this.id=i,this.fname=r,this.lname=s,this.display_name=c,this.email=d,this.photo_url=m,this.photo_circle_url=h,this.initials=v,this.is_email_verified=y,this.is_signed_in=w}return e.fromDict=function(t){return new e(n.__assign({},t,{initials:o.getInitials(t.display_name||""),is_signed_in:!!t.id}))},e.fromUser=function(t){return new e(n.__assign({},t,{initials:o.getInitials(t.display_name||""),is_signed_in:!0}))},e.fromEmail=function(t){return new e({email:t})},Object.defineProperty(e,"anonymous",{get:function(){return e.__anonymous},enumerable:!0,configurable:!0}),e.prototype.getDisplayIdentity=function(){return null!=this.display_name?r.Emstring.em_snippet(this.display_name,22):null!=this.email?r.Emstring.em_snippet(this.email,22):i._("Anonymous user")},e.__anonymous=new e,e})();t.ActivityUser=a}),define("modules/clean/activity/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.SHARED_LINK_VIEW=1]="SHARED_LINK_VIEW",e[e.BROWSE_FILE_VIEWER=3]="BROWSE_FILE_VIEWER",e[e.SHARED_CONTENT_LINK_VIEW=7]="SHARED_CONTENT_LINK_VIEW"})(t.ActivityContext||(t.ActivityContext={}))}),define("modules/clean/annotations/annotation",["require","exports"],function(e,t){"use strict";function n(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0});var i={MARKER:0,HIGHLIGHT:1,REGION:2};t.AnnotationTypes=i;var o={MARKER:{CIRCLE:0},REGION:{RECTANGLE:0},HIGHLIGHT:{HIGHLIGHT:0}};t.AnnotationSubtypes=o;var r=(function(){function e(e,t,n){void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null),this.type=e,this.subtype=t,this.pdf_coordinates=null,this.image_coordinates=null,this.text_highlight=null,this.viewportCoordinates=[],this.BUBBLE_WIDTH=320,this.annotationSize=n}return e.createAnnotationFromDict=function(t){var n=new e;return n.revision=t.revision,n.zoom=t.zoom,n.type=t.type,n.subtype=t.subtype,n.pdf_coordinates=t.pdf_coordinates,n.image_coordinates=t.image_coordinates,n.text_highlight=t.text_highlight,n.viewportCoordinates=null!=t.viewportCoordinates?t.viewportCoordinates:[],n.thumbnail_url=t.thumbnail_url,n.annotationSize=28,n},e.prototype.toMetadataDict=function(){var e={type:this.type,subtype:this.subtype};return this.pdf_coordinates?e.pdf_coordinates=this.pdf_coordinates:this.image_coordinates&&(e.image_coordinates=this.image_coordinates),this.type===i.HIGHLIGHT&&(e.text_highlight=this.text_highlight),e},e.getCenterPosition=function(e){return{x:(e.left+e.right)/2,y:(e.top+e.bottom)/2}},e.prototype.getBoundingBox=function(){switch(this.type){case i.MARKER:var e=this.getFirstViewportCoordinates();return{top:e.y-this.annotationSize/2,right:e.x+this.annotationSize/2,bottom:e.y+this.annotationSize/2,left:e.x-this.annotationSize/2};case i.HIGHLIGHT:return this._getViewportBoundingRectangle();case i.REGION:return this._getViewportBoundingRectangle()}},e.prototype.getClampedBoundingBox=function(e,t,n,i){void 0===n&&(n=0),void 0===i&&(i=0);var o=this.getBoundingBox();return o.left=o.left-n,o.right=o.right-n,o.top=o.top-i,o.bottom=o.bottom-i,o.top=Math.min(Math.max(o.top,0),t-1),o.right=Math.min(Math.max(o.right,0),e-1),o.bottom=Math.min(Math.max(o.bottom,0),t-1),o.left=Math.min(Math.max(o.left,0),e-1),o},e.prototype._getViewportBoundingRectangle=function(){for(var e,t,n=e=this.getFirstViewportCoordinates().x,i=t=this.getFirstViewportCoordinates().y,o=0,r=Array.from(this.viewportCoordinates);o<r.length;o++)for(var a=r[o],s=0,l=Array.from(a);s<l.length;s++){var c=l[s];n=Math.min(n,c.x),e=Math.max(e,c.x),i=Math.min(i,c.y),t=Math.max(t,c.y)}return{top:i,right:e,bottom:t,left:n}},e.prototype.isPdfAnnotation=function(){return null!=this.pdf_coordinates},e.prototype.isImageAnnotation=function(){return null!=this.image_coordinates},e.prototype.getFirstCoordindates=function(){return this.isPdfAnnotation()?this.getFirstPdfCoordinates():this.isImageAnnotation()?this.getFirstImageCoordinates():void 0},e.prototype.getFirstViewportCoordinates=function(){return this.viewportCoordinates[0][0]},e.prototype.getFirstImageCoordinates=function(){return n(null!=this.image_coordinates?this.image_coordinates[0].coordinates:void 0,function(e){return e[0]})},e.prototype.getFirstPdfCoordinates=function(){return this.isOldCoordinatesFormat()?this.pdf_coordinates:null!=this.pdf_coordinates[0].coordinates?this.pdf_coordinates[0].coordinates[0]:void 0},e.prototype.getFirstPdfPage=function(){return this.isOldCoordinatesFormat()?null!=this.pdf_coordinates?this.pdf_coordinates.page:void 0:this.pdf_coordinates[0].page},e.prototype.isOldCoordinatesFormat=function(){return!(null!=this.pdf_coordinates&&null!=this.pdf_coordinates[0])},e.prototype.getSize=function(){return this.type===i.MARKER?this.annotationSize:null},e})();t.Annotation=r}),define("modules/clean/annotations/annotation_controller",["require","exports","tslib","react","external/react-dom","external/lodash","jquery","modules/clean/annotations/annotation","modules/clean/annotations/annotation_highlight","modules/clean/annotations/annotation_marker","modules/clean/annotations/annotation_region"],function(e,t,n,i,o,r,a,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importStar(o),r=n.__importStar(r),a=n.__importDefault(a),l=n.__importDefault(l),c=n.__importDefault(c),u=n.__importStar(u);var d=(function(e){function t(t){var n=e.call(this,t)||this;return n.onRefAnnotation=function(e){return n.activeAnnotation=e},n.allowAnnotationTypeSwitch=!0,n.isMouseDown=!1,n.positionAtLastMouseDown={x:0,y:0},n.onHideAnnotation=function(){return null!=n.activeAnnotation?n.activeAnnotation.hideAnnotation():void 0},n.onMouseDownCallback=function(e){if(!n.isMouseDown)if(n.isMouseDown=!0,n.positionAtLastMouseDown={x:e.pageX,y:e.pageY},n.allowAnnotationTypeSwitch){if(!n.isOnRegion(e)&&n.isOnText(e)){var t=s.AnnotationTypes.HIGHLIGHT;n.trySetActiveAnnotationType(t,function(){n.activeAnnotation&&n.activeAnnotation.onMouseDownCallback(e)})}}else n.activeAnnotation&&n.activeAnnotation.onMouseDownCallback(e)},n.onMouseMoveCallback=function(e){if(n.isMouseDown){null===n.state.activeAnnotationType&&n.props.isAnnotationCreationEnabled&&n.deselectAllText();var t=function(){n.activeAnnotation&&n.activeAnnotation.onMouseMoveCallback(e)};if(n.allowAnnotationTypeSwitch){var i=n.state.activeAnnotationType;n.isMouseDown&&null===i&&(n.props.onAnnotationRegionStart&&n.props.onAnnotationRegionStart(),i=s.AnnotationTypes.REGION),n.trySetActiveAnnotationType(i,t)}else t()}},n.onMouseUpCallback=function(e){if(n.isMouseDown){if(n.isMouseDown=!1,!n.allowAnnotationTypeSwitch)return void(n.activeAnnotation&&n.activeAnnotation.onMouseUpCallback(e));var t=n.state.activeAnnotationType;if(!t)return void(n.isAnnotationTypeCreationEnabled(s.AnnotationTypes.MARKER)?t=s.AnnotationTypes.MARKER:n.isAnnotationTypeCreationEnabled(s.AnnotationTypes.REGION)&&(n.props.disableTinyAnnotationRegions?n.onHideAnnotation():n.trySetActiveAnnotationType(s.AnnotationTypes.REGION,function(){n.activeAnnotation.createDefaultRegion&&n.activeAnnotation.createDefaultRegion(e)})));if(t===s.AnnotationTypes.REGION){var i={x:e.pageX,y:e.pageY},o=i.x-n.positionAtLastMouseDown.x,r=i.y-n.positionAtLastMouseDown.y;if(u.regionIsTiny(o,r))if(n.isAnnotationTypeCreationEnabled(s.AnnotationTypes.MARKER))t=s.AnnotationTypes.MARKER;else if(n.props.disableTinyAnnotationRegions)return void n.onHideAnnotation()}n.trySetActiveAnnotationType(t,function(){n.activeAnnotation&&n.activeAnnotation.onMouseUpCallback(e)})}},n.onMouseEnterCallback=function(e){1&e.buttons||!n.isMouseDown||n.onMouseUpCallback(e)},n.onScrollCallback=function(e){null!=n.activeAnnotation&&n.activeAnnotation.onScrollCallback(e)},n.onScaleChangeCallback=function(e){null!=n.activeAnnotation&&n.activeAnnotation.onScaleChangeCallback(e)},n.onAnnotationHiddenCallback=function(){n.setState({activeAnnotationType:null}),n.setAllowAnnotationTypeSwitch(),n.props.onAnnotationHiddenCallback&&n.props.onAnnotationHiddenCallback()},n.onAnnotationPlacedCallback=function(e){n.disallowAnnotationTypeSwitch(),n.props.onAnnotationPlacedCallback&&n.props.onAnnotationPlacedCallback(e)},n.onAnnotationStartDragCallback=function(e){n.props.onAnnotationStartDragCallback&&n.props.onAnnotationStartDragCallback(e)},n.onAnnotationEndDragCallback=function(e){n.props.onAnnotationEndDragCallback&&n.props.onAnnotationEndDragCallback(e)},n.onAnnotationScrollCallback=function(e){n.props.onAnnotationScrollCallback&&n.props.onAnnotationScrollCallback(e)},n.onAnnotationScaleChangeCallback=function(e){n.props.onAnnotationScaleChangeCallback&&n.props.onAnnotationScaleChangeCallback(e)},n.onAnnotationEnterCallback=function(e){n.props.onAnnotationEnterCallback&&n.props.onAnnotationEnterCallback(e)},n.onAnnotationLeaveCallback=function(e){n.props.onAnnotationLeaveCallback&&n.props.onAnnotationLeaveCallback(e)},n.state=n.getInitialState(),n}return n.__extends(t,e),t.prototype.getInitialState=function(){return{activeAnnotationType:null}},t.prototype.hasVisibleActiveAnnotation=function(){return null!=this.activeAnnotation},t.prototype.createRegion=function(e){var t=this,n=s.AnnotationTypes.REGION;this.isAnnotationTypeCreationEnabled(n)&&this.trySetActiveAnnotationType(n,function(){null!=t.activeAnnotation&&t.activeAnnotation.createRegion(e)})},t.prototype.componentDidMount=function(){var e=this.props.controllerEventHandlers;e&&(e.onHideAnnotation=this.onHideAnnotation,e.onMouseMoveCallback=this.onMouseMoveCallback,e.onMouseDownCallback=this.onMouseDownCallback,e.onMouseUpCallback=this.onMouseUpCallback,e.onMouseEnterCallback=this.onMouseEnterCallback,e.onScrollCallback=this.onScrollCallback,e.onScaleChangeCallback=this.onScaleChangeCallback)},t.prototype.componentWillReceiveProps=function(e){var t=e.controllerEventHandlers;t&&(t.onHideAnnotation=this.onHideAnnotation,t.onMouseMoveCallback=this.onMouseMoveCallback,t.onMouseDownCallback=this.onMouseDownCallback,t.onMouseUpCallback=this.onMouseUpCallback,t.onMouseEnterCallback=this.onMouseEnterCallback,t.onScrollCallback=this.onScrollCallback,t.onScaleChangeCallback=this.onScaleChangeCallback)},t.prototype.componentDidUpdate=function(e){var t=e.draftAnnotationVersion,n=this.props.draftAnnotationVersion;n&&t&&n>t&&(this.setAllowAnnotationTypeSwitch(),this.setState(this.getInitialState()))},t.prototype.setAllowAnnotationTypeSwitch=function(){this.allowAnnotationTypeSwitch=!0},t.prototype.disallowAnnotationTypeSwitch=function(){this.allowAnnotationTypeSwitch=!1},t.prototype.trySetActiveAnnotationType=function(e,t){return e!==this.state.activeAnnotationType&&this.isAnnotationTypeCreationEnabled(e)?(this.setState({activeAnnotationType:e},t),!0):(t&&t(),!1)},t.prototype.isOnRegion=function(e){var t=o.findDOMNode(this.activeAnnotation);return null!=t&&(e.target===t||a.default.contains(t,e.target))},t.prototype.isAnnotationTypeCreationEnabled=function(e){if(!this.props.isAnnotationCreationEnabled)return!1;switch(e){case s.AnnotationTypes.MARKER:return this.props.isAnnotationMarkerEnabled;case s.AnnotationTypes.HIGHLIGHT:return this.props.isAnnotationHighlightEnabled;case s.AnnotationTypes.REGION:return this.props.isAnnotationRegionEnabled;default:return!1}},t.prototype.isOnText=function(e){var t,n=a.default(e.target),i=n.contents(),o=(null!=(t=n.css("cursor"))?t:"").split(",");if(o=o[o.length-1].trim(),"text"===o||"vertical-text"===o||n.is("a")&&0===i.length)return!0;if("auto"!==o)return!1;for(var r=!1,s=0,l=Array.from(i);s<l.length;s++){l[s].nodeType===Node.TEXT_NODE&&(r=!0)}return r},t.prototype.deselectAllText=function(){window.getSelection().removeAllRanges()},t.prototype.renderActiveAnnotation=function(){if(null!=this.state.activeAnnotationType&&this.isAnnotationTypeCreationEnabled(this.state.activeAnnotationType))switch(this.state.activeAnnotationType){case s.AnnotationTypes.MARKER:return i.default.createElement(c.default,{ref:this.onRefAnnotation,parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback});case s.AnnotationTypes.HIGHLIGHT:return i.default.createElement(l.default,{ref:this.onRefAnnotation,parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback});case s.AnnotationTypes.REGION:return i.default.createElement(u.default,n.__assign({ref:this.onRefAnnotation},r.pick(this.props,"creationLayerWidth","creationLayerHeight","disableTinyAnnotationRegions","parentContainerOffset"),{onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback}))}return null},t.prototype.render=function(){return i.default.createElement("div",{className:"ephemeral-annotation-container"},this.renderActiveAnnotation())},t.displayName="AnnotationController",t.defaultProps={parentContainerOffset:{left:0,top:0}},t})(i.default.Component);t.default=d}),define("modules/clean/annotations/annotation_highlight",["require","exports","tslib","react","external/react-dom-factories","external/prop-types","jquery","modules/clean/annotations/annotation"],function(e,t,n,i,o,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importStar(o),r=n.__importStar(r),a=n.__importDefault(a);var l=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isShown:!1},t.hideAnnotation=function(){return t._hideAnnotation()},t._updateViewportBoundaries=function(){var e=window.getSelection();if(e.rangeCount>0){var n=void 0;n=t._isBrowserIE()?t._extractViewportClientRectanglesIEHack(e.getRangeAt(0)):t._extractViewportClientRectangles(e.getRangeAt(0));var i=t._consolidateClientRectangles(n);return t._setViewportCoordinatesFromRectangles(i)}},t._extractViewportClientRectangles=function(e){for(var t=[],n=e.endContainer,i=e.endOffset,o=e.cloneRange();n!==e.commonAncestorContainer;)o.setStart(n,0),o.setEnd(n,i),Array.prototype.push.apply(t,o.getClientRects()),i=Array.prototype.indexOf.call(n.parentNode.childNodes,n),n=n.parentNode;return o=e.cloneRange(),o.setEnd(n,i),Array.prototype.push.apply(t,o.getClientRects()),t},t._extractViewportClientRectanglesIEHack=function(e){if("canvasWrapper"===e.startContainer.className&&e.setStart(e.startContainer.nextSibling.children[0].childNodes[0],0),e.startContainer===e.commonAncestorContainer)return e.getClientRects();var t=[],n=e.cloneRange();n.setEnd(e.startContainer,e.startContainer.length),Array.prototype.push.apply(t,n.getClientRects());for(var i=e.startContainer.parentNode.nextSibling;i!==e.endContainer.parentNode;)Array.prototype.push.apply(t,i.getClientRects()),i=i.nextSibling;return n.setStart(e.endContainer,0),n.setEnd(e.endContainer,e.endOffset),Array.prototype.push.apply(t,n.getClientRects()),t},t._isBrowserIE=function(){var e=window.navigator.userAgent,t=e.indexOf("Trident/"),n=e.indexOf("Edge/");return t>0||n>0},t._consolidateClientRectangles=function(e){for(var n=[],i=0,o=Array.from(e);i<o.length;i++){var r=o[i];if(0!==r.width&&0!==r.height){if(n.length>0){var a=n[n.length-1];if(t._isWithinConsolidationVerticalBuffer(a,r)&&t._isWithinConsolidationHorizontalBuffer(a,r)){var s=t._calculateBoundingBox(a,r);a.top=s.top,a.right=s.right,a.bottom=s.bottom,a.left=s.left;continue}}n.push({top:r.top,right:r.right,bottom:r.bottom,left:r.left})}}return n},t._isWithinConsolidationVerticalBuffer=function(e,n){return Math.abs(e.top-n.top)<t.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER&&Math.abs(e.bottom-n.bottom)<t.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER},t._isWithinConsolidationHorizontalBuffer=function(e,n){var i=t._calculateBoundingBox(e,n);return i.right-i.left-(n.width+(e.right-e.left))<t.CONSOLIDATE_RECTANGLE_HORIZONTAL_BUFFER},t._calculateBoundingBox=function(e,t){return{top:Math.min(e.top,t.top),right:Math.max(e.right,t.right),bottom:Math.max(e.bottom,t.bottom),left:Math.min(e.left,t.left)}},t._setViewportCoordinatesFromRectangles=function(e){var n=t.annotation.viewportCoordinates,i=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,o=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;if(e=Array.from(e),0!==e.length){var r=e.map(function(e){return[{x:e.left+i,y:e.top+o},{x:e.right+i,y:e.bottom+o}]});n.splice.apply(n,[0,n.length].concat(r))}},t._getPositionRelativeToParentContainer=function(e){return{x:e.x-t.props.parentContainerOffset.left,y:e.y-t.props.parentContainerOffset.top}},t._updateHighlightedText=function(){return t.annotation.text_highlight={snippet_before:t._getTextBeforeHighlight(),
text:t._getHighlightedText(),snippet_after:t._getTextAfterHighlight()}},t._generateAnnotation=function(){return t.annotation=new s.Annotation(t.type,t.subtype),t._updateViewportBoundaries(),t._updateHighlightedText()},t._hideAnnotation=function(){return t._isBrowserIE()&&t.state.isShown&&t.setState({isShown:!1,viewportCoordinates:null}),t.annotation=null,t.props.onAnnotationHiddenCallback()},t._updateViewportCoordinatesFromUI=function(){if(t.state.isShown){for(var e=[],n=t.annotation.viewportCoordinates,i=0,o=Array.from(a.default(".annotation-highlight"));i<o.length;i++){var r=o[i],s=[],l=a.default(r),c=l.offset();s.push({x:c.left,y:c.top}),s.push({x:c.left+l.width(),y:c.top+l.height()}),e.push(s)}n.splice.apply(n,[0,n.length].concat(e))}},t._getHighlightedText=function(){var e=window.getSelection().toString().trim();return e=e.replace(/\s+/g," ")},t._getTextBeforeHighlight=function(){return""},t._getTextAfterHighlight=function(){return""},t._isTextSelected=function(){return""!==t._getHighlightedText()},t.onMouseDownCallback=function(e){return{}},t.onMouseMoveCallback=function(e){return{}},t.onMouseUpCallback=function(e){return setTimeout(function(){if(!t._isTextSelected())return t._hideAnnotation();if(t._generateAnnotation(),t.props.onAnnotationPlacedCallback(t.annotation),t._isBrowserIE()){for(var e=[],n=0,i=Array.from(t.annotation.viewportCoordinates);n<i.length;n++){var o=i[n],r=[],a=t._getPositionRelativeToParentContainer(o[0]),s=t._getPositionRelativeToParentContainer(o[1]);r.push({x:a.x,y:a.y}),r.push({x:s.x,y:s.y}),e.push(r)}return t.setState({isShown:!0,viewportCoordinates:e})}},0)},t.onScrollCallback=function(){if(null!=t.annotation)return t._isBrowserIE()?t._updateViewportCoordinatesFromUI():t._updateViewportBoundaries(),"function"==typeof t.props.onAnnotationScrollCallback?t.props.onAnnotationScrollCallback(t.annotation):void 0},t.onScaleChangeCallback=function(){if(null!=t.annotation)return t._updateViewportBoundaries(),"function"==typeof t.props.onAnnotationScaleChangeCallback?t.props.onAnnotationScaleChangeCallback(t.annotation):void 0},t._onMarkerMouseDown=function(e){return{}},t._onMarkerMouseOver=function(e){return{}},t._onMarkerMouseUp=function(e){return{}},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){return this.type=s.AnnotationTypes.HIGHLIGHT,this.subtype=s.AnnotationSubtypes.HIGHLIGHT.HIGHLIGHT,this.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER=8,this.CONSOLIDATE_RECTANGLE_HORIZONTAL_BUFFER=30},t.prototype.render=function(){var e=this;return o.div({className:"annotation-highlight-container",ref:"highlightContainer"},(function(){if(e.state.isShown){for(var t=[],n=0,i=Array.from(e.state.viewportCoordinates);n<i.length;n++){var r=i[n],a=r[0].x,s=r[0].y,l=r[1].x,c=r[1].y,u={left:a,top:s,width:l-a,height:c-s};t.push(o.div({className:"annotation-highlight",style:u}))}return t}})())},t.displayName="AnnotationHighlight",t.propTypes={onAnnotationPlacedCallback:r.func,onAnnotationHiddenCallback:r.func,onAnnotationStartDragCallback:r.func,onAnnotationEndDragCallback:r.func,onAnnotationOverCallback:r.func,onAnnotationScrollCallback:r.func,onAnnotationScaleChangeCallback:r.func,onAnnotationEnterCallback:r.func,onAnnotationLeaveCallback:r.func,parentContainerOffset:r.object},t.defaultProps={parentContainerOffset:{left:0,top:0}},t})(i.default.Component);t.default=l}),define("modules/clean/annotations/annotation_highlight_ui",["require","exports","tslib","external/classnames","react","external/react-dom","external/react-dom-factories","jquery","modules/clean/annotations/annotation"],function(e,t,n,i,o,r,a,s,l){"use strict";function c(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importDefault(o),r=n.__importStar(r),a=n.__importStar(a),s=n.__importDefault(s);var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isHover:!1},t._isGhostAnnotation=function(){return t.props.options.isGhostAnnotation||!1},t.onHighlightClick=function(e){t.props.onAnnotationClickCallback&&t.props.onAnnotationClickCallback({commentActivity:t.props.commentActivity},e)},t.onHighlightMouseEnter=function(e){return t.setState({isHover:!0}),clearTimeout(t.mouseLeaveTimeout),t._updateViewportCoordinates(),"function"==typeof t.props.onAnnotationEnterCallback?t.props.onAnnotationEnterCallback({annotation:t.annotation,commentActivity:t.props.commentActivity}):void 0},t.onHighlightMouseLeave=function(e){t.props.onAnnotationLeaveCallback&&t.props.onAnnotationLeaveCallback({annotation:t.annotation,commentActivity:t.props.commentActivity},e),t.mouseLeaveTimeout=setTimeout(function(){t.setState({isHover:!1})},100)},t._updateViewportCoordinates=function(){for(var e=s.default(r.findDOMNode(t.refs.highlightContainer)),n=[],i=e.children(),o=0,a=Array.from(i);o<a.length;o++){var l=a[o],c=[],u=s.default(l).offset();c.push({x:u.left,y:u.top}),c.push({x:u.left+s.default(l).width(),y:u.top+s.default(l).height()}),n.push(c)}return t.annotation.viewportCoordinates=n},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){return this.initialViewport=this.props.annotation.viewportCoordinates,this.annotation=l.Annotation.createAnnotationFromDict(this.props.annotation)},t.prototype.render=function(){for(var e,t,n,o=this,r=[],s=c(null!=this.props.commentActivity?this.props.commentActivity.comment:void 0,function(e){return e.resolved}),l=i.default({"annotation-highlight":!0,"annotation-highlight--ui":!0,"annotation-highlight--resolved":s,"highlight-hover":this.state.isHover,"annotation-highlight--ghost":this._isGhostAnnotation(),"annotation-highlight--emphasized":this.props.isEmphasized,"annotation-highlight--pending":"pending"===this.props.commentActivity.activity_key}),u=-1,d=0,p=Array.from(this.initialViewport);d<p.length;d++){var m=p[d];t=m[0].x,n=m[0].y;var f=m[1].x,h=m[1].y;(u===-1||n<u)&&(e=t,u=n);var _={left:t*this.props.scaleFactor,top:n*this.props.scaleFactor,width:f-t,height:h-n,transform:"scale("+this.props.scaleFactor+")",transformOrigin:"top left"};r.push(a.div({className:l,style:_,onClick:this.onHighlightClick,onMouseEnter:this.onHighlightMouseEnter,onMouseLeave:this.onHighlightMouseLeave,onMouseMove:this.props.onMouseMove,onMouseDown:this.props.onMouseDown}))}return a.div({className:"annotation-highlight-container",ref:"highlightContainer"},r,(function(){if(o.props.options.isAnnotationNumberingEnabled){var t={left:e*o.props.scaleFactor-9,top:u*o.props.scaleFactor-9},n=i.default({"annotation-number":!0,"annotation-number--resolved":s,"annotation-number--hover":o.state.isHover});return a.div({className:n,style:t},o.props.options.annotationNumber)}})())},t.displayName="AnnotationHighlightUI",t.defaultProps={scaleFactor:1},t})(o.default.Component);t.default=u}),define("modules/clean/annotations/annotation_marker",["require","exports","tslib","react","external/react-dom","external/react-dom-factories","external/prop-types","jquery","modules/clean/annotations/annotation"],function(e,t,n,i,o,r,a,s,l){"use strict";function c(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importStar(o),r=n.__importStar(r),a=n.__importStar(a),s=n.__importDefault(s);var u=(function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.hideAnnotation=function(){return i._hideAnnotation()},i._getSelectionText=function(){var e="";return window.getSelection&&(e=window.getSelection().toString()),e},i._hasSelectedText=function(){return""!==i._getSelectionText()},i._resetPositionDelta=function(){return i.positionDelta={x:0,y:0}},i._getOffsetPosition=function(e){var t=e.offsetX||(null!=e.nativeEvent?e.nativeEvent.offsetX:void 0)||c(null!=e.nativeEvent?e.nativeEvent.originalEvent:void 0,function(e){return e.layerX}),n=e.offsetY||(null!=e.nativeEvent?e.nativeEvent.offsetY:void 0)||c(null!=e.nativeEvent?e.nativeEvent.originalEvent:void 0,function(e){return e.layerY});return{x:t-i.annotation.getSize()/2,y:n-i.annotation.getSize()/2}},i._getPositionRelativeToParentContainer=function(e){return{x:e.pageX-i.props.parentContainerOffset.left,y:e.pageY-i.props.parentContainerOffset.top}},i._calculateMarkerPos=function(e){var t=i._getPositionRelativeToParentContainer(e),n=i.size/2;return{x:t.x-n-i.positionDelta.x,y:t.y-n-i.positionDelta.y}},i._generateAnnotation=function(e){return i.annotation=new l.Annotation(i.type,i.subtype,i.size),i._updateViewportCoordinatesFromEvent(e),i.annotation},i._updateViewportCoordinatesFromEvent=function(e){var t={x:e.clientX-i.positionDelta.x,y:e.clientY-i.positionDelta.y};return i.annotation.viewportCoordinates[0]=[t]},i._hideAnnotation=function(e){return i.annotation=null,i.setState({isToolVisible:!1,viewerX:null!=e?e.pageX:void 0,viewerY:null!=e?e.pageY:void 0}),"function"==typeof i.props.onAnnotationHiddenCallback?i.props.onAnnotationHiddenCallback():void 0},i._placeAnnotation=function(e){return i.setState({isToolVisible:!0,viewerX:i._calculateMarkerPos(e).x,viewerY:i._calculateMarkerPos(e).y},function(){return i._generateAnnotation(e),"function"==typeof i.props.onAnnotationPlacedCallback?i.props.onAnnotationPlacedCallback(i.annotation):void 0})},i.updateViewportCoordinatesFromMarker=function(){if(i.state.isToolVisible){var e=o.findDOMNode(i.refs.annotationMarker);if(e){var t=s.default(e),n=t.offset(),r={x:n.left+i.annotation.getSize()/2,y:n.top+i.annotation.getSize()/2};i.annotation.viewportCoordinates[0]=[r]}}return null},i._startAnnotationDrag=function(e){return e.preventDefault(),i.isInDragMode=!0,i.positionDelta=i._getOffsetPosition(e),i._updateViewportCoordinatesFromEvent(e),"function"==typeof i.props.onAnnotationStartDragCallback?i.props.onAnnotationStartDragCallback(i.annotation):void 0},i._endAnnotationDrag=function(e){return e.preventDefault(),i.isInDragMode=!1,i._updateViewportCoordinatesFromEvent(e),i._resetPositionDelta(),"function"==typeof i.props.onAnnotationEndDragCallback?i.props.onAnnotationEndDragCallback(i.annotation):void 0},i._isOnMarker=function(e){if(i.state.isToolVisible){var t=o.findDOMNode(i.refs.annotationMarker);return null!=t&&(e.target===t||s.default.contains(t,e.target))}},i.onMouseDownCallback=function(e){if(i.state.isToolVisible&&i._isOnMarker(e))return i._startAnnotationDrag(e),e.preventDefault()},i.onMouseMoveCallback=function(e){if(i.isInDragMode&&i.state.isToolVisible)return i.setState({viewerX:i._calculateMarkerPos(e).x,viewerY:i._calculateMarkerPos(e).y}),e.preventDefault()},i.onMouseUpCallback=function(e){return i.state.isToolVisible?i.isInDragMode?i._endAnnotationDrag(e):i._hideAnnotation(e):i._hasSelectedText()?void 0:(i._placeAnnotation(e),e.preventDefault())},i.onScrollCallback=function(){if(i.state.isToolVisible)return i.updateViewportCoordinatesFromMarker(),"function"==typeof i.props.onAnnotationScrollCallback?i.props.onAnnotationScrollCallback(i.annotation):void 0},i.onScaleChangeCallback=function(){return i.updateViewportCoordinatesFromMarker(),"function"==typeof i.props.onAnnotationScaleChangeCallback?i.props.onAnnotationScaleChangeCallback(i.annotation):void 0},i._onMarkerMouseDown=function(e){return{}},i._onMarkerMouseOver=function(e){return"function"==typeof i.props.onAnnotationOverCallback?i.props.onAnnotationOverCallback(i.annotation):void 0},i._onMarkerMouseUp=function(e){return{}},i._onMarkerMouseEnter=function(e){return"function"==typeof i.props.onAnnotationEnterCallback?i.props.onAnnotationEnterCallback(i.annotation):void 0},i._onMarkerMouseLeave=function(e){return"function"==typeof i.props.onAnnotationLeaveCallback?i.props.onAnnotationLeaveCallback(i.annotation):void 0},i.type=l.AnnotationTypes.MARKER,i.subtype=l.AnnotationSubtypes.MARKER.CIRCLE,i.size=28,i.isInDragMode=!1,i._resetPositionDelta(),i.state={isToolVisible:!1,viewerX:0,viewerY:0},i}return n.__extends(t,e),t.prototype.componentWillMount=function(){return{}},t.prototype.render=function(){var e=[];return this.state.isToolVisible&&(e=[r.div({key:"annotationMarker",ref:"annotationMarker",className:"annotation-marker annotation-marker--blue",onMouseDown:this._onMarkerMouseDown,onMouseUp:this._onMarkerMouseUp,onMouseOver:this._onMarkerMouseOver,onMouseEnter:this._onMarkerMouseEnter,onMouseLeave:this._onMarkerMouseLeave,style:{left:this.state.viewerX,top:this.state.viewerY}},r.div({className:"annotation-maker-inner"}))]),r.div({className:"annotation-marker-container"},this.state.isToolVisible?e:void 0)},t.displayName="AnnotationMarker",t.propTypes={onAnnotationPlacedCallback:a.func,onAnnotationHiddenCallback:a.func,onAnnotationStartDragCallback:a.func,onAnnotationEndDragCallback:a.func,onAnnotationOverCallback:a.func,onAnnotationScrollCallback:a.func,onAnnotationScaleChangeCallback:a.func,onAnnotationEnterCallback:a.func,onAnnotationLeaveCallback:a.func,parentContainerOffset:a.object},t.defaultProps={parentContainerOffset:{left:0,top:0}},t})(i.default.Component);t.default=u}),define("modules/clean/annotations/annotation_marker_ui",["require","exports","tslib","external/classnames","react","external/react-dom","external/react-dom-factories","external/prop-types","jquery"],function(e,t,n,i,o,r,a,s,l){"use strict";function c(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importDefault(o),r=n.__importStar(r),a=n.__importStar(a),s=n.__importStar(s),l=n.__importDefault(l);var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t._isGhostAnnotation=function(){return t.props.options.isGhostAnnotation||!1},t._onMarkerClick=function(e){return"function"==typeof t.props.onAnnotationClickCallback?t.props.onAnnotationClickCallback({commentActivity:t.props.commentActivity}):void 0},t._onMarkerMouseEnter=function(e){var n=l.default(r.findDOMNode(t.refs.annotationMarker)),i=t.props.annotation;return null==i.viewportCoordinates&&(i.viewportCoordinates=[]),i.viewportCoordinates[0]=[{x:n.offset().left+i.annotationSize/2,y:n.offset().top+i.annotationSize/2}],"function"==typeof t.props.onAnnotationEnterCallback?t.props.onAnnotationEnterCallback({annotation:i,commentActivity:t.props.commentActivity}):void 0},t._onMarkerMouseOver=function(e){return{}},t._onMarkerMouseLeave=function(e){return"function"==typeof t.props.onAnnotationLeaveCallback?t.props.onAnnotationLeaveCallback({annotation:t.props.annotation,commentActivity:t.props.commentActivity}):void 0},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){return this.initialViewport=this.props.annotation.getFirstViewportCoordinates()},t.prototype.render=function(){var e=c(null!=this.props.commentActivity?this.props.commentActivity.comment:void 0,function(e){return e.resolved}),t=i.default({"annotation-marker":!0,"annotation-marker--ui":!0,"annotation-marker--blue":!e,"annotation-marker--resolved":e,"annotation-marker--ghost":this._isGhostAnnotation()});return a.div({className:"annotation-marker-container",ref:"markerContainer"},a.div({key:"annotationMarker",ref:"annotationMarker",style:{left:this.initialViewport.x-this.props.annotation.annotationSize/2,top:this.initialViewport.y-this.props.annotation.annotationSize/2},className:t,onClick:this._onMarkerClick,onMouseEnter:this._onMarkerMouseEnter,onMouseOver:this._onMarkerMouseOver,onMouseLeave:this._onMarkerMouseLeave},a.div({className:"annotation-maker-inner"})))},t.displayName="AnnotationMarkerUI",t.propTypes={annotation:s.object,commentActivity:s.object,options:s.shape({isGhostAnnotation:s.bool}),onAnnotationEnterCallback:s.func,onAnnotationOverCallback:s.func,onAnnotationLeaveCallback:s.func,onAnnotationClickCallback:s.func},t.defaultProps={options:{}},t})(o.default.Component);t.default=u}),define("modules/clean/annotations/annotation_region",["require","exports","tslib","external/classnames","external/create-react-class","react","external/react-dom","external/react-dom-factories","external/prop-types","external/lodash","jquery","modules/clean/annotations/annotation"],function(e,t,n,i,o,r,a,s,l,c,u,d){"use strict";function p(e,t){return Math.sqrt(e*e+t*t)<=34}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importDefault(o),r=n.__importDefault(r),a=n.__importStar(a),s=n.__importStar(s),l=n.__importStar(l),c=n.__importStar(c),u=n.__importDefault(u),t.regionIsTiny=p;var m=o.default({displayName:"AnnotationRegion",propTypes:{creationLayerWidth:l.number,creationLayerHeight:l.number,disableTinyAnnotationRegions:l.bool,onAnnotationPlacedCallback:l.func,onAnnotationHiddenCallback:l.func,onAnnotationStartDragCallback:l.func,onAnnotationEndDragCallback:l.func,onAnnotationOverCallback:l.func,onAnnotationScrollCallback:l.func,onAnnotationScaleChangeCallback:l.func,onAnnotationEnterCallback:l.func,onAnnotationLeaveCallback:l.func,parentContainerOffset:l.object},TYPE:d.AnnotationTypes.REGION,SUBTYPE:d.AnnotationSubtypes.REGION.RECTANGLE,DEFAULT_REGION_SIZE:60,Directions:{TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left"},isResizing:!1,getInitialState:function(){return{isInDragMode:!1,resizeDirections:[],isToolVisible:!1,isInitialCreation:!1,rectangle:{top:0,right:0,bottom:0,left:0},anchorRectangle:{top:0,right:0,bottom:0,left:0},anchorMouse:{x:0,y:0}}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},_getPositionRelativeToParentContainer:function(e){return{x:e.pageX-this.props.parentContainerOffset.left,y:e.pageY-this.props.parentContainerOffset.top}},_updateAnnotationFromState:function(){var e=this.state.rectangle.top+this.props.parentContainerOffset.top,t=this.state.rectangle.right+this.props.parentContainerOffset.left,n=this.state.rectangle.bottom+this.props.parentContainerOffset.top,i=this.state.rectangle.left+this.props.parentContainerOffset.left;return this.annotation.viewportCoordinates[0]=[{x:i,y:e},{x:i,y:n},{x:t,y:n},{x:t,y:e}]},_isOnRegion:function(e){if(this.state.isToolVisible){var t=a.findDOMNode(this.refs.annotationRegion);if(null!=t)return e.target===t||u.default.contains(t,e.target)}return!1},_isModifying:function(){return this.state.isInDragMode||this.isResizing},_showNewRectangle:function(e){return this.isResizing=!0,this.setState({isInDragMode:!1,resizeDirections:[this.Directions.TOP,this.Directions.LEFT],isToolVisible:!0,isInitialCreation:!0,rectangle:{top:e.y,right:e.x,bottom:e.y,left:e.x},anchorRectangle:{top:e.y,right:e.x,bottom:e.y,left:e.x},anchorMouse:e})},_startDragging:function(e){return this.isResizing=!1,this.setState({isInDragMode:!0,resizeDirections:[],anchorRectangle:c.clone(this.state.rectangle),anchorMouse:e})},_startResizing:function(e,t){return this.isResizing=!0,this.setState({isInDragMode:!1,resizeDirections:c.clone(t),anchorRectangle:c.clone(this.state.rectangle),anchorMouse:e})},componentWillMount:function(){return this.annotation=new d.Annotation(this.TYPE,this.SUBTYPE)},hideAnnotation:function(){return this.setState({isToolVisible:!1,isInDragMode:!1,resizeDirections:[]}),"function"==typeof this.props.onAnnotationHiddenCallback?this.props.onAnnotationHiddenCallback(this.annotation):void 0},getDimensions:function(){return{width:this.state.rectangle.right-this.state.rectangle.left,height:this.state.rectangle.bottom-this.state.rectangle.top}},createDefaultRegion:function(e){e.preventDefault();var t=this._getPositionRelativeToParentContainer(e),n=t.x,i=t.y,o=this.DEFAULT_REGION_SIZE/2;this.createRegion({top:i-o,right:n+o,bottom:i+o,left:n-o})},createRegion:function(e){var t=this;return this.isResizing=!1,this.setState({isHovering:!0,isToolVisible:!0,isInDragMode:!1,resizeDirections:[],isInitialCreation:!1,rectangle:e},function(){return t._updateAnnotationFromState(),"function"==typeof t.props.onAnnotationPlacedCallback?t.props.onAnnotationPlacedCallback(t.annotation):void 0})},onMouseDownCallback:function(e){e.preventDefault();var t=this._getPositionRelativeToParentContainer(e);return this.state.isToolVisible?this._isOnRegion(e)&&!this.isResizing?(this._updateAnnotationFromState(),"function"==typeof this.props.onAnnotationStartDragCallback&&this.props.onAnnotationStartDragCallback(this.annotation),this._startDragging(t)):void 0:this._showNewRectangle(t)},onMouseMoveCallback:function(e){var t;if(e.preventDefault(),!this.state.isToolVisible)return t=this._getPositionRelativeToParentContainer(e),void this._showNewRectangle(t);if(this._isModifying()){t=this._getPositionRelativeToParentContainer(e);var n,i={x:t.x-this.state.anchorMouse.x,y:t.y-this.state.anchorMouse.y},o=this.props,r=o.creationLayerWidth,a=o.creationLayerHeight,s=function(e,t,n){return Math.max(t,Math.min(e,n))},l=this.state.anchorRectangle,u=l.top,d=l.right,p=l.bottom,m=l.left;this.state.isInDragMode?(i.y=s(i.y,-u,a-p),i.x=s(i.x,-m,r-d),n={top:u+i.y,right:d+i.x,bottom:p+i.y,left:m+i.x}):this.isResizing&&(n=c.clone(this.state.anchorRectangle),this.state.resizeDirections.indexOf(this.Directions.TOP)>=0?n.top=s(u+i.y,0,a):this.state.resizeDirections.indexOf(this.Directions.BOTTOM)>=0&&(n.bottom=s(p+i.y,0,a)),this.state.resizeDirections.indexOf(this.Directions.LEFT)>=0?n.left=s(m+i.x,0,r):this.state.resizeDirections.indexOf(this.Directions.RIGHT)>=0&&(n.right=s(d+i.x,0,r)),n={top:Math.min(n.top,n.bottom),right:Math.max(n.left,n.right),bottom:Math.max(n.top,n.bottom),left:Math.min(n.left,n.right)}),this.setState({rectangle:n})}},onMouseUpCallback:function(e){if(e.preventDefault(),this.state.isToolVisible)if(this._isModifying()){if(this.props.disableTinyAnnotationRegions){var t=this.state.rectangle,n=t.top,i=t.right,o=t.bottom,r=t.left;if(p(i-r,o-n))return void this.hideAnnotation()}this._updateAnnotationFromState(),this.state.isInitialCreation?"function"==typeof this.props.onAnnotationPlacedCallback&&this.props.onAnnotationPlacedCallback(this.annotation):"function"==typeof this.props.onAnnotationEndDragCallback&&this.props.onAnnotationEndDragCallback(this.annotation),this.isResizing=!1,this.setState({isInDragMode:!1,resizeDirections:[],isInitialCreation:!1})}else this.hideAnnotation()},onScrollCallback:function(){if(this.state.isToolVisible)return this._updateAnnotationFromState(),"function"==typeof this.props.onAnnotationScrollCallback?this.props.onAnnotationScrollCallback(this.annotation):void 0},onScaleChangeCallback:function(){return this._updateAnnotationFromState(),"function"==typeof this.props.onAnnotationScaleChangeCallback?this.props.onAnnotationScaleChangeCallback(this.annotation):void 0},_onRegionMouseDown:function(e){},_onRegionMouseOver:function(e){return"function"==typeof this.props.onAnnotationOverCallback?this.props.onAnnotationOverCallback(this.annotation):void 0},_onRegionMouseUp:function(e){},_onRegionMouseEnter:function(e){return this.setState({isHovering:!0}),"function"==typeof this.props.onAnnotationEnterCallback?this.props.onAnnotationEnterCallback(this.annotation):void 0},_onRegionMouseLeave:function(e){return this.setState({isHovering:!1}),"function"==typeof this.props.onAnnotationLeaveCallback?this.props.onAnnotationLeaveCallback(this.annotation):void 0},_onHandleMouseDown:function(e,t){e.preventDefault(),this.isResizing=!0;var n=this._getPositionRelativeToParentContainer(e);return this._updateAnnotationFromState(),"function"==typeof this.props.onAnnotationStartDragCallback&&this.props.onAnnotationStartDragCallback(this.annotation),this._startResizing(n,t)},_renderSideHandles:function(){var e=this;return s.div({ref:"side-handle-wrapper",className:"annotation-region-side-handle--wrapper"},Array.from(c.values(this.Directions)).map(function(t){return(function(t){return s.div({ref:"side-handle-"+t,className:"annotation-region-side-handle annotation-region-side-handle--"+t,onMouseDown:function(n){return e._onHandleMouseDown(n,[t])}})})(t)}))},_renderCornerHandles:function(){var e=this;return[this.Directions.TOP,this.Directions.BOTTOM].map(function(t){return[e.Directions.LEFT,e.Directions.RIGHT].map(function(n){return(function(t,n){return s.div({ref:"corner-handle-"+t+"-"+n,className:"annotation-region-corner-handle annotation-region-corner-handle--"+t+"-"+n,onMouseDown:function(i){return e._onHandleMouseDown(i,[t,n])}},s.div({ref:"corner-handle-"+t+"-"+n+"-dot",className:"annotation-region-corner-handle--dot annotation-region-corner-handle--dot--"+t+"-"+n}))})(t,n)})})},render:function(){var e;if(this.state.isToolVisible){var t=i.default("annotation-region","annotation-region--blue",{"is-modifying":this._isModifying(),hover:this.state.isHovering});e=r.default.createElement("div",{key:"annotationRegion",ref:"annotationRegion",className:t,onMouseDown:this._onRegionMouseDown,onMouseUp:this._onRegionMouseUp,onMouseOver:this._onRegionMouseOver,onMouseOut:this._onRegionMouseOut,onMouseEnter:this._onRegionMouseEnter,onMouseLeave:this._onRegionMouseLeave,style:{left:this.state.rectangle.left,top:this.state.rectangle.top,width:this.state.rectangle.right-this.state.rectangle.left,height:this.state.rectangle.bottom-this.state.rectangle.top}},this._renderSideHandles(),this._renderCornerHandles())}return r.default.createElement("div",{className:"annotation-region-container"},e)}});t.default=m}),define("modules/clean/annotations/annotation_region_ui",["require","exports","tslib","external/classnames","react","external/react-dom","external/react-dom-factories","jquery"],function(e,t,n,i,o,r,a,s){"use strict";function l(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importDefault(o),r=n.__importStar(r),a=n.__importStar(a),s=n.__importDefault(s);var c=(function(e){function t(t){var n=e.call(this,t)||this;return n._isGhostAnnotation=function(){return n.props.options.isGhostAnnotation||!1},n.onRegionClick=function(e){var t=n.props,i=t.onAnnotationClickCallback,o=t.annotation,r=t.commentActivity;i&&i({annotation:o,commentActivity:r},e)},n.onRegionMouseEnter=function(e){var t=s.default(r.findDOMNode(n.refs.annotationRegion)),i=n.props.annotation;if(null==i.viewportCoordinates&&(i.viewportCoordinates=[]),!n.props.useEmphasizedState){var o=t.offset().top,a=t.offset().left,l=o+t.height(),c=a+t.width();i.viewportCoordinates[0]=[{x:a,y:o},{x:a,y:l},{x:c,y:l},{x:c,y:o}]}return"function"==typeof n.props.onAnnotationEnterCallback?n.props.onAnnotationEnterCallback({annotation:i,commentActivity:n.props.commentActivity}):void 0},n.onRegionMouseLeave=function(e){n.props.onAnnotationLeaveCallback&&n.props.onAnnotationLeaveCallback({annotation:n.props.annotation,commentActivity:n.props.commentActivity},e)},n.setEmphasized=function(e){n.setState({isEmphasized:e})},n.state={isEmphasized:n.props.isEmphasized},n}return n.__extends(t,e),Object.defineProperty(t.prototype,"isEmphasized",{get:function(){return this.props.useEmphasizedState?this.state.isEmphasized:this.props.isEmphasized},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e=this,t=l(null!=this.props.commentActivity?this.props.commentActivity.comment:void 0,function(e){return e.resolved}),n=this.props.annotation.getBoundingBox(),o=i.default({"annotation-region":!0,"annotation-region--ui":!0,"annotation-region--resolved":t,"annotation-region--ui--resolved":t,"annotation-region--ghost":this._isGhostAnnotation(),"annotation-region--emphasized":this.isEmphasized}),r={left:n.left*this.props.scaleFactor,top:n.top*this.props.scaleFactor,width:(n.right-n.left)*this.props.scaleFactor,height:(n.bottom-n.top)*this.props.scaleFactor};return a.div({className:"annotation-region-container"},a.div({key:"annotationRegion",ref:"annotationRegion",className:o,onClick:this.onRegionClick,onMouseEnter:this.onRegionMouseEnter,onMouseLeave:this.onRegionMouseLeave,onMouseMove:this.props.onMouseMove,onMouseDown:this.props.onMouseDown,style:r},a.div({className:"annotation-region-inner"}),(function(){if(e.props.options.isAnnotationNumberingEnabled){var n=i.default({"annotation-number":!0,"annotation-number--resolved":t});return a.div({className:n},e.props.options.annotationNumber)}})()))},t.displayName="AnnotationRegionUI",t.defaultProps={scaleFactor:1},t})(o.default.Component);t.default=c}),define("modules/clean/annotations/annotation_renderer_utils",["require","exports","tslib","external/lodash","modules/clean/annotations/annotation","modules/clean/annotations/annotation_highlight_ui","modules/clean/annotations/annotation_marker_ui","modules/clean/annotations/annotation_region_ui"],function(e,t,n,i,o,r,a,s){"use strict";function l(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),r=n.__importDefault(r),a=n.__importDefault(a),s=n.__importDefault(s);var c=(function(){function e(){}return e.prototype.shouldUpdateAnnotations=function(e,t){if((null!=e.annotations?e.annotations.length:void 0)!==l(Object.keys(t),function(e){return e.length}))return!0;for(var n=0,o=Array.from(e.annotations);n<o.length;n++){var r=o[n],a=r.commentActivity.activity_key;if(!i.isEqual(t[a],r))return!0}return!1},e.prototype.renderAnnotation=function(e,t,n){if(null==e.annotation||null==e.commentActivity)return null;var i=o.Annotation.createAnnotationFromDict(e.annotation),l=e.commentActivity;if(null==(null!=i?i.type:void 0)||t(l.activity_key))return null;var c=null;switch(i.type){case o.AnnotationTypes.MARKER:c=a.default;break;case o.AnnotationTypes.HIGHLIGHT:c=r.default;break;case o.AnnotationTypes.REGION:c=s.default}return null==c?null:n(c,i,l,null!=e.options?e.options:{})},e})();t.default=c}),define("modules/clean/auth/login_or_register/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n;(function(e){e.COMMENT="comment",e.DOWNLOAD="download",e.IMMEDIATE="immediate"})(n||(n={})),t.LoginOrRegisterKind=n;var i;(function(e){e.DIRECT_DOWNLOAD="direct_download",e.SAVE_TO_DROPBOX="add_to_dropbox"})(i||(i={})),t.DownloadAction=i;var o;(function(e){e[e.LOGIN=0]="LOGIN",e[e.REGISTER=1]="REGISTER"})(o||(o={})),t.Mode=o;var r;(function(e){e.DEFAULT="",e.POST="post_comment_variant",e.SUBSCRIBE="subscribe_variant"})(r||(r={})),t.CommentTextVariant=r}),define("modules/clean/average_counter",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(){this.average=0,this.count=0}return e.prototype.getAverage=function(){return this.average},e.prototype.add=function(e){this.average=(this.average*this.count+e)/(this.count+1),this.count++},e.prototype.addArray=function(e){var t=e.reduce(function(e,t){return e+t}),n=this.count+e.length;this.average=(this.average*this.count+t)/n,this.count=n},e})();t.AverageCounter=n}),define("modules/clean/callback_chain/callback_chain",["require","exports"],function(e,t){"use strict";function n(e){return void 0!==e.abortCallbackChain}function i(e){var t=e,n=!1;return t.abortCallbackChain=function(){n=!0},Object.defineProperty(t,"callbackChainAborted",{get:function(){return n}}),t}Object.defineProperty(t,"__esModule",{value:!0});var o=(function(){function e(e){this.callbacks=e}return e.prototype.run=function(e){for(var t=n(e)?e:i(e),o=0,r=this.callbacks;o<r.length;o++){var a=r[o];if(t.callbackChainAborted)break;a(t)}},e})();t.CallbackChain=o}),define("modules/clean/comments/actions",["require","exports","tslib","external/reflux","external/lodash"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),o=n.__importStar(o)
;var r=["stopViewingComments","showResolvedComments","hideResolvedComments","showAnnotationConversation","hideAnnotationConversation","showAnnotationInput","hideAnnotationInput","updateAnnotationText","updateAnnotationReplyText","startAnnotationCreation","stopAnnotationCreation","notifyPreviewReady","switchRevision","startViewingComments","revealAnnotation","receiveFileActivity","showComments","hideComments","switchTabs","setShouldShowOnboarding","updateAnnotationReplyFocused","updateAnnotationConversationHover","updateAnnotationUiHover","setRegionCreationEnabled","setShowTutorial","setCurrentTutorialStep","setExpandedComment","setMentionedContact","addedComment","enableCommenting","disableCommenting","cancelAnnotationComment","receiveRevisions"];t.default=i.createActions(o.zipObject(r,r.map(function(e){return{sync:!0}})))}),define("modules/clean/comments/components/ui_constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_ANNOTATION_COMMENT_INPUT_MAX_HEIGHT=220,t.TUTORIAL_INITIATOR="tutorialInitiator",t.TUTORIAL_CREATE_ANNOTATION="tutorialCreateAnnotation",t.TUTORIAL_CREATE_ANNOTATION_SUCCESS="tutorialCreateAnnotationSuccess",t.TUTORIAL_REPLY="tutorialReply",t.TUTORIAL_REPLY_SUCCESS="tutorialReplySuccess",t.TUTORIAL_MENTION="tutorialMention",t.TUTORIAL_MENTION_SUCCESS="tutorialMentionSuccess"}),define("modules/clean/comments/events",["require","exports","tslib","external/eventemitter3"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.CommentsEvents=new i.default,t.CommentsEventsMixin={onCommentsEvent:function(e,n,i){this.__commentsEvents.push([e,n,i]),t.CommentsEvents.on(e,n,i)},componentWillMount:function(){this.__commentsEvents=[]},componentWillUnmount:function(){this.__commentsEvents.forEach(function(e){var n=e[0],i=e[1],o=e[2];t.CommentsEvents.off(n,i,o)}),this.__commentsEvents=null}}}),define("modules/clean/comments/legacy_redux_integration",["require","exports","modules/clean/react/file_viewer/data/store","modules/clean/react/file_viewer/data/actions"],function(e,t,n,i){"use strict";function o(e){s.dispatch(i.switchRevisionAction(e))}function r(){s.dispatch(i.restoreRevisionAction())}function a(e){s.dispatch(i.saveForwardRevision(e))}Object.defineProperty(t,"__esModule",{value:!0});var s=n.getStoreForFileViewer();t.reduxSwitchRevision=o,t.reduxRestoreRevision=r,t.reduxSaveForwardRevision=a}),define("modules/clean/comments/lib/type_check",["require","exports","tslib","modules/core/types"],function(e,t,n,i){"use strict";function o(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t,n,i){i.value=a.apply(void 0,e.concat([i.value]))}}function r(e){return function(t,n,i){i.value=s(e,i.value)}}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i);var a=i.default.takes,s=i.default.returns;t.takes=o,t.returns=r}),define("modules/clean/comments/models/comment",["require","exports","tslib","external/lodash","modules/clean/file_activity/models/immutability_helper","modules/clean/activity/activity_user"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var a=(function(){function e(e){var t=void 0===e?{}:e,n=t.revision,i=void 0===n?null:n,o=t.annotation,r=void 0===o?null:o,a=t.sticker_id,s=void 0===a?null:a,l=t.thumbnail_url,c=void 0===l?null:l;this.revision=i,this.annotation=r,this.sticker_id=s,this.thumbnail_url=c}return e.fromDict=function(t){return new e({revision:t.revision,annotation:t.annotation,sticker_id:t.stickers&&t.stickers.id,thumbnail_url:t.thumbnail_url})},e.prototype.toDict=function(){return i.pickBy({revision:this.revision,annotation:this.annotation,stickers:this.sticker_id?{id:this.sticker_id}:null,thumbnail_url:this.thumbnail_url},function(e){return null!=e})},e.prototype.hasRevisionData=function(){return null!=this.revision},e.prototype.hasAnnotationData=function(){return null!=this.annotation},e.prototype.hasStickerData=function(){return null!=this.sticker_id},e.prototype.hasThumbnailUrl=function(){return null!=this.thumbnail_url},e.prototype.getStickerId=function(){return this.sticker_id},e})();t.CommentMetadata=a;var s=(function(){function e(e){var t=void 0===e?{}:e,n=t.comment_gid,i=void 0===n?"":n,o=t.commenter,a=void 0===o?r.ActivityUser.anonymous:o,s=t.comment_text,l=void 0===s?"":s,c=t.raw_comment_text,u=void 0===c?"":c,d=t.when_mses,p=void 0===d?0:d,m=t.resolved,f=void 0!==m&&m,h=t.comment_metadata,_=void 0===h?null:h;this.comment_gid=i,this.commenter=a,this.comment_text=l,this.raw_comment_text=u,this.when_mses=p,this.resolved=f,this.comment_metadata=_}return e.fromDict=function(t){var n=t.comment_meta_json;return new e({comment_gid:t.comment_gid,commenter:r.ActivityUser.fromDict(t.commenter_dict),comment_text:t.comment_text,raw_comment_text:t.raw_comment_text,when_mses:t.when_mses,resolved:t.resolved,comment_metadata:n?a.fromDict(n):null})},e.prototype.hasMetadata=function(){return null!=this.comment_metadata},e.prototype.resolve=function(){return o.set(this,"resolved",!0)},e.prototype.unresolve=function(){return o.set(this,"resolved",!1)},e})();t.Comment=s}),define("modules/clean/comments/models/comment_activity",["require","exports","tslib","external/lodash","modules/clean/file_activity/models/immutability_helper","modules/clean/activity/activity_user","modules/clean/comments/models/comment"],function(e,t,n,i,o,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var s=(function(){function e(e){var t=(void 0===e?{}:e).user_ids_who_can_delete,n=void 0===t?[]:t;this.user_ids_who_can_delete=n}return e.fromDict=function(t){return t.user_ids_who_can_delete.forEach(function(e){if(!i.isNumber(e))throw TypeError(e+" in user_ids_who_can_delete is not a number")}),new e(t)},e})();t.CommentActivityPermissions=s;var l=(function(){function e(e){var t=void 0===e?{}:e,n=t.activity_key,i=void 0===n?"":n,o=t.comment_activities,r=void 0===o?[]:o,l=t.users_to_notify,c=void 0===l?[]:l,u=t.is_seen,d=void 0!==u&&u,p=t.highlight_as_unread,m=void 0!==p&&p,f=t.comment,h=void 0===f?new a.Comment:f,_=t.permissions,v=void 0===_?new s:_,g=t.status,y=void 0===g?"POSTED":g;this.activity_key=i,this.comment_activities=r,this.users_to_notify=c,this.is_seen=d,this.highlight_as_unread=m,this.comment=h,this.permissions=v,this.status=y}return e.createLocalInstance=function(t){var n=t.activityKey,o=void 0===n?i.uniqueId("local-comment-activity-"):n,r=t.commenter,s=t.rawCommentText,l=t.metadata,c=void 0===l?null:l,u=t.status,d=void 0===u?"POSTING":u;return new e({activity_key:o,comment:new a.Comment({comment_gid:i.uniqueId("pending-comment-gid-"),commenter:r,comment_text:s,raw_comment_text:s,when_mses:(new Date).getTime(),resolved:!1,comment_metadata:c}),is_seen:!0,highlight_as_unread:!1,status:d})},e.fromDict=function(t){return new e({activity_key:t.activity_key,comment_activities:t.comment_activity_dicts.map(e.fromDict),users_to_notify:(t.users_to_notify||[]).map(r.ActivityUser.fromDict),is_seen:t.is_seen,highlight_as_unread:t.highlight_as_unread,comment:a.Comment.fromDict(t.comment),permissions:s.fromDict(t.permissions)})},Object.defineProperty(e.prototype,"when_mses",{get:function(){return this.comment.when_mses},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_pending",{get:function(){return"POSTED"!==this.status},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_resolved",{get:function(){return this.comment.resolved},enumerable:!0,configurable:!0}),e.prototype.shouldHighlightAsUnread=function(){return!!this.highlight_as_unread||this.comment_activities.some(function(e){return e.shouldHighlightAsUnread()})},e.prototype.resolve=function(){return o.set(this,"comment",this.comment.resolve())},e.prototype.unresolve=function(){return o.set(this,"comment",this.comment.unresolve())},e.prototype.setStatus=function(e){return o.set(this,"status",e)},e.prototype.markSeen=function(){return o.merge(this,{is_seen:!0,highlight_as_unread:!1})},e})();t.CommentActivity=l}),define("modules/clean/comments/models/loading_spinner",["require","exports"],function(e,t){"use strict";function n(e,t){return(null==t||t.comment_activities.length>0)&&e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}),define("modules/clean/comments/revisions",["require","exports","tslib","external/lodash"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var o=function(e,t){var o=i.pick(t,"revision_id","direct_blockserver_link","preview_ssr_image_url_tmpl","preview_ssr_text_url_tmpl","preview_ssr_refresh_url","preview_url","preview");return o.preview_url=t.preview_link,n.__assign({},e,o)};t.getFileWithRevision=o;var r=function(e,t){return t.when-e.when};t.compareRevision=r;var a=function(e,t){return r(e,t)>0};t.isRevisionOlderThan=a;var s=function(e,t){return r(e,t)<0};t.isRevisionNewerThan=s;var l=function(e,t){return 0===r(e,t)};t.isRevisionEqual=l}),define("modules/clean/comments/store",["require","exports","tslib","external/reflux","external/lodash","modules/clean/comments/actions","modules/clean/comments/components/ui_constants","modules/clean/comments/events","modules/clean/comments/models/loading_spinner","modules/clean/comments/revisions","modules/clean/react/file_comments/logger","modules/constants/comments_panel","modules/core/exception","modules/clean/comments/legacy_redux_integration"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m){"use strict";function f(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),o=n.__importStar(o),r=n.__importDefault(r),l=n.__importDefault(l),c=n.__importStar(c),u=n.__importDefault(u),d=n.__importStar(d),t.default=i.createStore({listenables:r.default,init:function(){return this.state=this.getInitialState()},getInitialState:function(){return{actorId:null,viewing:{context:null,contextData:null,revision:null,file:null,previewType:null,showCommentsOverride:null},activity:null,showLoadingSpinner:!0,oref:null,showResolvedComments:!1,isPreviewReady:!1,regionCreationEnabled:!1,viewAnnotation:null,createAnnotation:null,annotationText:null,annotationReplyTextByKey:{},shouldShowOnboarding:void 0,showTutorial:d.SHOW_COMMENTS_TUTORIAL,currentTutorialStep:a.TUTORIAL_INITIATOR,showCommentsPref:d.SHOW_COMMENTS_PANEL,revisions:null}},setState:function(e){return this.state=o.assignIn({},this.state,e),this.trigger(this.state)},replaceState:function(e){return this.state=e,this.forceUpdate()},forceUpdate:function(){return this.trigger(this.state)},isUserSubscribed:function(e){if(null!=this.state.activity?this.state.activity.users_to_notify:void 0)for(var t=0,n=Array.from(this.state.activity.users_to_notify);t<n.length;t++){var i=n[t];if(i.id===e)return!0}return!1},isCommentingEnabled:function(){return!this.state.activity||!this.state.activity.feedback_off},isFileActivityReady:function(){return null!=this.state.activity},canEnableComments:function(){return null!=this.state.activity?this.state.activity.can_edit_feedback:void 0},isStoreInitialized:function(){return!!this.state.viewing.context},hasUnreadComments:function(){return!!(null!=this.state.activity?this.state.activity.comment_activities.some(function(e){return e.shouldHighlightAsUnread()}):void 0)},areCommentsHidden:function(){return null!=this.state.viewing.showCommentsOverride?!this.state.viewing.showCommentsOverride:this.state.showCommentsPref===!1?!this.hasUnreadComments():!this.isCommentingEnabled()},unreadCommentCount:function(){if(null==this.state.activity)return null;var e=function(e){return e.highlight_as_unread&&!e.comment.resolved},t=function(t,n){return n.comment.resolved?t:(e(n)&&(t+=1),t+=n.comment_activities.filter(e).length)};return this.state.activity.comment_activities.reduce(t,0)},isTutorialShown:function(){return null!=this.state.viewing.showTutorialOverride?this.state.viewing.showTutorialOverride:this.state.showTutorial},onReceiveFileActivity:function(e){return null!=e&&null==this.state.viewing.revision&&(this.state.viewing.revision=e.latest_revision),this.setState({activity:e})},onStartViewingComments:function(e){var t,n=e.actorId,i=e.context,o=e.contextData,r=e.oref,a=e.file,s=e.previewType,c=(e.previewSelector,e.showCommentsOverride),u=e.showTutorialOverride;return t=null===this.state.contextData||l.default(this.state.showLoadingSpinner,this.state.activity),this.setState({actorId:n,viewing:{context:i,contextData:o,file:a,previewType:s,revision:null,showCommentsOverride:c,showTutorialOverride:u},oref:r,viewAnnotation:null,createAnnotation:null,isPreviewReady:!1,showLoadingSpinner:t,annotationText:null,annotationReplyTextByKey:{}})},onStopViewingComments:function(){return this.setState({actorId:null,activity:null,viewing:{context:null,contextData:null,revision:null,file:null,previewType:null,showCommentsOverride:null,showTutorialOverride:null},showLoadingSpinner:!0,oref:null,viewAnnotation:null,createAnnotation:null,isPreviewReady:!1,annotationText:null,annotationReplyTextByKey:{},revisions:null})},onShowResolvedComments:function(){return this.setState({showResolvedComments:!0})},onHideResolvedComments:function(){return this.setState({showResolvedComments:!1})},onNotifyPreviewReady:function(){if(this.setState({isPreviewReady:!0}),null!=this.state.activity)return s.CommentsEvents.emit("preview-and-comments-ready")},onUpdateAnnotationConversationHover:function(e){if(null!=this.state.viewAnnotation){var t=o.assignIn({},this.state.viewAnnotation,{conversationHover:e});return this.setState({viewAnnotation:t})}},onUpdateAnnotationUiHover:function(e){if(null!=this.state.viewAnnotation){var t=o.assignIn({},this.state.viewAnnotation,{annotationHover:e});return this.setState({viewAnnotation:t})}},onShowAnnotationConversation:function(e){var t=e.annotation,n=e.activityKey;return p.assert(null!=this.state.activity,"Cannot show annotation when file activity is not ready!"),p.assert(null!=t,"Invalid annotation to show"),p.assert(null!=this.state.activity.findConversationByKey(n),"Invalid inline comment to show: "+n),this.setState({viewAnnotation:{annotation:t,activityKey:n,replyFocused:!1,annotationHover:!0,conversationHover:!1}})},onHideAnnotationConversation:function(){return this.setState({viewAnnotation:null})},onUpdateAnnotationReplyFocused:function(e){if(null!=this.state.viewAnnotation){var t=o.assignIn({},this.state.viewAnnotation,{replyFocused:e});return this.setState({viewAnnotation:t})}},onStartAnnotationCreation:function(e){var t=e.annotation;return this.setState({viewAnnotation:null,createAnnotation:{annotation:t,showBubble:!0}}),this._updateTutorial()},onStopAnnotationCreation:function(){return this.setState({createAnnotation:null})},onUpdateAnnotationText:function(e){return this.setState({annotationText:e})},onUpdateAnnotationReplyText:function(e){var t,n,i=e.activityKey,r=e.text;return i in this.state.annotationReplyTextByKey&&!r?(n=o.omit(this.state.annotationReplyTextByKey,i),this.setState({annotationReplyTextByKey:n})):(n=o.assignIn({},this.state.annotationReplyTextByKey,(t={},t[i]=r,t)),this.setState({annotationReplyTextByKey:n}))},onShowAnnotationInput:function(){if(null!=this.state.createAnnotation)return this.setState({createAnnotation:{annotation:this.state.createAnnotation.annotation,showBubble:!0}})},onHideAnnotationInput:function(){if(null!=this.state.createAnnotation)return this.setState({createAnnotation:{annotation:this.state.createAnnotation.annotation,showBubble:!1}})},onSwitchRevision:function(e){var t,n=e.revision,i=e.commentActivity;if(p.assert(null!=n,"Revision to switch to must not be null!"),p.assert(null!=this.state.activity,"Cannot switch revision when file activity is not ready!"),!c.isRevisionEqual(n,this.state.viewing.revision)){if(c.isRevisionEqual(n,this.state.activity.latest_revision))t=d.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SWITCH_TO_LATEST_REVISION,m.reduxRestoreRevision();else{t=d.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SWITCH_TO_OLD_REVISION;var r=c.getFileWithRevision(this.state.viewing.file,n);m.reduxSwitchRevision(r)}return this.setState({viewing:o.assignIn({},this.state.viewing,{revision:n}),isPreviewReady:!1}),s.CommentsEvents.emit("revision-did-change"),u.default.log_annotation_event(t,this.state.activity.activity_key,null!=i?i.activity_key:void 0,this.state.actorId,this.state.viewing.context,f(null!=i?i.comment.comment_metadata:void 0,function(e){return e.annotation}))}},onShowComments:function(){return this.setState({viewing:o.assignIn(this.state.viewing,{showCommentsOverride:!0}),showCommentsPref:!0})},onHideComments:function(){return this.setState({viewing:o.assignIn(this.state.viewing,{showCommentsOverride:!1}),viewAnnotation:null,createAnnotation:null,showCommentsPref:!1})},onSetRegionCreationEnabled:function(e){return this.setState({regionCreationEnabled:e,viewAnnotation:null,createAnnotation:null})},onAddedComment:function(){return this.onShowComments(),this.onCancelAnnotationComment()},onCancelAnnotationComment:function(){if(null!=this.state.createAnnotation)return this.onStopAnnotationCreation(),this.onUpdateAnnotationText(null);if(null!=this.state.viewAnnotation){var e=this.state.viewAnnotation.activityKey;return this.onHideAnnotationConversation(),this.onUpdateAnnotationReplyText({activityKey:e,text:null})}},onEnableCommenting:function(){return this.onShowComments()},onDisableCommenting:function(){},onSetShouldShowOnboarding:function(e){return this.setState({shouldShowOnboarding:e})},onSetShowTutorial:function(e){return d.SHOW_COMMENTS_TUTORIAL=e,this.setState({showTutorial:e,viewing:o.assignIn(this.state.viewing,{showTutorialOverride:null})})},onSetCurrentTutorialStep:function(e){return this.setState({currentTutorialStep:e})},onSetExpandedComment:function(e){return this.setState({expandedComment:e}),this._updateTutorial()},onSetMentionedContact:function(e){return this.setState({mentionedContact:e}),this._updateTutorial()},_updateTutorial:function(){return this.state.currentTutorialStep===a.TUTORIAL_CREATE_ANNOTATION&&null!=this.state.createAnnotation?this.setState({currentTutorialStep:a.TUTORIAL_CREATE_ANNOTATION_SUCCESS}):this.state.currentTutorialStep===a.TUTORIAL_REPLY&&this.state.expandedComment?this.setState({currentTutorialStep:a.TUTORIAL_REPLY_SUCCESS}):this.state.currentTutorialStep===a.TUTORIAL_MENTION&&this.state.mentionedContact?this.setState({currentTutorialStep:a.TUTORIAL_MENTION_SUCCESS}):void 0},onReceiveRevisions:function(e){return this.setState({revisions:e})}})}),define("modules/clean/file_activity/api",["require","exports","tslib","external/lodash","modules/clean/ajax","modules/clean/comments/models/comment_activity","modules/clean/file_activity/models/file_activity","modules/core/types"],function(e,t,n,i,o,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),o=n.__importStar(o),s=n.__importDefault(s);var l=s.default.takes,c=s.default.returns,u=s.default.Maybe,d={actorId:u(Number),oref:u(String),isBackgroundRequest:u(Boolean)},p=function(e){var t=e.url,n=e.type,r=e.data,a=e.actorId,s=e.oref,l=e.isBackgroundRequest,c=l?o.SilentBackgroundRequestOref:o.WebRequestOref;return new Promise(function(e,o){return c({url:t,type:n,data:i.assignIn({oref:s},r),subject_user:a,success:e,error:function(e,t,n){if("abort"!==t)return o(Error(n))}})}).then(JSON.parse)},m=function(e){if("error"===e.status){var t=null!=e.payload?e.payload.error_text:void 0,n=Error(t);throw n.payload=e.payload,n.error_text=t,n}return e.payload},f=function(e){return[m(e),e.bolt_data]},h=function(e){return a.FileActivity.fromDict(e)},_=i.assignIn({commentActivityKey:u(String),context:Number,contextData:String,text:String,metadata:u(Object)},d),v=l(_,c(Promise,function(e){var t=e.actorId,n=e.commentActivityKey,i=e.context,o=e.contextData,a=e.text,s=e.metadata,l=e.oref,c=e.isBackgroundRequest;return p({actorId:t,url:"/file_activity/comment",type:"POST",data:{activity_context:i,activity_context_data:o,comment_text:a,comment_metadata_json:JSON.stringify(s),target_comment_activity_key:n},oref:l,isBackgroundRequest:c}).then(m).then(r.CommentActivity.fromDict)}));t.addComment=v;var g=i.assignIn({commentActivityKey:String,context:Number,contextData:String},d),y=l(g,c(Promise,function(e){return p({actorId:e.actorId,url:"/file_activity/comment/delete",type:"POST",data:{comment_key:e.commentActivityKey,activity_context:e.context,activity_context_data:e.contextData},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest}).then(m)}));t.deleteComment=y;var b=i.assignIn({enableComment:Boolean,context:Number,contextData:String},d),w=l(b,c(Promise,function(e){var t=e.actorId,n=e.enableComment;return p({actorId:t,url:"/file_activity/feedback_setting",type:"POST",data:{activity_context:e.context,activity_context_data:e.contextData,feedback_off:!n},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest}).then(m)}));t.updateCommentSetting=w;var C=i.assignIn({resolved:Boolean,commentActivityKey:String,context:Number,contextData:String},d),S=l(C,c(Promise,function(e){var t=e.actorId,n=e.resolved;return p({actorId:t,url:"/file_activity/comment/resolve",type:"POST",data:{activity_key:e.commentActivityKey,activity_context:e.context,activity_context_data:e.contextData,resolved:n},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest}).then(m)}));t.updateResolveComment=S;var E=i.assignIn({commentActivityKeys:Array,context:Number,contextData:String},d),A=l(E,c(Promise,function(e){var t=e.actorId,n=e.commentActivityKeys,i=e.context,o=e.contextData,r=e.oref,a=e.isBackgroundRequest;return p({actorId:t,url:"/file_activity/mark_comment_seen_batch",type:"POST",data:{comment_activity_keys:JSON.stringify(n),activity_context:i,activity_context_data:o},oref:r,isBackgroundRequest:a}).then(m)}));t.markCommentSeenBatch=A;var T=i.assignIn({context:Number,contextData:String},d),P=function(e){return p({actorId:e.actorId,url:"/file_activity/file_activity",type:"GET",data:{activity_context:e.context,activity_context_data:e.contextData},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest})},I=l(T,c(Promise,function(e){return P(e).then(m).then(h)}));t.fetchFileActivity=I;var k=l(T,c(Promise,function(e){return P(e).then(f).then(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Array.from(e[0]),i=n[0],o=n[1];return[h(i),o]})}));t.fetchFileActivityWithBoltData=k;var x=i.assignIn({context:Number,contextDataList:Array},d),M=l(x,c(Promise,function(e){var t=e.actorId,n=e.context,o=e.contextDataList,r=e.oref,a=e.isBackgroundRequest;return p({actorId:t,url:"/file_activity/file_activity_batch",type:"GET",data:{activity_context:n,activity_context_data_batch:JSON.stringify(o)},oref:r,isBackgroundRequest:a}).then(function(e){return i.mapValues(e,h)})}));t.fetchFileActivities=M;var O=i.assignIn({subscribed:Boolean,context:Number,contextData:String},d),F=l(O,c(Promise,function(e){var t=e.actorId,n=e.subscribed;return p({actorId:t,url:"/file_activity/subscribe",type:"POST",data:{activity_context:e.context,activity_context_data:e.contextData,subscribed:n},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest}).then(m)}));t.updateFileActivitySubscription=F;var R=i.assignIn({context:Number,contextDataList:Array},d),D=l(R,c(Promise,function(e){var t=e.actorId,n=e.context,o=e.contextDataList,r=e.oref,a=e.isBackgroundRequest;return p({actorId:t,url:"/file_activity/comment_status_batch",type:"POST",data:{activity_context:n,activity_context_data_batch:JSON.stringify(o)},oref:r,isBackgroundRequest:a}).then(m).then(function(e){return i.mapValues(e,function(e){return{feedback_off:e.feedback_off,comment_count:e.comment_count,unresolved_comment_count:e.unresolved_comment_count}})})}));t.fetchCommentStatusBatch=D;var L=i.assignIn({feedbackText:String,context:Number,contextData:String},d),N=l(L,c(Promise,function(e){var t=e.actorId,n=e.feedbackText;return p({actorId:t,url:"/file_activity/product_feedback",type:"POST",data:{activity_context:e.context,activity_context_data:e.contextData,feedback_text:n},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest}).then(m)}));t.submitProductFeedback=N;var B=l({actorId:Number},c(Promise,function(e){var t=e.actorId;return new Promise(function(e,n){return o.SilentBackgroundRequestOref({url:"/file_activity/mark_commenting_onboarding_seen",type:"POST",success:e,error:n,subject_user:t})}).then(JSON.parse).then(m)}));t.markCommentingOnboardingSeen=B;var U=l({actorId:Number},c(Promise,function(e){var t=e.actorId;return new Promise(function(e,n){return o.SilentBackgroundRequestOref({url:"/file_activity/should_show_commenting_onboarding",type:"POST",success:e,error:n,subject_user:t})}).then(JSON.parse).then(m)}));t.shouldShowCommentingOnboarding=U;var V=l({actorId:Number,shouldShow:Boolean},c(Promise,function(e){return p({actorId:e.actorId,url:"/file_activity/set_commenting_pane_visibility",type:"POST",data:{show_pane:e.shouldShow}}).then(m)}));t.setCommentingPaneVisibility=V;var H=l({shouldShow:Boolean},c(Promise,function(e){return p({url:"/file_activity/set_commenting_pane_visibility",type:"POST",data:{show_pane:e.shouldShow}}).then(m)}));t.setSessionCommentingPaneVisibility=H;var j=l({actorId:Number,shouldShow:Boolean},c(Promise,function(e){return p({actorId:e.actorId,url:"/file_activity/set_show_comments_tutorial",type:"POST",data:{show_tutorial:e.shouldShow}}).then(m)}));t.setShowCommentsTutorial=j}),define("modules/clean/file_activity/clients/file_activity_bolt_client",["require","exports","tslib","external/eventemitter3","modules/clean/analytics","modules/clean/bolt","modules/clean/file_activity/api","modules/clean/optimistic_update","modules/clean/storage","modules/core/exception","modules/core/types"],function(e,t,n,i,o,r,a,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),r=n.__importStar(r),a=n.__importStar(a),c=n.__importStar(c),u=n.__importDefault(u);var d=u.default.takes,p=u.default.Maybe,m=function(e,t){return new r.SignedChannelState("file_activity",e.activity_key,t.revision,t.token)},f=function(e){return{revision:e.revision,token:e.token}},h=void 0,_=(function(e){function t(){var t=e.call(this)||this;return t._onBoltUpdate=t._onBoltUpdate.bind(t),t._onBoltRefresh=t._onBoltRefresh.bind(t),h.apply(t,arguments)}return n.__extends(t,e),t.initClass=function(){h=d({actorId:p(Number),context:Number,contextData:String,oref:p(String)},function(e){var t=e.actorId,n=e.context,i=e.contextData,o=e.oref;return this.__requestOptions={actorId:t,context:n,contextData:i,oref:o,isBackgroundRequest:!0},this.__optimist=new s.Optimist(null),this.__isLive=!1,this.__isReady=!1,this.__canInit=!0})},t.prototype.getFileActivity=function(){return this.__optimist.getValue()},t.prototype.isReady=function(){return this.__isReady},t.prototype.isLive=function(){return this.__isLive},t.prototype.rebase=function(e){c.assert(this.__isReady,"Cannot rebase when server data is not ready");var t=this.getFileActivity();return this.__optimist.rebase(e),this.emit("updated",this.getFileActivity(),t)},t.prototype.commitOptimisticUpdate=function(e){c.assert(this.__isReady,"Cannot commit optimistic update when server data is not ready");var t=this.getFileActivity(),n=this.__optimist.commit(e);return this.emit("updated",this.getFileActivity(),t),n},t.prototype.rollbackOptimisticUpdate=function(e){c.assert(this.__isReady,"Cannot rollback optimistic update when server data is not ready");var t=this.getFileActivity();if(this.__optimist.rollback(e))return this.emit("updated",this.getFileActivity(),t)},t.prototype.init=function(){var e=this;c.assert(this.__canInit,"Cannot initialize an already initialized or initialization in-progress client"),this.__canInit=!1,this._pullFromServer().then(function(){if(o.CommentsVortexLogger.log("load-comments-success"),e.__isLive)return e._doStartLiveUpdate()}).catch(function(){return e.__canInit=!0})},t.prototype.startLiveUpdate=function(){return c.assert(!this.__isLive,"Client is already live updating"),this.__isReady&&this._doStartLiveUpdate(),this.__isLive=!0},t.prototype.stopLiveUpdate=function(){return this.__isLive=!1,null!=this.__boltClient?this.__boltClient.unsubscribe():void 0},t.prototype._doStartLiveUpdate=function(){var e=m(this.getFileActivity(),this.__boltData);return this.__boltClient=new r.BoltClient([e],this._onBoltUpdate,this._onBoltRefresh),this.__boltClient.start()},t.prototype._pullFromServer=function(){var e=this;l.SessionStorage.set("reload-timestamp",(new Date).getTime());var t=a.fetchFileActivityWithBoltData(this.__requestOptions);return t.then(function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=Array.from(t[0]),o=i[0],r=i[1];e.__boltData=r;var a=e.__optimist.getValue();return e.__optimist.rebase(function(){return o}),o=e.__optimist.getValue(),e.__isReady?e.emit("updated",o,a):(e.__isReady=!0,e.emit("ready",o))}),t.catch(function(t){return e.emit("error",t)}),t},t.prototype._onBoltUpdate=function(e){var t=this;if(1===(null!=e?e.length:void 0)&&e[0].unique_id===this.getFileActivity().activity_key){var n=e[0];return this.__boltData=f(n),this._pullFromServer().then(function(){if(t.__isLive)return n=m(t.getFileActivity(),t.__boltData),t.__boltClient.update_states([n])})}},t.prototype._onBoltRefresh=function(e){var t=this;return this._pullFromServer().then(function(){if(t.__isLive)return t.stopLiveUpdate(),t.startLiveUpdate()})},t})(i.default);_.initClass(),t.default=_}),define("modules/clean/file_activity/clients/file_activity_data_source",["require","exports","tslib","external/lru","external/lodash","modules/clean/comments/events","modules/clean/comments/store","modules/clean/file_activity/clients/file_activity_bolt_client","modules/core/exception"],function(e,t,n,i,o,r,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importStar(o),a=n.__importDefault(a),s=n.__importDefault(s);var c=function(e,t,n,i){return void 0===i&&(i=""),e=null!=e?e:"",e+":"+t+":"+n+":"+i},u=(function(){function e(e){var t=e._cache,n=e._unsubscribeStore,i=e._sendFileActivity,o=e._state;this.onStoreUpdate=this.onStoreUpdate.bind(this),this.onClientUpdated=this.onClientUpdated.bind(this),this._cache=t,this._unsubscribeStore=n,this._sendFileActivity=i,this._state=o}return e.initInstance=function(){var t=e;if(null==t.__instance)return t.__instance=t.create(a.default,function(e){return r.CommentsEvents.emit("file-activity-updated",e)})},e.getInstance=function(){var t=e;return l.assert(null!=t.__instance,"expected singleton to have been initialized"),t.__instance},e.create=function(t,n,o){void 0===o&&(o=10);var r=new i.default(o);r.shift=function(){var e=i.default.prototype.shift.call(this),t=e.value;return null!=t&&t.removeAllListeners(),null!=t&&t.stopLiveUpdate(),e};var a=new e({_cache:r,_state:{},_sendFileActivity:n});return a._unsubscribeStore=t.listen(a.onStoreUpdate),a.onStoreUpdate(t.state),a},e.prototype.dispose=function(){return this._unsubscribeStore()},e.prototype.resetCache=function(){return this._cache.removeAll()},e.prototype.replaceState=function(e){if(this.shouldUpdate(e)){this.willUpdate(e);var t=this._state;return this._state=e,this.didUpdate(t)}},e.prototype.getState=function(){return this._state},e.prototype.onStoreUpdate=function(e){var t=e.actorId,n=e.oref,i=e.viewing,o=i.context,r=i.contextData,a={oref:n,actorId:t,context:o,contextData:r};return this.replaceState(a)},e.prototype.shouldUpdate=function(e){return!o.isEqual(this._state,e)},e.prototype.willUpdate=function(e){var t=this.getCurrentClient();if(null!=t)return this.deactivateClient(t)},e.prototype.didUpdate=function(e){var t=this.getCurrentFetchKey();if(!this.isFetching(t)&&(this.sendActivity(null),!this.isNullState(this._state)))return this.fetchAndSend(this._state)},e.prototype.getFetchKey=function(e){return c(e.actorId,e.context,e.contextData,e.oref)},e.prototype.getCurrentFetchKey=function(){return this.getFetchKey(this._state)},e.prototype.getCurrentClient=function(){var e=this.getCurrentFetchKey()
;return this._cache.get(e)},e.prototype.isFetching=function(e){var t=this._cache.find(this.getFetchKey(e));return null!=t&&!t.isReady()},e.prototype.isNullState=function(e){return!(null!=e.context&&null!=e.contextData)},e.prototype.activateClient=function(e){if(e.on("ready",this.onClientUpdated),e.on("updated",this.onClientUpdated),e.on("error",this.onClientError),e.startLiveUpdate(),e.isReady())return this.onClientUpdated(e.getFileActivity())},e.prototype.deactivateClient=function(e){return e.off("ready",this.onClientUpdated),e.off("updated",this.onClientUpdated),e.off("error",this.onClientError),e.stopLiveUpdate()},e.prototype.deactivateCurrentClient=function(){var e=this.getCurrentClient();if(null!=e)return this.deactivateClient(e)},e.prototype.fetchAndSend=function(e){var t=e.actorId,n=e.context,i=e.contextData,o=e.oref,r=c(t,n,i,o),a=this._cache.get(r);if(null!=a)return this.activateClient(a);var s=this.createFileActivityBoltClient({actorId:t,context:n,contextData:i,oref:o});return s.init(),this._cache.set(r,s),this.activateClient(s)},e.prototype.onClientUpdated=function(e){return this.sendActivity(e)},e.prototype.onClientError=function(e){throw e},e.prototype.sendActivity=function(e){return this._sendFileActivity(e)},e.prototype.createFileActivityBoltClient=function(e){return new s.default(e)},e.prototype.rebase=function(e){var t=this.getCurrentClient();return null!=t&&t.rebase(e)},e.prototype.commitOptimisticUpdate=function(e){var t=this.getCurrentClient();return null!=t?t.commitOptimisticUpdate(e):null},e.prototype.rollbackOptimisticUpdate=function(e){var t=this.getCurrentClient();return null!=t&&t.rollbackOptimisticUpdate(e)},e})();t.default=u}),define("modules/clean/file_activity/models/file_activity",["require","exports","tslib","external/lodash","modules/core/types","modules/clean/file_activity/models/immutability_helper","modules/clean/activity/activity_user","modules/clean/comments/lib/type_check","modules/clean/comments/models/comment_activity","modules/clean/file_activity/models/revision"],function(e,t,n,i,o,r,a,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),o=n.__importDefault(o);var u=o.default.Maybe,d=(function(){function e(e){var t=void 0===e?{}:e,n=t.activity_key,i=void 0===n?"":n,o=t.feedback_off,r=void 0!==o&&o,a=t.can_edit_feedback,s=void 0===a||a,l=t.comment_activities,c=void 0===l?[]:l,u=t.users_to_notify,d=void 0===u?[]:u,p=t.latest_revision,m=void 0===p?null:p;this.activity_key=i,this.feedback_off=r,this.can_edit_feedback=s,this.comment_activities=c,this.users_to_notify=d,this.latest_revision=m}return e.fromDict=function(t){return new e({activity_key:t.activity_key,feedback_off:t.feedback_off,can_edit_feedback:t.can_edit_feedback,comment_activities:t.comment_activity_dicts.map(l.CommentActivity.fromDict),users_to_notify:(t.users_to_notify||[]).map(a.ActivityUser.fromDict),latest_revision:t.latest_revision})},e.prototype.enableCommenting=function(){return r.set(this,"feedback_off",!1)},e.prototype.disableCommenting=function(){return r.set(this,"feedback_off",!0)},e.prototype._withMutations=function(e){var t=r.thaw(this);return e(t),t},e.prototype._reapComments=function(e){var t=this.comment_activities.slice();return this.comment_activities.forEach(function(e){t.push.apply(t,e.comment_activities)}),e?t.filter(e):t},e.prototype._findCommentPath=function(e,t){void 0===t&&(t=!1);for(var n=function(t){return t.activity_key===e},i=0;i<this.comment_activities.length;i++){var o=this.comment_activities[i];if(n(o))return["comment_activities",i];if(!t)for(var r=0;r<o.comment_activities.length;r++)if(n(o.comment_activities[r]))return["comment_activities",i,"comment_activities",r]}return null},e.prototype._updateComment=function(e,t){return e?r.updateIn(this,e,t):this},e.prototype._updateConversations=function(e){return r.update(this,"comment_activities",e)},e.prototype._updateReplies=function(e,t){var n=this._findCommentPath(e,!0);return n?(n.push("comment_activities"),r.updateIn(this,n,t)):this},e.prototype.findCommentByKey=function(e){for(var t=function(t){return t.activity_key===e},n=0;n<this.comment_activities.length;n++){var i=this.comment_activities[n];if(t(i))return i;for(var o=0;o<i.comment_activities.length;o++){var r=i.comment_activities[o];if(t(r))return r}}return null},e.prototype.findConversationByKey=function(e){return i.find(this.comment_activities,{activity_key:e})},e.prototype.purgeCommentByKey=function(e){var t=this._findCommentPath(e);if(t){var n=t.pop();return r.updateIn(this,t,function(e){return r.splice(e,n,1)})}return this},e.prototype.appendComment=function(e,t){var n=function(e){return r.push(e,t)};return this.activity_key===e?this._updateConversations(n):this._updateReplies(e,n)},e.prototype.resolveCommentByKey=function(e){var t=this._findCommentPath(e);return this._updateComment(t,function(e){return e.resolve()})},e.prototype.unresolveCommentByKey=function(e){var t=this._findCommentPath(e);return this._updateComment(t,function(e){return e.unresolve()})},e.prototype.setCommentStatusByKey=function(e,t){var n=this._findCommentPath(e);return this._updateComment(n,function(e){return e.setStatus(t)})},e.prototype.markCommentSeenByKeyBatch=function(e){return 0===e.length?this:this._withMutations(function(t){t._reapComments(function(t){return e.includes(t.activity_key)}).forEach(function(e){e.is_seen=!0,e.highlight_as_unread=!1})})},n.__decorate([s.takes({activity_key:String,feedback_off:Boolean,can_edit_feedback:Boolean,comment_activity_dicts:Array,users_to_notify:u(Array),latest_revision:c.RevisionShape})],e,"fromDict",null),e})();t.FileActivity=d}),define("modules/clean/file_activity/models/immutability_helper",["require","exports"],function(e,t){"use strict";function n(e){if(null==e)throw new TypeError("Cannot thaw null/undefined object");if(Array.isArray(e))return f.call(e);for(var t=Object.create(Object.getPrototypeOf(e)),n=Object.getOwnPropertyNames(e),i=0,o=n;i<o.length;i++){var r=o[i],a=Object.getOwnPropertyDescriptor(e,r);a&&(a.get||a.set)?(a.configurable=!0,Object.defineProperty(t,r,a)):t[r]=e[r]}return t}function i(e,t){var i=n(e);return t(i),i}function o(e,t){if(!t||0===t.length)throw new TypeError("Invalid key path: "+JSON.stringify(t));return t.reduce(function(e,t){return null==e?null:e[t]},e)}function r(e,t,i){if(null==e)throw new TypeError("Object to `set` cannot be null");if(e[t]===i)return e;var o=n(e);return o[t]=i,o}function a(e,t,n){return r(e,t,n(e[t]))}function s(e,t,n){if(!t||0===t.length)throw new TypeError("Invalid key path: "+JSON.stringify(t));if(null==e)throw new TypeError("Target object cannot be null");var i=t[0];return 1===t.length?a(e,i,n):r(e,i,s(e[i],t.slice(1),n))}function l(e,t,n){if(!t||0===t.length)throw new TypeError("Invalid key path: "+JSON.stringify(t));if(null==e)throw new TypeError("Target object cannot be null");var i=t[0];switch(t.length){case 1:return r(e,i,n);default:return r(e,i,l(e[i]||{},t.slice(1),n))}}function c(e,t){if(null==e||null==t)throw new TypeError("Both target and source cannot be null");var i=Object.keys(t).reduce(function(n,i){return t[i]!==e[i]&&n.push(i),n},[]);if(i.length){for(var o=n(e),r=0,a=i;r<a.length;r++){var s=a[r],l=Object.getOwnPropertyDescriptor(t,s);void 0!==l&&Object.defineProperty(o,s,l)}return o}return e}function u(e,t,n){if(null==e||null==n)throw new TypeError("Both target and source cannot be null");return s(e,t,function(e){return c(e,n)})}function d(e,t,n){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var r=f.call(e);return r.splice.apply(r,[t,n].concat(i)),r}function p(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=f.call(e);return i.unshift.apply(i,t),i}function m(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=f.call(e);return i.push.apply(i,t),i}Object.defineProperty(t,"__esModule",{value:!0});var f=Array.prototype.slice;t.thaw=n,t.withMutations=i,t.getIn=o,t.set=r,t.update=a,t.updateIn=s,t.setIn=l,t.merge=c,t.mergeIn=u,t.splice=d,t.unshift=p,t.push=m}),define("modules/clean/file_activity/models/revision",["require","exports","tslib","modules/core/types"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i);var o=i.default.Maybe;t.RevisionShape=Object.freeze({revision_id:String,when:Number,preview_link:o(String),direct_blockserver_link:o(String)})}),define("modules/clean/frame_messenger/frame_messenger_base",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e){var t=this;this._window=window,this.handleUntrustedMessage=function(e){if(t.isOriginAllowed(e.origin)){var n;try{n=JSON.parse(e.data)}catch(e){return}n.action&&t.dispatchMessage(e,n)}},this.allowedOrigins=e}return e.prototype.getWindow=function(){return this._window},e.prototype.setWindow=function(e){this._window=e},e.prototype.startListening=function(){this.getWindow().addEventListener("message",this.handleUntrustedMessage)},e.prototype.stopListening=function(){this.getWindow().removeEventListener("message",this.handleUntrustedMessage)},e.prototype.regexIn=function(e,t){if(t.indexOf(e)>-1)return!0;for(var n=0,i=t;n<i.length;n++){var o=i[n];if(o instanceof RegExp&&e.match(o))return!0}return!1},e.stripStandardPort=function(e){return"http://"===e.substr(0,7)?e.replace(/:80/,""):"https://"===e.substr(0,8)?e.replace(/:443$/,""):e},e.prototype.isOriginAllowed=function(t){return this.regexIn(e.stripStandardPort(t),this.allowedOrigins)},e.prototype.packagePostMessage=function(e,t){var n={action:e,parameters:t};return JSON.stringify(n)},e})();t.FrameMessengerBase=n}),define("modules/clean/frame_messenger/frame_messenger_host",["require","exports","tslib","modules/clean/frame_messenger/frame_messenger_base","modules/clean/frame_messenger/frame_messenger_logger"],function(e,t,n,i,o){"use strict";function r(e,t){return t.indexOf(e)>=0}Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._trustedChildOriginForPosting=null,t._validActionsFromChild=[],t.getChildIframes=function(){return[]},t}return n.__extends(t,e),t.prototype.configureChildMessaging=function(e,t,n){if("string"==typeof e){var i=e;this.getChildIframes=function(){return[].slice.call(document.querySelectorAll(i),0)}}else this.getChildIframes=e;this._trustedChildOriginForPosting=null,this._validActionsFromChild=n,this._trustedMessageFromChildHandler=t},t.prototype.startListening=function(){e.prototype.startListening.call(this),this.postMessageToChildren("parent-ready")},t.prototype.getTrustedChildOriginForPosting=function(){if(null!=this._trustedChildOriginForPosting)return this._trustedChildOriginForPosting;for(var e=this.getChildIframes(),t=0,n=e;t<n.length;t++){var i=n[t],o=""+i.getAttribute("src"),r=this.getOriginFromUrl(o);if(this.isOriginAllowed(r)){this.updateChildOrigin(r);break}}return this._trustedChildOriginForPosting},t.prototype.childIsValidated=function(){return null!=this._trustedChildOriginForPosting},t.prototype._isNumber=function(e){return!isNaN(parseInt(e,10))},t.prototype.getOriginFromUrl=function(e){var t=document.createElement("a");t.href=e;var n=t.origin;if(n)return"null"===n?"*":n;var i=this._isNumber(t.port)?":"+t.port:"";return t.protocol+"//"+t.hostname+i},t.prototype.postMessageToChildren=function(e,t){void 0===t&&(t={});var n=this.getChildIframes();this.postMessageToChildElements(n,e,t)},t.prototype.resetOriginsForPosting=function(){this._trustedChildOriginForPosting=null},t.prototype.updateChildOrigin=function(e){"null"===e&&(e="*"),this._trustedChildOriginForPosting=e},t.prototype.dispatchMessage=function(e,t){o.logFrameMessage("frame_messenger_host",{event:e,messageJson:t}),this.updateChildOrigin(e.origin),"child-requesting-parent-origin"===t.action&&this.postMessageToChildren("parent-ready"),r(t.action,this._validActionsFromChild)&&null!=this._trustedMessageFromChildHandler&&this._trustedMessageFromChildHandler(t)},t.prototype.postMessageToChildElements=function(e,t,n){void 0===n&&(n={});var i=this.getTrustedChildOriginForPosting();if(null!==i){var o=this.packagePostMessage(t,n);e.forEach(function(e){e.contentWindow&&e.contentWindow.postMessage(o,i)})}},t})(i.FrameMessengerBase);t.FrameMessengerHost=a}),define("modules/clean/frame_messenger/frame_messenger_logger",["require","exports","tslib","external/lodash"],function(e,t,n,i){"use strict";function o(e,t){t.eventName,t.messageJson,t.event,t.data;return}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var r=[];t.logFrameMessage=o;i.debounce(function(){console.groupCollapsed("Frame Messenger Events"),console.table(r),console.groupEnd()},1e3)}),define("modules/clean/image_annotations",["require","exports","tslib","jquery","modules/clean/image_preview_util","modules/clean/image_viewer_annotation_interface","modules/clean/image_viewer_annotation_renderer"],function(e,t,n,i,o,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importDefault(o),r=n.__importDefault(r),a=n.__importDefault(a);var s=(function(){function e(e){var t=this;this.onClickPreviewImageContainer=function(e){var n=function(t){return!!i.default(e.target).closest(t).length};n(o.default.getPreviewImage())||n(o.default.getAnnotationContainer())||t.hideAnnotation()},this.hideAnnotation=function(){var e=t.annotationInterface;e&&e.onHideAnnotation()},this.onTransitionEnd=function(e){"opacity"!==e.propertyName&&t.forceResizeAndUpdateOffsets()},this.forceResizeAndUpdateOffsets=function(){t.resizeAnnotationContainer(),null!=t.annotationInterface&&t.annotationInterface.onScaleChangeCallback(void 0)},this._handleMessage=this._handleMessage.bind(this),this._onScroll=this._onScroll.bind(this),this.onResize=this.onResize.bind(this),this.opts=e}return e.prototype.onImageLoad=function(e){return void 0===e&&(e=null),this.reset(),this.resizeImageCallback=e,this._prepareAnnotations()},e.prototype.replaceOpts=function(e){this.opts=e,this.annotationRenderer&&this.annotationRenderer.replaceOpts(e),this.annotationInterface&&this.annotationInterface.replaceOpts(e)},e.prototype._prepareAnnotations=function(){this._prepareAnnotationInterface(),this.annotationRenderer=new a.default(this.opts),window.addEventListener("resize",this.onResize),o.default.getPreviewImageWrapper().on("scroll",this._onScroll),window.addEventListener("transitionend",this.onTransitionEnd),window.addEventListener("message",this._handleMessage),this._postPageRendered()},e.prototype._prepareAnnotationInterface=function(){if(0===o.default.getAnnotationContainer().length){var e=o.default.getPreviewImageWrapper(),t=i.default("<div class='"+o.default.ANNOTATION_CONTAINER+"' />");this.$annotationContainer=t.appendTo(e)}this.resizeAnnotationContainer(),this.annotationInterface=new r.default(this.opts),o.default.getPreviewImageContainer().on("click.image",this.onClickPreviewImageContainer),o.default.getAnnotationContainer().on("mouseup.image",this.annotationInterface.onMouseUpCallback).on("mousedown.image",this.annotationInterface.onMouseDownCallback).on("mousemove.image",this.annotationInterface.onMouseMoveCallback).on("mouseenter.image",this.annotationInterface.onMouseEnterCallback).on("keydown.image",this.annotationInterface.onKeyDownCallback),setTimeout(this.forceResizeAndUpdateOffsets,0)},e.prototype._handleMessage=function(e){var t;try{t=JSON.parse(e.data)}catch(e){return}var n=this,i=n.annotationInterface,o=n.annotationRenderer;if(i&&o)switch(t.action){case"focus-annotation":var r=t.parameters.id;o.focusAnnotation(r);break;case"hover-annotation":var r=t.parameters.id;o.hoverAnnotation(r);break;case"update-annotations":this.resizeAnnotationContainer(),i.updateOffset(void 0),o.updateAnnotations(t.parameters);break;case"remove-annotation":var a=t.parameters.commentActivity;o.removeAnnotation(a);break;case"remove-all-annotations":o.removeAllAnnotations(),this.resizeAnnotationContainer(),i.updateOffset(void 0);break;case"enable-annotation-creation":i.enableAnnotationCreation();break;case"disable-annotation-creation":i.disableAnnotationCreation();break;case"enable-region-creation":this._setRegionCreationEnabled(!0);break;case"disable-region-creation":this._setRegionCreationEnabled(!1);break;case"hide-annotation":this.hideAnnotation();break;case"scroll-to-annotation":if(!this.opts.comments2AnnotationsEnabled){var a=t.parameters.commentActivity;o.highlightAnnotation(a)}break;case"place-default-annotation":i.placeDefaultAnnotation();break;case"file-feedback-ui-ready":this._postPageRendered()}},e.prototype._postPageRendered=function(){return this._postMessage("page-rendered")},e.prototype._postMessage=function(e,t){return void 0===t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},e.prototype._setRegionCreationEnabled=function(e){return e?null!=this.annotationInterface&&this.annotationInterface.enableRegionCreation():null!=this.annotationInterface&&this.annotationInterface.disableRegionCreation(),this.resizeAnnotationContainer(),null!=this.annotationInterface?this.annotationInterface.updateOffset(void 0):void 0},e.prototype._onScroll=function(){return null!=this.annotationInterface?this.annotationInterface.onScrollCallback(void 0):void 0},e.prototype.onResize=function(e){var t=this;void 0===e&&(e=!0);var n=this,i=n.annotationRenderer,o=n.annotationInterface;null!=i&&i.removeAllAnnotations(),this._postMessage("scale-change");var r=function(){return t.resizeAnnotationContainer(),t._postPageRendered(),null!=o&&o.onScaleChangeCallback(void 0),"function"==typeof t.resizeImageCallback?t.resizeImageCallback():void 0};return clearTimeout(this.scaleChangeTimer),e?this.scaleChangeTimer=setTimeout(r,100):r()},e.prototype.resizeAnnotationContainer=function(){if(this.$annotationContainer){var e=o.default.getPreviewImage();if(e&&e.offset()&&e.offsetParent()&&e.offsetParent().offset()){var t=Math.max(e.offset().top-e.offsetParent().offset().top,0),n=Math.max(e.offset().left-e.offsetParent().offset().left,0),r=t+"px "+n+"px";if(this.$annotationContainer.css("margin",r),this.annotationInterface&&this.annotationInterface.isAnnotationRegionEnabled){var a=e[0].getBoundingClientRect(),s=a.width,l=a.height;this.$annotationContainer.height(l),this.$annotationContainer.width(s);var c=i.default(".comments2-annotation-overlay");c.height(l),c.width(s),c.css("margin",r)}else this.$annotationContainer.height(0),this.$annotationContainer.width(0)}}},e.prototype.removeAnnotations=function(){return null!=this.annotationRenderer?this.annotationRenderer.removeAllAnnotations():void 0},e.prototype.reset=function(){return null!=this.annotationRenderer&&this.annotationRenderer.reset(),null!=this.annotationInterface&&this.annotationInterface.reset(),o.default.getPreviewImageContainer().off("click.image"),o.default.getAnnotationContainer().off("mouseup.image").off("mousedown.image").off("mousemove.image").off("keydown.image"),o.default.getPreviewImageWrapper().off("scroll",this._onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("message",this._handleMessage),window.removeEventListener("transitionend",this.onTransitionEnd),this._postMessage("reset-file-feedback-ui")},e})();t.ImageAnnotations=s}),define("modules/clean/image_preview_util",["require","exports","tslib","jquery","modules/clean/react/size_class/constants","modules/clean/react/previews/image/constants"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),r=n.__importStar(r);var a={PREVIEW_IMAGE_CONTAINER:"preview-image-container",PREVIEW_IMAGE_WRAPPER:"preview-image-wrapper",PREVIEW_IMAGE:"preview-image",ANNOTATION_CONTAINER:"db-annotation-container",ANNOTATION_LAYER_CSS:"db-annotation-layer",ANNOTATION_CANVAS_LAYER_CSS:"db-annotation-canvas-layer",getPreviewImageContainer:function(){return i.default("."+this.PREVIEW_IMAGE_CONTAINER)},getPreviewImageWrapper:function(){return i.default("."+this.PREVIEW_IMAGE_WRAPPER)},getPreviewImage:function(){return this.getPreviewImageContainer().find("."+this.PREVIEW_IMAGE)},getPreviewImageElement:function(){return this.getPreviewImage()[0]},getAnnotationContainer:function(){return i.default("."+this.ANNOTATION_CONTAINER)},getAnnotationLayers:function(){return i.default("."+this.ANNOTATION_LAYER_CSS)},getAnnotationLCanvasLayer:function(){return i.default("."+this.ANNOTATION_CANVAS_LAYER_CSS)},convertAnnotationImagePointsToViewportCoordinates:function(e){for(var t=[],n=a.getPreviewImageElement().getBoundingClientRect(),i=n.width,o=n.height,r=0,s=Array.from(e.image_coordinates);r<s.length;r++){for(var l=s[r],c=[],u=0,d=Array.from(l.coordinates);u<d.length;u++){var p=d[u],m=p.x*i,f=p.y*o;c.push({x:m,y:f})}t.push(c)}return t},convertAnnotationViewportCoordinatesToImagePoints:function(e,t,n){for(var i=[],o=a.getPreviewImageElement().getBoundingClientRect(),r=o.width,s=o.height,l=0,c=Array.from(e.viewportCoordinates);l<c.length;l++){for(var u=c[l],d=[],p=0,m=Array.from(u);p<m.length;p++){var f=m[p],h=(f.x-t)/r,_=(f.y-n)/s;d.push({x:h,y:_})}i.push({coordinates:d})}return i},getImagePadding:function(e){return e===o.SizeClass.Large?{height:r.IMAGE_LARGE_PADDING_HEIGHT,width:r.IMAGE_LARGE_PADDING_WIDTH}:{height:r.IMAGE_PADDING_HEIGHT,width:r.IMAGE_PADDING_WIDTH}},getMinimumZoomPercent:function(e){var t=e.windowDimensions,n=e.imagePadding,i=e.imageDimensions,o=(t.height-n.height)/i.height,r=(t.width-n.width)/i.width;return Math.min(o,r,1)}};t.default=a}),define("modules/clean/image_size",["require","exports"],function(e,t){"use strict";function n(e,t){for(var n=0,o=i;n<o.length;n++){var r=o[n],a=r[0],s=r[1],l=r[2];if(s>=e||l>=t)return a}return i[i.length-1][0]}Object.defineProperty(t,"__esModule",{value:!0});var i=[["480x320",480,320],["640x480",640,480],["800x600",800,600],["1024x768",1024,768],["1280x960",1280,960],["1600x1200",1600,1200],["2048x1536",2048,1536]];t.imageBestFitSize=n}),define("modules/clean/image_viewer_annotation_interface",["require","exports","tslib","react","external/react-dom","jquery","modules/clean/annotations/annotation_controller","modules/clean/image_preview_util"],function(e,t,n,i,o,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importStar(o),r=n.__importDefault(r),a=n.__importDefault(a),s=n.__importDefault(s);var l=(function(){function e(e){var t=this;this.onAnnotationRegionStart=function(){t.setDraftAnnotationExists(!0)},this.setDraftAnnotationExists=function(e){var t=s.default.getAnnotationLCanvasLayer();t&&0!==t.length&&t.attr("data-draft-annotation-exists",e)},this._prepareAnnotationController=this._prepareAnnotationController.bind(this),this._refreshAnnotationController=this._refreshAnnotationController.bind(this),this._prepareAnnotationCoords=this._prepareAnnotationCoords.bind(this),this.onHideAnnotation=this.onHideAnnotation.bind(this),this.onMouseDownCallback=this.onMouseDownCallback.bind(this),this.onMouseMoveCallback=this.onMouseMoveCallback.bind(this),this.onMouseUpCallback=this.onMouseUpCallback.bind(this),this.onMouseEnterCallback=this.onMouseEnterCallback.bind(this),this.onKeyDownCallback=this.onKeyDownCallback.bind(this),this.onScrollCallback=this.onScrollCallback.bind(this),this.onScaleChangeCallback=this.onScaleChangeCallback.bind(this),this.onAnnotationHiddenCallback=this.onAnnotationHiddenCallback.bind(this),this.onAnnotationPlacedCallback=this.onAnnotationPlacedCallback.bind(this),this.onAnnotationStartDragCallback=this.onAnnotationStartDragCallback.bind(this),this.onAnnotationEndDragCallback=this.onAnnotationEndDragCallback.bind(this),this.onAnnotationScrollCallback=this.onAnnotationScrollCallback.bind(this),this.onAnnotationScaleChangeCallback=this.onAnnotationScaleChangeCallback.bind(this),this.onAnnotationEnterCallback=this.onAnnotationEnterCallback.bind(this),this.onAnnotationLeaveCallback=this.onAnnotationLeaveCallback.bind(this),this.controllerEventHandlers={onMouseMoveCallback:r.default.noop,onMouseDownCallback:r.default.noop,onMouseUpCallback:r.default.noop,onMouseEnterCallback:r.default.noop,onHideAnnotation:r.default.noop,onScrollCallback:r.default.noop,onScaleChangeCallback:r.default.noop,onKeyDownCallback:r.default.noop},this.isAnnotationRegionEnabled=!1,this.isAnnotationCreationEnabled=!1,this.opts=e,this._prepareAnnotationController()}return e.prototype.replaceOpts=function(e){this.opts=e},e.prototype.sendToParent=function(e,t){return void 0===t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},e.prototype._isOnAnnotationUI=function(e){return r.default(e.target).parents(".db-annotation-layer").length>0},e.prototype._isOnAnnotationOverlay=function(e){return r.default(e.target).parents("#annotation-overlay").length>0},e.prototype._destroyAnnotationController=function(){var e=s.default.getAnnotationLCanvasLayer();e&&e.length>0&&(o.unmountComponentAtNode(e[0]),e.remove())},e.prototype._prepareAnnotationController=function(){var e=s.default.getAnnotationContainer();if(0===e.find("."+s.default.ANNOTATION_CANVAS_LAYER_CSS).length){var t=r.default("<div class='"+s.default.ANNOTATION_CANVAS_LAYER_CSS+"' />");return this.$parentContainerEl=t.appendTo(e),this.parentContainerOffset=this.$parentContainerEl.offset(),this._refreshAnnotationController()}},e.prototype._refreshAnnotationController=function(e){if(null!=this.$parentContainerEl?this.$parentContainerEl.get(0):void 0){var t=s.default.getPreviewImageElement().getBoundingClientRect();return this.annotationController=o.render(i.default.createElement(a.default,{parentContainerOffset:this.parentContainerOffset,controllerEventHandlers:this.controllerEventHandlers,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationRegionStart:this.onAnnotationRegionStart,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback,isAnnotationMarkerEnabled:!1,isAnnotationHighlightEnabled:!1,isAnnotationRegionEnabled:this.isAnnotationRegionEnabled,isAnnotationCreationEnabled:this.isAnnotationCreationEnabled,disableTinyAnnotationRegions:this.opts.comments2AnnotationsEnabled,creationLayerWidth:t.width,creationLayerHeight:t.height}),this.$parentContainerEl.get(0),e)}},e.prototype._prepareAnnotationCoords=function(e){return null!=e&&(e=this.addTranslatedImagePoints(e)),e},e.prototype.addTranslatedImagePoints=function(e){return e.image_coordinates=s.default.convertAnnotationViewportCoordinatesToImagePoints(e,this.parentContainerOffset.left,this.parentContainerOffset.top),e},e.prototype.updateOffset=function(e){if(this.$parentContainerEl)return this.parentContainerOffset=this.$parentContainerEl.offset(),this._refreshAnnotationController(e)},e.prototype.enableAnnotationCreation=function(){return this.isAnnotationCreationEnabled=!0,this._refreshAnnotationController()},e.prototype.disableAnnotationCreation=function(){return this.isAnnotationCreationEnabled=!1,this._refreshAnnotationController()},e.prototype.enableRegionCreation=function(){return r.default("html").addClass("region-creation"),this.isAnnotationRegionEnabled=!0,this._refreshAnnotationController()},e.prototype.disableRegionCreation=function(){return r.default("html").removeClass("region-creation"),this.isAnnotationRegionEnabled=!1,this._refreshAnnotationController()},e.prototype.placeDefaultAnnotation=function(){if(null!=this.annotationController){var e={image_coordinates:[{coordinates:[{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:0}]}]},t=s.default.convertAnnotationImagePointsToViewportCoordinates(e)[0];this.annotationController.createRegion({top:t[0].y,left:t[0].x,bottom:t[2].y,right:t[2].x})}},e.prototype.reset=function(){return this.disableRegionCreation(),this._destroyAnnotationController(),s.default.getAnnotationContainer().remove()},e.prototype.onHideAnnotation=function(){return null!=this.controllerEventHandlers?this.controllerEventHandlers.onHideAnnotation():void 0},e.prototype.onMouseDownCallback=function(e){if((this.opts.comments2AnnotationsEnabled||!this._isOnAnnotationUI(e))&&!this._isOnAnnotationOverlay(e))return null!=this.controllerEventHandlers?this.controllerEventHandlers.onMouseDownCallback(e):void 0},e.prototype.onMouseMoveCallback=function(e){return null!=this.controllerEventHandlers?this.controllerEventHandlers.onMouseMoveCallback(e):void 0},e.prototype.onMouseUpCallback=function(e){return null!=this.controllerEventHandlers?this.controllerEventHandlers.onMouseUpCallback(e):void 0},e.prototype.onMouseEnterCallback=function(e){this.controllerEventHandlers&&this.controllerEventHandlers.onMouseEnterCallback(e)},e.prototype.onKeyDownCallback=function(e){var t=e.keyCode||e.which||e.charCode;return this.sendToParent("on-keydown",{keyCode:t})},e.prototype.onScrollCallback=function(e){if(this.updateOffset(null!=this.controllerEventHandlers?this.controllerEventHandlers.onScrollCallback():void 0),!(null!=this.annotationController?this.annotationController.hasVisibleActiveAnnotation():void 0))return this.sendToParent("scroll")},e.prototype.onScaleChangeCallback=function(e){return this.updateOffset(null!=this.controllerEventHandlers?this.controllerEventHandlers.onHideAnnotation:void 0),this.sendToParent("scale-change",e)},e.prototype.onAnnotationHiddenCallback=function(){return this.setDraftAnnotationExists(!1),this.sendToParent("annotation-hidden")},e.prototype.onAnnotationPlacedCallback=function(e){return this.setDraftAnnotationExists(!0),this.sendToParent("annotation-placed",{annotation:this._prepareAnnotationCoords(e)})},e.prototype.onAnnotationStartDragCallback=function(e){return this.sendToParent("annotation-start-drag")},e.prototype.onAnnotationEndDragCallback=function(e){return this.sendToParent("annotation-end-drag",{annotation:this._prepareAnnotationCoords(e)})},e.prototype.onAnnotationScrollCallback=function(e){return this.sendToParent("scroll",{annotation:this._prepareAnnotationCoords(e)})},e.prototype.onAnnotationScaleChangeCallback=function(e){return this.sendToParent("scale-change",{annotation:this._prepareAnnotationCoords(e)})},e.prototype.onAnnotationEnterCallback=function(){return this.sendToParent("annotation-enter",{annotation:this._prepareAnnotationCoords()})},e.prototype.onAnnotationLeaveCallback=function(){return this.sendToParent("annotation-leave",{annotation:this._prepareAnnotationCoords()})},e})();t.default=l}),define("modules/clean/image_viewer_annotation_renderer",["require","exports","tslib","react","external/react-dom","external/lodash","jquery","modules/clean/annotations/annotation_renderer_utils","modules/clean/image_preview_util","modules/clean/react/comments2/position_utils"],function(e,t,n,i,o,r,a,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importStar(o),r=n.__importStar(r),a=n.__importDefault(a),s=n.__importDefault(s),l=n.__importDefault(l);var u=new s.default,d=(function(){function e(e){var t=this;this.isAnnotationEmphasized=function(e){return[t._focusedAnnotationId,t._hoveredAnnotationId].includes(e)},this.updateEmphasizedAnnotations=function(){r.toPairs(t._refsByActivityKey).forEach(function(e){var n=e[0];return e[1].setEmphasized(t.isAnnotationEmphasized(n))})},this._renderAnnotation=function(e,r,s,c){var u=l.default.getAnnotationContainer();if(u&&u.length>0){r.viewportCoordinates=l.default.convertAnnotationImagePointsToViewportCoordinates(r);var d=a.default("<div class='"+l.default.ANNOTATION_LAYER_CSS+"' />");d.attr({"data-comment-activity-key":s.activity_key});var p=d.appendTo(u).get(0),m=t._comments2AnnotationsEnabled?{onMouseMove:t.updateHoverOnMouseEvent,isEmphasized:t.isAnnotationEmphasized(s.activity_key),useEmphasizedState:!0}:{}
;return o.render(i.default.createElement(e,n.__assign({annotation:r,commentActivity:s,options:c,onAnnotationClickCallback:t.onAnnotationClickCallback,onAnnotationEnterCallback:t.onAnnotationEnterCallback,onAnnotationOverCallback:t.onAnnotationOverCallback,onAnnotationLeaveCallback:t.onAnnotationLeaveCallback,ref:function(e){return t.setAnnotationRef(e,s.activity_key)}},m)),p)}},this.setAnnotationRef=function(e,n){e&&(t._refsByActivityKey[n]=e)},this.clearCachedAnnotationClientRects=function(){t.getBoundingClientRectForActivityKey.cache.clear()},this.getBoundingClientRectForActivityKey=r.memoize(function(e){var n=t._refsByActivityKey[e];if(!n)throw new Error("no annotation for activityKey: "+e);return n.refs.annotationRegion.getBoundingClientRect()}),this.getRankedActivityKeysFromMouseEvent=function(e){var n=r.mapValues(t._refsByActivityKey,function(e,n){return t.getBoundingClientRectForActivityKey(n)});return c.getRankedElementsForMousePosition(e,n,200)},this.updateHoverOnMouseEvent=function(e){e.persist(),t.updateHoverOnMouseEventThrottled(e)},this.updateHoverOnMouseEventThrottled=r.throttle(function(e){var n=t.getRankedActivityKeysFromMouseEvent(e);if(!n.length)return void t._sendToParent("annotation-ui-leave",{});var i=n[0];t._sendToParent("annotation-ui-enter",{commentActivity:{activity_key:i}})},150),this.onAnnotationClickCallback=function(e,i){var o=t.getRankedActivityKeysFromMouseEvent(i);return t._sendToParent("annotation-ui-click",n.__assign({},e,{rankedActivityKeys:o}))},this.removeAnnotation=this.removeAnnotation.bind(this),this.updateAnnotations=this.updateAnnotations.bind(this),this._renderAnnotation=this._renderAnnotation.bind(this),this.onAnnotationClickCallback=this.onAnnotationClickCallback.bind(this),this.onAnnotationEnterCallback=this.onAnnotationEnterCallback.bind(this),this.onAnnotationLeaveCallback=this.onAnnotationLeaveCallback.bind(this),this._annotationsByActivityKey={},this._refsByActivityKey={},this._comments2AnnotationsEnabled=e.comments2AnnotationsEnabled}return e.prototype.replaceOpts=function(e){this._comments2AnnotationsEnabled=e.comments2AnnotationsEnabled},e.prototype.hoverAnnotation=function(e){this._hoveredAnnotationId=e,this.updateEmphasizedAnnotations()},e.prototype.focusAnnotation=function(e){this._focusedAnnotationId=e,this.updateEmphasizedAnnotations()},e.prototype._isAnnotationAlreadyRendered=function(e){return a.default("."+l.default.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e+"']").length>0},e.prototype.removeAnnotation=function(e){if(this._isAnnotationAlreadyRendered(e.activity_key)){delete this._refsByActivityKey[e.activity_key];var t=a.default("."+l.default.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e.activity_key+"']").get(0);o.unmountComponentAtNode(t),t.remove()}},e.prototype.removeAllAnnotations=function(){return this.reset()},e.prototype.reset=function(){for(var e=l.default.getAnnotationLayers(),t=0,n=Array.from(e);t<n.length;t++){var i=n[t];o.unmountComponentAtNode(i)}return e.remove(),this._refsByActivityKey={},this.clearCachedAnnotationClientRects(),this._annotationsByActivityKey={}},e.prototype.highlightAnnotation=function(e){if(this._isAnnotationAlreadyRendered(e.activity_key)){var t=a.default("."+l.default.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e.activity_key+"']");return t.removeClass("start-highlight-animation"),t.width(t.width()),t.addClass("start-highlight-animation")}},e.prototype.updateAnnotations=function(e){var t=this;if(u.shouldUpdateAnnotations(e,this._annotationsByActivityKey))return this.removeAllAnnotations(),(function(){for(var n=[],i=0,o=Array.from(e.annotations);i<o.length;i++){var r=o[i];u.renderAnnotation(r,t._isAnnotationAlreadyRendered,t._renderAnnotation);var a=r.commentActivity.activity_key;n.push(t._annotationsByActivityKey[a]=r)}return n})()},e.prototype._sendToParent=function(e,t){return void 0===t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},e.prototype.onAnnotationEnterCallback=function(e){return this._sendToParent("annotation-ui-enter",e)},e.prototype.onAnnotationOverCallback=function(e){return{}},e.prototype.onAnnotationLeaveCallback=function(e,t){this._comments2AnnotationsEnabled?this.updateHoverOnMouseEvent(t):this._sendToParent("annotation-ui-leave",e)},e})();t.default=d}),define("modules/clean/integrations/zoom_share_dialog/async_modal",["require","exports","tslib"],function(e,t,n){"use strict";function i(t,i,o,r){return n.__awaiter(this,void 0,void 0,function(){var a;return n.__generator(this,function(s){switch(s.label){case 0:return[4,new Promise(function(t,n){e(["modules/clean/integrations/zoom_share_dialog/modal"],t,n)}).then(n.__importStar)];case 1:return a=s.sent().showModal,a(t,i,o,r||"web"),[2]}})})}Object.defineProperty(t,"__esModule",{value:!0}),t.asyncShowModal=i}),define("modules/clean/loggers/file_preview_logger",["require","exports","tslib","modules/clean/ajax","modules/clean/react/file_viewer/constants","modules/clean/react/previews/constants","modules/clean/web_timing_logger","modules/constants/request","modules/core/browser"],function(e,t,n,i,o,r,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),a=n.__importStar(a),s=n.__importStar(s),l=n.__importStar(l);var c={};c[o.EventType.FilePreviewSessionEnded]="preview_session_ended",c[o.EventType.FilePreviewAttemptStarted]="preview_attempted",c[o.EventType.FilePreviewSupportConfirmed]="support_confirmed",c[o.EventType.FilePreviewSupportDenied]="support_denied",c[o.EventType.FilePreviewDownloadAttempted]="download_attempted",c[o.EventType.FilePreviewDownloadSucceeded]="download_succeeded",c[o.EventType.FilePreviewDownloadFailed]="download_failed",c[o.EventType.FilePreviewRenderSucceeded]="render_succeeded",c[o.EventType.FilePreviewRenderFailed]="render_failed",c[o.EventType.FilePreviewFidelitySurveyAsked]="fidelity_survey_asked",c[o.EventType.FilePreviewFidelitySurveyAnswered]="fidelity_survey_answered",c[o.EventType.FilePreviewFidelitySurveyDismissed]="fidelity_survey_dismissed",c[o.EventType.FilePreviewUserAction]="user_action",c[o.EventType.ArchivePreviewContentsScanned]="archive_contents_scanned",c[o.EventType.FilePreviewModeDetermined]="file_preview_mode_determined",c[o.EventType.FilePreviewModeBounce]="file_preview_mode_bounce";var u=(function(){function e(){this._eventHandlers={}}return e.prototype._getSerializedTimeline=function(e){return null},e.prototype.addEventHandlers=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,i=e;n<i.length;n++){var o=i[n],r=o[0],a=o[1];this._eventHandlers[r]=a}},e.prototype._log=function(e,t,n){void 0===n&&(n={});var o=this._getSerializedTimeline(t),r={device_type:t.fileViewerSession.deviceType,event_name:c[e],extra:JSON.stringify(n),file_viewer_session_id:t.fileViewerSession.id,file_preview_session_id:t.id,file_ns_id:t.file.ns_id,file_sjid:t.file.sjid,file_preview_timeline:o?JSON.stringify(o):null,file_preview_size:t.previewSize};i.SilentBackgroundBeaconRequest({url:"/log/file_preview",data:r})},e.prototype.listenTo=function(e){for(var t in this._eventHandlers)if(this._eventHandlers.hasOwnProperty(t)){var n=this._eventHandlers[t];e.addListener(t,n)}},e.prototype.unlistenTo=function(e){for(var t in this._eventHandlers)if(this._eventHandlers.hasOwnProperty(t)){var n=this._eventHandlers[t];e.removeListener(t,n)}},e})(),d=(function(e){function t(){var t=e.call(this)||this;return t._logAsked=function(e){t._log(o.EventType.FilePreviewFidelitySurveyAsked,e)},t._logAnswered=function(e,n){t._log(o.EventType.FilePreviewFidelitySurveyAnswered,e,n)},t._logDismissed=function(e,n){t._log(o.EventType.FilePreviewFidelitySurveyDismissed,e,n)},t.addEventHandlers([o.EventType.FilePreviewFidelitySurveyAsked,t._logAsked],[o.EventType.FilePreviewFidelitySurveyAnswered,t._logAnswered],[o.EventType.FilePreviewFidelitySurveyDismissed,t._logDismissed]),t}return n.__extends(t,e),t.prototype._log=function(t,n,i){void 0===i&&(i={}),i._client_time=+Date.now();var o=n.sourceContext,r=n.sourceAction;o&&(i._source_context=o),r&&(i._source_action=r),e.prototype._log.call(this,t,n,i)},t})(u);t.FilePreviewFidelitySurveyLogger=d;var p=(function(e){function t(t){var n=e.call(this)||this;return n._handleFilePreviewAttemptStarted=function(e,t){n._handleEvent(o.EventType.FilePreviewAttemptStarted,e,t)},n._handleFilePreviewSupportConfirmed=function(e,t){n._handleEvent(o.EventType.FilePreviewSupportConfirmed,e,t)},n._handleFilePreviewSupportDenied=function(e,t){n._handleEvent(o.EventType.FilePreviewSupportDenied,e,t)},n._handleFilePreviewDownloadAttempted=function(e,t){n._handleEvent(o.EventType.FilePreviewDownloadAttempted,e,t)},n._handleFilePreviewDownloadSucceeded=function(e,t){n._handleEvent(o.EventType.FilePreviewDownloadSucceeded,e,t)},n._handleFilePreviewDownloadFailed=function(e,t){n._handleEvent(o.EventType.FilePreviewDownloadFailed,e,t)},n._handleFilePreviewRenderSucceeded=function(e,t){n._handleEvent(o.EventType.FilePreviewRenderSucceeded,e,t)},n._handleFilePreviewRenderFailed=function(e,t){n._handleEvent(o.EventType.FilePreviewRenderFailed,e,t)},n._handleFilePreviewSessionEnded=function(e,t){n._handleEvent(o.EventType.FilePreviewSessionEnded,e,t)},n._filePreviewSessionId=t,n.addEventHandlers([o.EventType.FilePreviewAttemptStarted,n._handleFilePreviewAttemptStarted],[o.EventType.FilePreviewSupportConfirmed,n._handleFilePreviewSupportConfirmed],[o.EventType.FilePreviewSupportDenied,n._handleFilePreviewSupportDenied],[o.EventType.FilePreviewDownloadAttempted,n._handleFilePreviewDownloadAttempted],[o.EventType.FilePreviewDownloadSucceeded,n._handleFilePreviewDownloadSucceeded],[o.EventType.FilePreviewDownloadFailed,n._handleFilePreviewDownloadFailed],[o.EventType.FilePreviewRenderSucceeded,n._handleFilePreviewRenderSucceeded],[o.EventType.FilePreviewRenderFailed,n._handleFilePreviewRenderFailed],[o.EventType.FilePreviewSessionEnded,n._handleFilePreviewSessionEnded]),n}return n.__extends(t,e),t.prototype._handleEvent=function(e,t,n){if(void 0===n&&(n={}),this._filePreviewSessionId===t.id){n.preview_type=t.previewType,n.file_preview_timeline=JSON.stringify(this._getSerializedTimeline(t)),n.web_timing_logger_req_id=s.REQUEST_ID,n.source_context=t.sourceContext,n.source_action=t.sourceAction,null!=t.primaryMarkTs&&(n.primary_mark_ts=t.primaryMarkTs,n.time_to_primary_mark=t.timeToPrimaryMark());var i=a.start_time();if(null!=t.lastEvent&&(n.last_event=c[t.lastEvent]),t.sourceAction===r.PreviewSourceAction.Visit&&e===o.EventType.FilePreviewRenderSucceeded){var u=a.time_to_interactive();null!=u&&null!=i&&(n.time_to_interactive=u-i);var d=l.performance();if(null!=d){var p=d.timing;null!=p&&null!=i&&(n.time_to_first_byte=p.responseStart-i,n.web_timing_data=JSON.stringify(p))}window._timingData&&window._timingData.img&&(delete window._timingData.img.dl_error_finish,n.img_timing_data=JSON.stringify(window._timingData.img))}e===o.EventType.FilePreviewSessionEnded&&(n.password_needed=t.passwordNeeded),this._log(e,t,n)}},t.prototype._getSerializedTimeline=function(e){var t={};for(var n in e.previewTimeline)if(e.previewTimeline.hasOwnProperty(n)){var i=e.previewTimeline[n],o=this._timelineKey(n);t[o]=i.timestamp}return t},t.prototype._timelineKey=function(e){return c[e]+"_ts"},t})(u);t.FilePreviewTimelineLogger=p;var m=(function(e){function t(){var t=e.call(this)||this;return t.logContentsScanned=function(e,n){t._log(o.EventType.ArchivePreviewContentsScanned,e,n)},t.addEventHandlers([o.EventType.ArchivePreviewContentsScanned,t.logContentsScanned]),t}return n.__extends(t,e),t})(u);t.FilePreviewArchiveLogger=m;var f=(function(e){function t(){var t=e.call(this)||this;return t._logUserAction=function(e,n,i,r){r.action=n,r.context=i,t._log(o.EventType.FilePreviewUserAction,e,r)},t.addEventHandlers([o.EventType.FilePreviewUserAction,t._logUserAction]),t}return n.__extends(t,e),t})(u);t.FilePreviewUserActionLogger=f;var h=(function(e){function t(){var t=e.call(this)||this;return t.determinedTime=0,t.bounceLogged=!1,t.logDetermined=function(e,n){t.determinedTime=Date.now(),t._log(o.EventType.FilePreviewModeDetermined,e,n)},t.logBounce=function(e){if(!t.bounceLogged&&0!==t.determinedTime){t.bounceLogged=!0;var n=Date.now()-t.determinedTime;t._log(o.EventType.FilePreviewModeBounce,e,{time:n})}},t.addEventHandlers([o.EventType.FilePreviewModeDetermined,t.logDetermined],[o.EventType.FilePreviewModeBounce,t.logBounce]),t}return n.__extends(t,e),t})(u);t.FilePreviewModeLogger=h}),define("modules/clean/loggers/file_viewer_logger",["require","exports","tslib","modules/clean/analytics","modules/clean/file_store/utils","modules/constants/python"],function(e,t,n,i,o,r){"use strict";function a(){return i.UserActivityLogger.start("web","file_view_first_page_rendered"),i.PreviewActivityLogger.start("file_view_first_page_rendered"),i.FileViewLogger.start()}function s(e,t){e=e;for(var r=o.getExtension(e),a=n.__assign({},t.attributes,{total_time:-1,file_ext:r,source:"file-viewer",originalSize:null!=e.bytes?e.bytes:0}),s=0,l=t.stats;s<l.length;s++){var u=l[s];a[c[u.name]]=u.end-u.start}return i.UserActivityLogger.stop("web","file_view_first_page_rendered",a),i.PreviewActivityLogger.stop("file_view_first_page_rendered",{file_ext:r,extra:JSON.stringify(a)})}function l(e,t,n,a,s,l,c){void 0===c&&(c=!1);var u={user_id:null!=t?t.id:void 0,target:n,platform:r.FileViewPlatformType.WEB,ns_id:e.ns_id,sjid:e.sjid,ns_path:e.ns_path,origin:a,action:s,shared_link_url:l,extra:{file_ext:o.getExtension(e),file_bytes:e.bytes,file_mtime:e.ts,preview_type:e.preview_type,time_taken:-1,is_team:1===(null!=t?t.is_team:void 0),paid:1===(null!=t?t.paid:void 0),is_ndsl:c}};return i.FileViewLogger.stop(u)}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var c={Overall:"viewer_overall_time","Page Request":"viewer_page_request_time",Rendering:"viewer_rendering_time"};t.start=a,t.logPageRendered=s,t.logView=l}),define("modules/clean/loggers/video_preview_logger",["require","exports","tslib","modules/clean/ajax","modules/clean/perf_tools/web_timing_utils"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var r=(function(){function e(e,t){this.videoTruncated=!1,this.filePreviewSessionId=t?t.id:"",this.videoFormat=e}return e.prototype.populateVideoDuration=function(e){this.videoDuration=Math.round(e)},e.prototype.setVideoTruncated=function(){this.videoTruncated=!0},e.prototype.logEvent=function(e,t){var n=o.WebTimingUtil.getNow(),r={event_name:e,client_timestamp_ms:n,file_preview_session_id:this.filePreviewSessionId,video_format:this.videoFormat,video_duration_seconds:this.videoDuration,video_truncated:this.videoTruncated,extra:t?JSON.stringify(t):void 0};i.SilentBackgroundBeaconRequest({url:"/log/video_preview",data:r})},e})();t.VideoPreviewLogger=r}),define("modules/clean/logging/hive/schemas/web-comments2",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e){this.category="web-comments2",this.active_user_id=null,this.authed_user_ids=null,this.identity_gid=null,this.locale_browser_header=null,this.locale_user_selected=null,this.referrer=null,this.session_id=null,this.team_id=null,this.team_type=null,this.ua_browser_name=null,this.ua_browser_version=null,this.ua_dist_name=null,this.ua_dist_version=null,this.ua_os_name=null,this.ua_os_version=null,this.user_agent=null,this.user_id=null,this.event=e.event,this.comment_gid=e.comment_gid,this.thread_gid=e.thread_gid,this.stream_gid=e.stream_gid,this.timestamp=Math.floor(Date.now()/1e3),this.is_annotation=e.is_annotation,this.time_comment_offset=e.time_comment_offset,this.file_extension=e.file_extension,this.file_obj_id=e.file_obj_id,this.platform=e.platform,this.oref_name=e.oref_name,this.ns_id=e.ns_id,this.file_size=e.file_size,this.annotation_type=e.annotation_type,this.page=e.page,Object.seal(this)}return e})();t.Comments2LoggingTableRow=n}),define("modules/clean/optimistic_update",["require","exports","tslib","external/lodash"],function(e,t,n,i){"use strict";function o(e){return i.isString(e)}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var r={},a=(function(){function e(e){this._base=e,this._journal=[],this._head=r}return e.prototype.getValue=function(){return this._head===r&&(this._head=this._journal.reduce(function(e,t){return t.patch(e,t.id)},this._base)),this._head},e.prototype.commit=function(e){var t=i.uniqueId("optimist-patch-");return this._head=r,this._journal.push({id:t,patch:e}),t},e.prototype.rollback=function(e){return null!==this._removeJournalEntry(e)},e.prototype.rebase=function(e){if(o(e)){var t=this._removeJournalEntry(e);return!!t&&(this._head=r,this._base=t.patch(this._base,e),!0)}return this._head=r,this._base=e(this._base),!0},e.prototype._removeJournalEntry=function(e){var t=i.findIndex(this._journal,function(t){return t.id===e});return t<0?null:(this._head=r,this._journal.splice(t,1)[0])},e})();t.Optimist=a}),define("modules/clean/previews/actions",["require","exports","tslib","modules/clean/referrer_cleansing_redirect","modules/core/i18n"],function(e,t,n,i,o){"use strict";function r(e){var t=window.open("about:blank");if(!t)throw new Error(o._("Could not open new window"));window.setTimeout(function(){var n=t.document.createElement("style");n.innerHTML="\n      @page { margin: 0;}\n      img { max-width: 100%; max-height: 100%}\n    ",t.document.head.appendChild(n);var i=function(){t.print()},o=function(){t.close()},r=t.document.createElement("img");r.src=e,r.onload=i,r.onerror=o,t.document.body.appendChild(r)},50)}function a(e){i.safe_open_tab_and_redirect(e)}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),t.imagePrint=r,t.docPrint=a}),define("modules/clean/previews/pending_upload_watcher",["require","exports","tslib","modules/clean/ajax","modules/clean/react/file_viewer/data/actions","modules/core/browser","modules/core/uri"],function(e,t,n,i,o,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),r=n.__importStar(r);var s=(function(){function e(e,t,n){void 0===n&&(n=""),this.pollUrl=new a.URI({path:"/sp/"}).updateQuery({link_type:e,link_key:t,secure_hash:n}).toString()}return e.prototype.startPolling=function(){this.pollPending()},e.prototype.pollSuccess=function(e){var t=JSON.parse(e);if(t.hasOwnProperty("upload_status")&&"complete"===t.upload_status)return void o.pendingFileUploaded();setTimeout(this.pollPending.bind(this),2e3)},e.prototype.pollFailure=function(e){e.status<400||e.status>=500?this.retryPoll():r.reload(!0)},e.prototype.retryPoll=function(){setTimeout(this.pollPending.bind(this),2e3)},e.prototype.pollPending=function(){var e=this;i.SilentBackgroundRequest({url:this.pollUrl,success:function(t){e.pollSuccess(t)},error:function(t){e.pollFailure(t)}})},e})();t.PendingUploadWatcher=s}),define("modules/clean/previews/util",["require","exports","tslib","modules/core/browser","modules/clean/analytics","modules/clean/datetime","modules/clean/filepath","modules/clean/previews/constants","modules/clean/file_store/utils","modules/clean/react/previews/constants","file-viewer/core","modules/constants/file_viewer","modules/core/uri"],function(e,t,n,i,o,r,a,s,l,c,u,d,p){"use strict";function m(){return".react-file-viewer__preview iframe"}function f(){return d.PASS_PLATFORM_INFO}function h(e){return["xls","csv","ods"].indexOf(e.substring(0,3))>-1}function _(e){var t=a.file_extension(e);return d.LOGGING_WHITELISTED_EXTS.includes("."+t)?t:d.LOGGING_EXT_PLACEHOLDER}function v(e){if("indd"===e)return e;var t=e.substring(0,3);switch(t){case"rtf":case"odt":case"wpd":return"doc";case"pps":case"odp":return"ppt";case"csv":case"ods":return"xls";default:return t}}function g(e){if(e.ts)return r.getActingTime(1e3*e.ts)}function y(e){if(e.ts)return r.getActingTime(1e3*e.ts,!1,!0,-1,!1,!0)}function b(e){if(e.ts)return r.getActingTime(1e3*e.ts,!1,!0,-1,!1,!1)}function w(e){if(e){var t=new Date(e);return r.getActingTime(t.getTime(),!1,!0,-1,!1,!0)}}function C(e){return e=e.updateQuery({annotation_highlight:"1"}),e=e.updateQuery({annotation_region:"1"})}function S(e,t){var n={};return n._subject_uid=String(t),e.updateQuery(n)}function E(e,t){return S(new p.URI({path:"/history"+e.fq_path}),t.id)}function A(e,t){o.UserActivityLogger.log("web","view_version_history");var n=E(e,t);i.redirect(n.toString())}function T(e){return d.PRESENTATION_EXTS.map(function(e){return e.slice(1)}).includes(e)}function P(e){return["doc","docm","docx"].includes(e)}function I(e){return["odp","odt","rtf","wpd"].includes(e)}function k(e,t){var n=Number.MAX_VALUE;if("pdf"===e)n=Number(524288e3);else if(P(e)||I(e))n=s.MAX_WORD_DOC_FILE_SIZE_B;else if(T(e))n=s.MAX_PPT_FILE_SIZE_B;else if(t===s.PreviewType.Archive)n=s.MAX_ARCHIVE_FILE_SIZE_B;else if(t===s.PreviewType.HTML||t===s.PreviewType.Text)n=Number(8388608);else{if(t!==s.PreviewType.Linkfile)return;n=Number(10240)}return n}function x(e,t){var n=e.bytes;if(void 0===n)return!0;var i=l.getExtension(e),o=k(i,t);return!o||n<=o}function M(e){return 0===e.bytes}function O(e){var t=c.ErrorType.LoadError;return e===u.RivieraStatus.TooBig?t=c.ErrorType.FileSizeError:e===u.RivieraStatus.PasswordProtected&&(t=c.ErrorType.PasswordProtectedError),t}function F(){return{overflow:"auto","-webkit-overflow-scrolling":"touch"}}function R(e,t){return e&&t?p.URI.parse(e).updateQuery({psid:t.id}).toString():e}function D(e,t){return s.IworkExtensions.includes(l.getExtension(e))&&!e.is_dir&&t===s.PreviewType.Image}function L(e){return s.IworkExtensions.includes(l.getExtension(e))}function N(e){return e.preview_type===s.PreviewType.CloudDoc}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),a=n.__importStar(a),d=n.__importStar(d),t.getIframeQuery=m,t.shouldShowPlatformInfo=f,t.is_excel2_file=h,t.getWhitelistedExtension=_,t.normalize_extension=v,t.getModifierString=g,t.getCompactDateTimeString=y,t.getCompactLowerCaseDateTimeString=b,t.getDateTimeFromUTCString=w,t.update_url_for_annotation=C,t.update_url_with_user_id=S,t.getVersionHistoryUrl=E,t.redirectToVersionHistory=A,t.VALID_PREVIEW_TYPES=[s.PreviewType.Archive,s.PreviewType.Audio,s.PreviewType.CloudDoc,s.PreviewType.Excel,s.PreviewType.HTML,s.PreviewType.Image,s.PreviewType.Linkfile,s.PreviewType.Other,s.PreviewType.SsrDoc,s.PreviewType.RawHTML,s.PreviewType.Restricted,s.PreviewType.Video,s.PreviewType.Doc,s.PreviewType.Photo,s.PreviewType.Text],t.isPptExtension=T,t.isWordDocExtension=P,t.isLibreOfficeExtension=I,t.getFileSizeLimit=k,t.filesizeSupported=x,t.isEmptyFile=M,t.mapRivieraStatusToErrorType=O,t.iOSIframeScrollStyles=F,t.tagCriticalPathContentRequest=R,t.isLimitedPreview=D,t.isSupportedBundleFile=L,t.isCloudDocPreview=N}),define("modules/clean/react/app_actions/data/store",["require","exports","modules/clean/react/app_actions/data/action_creators"],function(e,t,n){"use strict";function i(e,t,i){e.dispatch(n.updateExtensionConfigWithNewFiles({files:t,user:i}))}Object.defineProperty(t,"__esModule",{value:!0}),t.hydrateExtensionsNamespace=i}),define("modules/clean/react/comments2/components/annotations/empty_layer",["require","exports","tslib","external/react"],function(e,t,n,i){"use strict";function o(e){var t={position:"absolute",left:0,top:0,right:0,bottom:0};return i.default.createElement("div",{style:t},e.children)}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.EmptyLayer=o});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};define("modules/clean/react/comments2/components/annotations/loadable",["require","exports","modules/clean/react/async/loadable","modules/clean/react/comments2/components/annotations/empty_layer"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationViewLayer=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/comments2/components/annotations/annotation_view_layer"],t,n)}).then(__importStar).then(function(e){return e.AnnotationViewLayer})}}),t.AnnotationConductorLayer=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/comments2/components/annotations/annotation_conductor_layer"],t,n)}).then(__importStar).then(function(e){return e.AnnotationConductorLayer})},loading:i.EmptyLayer}),t.AnnotationInstructionalTooltipPane=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/comments2/components/annotations/annotation_instructional_tooltip_pane"],t,n)}).then(__importStar).then(function(e){return e.AnnotationInstructionalTooltipPane})},loading:i.EmptyLayer})}),define("modules/clean/react/comments2/components/mobile_web_comments",["require","exports","tslib","react","external/lodash","modules/clean/web_timing_logger","modules/clean/react/async/loadable","modules/clean/react/file_sidebar/base_comments_tab","modules/clean/react/comments2/util","modules/clean/react/size_class/constants"],function(e,t,n,i,o,r,a,s,l,c){"use strict";function u(e){return function(){return i.default.createElement(t.AsyncMobileWebComments,n.__assign({},e,{isMobile:!0,fileSidebarDispatch:o.noop,collapsed:!1}))}}function d(e){var t=e.currentFile;return e.sizeClass!==c.SizeClass.Large||l.isComments2Mobile()&&null!=t.ns_id?i.default.createElement(s.BaseCommentsTab,n.__assign({},e,{content:u(e),isVersionHistoryMode:!1})):null}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importStar(o),t.AsyncMobileWebComments=a.Loadable({loader:function(){return r.waitForTTI().then(function(){return new Promise(function(t,n){e(["modules/clean/react/comments2/components/comments_pane"],t,n)}).then(n.__importStar).then(function(e){return e.CommentsPane})})}}),t.MobileWebComments=d}),define("modules/clean/react/comments2/components/snackbars",["require","exports","tslib","react","modules/clean/react/snackbar","modules/core/i18n"],function(e,t,n,i,o,r){"use strict";function a(e){var t=e.message,n=i.default.createElement(o.Snackbar,{title:t,variant:"complete",closeButtonText:l,id:"comments2"});o.Snackbar.show(n)}function s(e){var t=e.message,n=e.retryFn,r=n?i.default.createElement(o.Snackbar,{title:t,variant:"fail",closeButtonText:l,actionButtonText:c,onActionClick:function(){n(),o.Snackbar.close()},id:"comments2"}):i.default.createElement(o.Snackbar,{title:t,variant:"fail",closeButtonText:l,id:"comments2"});o.Snackbar.show(r)}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i);var l=r._("Close",{comment:"Button to dismiss snackbar message"}),c=r._("Retry",{comment:"Button to retry a failed action"});t.showSuccessSnackbar=a,t.showErrorSnackbar=s}),define("modules/clean/react/comments2/data/action_helper",["require","exports","tslib"],function(e,t,n){"use strict";function i(e,t){return e.zero?{type:e.actionType}:{type:e.actionType,payload:t}}function o(e,t){return{type:e.actionTypes.request,payload:t,meta:{args:t}}}function r(e,t,n){return{type:e.actionTypes.success,payload:n,meta:{args:t}}}function a(e,t,n){return{type:e.actionTypes.error,error:n,meta:{args:t}}}function s(e){return{error:e+".Error",request:e+".Request",success:e+".Success"}}function l(e){return{actionTypes:s(e),name:e,type:"async"}}function c(e){return{actionType:e,name:e,type:"sync",zero:!1}}function u(e){return{actionType:e,name:e,type:"sync",zero:!0}}function d(e){return{asyncAction:function(t){return l(e+"/"+t)},syncAction:function(t){return c(e+"/"+t)},syncAction0:function(t){return u(e+"/"+t)}}}function p(e){return e.zero?function(){return{type:e.name}}:function(t){return{payload:t,type:e.name}}}function m(){var e=this;return function(t,i){return n.__awaiter(e,void 0,void 0,function(){var e,o,r,a,s;return n.__generator(this,function(n){switch(n.label){case 0:e=i.action,o=i.args,r=i.dispatch,r({type:e.actionTypes.request,payload:o,meta:{args:o}}),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,t(i)];case 2:return a=n.sent(),r({type:e.actionTypes.success,payload:a,meta:{args:o}}),[2,a];case 3:throw s=n.sent(),r({type:e.actionTypes.error,error:s,meta:{args:o}}),s;case 4:return[2]}})})}}var f=this;Object.defineProperty(t,"__esModule",{value:!0}),t.syncReduxAction=i,t.requestReduxAction=o,t.successReduxAction=r,t.errorReduxAction=a,t.asyncActionConstants=s,t.asyncAction=l,t.syncAction=c,t.syncAction0=u,t.namespacedActions=d,t.syncHandler=p,t.createAsyncHandler=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t,i){return function(o){return function(r,a){return n.__awaiter(f,void 0,void 0,function(){var s,l,c=this;return n.__generator(this,function(u){switch(u.label){case 0:s=e.reduceRight(function(e,t){return function(i){return n.__awaiter(c,void 0,void 0,function(){return n.__generator(this,function(n){switch(n.label){case 0:return[4,t(e,i)];case 1:return[2,n.sent()]}})})}},function(e){return i(o,e)}),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,s({action:t,args:o,dispatch:r,getState:a})];case 2:return[2,u.sent()];case 3:return l=u.sent(),[3,4];case 4:return[2]}})})}}}},t.dispatchMiddleware=m,t.thunkHandler=t.createAsyncHandler(),t.asyncHandler=t.createAsyncHandler(m())}),define("modules/clean/react/comments2/data/actions",["require","exports","tslib","external/lodash","modules/core/browser","modules/core/i18n","modules/clean/redux/types","modules/clean/react/comments2/data/api","modules/clean/react/file_sidebar/store/instance","modules/clean/react/comments2/transforms","modules/clean/react/comments2/data/types","modules/clean/react/comments2/enable_disable_option","modules/clean/react/comments2/components/snackbars","modules/clean/react/comments2/util","modules/clean/react/comments2/data/logger","modules/clean/react/comments2/data/perf_util","modules/clean/react/comments2/data/selectors","spectrum_comments/utils/throttle-debounce","modules/clean/bolt","modules/clean/browse_interface","modules/clean/react/comments2/data/action_helper","modules/clean/react/file_sidebar/store/sidebar/actions"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m,f,h,_,v,g,y,b,w){"use strict";function C(e){var t=this,i=e.clientFn,r=e.successCallback,a=e.eventToLog;return function(e,l){return n.__awaiter(t,void 0,void 0,function(){var t,c,u,d,p;return n.__generator(this,function(n){switch(n.label){case 0:if(t=_.getContext(l()),!t||!t.viewer)throw new Error;c=new s.Comments2Api(t.viewer.id,t.stream),u=o.get_uri().getQuery().oref,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,i(c)];case 2:return d=n.sent(),c.logEvent(a,{oref:u}),f.logEvent("telemetry_"+a,{stream:t.stream}),r(e,l,d),[3,4];case 3:return p=n.sent(),c.logErrorEvent("error trying to execute client event "+a,{oref:u}),[3,4];case 4:return[2]}})})}}function S(e){return function(n){n(ae(e));var i=e.thread;i.read||n(t.Actions.markThreadRead({threadId:i.id,origin:u.MarkThreadReadOrigin.ThreadActivated}))}}function E(){var e=/comment_id=(.*)/.exec(o.get_uri().getFragment());return e?e[1]:void 0}function A(e,t,n){var i="enabled"===t[".tag"]||"readonly"===t[".tag"],o={isEnabled:i};null!=n&&(o.canEnable=n.can_enable_commenting),o.isEnabled=i,e(Qe(o))}function T(){return C({clientFn:function(e){return e.enableCommenting()},successCallback:P,eventToLog:"enable_comments"})}function P(e,t,i){return n.__awaiter(this,void 0,void 0,function(){var o;return n.__generator(this,function(n){return o=_.getStreamId(t()),o!==i.id?[2]:(d.removeEnableCommentingFromOverflow(),e(oe(!0,!1)),[2])})})}function I(){return C({clientFn:function(e){return e.disableCommenting()},successCallback:k,eventToLog:"disable_comments"})}function k(e,t,i){return n.__awaiter(this,void 0,void 0,function(){var o,r;return n.__generator(this,function(n){return o=_.getStreamId(t()),o!==i.id?[2]:(r=_.getContext(t()),x(e,r,!0),[2])})})}function x(e,t,i){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(n){switch(n.label){case 0:return e(Qe({isEnabled:!1})),
[4,e(ne(u.Comments2ContextStatus.Disabled))];case 1:return n.sent(),i&&d.addEnableCommentingToOverflow(e,T),[4,l.store.dispatch(w.setComments2DisabledState())];case 2:return n.sent(),e(ee(t)),[2]}})})}function M(e){return function(n){if(m.useBolt()){var i=v.debounce(function(){m.unsubscribeBoltOnUpdate()&&t.bolt.unsubscribe(),G(),n(oe(!1,!1))},2e3),o=function(){t.bolt.unsubscribe(),W(function(){n(oe(!1,!1))})};t.bolt.subscribe(e,i,o)}}}function O(e){var i=this;return function(o,r){return n.__awaiter(i,void 0,void 0,function(){var i,a;return n.__generator(this,function(n){switch(n.label){case 0:return i=r(),a=_.getContext(i),m.isContextSame(a,e)?[3,2]:(t.bolt.unsubscribe(),o(ee(e)),o($e({setContextTime:+new Date,listCompleteTime:0})),e?(m.isUserSame(a&&a.viewer,e.viewer)||(o(t.Actions.checkOnboardingStatus(void 0)),m.inUpsellExperiment()&&o(he(void 0))),[4,o(oe(!0))]):[3,2]);case 1:n.sent(),n.label=2;case 2:return[2]}})})}}function F(){return function(e,t){var n=_.getContext(t.getState());if(!n||!n.viewer)throw new Error("Bad state");var o=new s.Comments2Api(n.viewer.id,n.stream);return e(i.merge({},t,{api:o,context:n}))}}function R(e){var t=this;return function(o,r){return n.__awaiter(t,void 0,void 0,function(){var t,s;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,o(r)];case 1:return t=n.sent(),e(i.merge({},r,{payload:t,status:a.ApiClientStatus.Success})),[2,t];case 2:throw s=n.sent(),e(i.merge({},r,{error:s,status:a.ApiClientStatus.Error})),s;case 3:return[2]}})})}}function D(e,t){if(t instanceof s.Comments2Error&&(t.code===s.ErrorCode.FILE_NOT_FOUND||t.code===s.ErrorCode.PERMISSION_DENIED))return{message:r._("Either that file was deleted or you no longer have access to it."),isRetriable:!1};switch(e){case Ie.name:case xe.name:case Re.name:return{message:r._("We were unable to post the comment."),isRetriable:!0};case Oe.name:return{message:r._("We were unable to delete the comment."),isRetriable:!0};case Ve.name:return{message:r._("We were unable to resolve the thread."),isRetriable:!0};case je.name:return{message:r._("We were unable to unresolve the thread."),isRetriable:!0};case Le.name:return{message:r._("We were unable to mark the thread as read."),isRetriable:!0};case Be.name:return{message:r._("We were unable to mark the thread as unread."),isRetriable:!0};case nt.name:return{message:r._("We were unable to subscribe to the file."),isRetriable:!0};case at.name:return{message:r._("We were unable to unsubscribe from the file."),isRetriable:!0};case pe.name:case ye.name:case Je.name:default:return null}}function L(e){switch(e){case nt.name:return{message:r._("You have subscribed to the file.")};case at.name:return{message:r._("You have unsubscribed from the file.")};default:return null}}function N(e){var t=this,i=e.handleError,o=e.handleSuccess;return function(e,r){return n.__awaiter(t,void 0,void 0,function(){function t(){return n.__awaiter(this,void 0,void 0,function(){var a,s,l,c;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e(r)];case 1:return a=n.sent(),[3,3];case 2:throw s=n.sent(),l=D(r.action.name,s),l&&i({message:l.message,retryFn:l.isRetriable?t:void 0}),s;case 3:return c=L(r.action.name),c&&o(c),[2,a]}})})}return n.__generator(this,function(e){switch(e.label){case 0:return[4,t()];case 1:return[2,e.sent()]}})})}}function B(){return+new Date}function U(e){var t=this;return function(i,o){return n.__awaiter(t,void 0,void 0,function(){function t(t){var n=e(o.action.name,t);if(n){var i=B();o.dispatch(j(n,i-r))}}var r,a,l,c;return n.__generator(this,function(e){switch(e.label){case 0:r=B(),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,i(o)];case 2:return a=e.sent(),[3,4];case 3:throw l=e.sent(),c=l instanceof s.Comments2Error?l.code:"unknown_error",t(c),l;case 4:return t(),[2,a]}})})}}function V(){return function(e,t){var n=t(),i=_.getViewerId(n),r=_.getFQPath(n);if(r&&i){var a=y.getFileHistoryUrl({fqPath:r,userId:i});o.redirect(a)}}}function H(e,t){var i=this;return void 0===t&&(t={}),function(o,r){return n.__awaiter(i,void 0,void 0,function(){var i,o,a;return n.__generator(this,function(n){return i=r(),o=_.getContext(i),o&&o.viewer&&(a=new s.Comments2Api(o.viewer.id,o.stream),a.logEvent(e,t)),[2]})})}}function j(e,t){var i=this;return function(o,r){return n.__awaiter(i,void 0,void 0,function(){var i,o,a,l,c;return n.__generator(this,function(n){return i=r(),(o=_.getContext(i))?(a=o.viewer,l=o.stream,c=a?new s.Comments2Api(a.id,l):new s.Comments2LoggedOutApi(l),c.logPerfEvent(e,t),[2]):[2]})})}}function q(e,t){var i=this;return function(o,r){return n.__awaiter(i,void 0,void 0,function(){var i,o,a;return n.__generator(this,function(n){return i=r(),o=_.getContext(i),o&&o.viewer&&(a=new s.Comments2Api(o.viewer.id,o.stream),a.logSimplePerfEvent(e,t)),[2]})})}}var K=this;Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),o=n.__importStar(o),m=n.__importStar(m),f=n.__importStar(f),h=n.__importStar(h),_=n.__importStar(_),w=n.__importStar(w),t.enableCommenting=T,t.disableCommenting=I,t.bolt={client:null,subscribe:function(e,n,i){var o=e.app_id,r=e.revision,a=e.token,s=e.unique_id,l=new g.SignedChannelState(o,s,r,a);t.bolt.client?t.bolt.client.update_states([l]):(t.bolt.client=new g.BoltClient([l],n,i),t.bolt.client.start())},unsubscribe:function(){t.bolt.client&&(t.bolt.client.unsubscribe(),t.bolt.client=null)}};var z=m.createBackoff(),W=z.backoff,G=z.resetBackoff;t.setFileContext=O;var Y=b.namespacedActions("Comments2"),Z=Y.asyncAction,X=Y.syncAction,Q=Y.syncAction0;t.statusHandlingMiddleware=N,t.perfLoggingMiddleware=U;var J=b.createAsyncHandler(N({handleError:p.showErrorSnackbar,handleSuccess:p.showSuccessSnackbar}),F(),R(function(e){var t=o.get_uri().getQuery().oref,n=e.getState(),i=_.getStream(n),r=_.getThreadMap(n);if(e.status===a.ApiClientStatus.Error)e.api.logErrorEvent("encountered an error with async api call "+e.action.name,{oref:t});else if(e.status===a.ApiClientStatus.Success){var s=e.args,l=e.payload;switch(e.action.name){case Ie.name:e.api.logEvent("new_comment",{commentId:l.id,oref:t});var c=r[l.id];f.logEvent("telemetry_new_comment",{commentId:l.id,stream:i,thread:c});break;case xe.name:e.api.logEvent("reply_to_comment",{commentId:l.id,oref:t,threadId:s.threadId});var c=r[s.threadId];f.logEvent("telemetry_reply_to_comment",{commentId:l.id,stream:i,thread:c});break;case Oe.name:e.api.logEvent("delete_comment",{commentId:s.commentId,oref:t,threadId:s.threadId});var c=r[s.threadId];f.logEvent("telemetry_delete_comment",{commentId:s.commentId,stream:i,thread:c});break;case Re.name:e.api.logEvent("edit_comment",{commentId:s.commentId,oref:t,threadId:s.threadId});var c=r[s.threadId];f.logEvent("telemetry_edit_comment",{commentId:s.commentId,stream:i,thread:c});break;case Ve.name:e.api.logEvent("resolve_thread",{oref:t,threadId:s});var c=r[s];f.logEvent("telemetry_resolve_thread",{stream:i,thread:c});break;case je.name:e.api.logEvent("unresolve_thread",{oref:t,threadId:s});var c=r[s];f.logEvent("telemetry_unresolve_thread",{stream:i,thread:c});break;case Le.name:var d=s.origin===u.MarkThreadReadOrigin.ThreadActivated?"read_thread":"mark_thread_as_read";e.api.logEvent(d,{oref:t,threadId:s.threadId});var c=r[s.threadId];f.logEvent("telemetry_"+d,{stream:i,thread:c});break;case Be.name:e.api.logEvent("mark_thread_as_unread",{oref:t,threadId:s});var c=r[s];f.logEvent("telemetry_mark_thread_as_unread",{stream:i,thread:c});break;case nt.name:e.api.logEvent("subscribe",{oref:t}),f.logEvent("telemetry_subscribe",{stream:i});break;case at.name:e.api.logEvent("unsubscribe",{oref:t}),f.logEvent("telemetry_unsubscribe",{stream:i})}}}),U(function(e,t){switch(e){case Ie.name:case xe.name:case Le.name:case Be.name:case Ve.name:case je.name:return h.threadActionCompleted(e,t);case Oe.name:case Re.name:return h.commentActionCompleted(e,t)}}),b.dispatchMiddleware()),$=X("SetContext"),ee=b.syncHandler($),te=X("SetContextStatus"),ne=b.syncHandler(te),ie=Z("ListComments"),oe=function(e,i){return void 0===e&&(e=!1),void 0===i&&(i=!0),function(o,a){return n.__awaiter(K,void 0,void 0,function(){var d,f,h,v,g,y,b,C,S,T,P,I,k,O,F,R,D,L,N,B,U,V,H,j,q,K;return n.__generator(this,function(n){switch(n.label){case 0:if(d=a(),f=_.getContext(d),!f)return[2];o({type:ie.actionTypes.request}),h=f.stream,v=f.viewer,g=v?new s.Comments2Api(v.id,h):new s.Comments2LoggedOutApi(h),n.label=1;case 1:return n.trys.push([1,6,,7]),[4,g.listComments(e,_.getCursor(d))];case 2:if(y=n.sent(),b=y.bolt_info,C=y.cursor,S=y.status,T=y.supported_enhancements,P=y.threads,I=y.users,k=y.permissions,O=+new Date,F=_.getContextStatus(d),F!==u.Comments2ContextStatus.Pending||"enabled"!==S[".tag"]&&"readonly"!==S[".tag"]||(R=_.getData(d),D=R.perfEvents&&R.perfEvents.setContextTime||0,o(t.Actions.logSimplePerfEvent("initial_list_completed_ms",O-D))),L=a(),N=_.getContext(L),!m.isContextSame(N,f))return[2];if(A(o,S,k),k&&o(tt({canSubscribe:k.can_subscribe,isSubscribed:k.is_subscribed})),T&&(B=T.time_based_annotations,U=T.time_based_annotations_upsell_tooltip_variant,V=(void 0===U?{".tag":"other"}:U)[".tag"],B&&o(ze()),"other"!==V&&o(Ge(V))),H=i?E():void 0,F===u.Comments2ContextStatus.Pending)switch(S[".tag"]){case"disabled":j=null!=k&&k.can_enable_commenting,x(o,f,j),H&&p.showErrorSnackbar({message:r._("Comments are disabled on this file.")});break;case"enabled":case"readonly":o($e({listCompleteTime:O})),o(ne(u.Comments2ContextStatus.Comments2)),l.store.dispatch(w.setComments2ShownState({commentCount:P.filter(function(e){return!e.resolved}).length}));break;case"comments1":o(ne(u.Comments2ContextStatus.Comments1))}return F!==u.Comments2ContextStatus.Comments2&&(F!==u.Comments2ContextStatus.Pending||"enabled"!==S[".tag"]&&"readonly"!==S[".tag"])?[3,5]:[4,o(M(b))];case 3:return n.sent(),q=c.streamToRevision(h),[4,o({type:ie.actionTypes.success,payload:{authors:I,cursor:C,threads:P,currentRevision:q}})];case 4:n.sent(),H&&o(t.Actions.activateComment(H)),n.label=5;case 5:return[3,7];case 6:return K=n.sent(),K instanceof s.Comments2Error&&(K.code===s.ErrorCode.FILE_NOT_FOUND?o(ne(u.Comments2ContextStatus.Disabled)):v&&g instanceof s.Comments2Api&&g.logErrorEvent((K.message,": "+K.message))),o({type:ie.actionTypes.error,error:K}),[3,7];case 7:return[2]}})})}},re=X("ActivateThread"),ae=b.syncHandler(re),se=function(e,t){return function(n,i){var o=i(),r=_.getDisplayedThreadsForLayer(o,e.page);n(de());var a=m.getThreadForNumberedAnnotationAtPoint(e,r,t);a&&n(S({thread:a,wasPreviewLayerClick:!0}))}},le=function(e){return function(t){return n.__awaiter(K,void 0,void 0,function(){var i;return n.__generator(this,function(n){switch(n.label){case 0:return i=l.store.getState().sidebar,i.open?[3,2]:[4,l.store.dispatch(w.open("annotation_select"))];case 1:n.sent(),n.label=2;case 2:return"comments"===i.activeTab?[3,4]:[4,l.store.dispatch(w.selectTab("comments"))];case 3:n.sent(),n.label=4;case 4:return t(S(e)),[2]}})})}},ce=function(e){return function(t,n){var i=_.getThreads(n()),o=m.findCommentThread(i,e);!o||o.comment.deleted?p.showErrorSnackbar({message:r._("That comment has been deleted.")}):o.thread.resolved&&p.showErrorSnackbar({message:r._("That comment has been resolved.")}),o&&t(S({thread:o.thread,pendingAnnotationInfo:m.getAnnotationInfoForThread(o.thread)}))}},ue=Q("DeactivateAllThreads"),de=b.syncHandler(ue),pe=Z("CheckOnboardingStatus"),me=J(pe,function(e,t){return t.api.checkOnboardingStatus()}),fe=Z("CheckUpsellExperimentDismissed"),he=J(fe,function(e,t){return t.api.checkUpsellExperiment()}),_e=X("HoverAnnotation"),ve=b.syncHandler(_e),ge=function(e,t){return function(n,i){var o=i(),r=_.getDisplayedThreadsForLayer(o,e.page),a=m.getThreadForNumberedAnnotationAtPoint(e,r,t);_.getHoverThreadId(o)!==(a&&a.id)&&n(ve(a&&a.id))}},ye=Z("MarkOnboarded"),be=J(ye,function(e,t){return t.api.markHasOnboarded(e)}),we=Z("DismissUpsellExperiment"),Ce=J(we,function(e,t){return t.api.dismissUpsellExperiment()}),Se=X("DismissOnboarding"),Ee=b.syncHandler(Se),Ae=function(e){return function(t,n){_.getOnboardingVariants(n())[e]&&t(be(e))}},Te=X("MarkModalVariantShown"),Pe=b.syncHandler(Te),Ie=Z("CreateThread"),ke=J(Ie,function(e,t){var n=e.annotation,i=(e.author,e.content),o=(e.guid,e.source),r=t.api,a=t.context.stream,s=c.iCommentContentToUserSubmittedComment({annotation:n,content:i,stream:a});return r.createThread(s,o)}),xe=Z("ReplyToThread"),Me=J(xe,function(e,t){var n=(e.author,e.content),i=(e.guid,e.threadId),o=t.api,r=t.context.stream,a=c.iCommentContentToUserSubmittedComment({content:n,stream:r});return o.replyToThread(a,i)}),Oe=Z("DeleteComment"),Fe=J(Oe,function(e,t){var n=e.commentId;e.threadId;return t.api.deleteComment(n)}),Re=Z("EditComment"),De=J(Re,function(e,t){var n=e.commentId,i=e.content,o=(e.threadId,t.api),r=t.context.stream,a=c.iCommentContentToUserSubmittedComment({content:i,stream:r});return o.editComment(n,a)}),Le=Z("MarkThreadRead"),Ne=J(Le,function(e,t){var n=(e.origin,e.threadId);return t.api.markThreadRead(n)}),Be=Z("MarkThreadUnread"),Ue=J(Be,function(e,t){return t.api.markThreadUnread(e)}),Ve=Z("MarkThreadResolved"),He=J(Ve,function(e,t){return t.api.markThreadResolved(e)}),je=Z("MarkThreadUnresolved"),qe=J(je,function(e,t){return t.api.markThreadUnresolved(e)}),Ke=Q("EnablePlayerIntegration"),ze=b.syncHandler(Ke),We=X("SetUpsellTooltipVariant"),Ge=b.syncHandler(We),Ye=Z("DismissUpsellTooltip"),Ze=J(Ye,function(e,t){return t.api.dismissUpsellTooltip()}),Xe=X("RecordEnabledStatus"),Qe=b.syncHandler(Xe),Je=X("SetPerfData"),$e=b.syncHandler(Je),et=X("SetSubscriptionStatus"),tt=b.syncHandler(et),nt=Z("Subscribe"),it=J(nt,function(e,t){return t.api.subscribe()}),ot=Q("ToggleShowResolved"),rt=b.syncHandler(ot),at=Z("Unsubscribe"),st=J(at,function(e,t){return t.api.unsubscribe()}),lt=X("UpdateDocumentCurrentPage"),ct=b.syncHandler(lt),ut=X("UpdateEditorIsEmpty"),dt=b.syncHandler(ut),pt=X("UpdatePlayerCurrentTime"),mt=b.syncHandler(pt),ft=X("DocMetadataLoad"),ht=b.syncHandler(ft),_t=X("SetPendingNumberedAnnotation"),vt=b.syncHandler(_t),gt=Q("ClearPendingNumberedAnnotation"),yt=b.syncHandler(gt),bt=Q("SetPendingNumberedAnnotationMayBeOffscreen"),wt=b.syncHandler(bt),Ct=Q("RequestEditorFocus"),St=b.syncHandler(Ct),Et=Q("FulfillEditorFocusRequest"),At=b.syncHandler(Et),Tt=X("TrackSidebarCommentsVisibility"),Pt=b.syncHandler(Tt),It=X("ResetStore"),kt=b.syncHandler(It);t.ActionTypes={SetContext:$,SetContextStatus:te,ActivateThread:re,CheckOnboardingStatus:pe,CheckUpsellExperimentDismissed:fe,CreateThread:Ie,DeactivateAllThreads:ue,DeleteComment:Oe,DismissUpsellTooltip:Ye,EditComment:Re,EnablePlayerIntegration:Ke,ListComments:ie,HoverThread:_e,MarkOnboarded:ye,DismissOnboarding:Se,DismissUpsellExperiment:we,MarkModalVariantShown:Te,MarkThreadRead:Le,MarkThreadResolved:Ve,MarkThreadUnread:Be,MarkThreadUnresolved:je,RecordEnabledStatus:Xe,ReplyToThread:xe,SetPerfData:Je,SetSubscriptionStatus:et,SetUpsellTooltipVariant:We,Subscribe:nt,ToggleShowResolved:ot,Unsubscribe:at,UpdateDocumentCurrentPage:lt,UpdateEditorIsEmpty:ut,UpdatePlayerCurrentTime:pt,DocMetadataLoad:ft,SetPendingNumberedAnnotation:_t,ClearPendingNumberedAnnotation:gt,SetPendingNumberedAnnotationMayBeOffscreen:bt,RequestEditorFocus:Ct,FulfillEditorFocusRequest:Et,TrackSidebarCommentsVisibility:Tt,ResetStore:It},t.Actions={setContextStatus:ne,setFileContext:O,activateComment:ce,activateThread:ae,activateThreadAndMarkAsRead:S,activateThreadByLayerClick:se,activateThreadByMarkerClick:le,checkOnboardingStatus:me,checkUpsellExperimentDismissed:he,createThread:ke,deactivateAllThreads:de,deleteComment:Fe,disableCommenting:I,dismissUpsellTooltip:Ze,editComment:De,enableCommenting:T,enablePlayerIntegration:ze,hoverThread:ve,hoverThreadByLayer:ge,listComments:oe,markOnboarded:be,markOnboardedIfUnmarked:Ae,dismissOnboarding:Ee,dismissUpsellExperiment:Ce,markModalVariantShown:Pe,markThreadRead:Ne,markThreadResolved:He,markThreadUnread:Ue,markThreadUnresolved:qe,recordEnabledStatus:Qe,replyToThread:Me,setPerfData:$e,setSubscriptionStatus:tt,setUpsellTooltipVariant:Ge,subscribe:it,toggleShowResolved:rt,unsubscribe:st,updateDocumentCurrentPage:ct,updateEditorIsEmpty:dt,updatePlayerCurrentTime:mt,setPendingNumberedAnnotation:vt,clearPendingNumberedAnnotation:yt,setPendingNumberedAnnotationMayBeOffscreen:wt,requestEditorFocus:St,fulfillEditorFocusRequest:At,trackSidebarCommentsVisibility:Pt,openVersionHistory:V,docMetadataLoad:ht,logEvent:H,logPerfEvent:j,logSimplePerfEvent:q,resetStore:kt}}),define("modules/clean/react/comments2/data/api",["require","exports","tslib","modules/clean/api_v2/error","modules/clean/api_v2/user_client","modules/clean/api_v2/noauth_client","modules/core/exception"],function(e,t,n,i,o,r,a){"use strict";function s(e,t){if(e instanceof i.ApiError){var n=t;return e.message&&(n+=". Detailed message: "+e.message.toString()),new c(e.error[".tag"],n,e)}return e}function l(e){var t={".tag":e.type};return e.linkUrl?{type:t,identifier:{".tag":"shared_link_details",url:e.linkUrl}}:{type:t,identifier:{".tag":"file_path_or_id",file_path_or_id:e.id}}}Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importStar(a);var c=(function(){function e(e,t,n){this.code=e,this.message=t,this.apiError=n}return e})();t.Comments2Error=c;(function(e){e.FILE_NOT_FOUND="file_not_found",e.PERMISSION_DENIED="permission_denied",e.BAD_REQUEST="bad_request"})(t.ErrorCode||(t.ErrorCode={}));var u=(function(){function e(e){this.routes=(new r.NoAuthApiV2Client).ns("comments2"),this.params={},this.stream=l(e)}return e.prototype.listComments=function(e,t){return void 0===e&&(e=!1),this.routes.rpc("logged_out/list_comments",{stream:this.stream,cursor:t,include_permissions:e},this.params).catch(function(e){throw s(e,"/logged_out/list_comments did not complete successfully")})},e.prototype.logPerfEvent=function(e,t,n){return void 0===n&&(n={}),this.logPerfEventImpl(e,t,n)},e.prototype.logPerfEventImpl=function(e,t,n){var i=n.threadId,o=n.commentId,r=n.oref,l=n.errorMessage,c={event:e,value:t,stream:this.stream,thread_id:i,comment_id:o,error_message:l,oref:r};return this.routes.rpc("log_perf_event",c,this.params).catch(function(e){throw a.reportStack("comments2 perf logging failed",{severity:a.SEVERITY.NONCRITICAL,tags:["comments2_logging"],exc_extra:c}),s(e,"/log_perf_event did not complete successfully")})},e})();t.Comments2LoggedOutApi=u;var d=(function(){function e(e){this.routes=(new o.UserApiV2Client).ns("comments2"),this.params={subjectUserId:e}}return e.prototype.enrollInBeta=function(){return this.routes.rpc("enroll_in_beta",void 0,this.params).catch(function(e){throw s(e,"/enroll_in_beta did not complete successfully")})},e})();t.Comments2NonStreamApi=d;var p=(function(){function e(e,t){this.routes=(new o.UserApiV2Client).ns("comments2"),this.params={subjectUserId:e},this.stream=l(t)}return e.prototype.checkOnboardingStatus=function(){return this.routes.rpc("check_onboarding_status",void 0,this.params).catch(function(e){throw s(e,"/check_onboarding_status did not complete successfully")})},e.prototype.checkUpsellExperiment=function(){return this.routes.rpc("check_upsell_experiment",void 0,this.params).catch(function(e){throw s(e,"/check_onboarding_status did not complete successfully")})},e.prototype.createThread=function(e,t){return this.routes.rpc("add_comment",{stream:this.stream,comment:e,source:t},this.params).catch(function(e){throw s(e,"/add_comment (new comment) did not complete successfully")})},e.prototype.deleteComment=function(e){return this.routes.rpc("delete_comment",{stream:this.stream,id:e},this.params).catch(function(e){throw s(e,"/delete_comment did not complete successfully")})},e.prototype.disableCommenting=function(){return this.routes.rpc("disable_commenting",{stream:this.stream},this.params).catch(function(e){throw s(e,"/disable_commenting did not complete successfully")})},e.prototype.dismissUpsellExperiment=function(){return this.routes.rpc("dismiss_upsell_experiment",void 0,this.params).catch(function(e){throw s(e,"/dismiss_upsell_tooltip did not complete successfully")})},e.prototype.dismissUpsellTooltip=function(){return this.routes.rpc("dismiss_upsell_tooltip",void 0,this.params).catch(function(e){throw s(e,"/dismiss_upsell_tooltip did not complete successfully")})},e.prototype.editComment=function(e,t){return this.routes.rpc("edit_comment",{stream:this.stream,id:e,comment:t},this.params).catch(function(e){throw s(e,"/edit_comment did not complete successfully")})},e.prototype.enableCommenting=function(){return this.routes.rpc("enable_commenting",{stream:this.stream},this.params).catch(function(e){throw s(e,"/enable_commenting did not complete successfully")})},e.prototype.listComments=function(e,t){return void 0===e&&(e=!1),this.routes.rpc("list_comments",{stream:this.stream,cursor:t,include_permissions:e},this.params).catch(function(e){throw s(e,"/list_comments did not complete successfully")})},e.prototype.logEvent=function(e,t){return void 0===t&&(t={}),this.logEventImpl(e,t)},e.prototype.logPerfEvent=function(e,t){return this.logPerfEventImpl(e,t)},e.prototype.logSimplePerfEvent=function(e,t){return this.logPerfEvent({".tag":e},t)},e.prototype.logErrorEvent=function(e,t){return void 0===t&&(t={}),this.logEventImpl("comment_error",n.__assign({},t,{errorMessage:e}))},e.prototype.logEventImpl=function(e,t){var n=t.threadId,i=t.commentId,o=t.oref,r=t.errorMessage,l={event:{".tag":e},stream:this.stream,thread_id:n,comment_id:i,error_message:r,oref:o};return this.routes.rpc("log_event",l,this.params).catch(function(e){throw a.reportStack("comments2 logging failed",{severity:a.SEVERITY.NONCRITICAL,tags:["comments2_logging"],exc_extra:l}),s(e,"/log_event did not complete successfully")})},e.prototype.logPerfEventImpl=function(e,t){var n={event:e,value:t,stream:this.stream};return this.routes.rpc("log_perf_event",n,this.params).catch(function(e){throw a.reportStack("comments2 perf logging failed",{severity:a.SEVERITY.NONCRITICAL,tags:["comments2_logging"],exc_extra:n}),s(e,"/log_perf_event did not complete successfully")})},e.prototype.markHasOnboarded=function(e){var t={".tag":e};return this.routes.rpc("mark_has_onboarded",{type:t},this.params).catch(function(e){throw s(e,"/mark_has_onboarded did not complete successfully")})},e.prototype.markThreadRead=function(e){return this.routes.rpc("mark_thread_read",{stream:this.stream,id:e},this.params).catch(function(e){throw s(e,"/mark_thread_read did not complete successfully")})},e.prototype.markThreadUnread=function(e){return this.routes.rpc("mark_thread_unread",{stream:this.stream,id:e},this.params).catch(function(e){throw s(e,"/mark_thread_unread did not complete successfully")})},e.prototype.markThreadResolved=function(e){return this.routes.rpc("resolve_thread",{stream:this.stream,id:e},this.params).catch(function(e){throw s(e,"/resolve_thread did not complete successfully")})},e.prototype.markThreadUnresolved=function(e){return this.routes.rpc("unresolve_thread",{stream:this.stream,id:e},this.params).catch(function(e){throw s(e,"/unresolve_thread did not complete successfully")})},e.prototype.replyToThread=function(e,t){return this.routes.rpc("add_comment",{stream:this.stream,comment:e,thread_id:t},this.params).catch(function(e){throw s(e,"/add_comment (reply comment) did not complete successfully")})},e.prototype.subscribe=function(){return this.routes.rpc("subscribe",{stream:this.stream},this.params).catch(function(e){throw s(e,"/subscribe did not complete successfully")})},e.prototype.unsubscribe=function(){return this.routes.rpc("unsubscribe",{stream:this.stream},this.params).catch(function(e){throw s(e,"/unsubscribe did not complete successfully")})},e})();t.Comments2Api=p}),define("modules/clean/react/comments2/data/initial_state",["require","exports","modules/clean/react/comments2/data/types"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i;t.INITIAL_STATE={context:void 0,data:{editorIsEmpty:!0,threads:{},authors:{},activatedThreadId:void 0,documentRectangleToMakeVisible:void 0,hoverThreadId:void 0,cursor:void 0,modalVariantsShown:(i={},i[n.ModalVariant.EmailVerifyModal]=!1,i[n.ModalVariant.SignUpModal]=!1,i),onboardingVariants:{premium_av_comments_pane_surface:!1,premium_av_preview_surface:!1,non_premium_av_comments_pane_surface:!1,not_annotatable_file_comments_pane_surface:!1,how_to_at_mention_comments_pane_surface:!1,image_preview_surface:!1,document_preview_surface:!1},pendingAnnotationInfo:{playerCurrentTime:0,annotationMayBeOffscreen:!1},showResolved:!1,upsellExperimentNotDismissed:!1,playerIntegrationEnabled:!1,enabledStatus:{canEnable:!1,isEnabled:!1},subscriptionStatus:{canSubscribe:!1,isSubscribed:!1},requestEditorFocus:!1,visibleInSidebar:!0,perfEvents:{},upsellTooltipVariant:void 0},statuses:{}}}),define("modules/clean/react/comments2/data/logger",["require","exports","tslib","external/lodash","modules/clean/logging/hive/schemas/web-comments2","modules/clean/logging/telemetry","modules/clean/previews/util","modules/clean/react/comments2/data/util","modules/constants/python","modules/core/browser","modules/core/browser_detection"],function(e,t,n,i,o,r,a,s,l,c,u){"use strict";function d(e,t){var n=t.commentId,r=t.stream,d=t.thread,m={event:e};n&&(m.comment_gid=n),d&&(m.thread_gid=d.id,m.is_annotation=!!d.annotation,s.isThreadWithTimecodeAnnotation(d)&&(m.annotation_type="time",m.time_comment_offset=d.annotation.time),s.isThreadWithDocumentAnnotation(d)&&(m.annotation_type=d.annotation.regionType,m.page=d.annotation.regions[0].page),s.isThreadWithImageAnnotation(d)&&(m.annotation_type="rectangle")),r&&(m.stream_gid=r.id,m.file_obj_id=r.id,m.ns_id=r.ns_id,m.file_size=r.bytes,m.file_extension=a.getWhitelistedExtension(r.filename));var f=c.get_uri().getQuery().oref,h=i.find(l.OREF_CONSTANTS,function(e){return e===f});m.oref_name=h,m.platform=u.is_mobile_or_tablet()?"mobile":"web",p.log(new o.Comments2LoggingTableRow(m))}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),r=n.__importStar(r),c=n.__importStar(c);var p=new r.HiveLogger;t.logEvent=d}),define("modules/clean/react/comments2/data/perf_util",["require","exports"],function(e,t){"use strict";function n(e,t){return{".tag":"thread_action_completed_ms",action:e,error_message:t}}function i(e,t){return{".tag":"comment_action_completed_ms",action:e,error_message:t}}function o(){return{".tag":"mentions_query_completed_ms"}}function r(){return+new Date}function a(e,t){var n=r();return function(i){e(i),t(r()-n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.threadActionCompleted=n,t.commentActionCompleted=i,t.mentionsQueryCompleted=o,t.currentTime=r,t.withTiming=a}),define("modules/clean/react/comments2/data/reducer",["require","exports","tslib","external/lodash","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/initial_state","modules/clean/react/comments2/data/util","modules/clean/react/comments2/data/reducer_helper","modules/clean/react/comments2/data/types","modules/clean/react/comments2/transforms"],function(e,t,n,i,o,r,a,s,l,c){"use strict";function u(e,t,n){return e.map(function(e){return e.id===t?n(e):e})}function d(e,t){var i;return n.__assign({},e,{threads:n.__assign({},e.threads,(i={},i[t.id]=t,i))})}function p(e,t,n){var o=e.threads[t];return d(e,i.assignIn({},o,n))}function m(e,t,i,o){var r,a=t.threads[i];return p(t,i,a.pending?n.__assign({},a,(r={},r[o]=a.pending.originalValue,r.pending=n.__assign({},a.pending,{error:e}),r)):a)}function f(e,t,n,i){return p(e,n,{comments:u(e.threads[n].comments,t,i)})}function h(e,t,i,o,r){return f(t,i,o,function(t){var i;return t.pending?n.__assign({},t,(i={},i[r]=t.pending.originalValue,i.pending=n.__assign({},t.pending,{error:e}),i)):t})}function _(e,t){void 0===e&&(e=r.INITIAL_STATE);var n=y(e.context,t),i=w(e.data,t),o=v(e.statuses,t);return n!==e.context||i!==e.data||o!==e.statuses?{context:n,data:i,statuses:o}:e}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),c=n.__importStar(c);var v=s.createStatusReducer(o.ActionTypes),g=s.createActionReducer(),y=s.createReducerFrom(g(o.ActionTypes.SetContext,function(e,t){return t?n.__assign({},t,{status:l.Comments2ContextStatus.Pending}):void 0}),g(o.ActionTypes.SetContextStatus,function(e,t){return n.__assign({},e,{status:t})})),b=s.createActionReducer(),w=s.createReducerFrom(b(o.ActionTypes.ActivateThread,function(e,t){var i=t.thread,o=t.pendingAnnotationInfo,r=t.wasPreviewLayerClick;return n.__assign({},e,{activatedThreadId:i.id,documentRectangleToMakeVisible:r?void 0:a.documentRectangleFromThread(i),pendingAnnotationInfo:o||e.pendingAnnotationInfo})}),b(o.ActionTypes.DeactivateAllThreads,function(e){return i.assignIn({},e,{activatedThreadId:void 0,activatedDocumentAnnotationRectangle:void 0})}),b(o.ActionTypes.ListComments,function(e,t,i){var o=n.__assign({},e.authors,c.usersToIUserMap(t.authors)),r=n.__assign({},e.threads,c.threadsToIThreadMap(t.threads,o,t.currentRevision));return n.__assign({},e,{threads:r,authors:o,cursor:t.cursor})}),b(o.ActionTypes.CreateThread,{Request:function(e,t,i){var r,s=new Date,l=i.annotation,c=i.author,u=i.content,d=i.guid,p={id:d,threadId:d,timestamp:s,author:c,content:u,revisionInfo:{isCurrent:!0},userPermissions:{canDelete:!1,canEdit:!1}},m={id:d,timestamp:s,read:!0,resolved:!1,comments:[p],annotation:l},f=n.__assign({},m,{pending:{action:o.ActionTypes.CreateThread.name,originalValue:void 0,pendingValue:m}}),h=e.pendingAnnotationInfo.annotationMayBeOffscreen?a.documentRectangleFromThread(m):void 0;return n.__assign({},e,{activatedThreadId:d,documentRectangleToMakeVisible:h,threads:n.__assign({},e.threads,(r={},r[d]=f,r))})},Success:function(e,t,i){var o,r=e.threads,a=i.guid,s=r[a],l=n.__rest(r,["symbol"==typeof a?a:a+""]),c=u(s.comments,i.guid,function(e){return n.__assign({},e,{id:t.id,userPermissions:{canDelete:!0,canEdit:!0}})});return n.__assign({},e,{activatedThreadId:e.activatedThreadId===i.guid?t.id:e.activatedThreadId,threads:n.__assign({},l,(o={},o[t.id]=n.__assign({},s,{id:t.id,comments:c,pending:void 0}),o))})},Error:function(e,t,i){var o=e.threads,r=i.guid,a=(o[r],n.__rest(o,["symbol"==typeof r?r:r+""]));return n.__assign({},e,{threads:a})}}),b(o.ActionTypes.ReplyToThread,{Request:function(e,t,i){var r,a=new Date,s=i.author,l=i.content,c=i.guid,u=i.threadId,d={id:c,threadId:u,timestamp:a,author:s,content:l,revisionInfo:{isCurrent:!0},userPermissions:{canDelete:!1,canEdit:!1}},p=e.threads[u],m=n.__assign({},p,{read:!0,comments:p.comments.concat([d])}),f=n.__assign({},m,{pending:{action:o.ActionTypes.ReplyToThread.name,originalValue:p,pendingValue:m}});return n.__assign({},e,{activatedThreadId:u,threads:n.__assign({},e.threads,(r={},r[u]=f,r))})},Success:function(e,t,i){var o,r=e.threads[i.threadId],a=u(r.comments,i.guid,function(e){return n.__assign({},e,{id:t.id,userPermissions:{canDelete:!0,canEdit:!0}})});return n.__assign({},e,{threads:n.__assign({},e.threads,(o={},o[i.threadId]=n.__assign({},r,{comments:a,pending:void 0}),o))})},Error:function(e,t,i){var o,r=e.threads[i.threadId],a=r.comments.filter(function(e){return e.id!==i.guid});return n.__assign({},e,{threads:n.__assign({},e.threads,(o={},o[i.threadId]=n.__assign({},r,{comments:a,pending:void 0}),o))})}}),b(o.ActionTypes.DeleteComment,{Request:function(e,t,i){return f(e,i.commentId,i.threadId,function(e){return n.__assign({},e,{deleted:!0,pending:{action:o.ActionTypes.DeleteComment.name,originalValue:e.deleted,pendingValue:!0}})})},Success:function(e,t,i){return f(e,i.commentId,i.threadId,function(e){return n.__assign({},e,{pending:void 0})})},Error:function(e,t,n){return h(t,e,n.commentId,n.threadId,"deleted")}}),b(o.ActionTypes.EditComment,{Request:function(e,t,i){return f(e,i.commentId,i.threadId,function(e){return n.__assign({},e,{content:i.content,pending:{action:o.ActionTypes.EditComment.name,originalValue:e.content,pendingValue:i.content}})})},Success:function(e,t,i){return f(e,i.commentId,i.threadId,function(e){return n.__assign({},e,{
pending:void 0})})},Error:function(e,t,n){return h(t,e,n.commentId,n.threadId,"content")}}),b(o.ActionTypes.SetPerfData,function(e,t){return n.__assign({},e,{perfEvents:n.__assign({},e.perfEvents,t)})}),b(o.ActionTypes.CheckUpsellExperimentDismissed,function(e,t){return n.__assign({},e,{upsellExperimentNotDismissed:!t.has_dismissed})}),b(o.ActionTypes.CheckOnboardingStatus,function(e,t){return n.__assign({},e,{onboardingVariants:{premium_av_comments_pane_surface:t.premium_av_comments_pane_surface===!1,premium_av_preview_surface:t.premium_av_preview_surface===!1,non_premium_av_comments_pane_surface:t.non_premium_av_comments_pane_surface===!1,not_annotatable_file_comments_pane_surface:t.not_annotatable_file_comments_pane_surface===!1,how_to_at_mention_comments_pane_surface:t.how_to_at_mention_comments_pane_surface===!1,image_preview_surface:t.image_preview_surface===!1,document_preview_surface:t.document_preview_surface===!1}})}),b(o.ActionTypes.MarkOnboarded,function(e,t,i){var o;return n.__assign({},e,{onboardingVariants:n.__assign({},e.onboardingVariants,(o={},o[i]=!1,o))})}),b(o.ActionTypes.MarkModalVariantShown,function(e,t){var i;return n.__assign({},e,{modalVariantsShown:n.__assign({},e.modalVariantsShown,(i={},i[t]=!0,i))})}),b(o.ActionTypes.DismissOnboarding,function(e){return n.__assign({},e,{onboardingVariants:i.mapValues(e.onboardingVariants,function(){return!1})})}),b(o.ActionTypes.MarkThreadRead,{Request:function(e,t,n){return p(e,n.threadId,{read:!0,pending:{action:o.ActionTypes.MarkThreadRead.name,originalValue:e.threads[n.threadId].read,pendingValue:!0}})},Success:function(e,t,n){return p(e,n.threadId,{pending:void 0})},Error:function(e,t,n){return m(t,e,n.threadId,"read")}}),b(o.ActionTypes.MarkThreadUnread,{Request:function(e,t,n){return p(e,n,{read:!1,pending:{action:o.ActionTypes.MarkThreadUnread.name,originalValue:e.threads[n].read,pendingValue:!1}})},Success:function(e,t,n){return p(e,n,{pending:void 0})},Error:function(e,t,n){return m(t,e,n,"read")}}),b(o.ActionTypes.MarkThreadResolved,{Request:function(e,t,n){return p(e,n,{resolved:!0,pending:{action:o.ActionTypes.MarkThreadResolved.name,originalValue:e.threads[n].resolved,pendingValue:!0}})},Success:function(e,t,n){return p(e,n,{pending:void 0})},Error:function(e,t,n){return m(t,e,n,"resolved")}}),b(o.ActionTypes.MarkThreadUnresolved,{Request:function(e,t,n){return p(e,n,{resolved:!1,pending:{action:o.ActionTypes.MarkThreadUnresolved.name,originalValue:e.threads[n].resolved,pendingValue:!1}})},Success:function(e,t,n){return p(e,n,{pending:void 0})},Error:function(e,t,n){return m(t,e,n,"resolved")}}),b(o.ActionTypes.SetContext,function(e,t){return n.__assign({},e,i.pick(r.INITIAL_STATE.data,"activatedThreadId","authors","cursor","documentMetadata","enabledStatus","pendingAnnotationInfo","playerIntegrationEnabled","requestEditorFocus","subscriptionStatus","threads"))}),b(o.ActionTypes.ToggleShowResolved,function(e){return n.__assign({},e,{showResolved:!e.showResolved})}),b(o.ActionTypes.UpdateEditorIsEmpty,function(e,t){return n.__assign({},e,{editorIsEmpty:t})}),b(o.ActionTypes.UpdateDocumentCurrentPage,function(e,t){return n.__assign({},e,{pendingAnnotationInfo:n.__assign({},e.pendingAnnotationInfo,{currentPageNumber:t})})}),b(o.ActionTypes.UpdatePlayerCurrentTime,function(e,t){return n.__assign({},e,{pendingAnnotationInfo:n.__assign({},e.pendingAnnotationInfo,{playerCurrentTime:t})})}),b(o.ActionTypes.HoverThread,function(e,t){return n.__assign({},e,{hoverThreadId:t})}),b(o.ActionTypes.SetPendingNumberedAnnotation,function(e,t){return n.__assign({},e,{pendingAnnotationInfo:n.__assign({},e.pendingAnnotationInfo,{numberedAnnotation:t,annotationMayBeOffscreen:!1})})}),b(o.ActionTypes.ClearPendingNumberedAnnotation,function(e,t){return n.__assign({},e,{pendingAnnotationInfo:n.__assign({},e.pendingAnnotationInfo,{numberedAnnotation:void 0,annotationMayBeOffscreen:!1})})}),b(o.ActionTypes.SetPendingNumberedAnnotationMayBeOffscreen,function(e){return n.__assign({},e,{pendingAnnotationInfo:n.__assign({},e.pendingAnnotationInfo,{annotationMayBeOffscreen:!0})})}),b(o.ActionTypes.TrackSidebarCommentsVisibility,function(e,t){return n.__assign({},e,{visibleInSidebar:t})}),b(o.ActionTypes.DocMetadataLoad,function(e,t){return n.__assign({},e,{documentMetadata:t})}),b(o.ActionTypes.RequestEditorFocus,function(e){return n.__assign({},e,{requestEditorFocus:!0})}),b(o.ActionTypes.FulfillEditorFocusRequest,function(e){if(!e.requestEditorFocus)throw new Error("Fulfilling request for editor focus, but isnt requested in store");return n.__assign({},e,{requestEditorFocus:!1})}),b(o.ActionTypes.EnablePlayerIntegration,function(e,t){return n.__assign({},e,{playerIntegrationEnabled:!0})}),b(o.ActionTypes.SetUpsellTooltipVariant,function(e,t){return n.__assign({},e,{upsellTooltipVariant:t})}),b(o.ActionTypes.DismissUpsellTooltip,{Request:function(e){return n.__assign({},e,{upsellTooltipVariant:void 0})}}),b(o.ActionTypes.DismissUpsellExperiment,{Request:function(e){return n.__assign({},e,{upsellExperimentNotDismissed:!1})}}),b(o.ActionTypes.RecordEnabledStatus,function(e,t){return n.__assign({},e,{enabledStatus:i.merge({},e.enabledStatus,t)})}),b(o.ActionTypes.SetSubscriptionStatus,function(e,t){return n.__assign({},e,{subscriptionStatus:t})}),b(o.ActionTypes.Subscribe,function(e){return n.__assign({},e,{subscriptionStatus:i.merge({},e.subscriptionStatus,{isSubscribed:!0})})}),b(o.ActionTypes.Unsubscribe,function(e){return n.__assign({},e,{subscriptionStatus:i.merge({},e.subscriptionStatus,{isSubscribed:!1})})}),b(o.ActionTypes.ResetStore,function(e,t){return n.__assign({},r.INITIAL_STATE.data)}));t.reducer=_}),define("modules/clean/react/comments2/data/reducer_helper",["require","exports","tslib","modules/clean/redux/types"],function(e,t,n,i){"use strict";function o(e){for(var t={},o=0,r=Object.keys(e).map(function(t){return e[t]});o<r.length;o++){var a=r[o];"async"===a.type&&(t[a.actionTypes.request]={name:a.name,status:i.ApiClientStatus.Request},t[a.actionTypes.error]={name:a.name,status:i.ApiClientStatus.Error})}return function(e,i){var o,r=t[i.type];return r&&(e=n.__assign({},e,(o={},o[r.name]=r.status,o))),e}}function r(){function e(e,t){switch(e.type){case"async":return"function"==typeof t?[[e.actionTypes.success,t]]:[t.Error&&[e.actionTypes.error,t.Error],t.Request&&[e.actionTypes.request,t.Request],t.Success&&[e.actionTypes.success,t.Success]].filter(function(e){return e});case"sync":if("function"==typeof t)return[[e.actionType,t]]}throw new Error}return e}function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n={},i=0,o=e;i<o.length;i++)for(var r=o[i],a=0,s=r;a<s.length;a++){var l=s[a],c=l[0],u=l[1];n[c]||(n[c]=[]),n[c].push(u)}return function(e,t){for(var i=n[t.type],o=0,r=i||[];o<r.length;o++){var a=r[o],s=t.meta&&t.meta.args;e=a(e,"payload"in t?t.payload:t.error,s)}return e}}Object.defineProperty(t,"__esModule",{value:!0}),t.createStatusReducer=o,t.createActionReducer=r,t.createReducerFrom=a}),define("modules/clean/react/comments2/data/selectors",["require","exports","tslib","external/lodash","external/reselect","modules/clean/redux/selectors","modules/clean/redux/types","modules/clean/react/comments2/data/types","modules/clean/react/comments2/data/util","modules/clean/react/comments2/util","modules/clean/react/file_viewer/data/selectors","modules/clean/previews/constants","modules/clean/previews/data/preview_type_util","modules/clean/react/file_viewer/data/selectors","modules/clean/react/comments2/transforms"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m,f){"use strict";function h(e,t){return e.filter(function(e){var n=e.comments[0].revisionInfo;return n.isCurrent||!t||n.revision&&n.revision.nsId===t.ns_id&&n.revision.sjId<=t.sjid})}function _(e){return p.getPreviewType(m.getPreviewApiDataForCurrentFile(e))}function v(e){return o.createSelector(t.getData,function(t){return t[e]})}function g(e){var n,i=t.getData(e).onboardingVariants;switch(_(e)){case d.PreviewType.SsrDoc:n=["document_preview_surface","how_to_at_mention_comments_pane_surface"];break;case d.PreviewType.Image:n=["image_preview_surface","how_to_at_mention_comments_pane_surface"];break;case d.PreviewType.Audio:case d.PreviewType.Video:n=t.getIsPlayerIntegrationEnabled(e)?["premium_av_comments_pane_surface","premium_av_preview_surface"]:["non_premium_av_comments_pane_surface"];break;case void 0:return[];default:n=["not_annotatable_file_comments_pane_surface"]}return n.filter(function(e){return i[e]})}function y(e){var n=t.getData(e).onboardingVariants,i=!u.getIsMediaPlaying(e),o=u.getPauseCount(e);return t.getContextStatus(e)===s.Comments2ContextStatus.Comments2&&!c.isComments2Mobile()&&t.getIsPlayerIntegrationEnabled(e)&&i&&!w(e)&&n.premium_av_preview_surface&&o%5===1&&o<15}function b(e){var n=t.getData(e).onboardingVariants;switch(_(e)){case d.PreviewType.Audio:case d.PreviewType.Video:return t.getIsPlayerIntegrationEnabled(e)?n.premium_av_comments_pane_surface:n.non_premium_av_comments_pane_surface;case d.PreviewType.SsrDoc:return n.document_preview_surface||n.how_to_at_mention_comments_pane_surface;case d.PreviewType.Image:return n.image_preview_surface||n.how_to_at_mention_comments_pane_surface;case void 0:return!1;default:return n.not_annotatable_file_comments_pane_surface}}function w(e){return t.getContextStatus(e)===s.Comments2ContextStatus.Comments2&&!c.isComments2Mobile()&&b(e)}function C(e){return t.getData(e).onboardingVariants}function S(e){var n=t.getData(e).modalVariantsShown;return n[s.ModalVariant.EmailVerifyModal]||n[s.ModalVariant.SignUpModal]}function E(e){var t=G(e);return t&&l.isThreadWithTimecodeAnnotation(t)?t:void 0}function A(e){return t.getIsComments2Ready(e)?Y(e):void 0}function T(e){return t.getThreads(e).filter(function(e){return!e.resolved})}function P(e){return T(e).filter(function(e){var t=e.annotation;return t&&("video"===t.type||"audio"===t.type)})}function I(e){return t.getData(e).enabledStatus.canEnable}function k(e){return t.getData(e).enabledStatus.isEnabled}function x(e){return t.getData(e).subscriptionStatus.canSubscribe}function M(e){return t.getData(e).subscriptionStatus.isSubscribed}function O(e){var n=t.getContext(e);return n&&n.stream}function F(e){var n=t.getContext(e);return n&&n.stream.id}function R(e){return Z(e).playerCurrentTime}function D(e){return Z(e).currentPageNumber}function L(e){return Z(e).numberedAnnotation}function N(e){return t.getIsComments2Ready(e)&&!!L(e)}function B(e,t){return void 0===t?H(e):U(e,t)}function U(e,t){return i.get($(e),t,[])}function V(e){var t=e.annotation;return!!t&&("document"===t.type||"image"===t.type)}function H(e){return Q(e).filter(function(e){return e&&void 0!==e.annotation&&"image"===e.annotation.type})}function j(e){return Q(e).filter(V)}function q(e){switch(_(e)){case d.PreviewType.SsrDoc:return t.getData(e).documentMetadata;case d.PreviewType.Image:return t.IMAGE_SENTINEL;default:return}}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),c=n.__importStar(c),m=n.__importStar(m);t.IMAGE_SENTINEL="IMAGE_SENTINEL",t.getState=function(e){return r.getStateAtNamespace(e,a.COMMENTS2_NAMESPACE_KEY)};var K=function(e,t){switch(t){case s.SortType.Chronological:return i.sortBy(e,[function(e){return e.timestamp.getTime()}]);case s.SortType.VideoTimeCode:var n=i.groupBy(e,function(e){return e.annotation?"video":"global"}),o=n.video,r=n.global;return i.sortBy(o,[function(e){return e.annotation.time},function(e){return e.timestamp.getTime()}]).concat(i.sortBy(r,[function(e){return e.timestamp.getTime()}]))}};t.getContext=function(e){var n=t.getState(e).context;return n?{stream:n.stream,viewer:n.viewer}:void 0},t.getContextStatus=function(e){var n=t.getState(e).context;return n?n.status:void 0},t.getFQPath=function(e){var n=t.getContext(e);return n?n.stream.fq_path:void 0},t.getViewer=function(e){var n=t.getContext(e);return n?n.viewer:void 0},t.getViewerId=function(e){var n=t.getViewer(e);return n?n.id:void 0},t.canCreateAnnotations=function(e){var n=t.getContext(e);return!(!n||!n.viewer)&&!c.isComments2Mobile()&&t.getVisibleInSidebar(e)},t.getPreviewTypeForCurrentFile=_,t.getIsComments2Ready=function(e){var t=e[a.COMMENTS2_NAMESPACE_KEY];return!(!t||!t.context||t.context.status!==s.Comments2ContextStatus.Comments2)},t.getComments2AnnotationsMode=o.createSelector(t.getIsComments2Ready,function(e){return e?s.Comments2AnnotationsMode.SpectrumComponents:s.Comments2AnnotationsMode.Off}),t.getData=function(e){return t.getState(e).data},t.getRevision=o.createSelector(t.getContext,function(e){return e&&f.streamToRevision(e.stream)}),t.getSort=o.createSelector(_,function(e){switch(e){case d.PreviewType.Audio:case d.PreviewType.Video:return s.SortType.VideoTimeCode;default:return s.SortType.Chronological}}),t.getEditorIsEmpty=v("editorIsEmpty"),t.getThreadMap=v("threads");var z=o.createSelector(t.getThreadMap,function(e){return i.values(e)}),W=o.createSelector(t.getContext,function(e){return e&&e.stream.isVersionHistoryMode});t.getThreads=o.createSelector([z,t.getSort,W,t.getRevision],function(e,t,n,i){var o=K(e,t);return n?h(o,i):o}),t.getCursor=v("cursor"),t.getUnmarkedOnboardingKeysRelevantToCurrentFile=g,t.getShowOnboardingOnVideo=y,t.getShowOnboardingOnCommentsPane=w,t.getOnboardingVariants=C,t.getHasShownAnyModalVariant=S,t.getActivatedThreadId=v("activatedThreadId");var G=o.createSelector(t.getActivatedThreadId,t.getThreadMap,function(e,t){return e&&t[e]});t.getActivatedTimecodeThread=E;var Y=v("documentRectangleToMakeVisible");t.getDocumentRectangleToMakeVisibleIfComments2Ready=A,t.getHoverThreadId=v("hoverThreadId"),t.getUnresolvedTimecodeThreads=P,t.getShowResolved=v("showResolved"),t.getStatuses=function(e){return t.getState(e).statuses},t.getIsPlayerIntegrationEnabled=v("playerIntegrationEnabled"),t.getCanEnable=I,t.getIsEnabled=k,t.getCanSubscribe=x,t.getIsSubscribed=M,t.getStream=O,t.getStreamId=F;var Z=v("pendingAnnotationInfo");t.getPlayerCurrentTime=R,t.getCurrentPageNumber=D,t.getPendingNumberedAnnotation=L,t.getHasPendingNumberedAnnotation=N;var X=v("enabledStatus");t.getVisibleInSidebar=v("visibleInSidebar");var Q=o.createSelector([t.getVisibleInSidebar,X,t.getShowResolved,z],function(e,t,n,i){return e&&t.isEnabled?(n?i:i.filter(function(e){return!e.resolved})).filter(function(e){return e.comments.some(function(e){return!e.deleted})}):[]}),J=o.createSelector(Q,function(e){return e.filter(l.isThreadWithDocumentAnnotation)}),$=o.createSelector(J,function(e){return i.groupBy(e,function(e){return e.annotation.regions[0].page})});t.getDisplayedThreadsForLayer=B,t.getDisplayedThreadsWithDocumentAnnotationsOnPage=U,t.getDisplayedThreadsWithImageAnnotations=H,t.getDisplayedThreadsWithNumberedAnnotations=j;var ee=function(){return c.showEditorForGuests()};t.getStreamSettings=o.createSelector([t.getViewer,ee],function(e,t){return e?e.is_email_verified?{canComment:!0,canModifyThreads:!0,canShowEditor:!0}:{canComment:!1,canModifyThreads:!0,canShowEditor:!0}:{canComment:!1,canModifyThreads:!1,canShowEditor:t}}),t.getDocumentMetadata=q,t.getIsEditorFocusRequested=v("requestEditorFocus")}),define("modules/clean/react/comments2/data/sidebar_watcher",["require","exports","tslib","external/eventemitter3"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.sideChannelEventEmitter=new i.default,t.COMMENTS_VISIBLE_SIGNAL="comments_visible",t.COMMENTS_HIDDEN_SIGNAL="comments_hidden"}),define("modules/clean/react/comments2/data/store",["require","exports","tslib","external/lodash","modules/clean/redux/types","modules/clean/react/comments2/data/reducer","modules/clean/redux/store"],function(e,t,n,i,o,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),t.getStoreForComments2=i.once(function(){var e;return a.getStoreAndRegisterReducers((e={},e[o.COMMENTS2_NAMESPACE_KEY]=r.reducer,e))})}),define("modules/clean/react/comments2/data/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.Disabled=0]="Disabled",e[e.Pending=1]="Pending",e[e.Comments1=2]="Comments1",e[e.Comments2=3]="Comments2"})(t.Comments2ContextStatus||(t.Comments2ContextStatus={}));(function(e){e[e.Off=0]="Off",e[e.SpectrumComponents=1]="SpectrumComponents"})(t.Comments2AnnotationsMode||(t.Comments2AnnotationsMode={}));(function(e){e.EmailVerifyModal="EmailVerifyModal",e.SignUpModal="SignUpModal"})(t.ModalVariant||(t.ModalVariant={}));(function(e){e[e.EditorFocus=0]="EditorFocus",e[e.OnPost=1]="OnPost"})(t.ShowModalReason||(t.ShowModalReason={}));(function(e){e.Chronological="CHRONOLOGICAL",e.VideoTimeCode="VIDEO_TIME_CODE"})(t.SortType||(t.SortType={}));(function(e){e[e.ThreadActivated=0]="ThreadActivated",e[e.UIButtonClicked=1]="UIButtonClicked"})(t.MarkThreadReadOrigin||(t.MarkThreadReadOrigin={}))}),define("modules/clean/react/comments2/data/util",["require","exports","tslib","modules/clean/react/comments2/util"],function(e,t,n,i){"use strict";function o(e){var t=e.annotation;return!!t&&"document"===t.type}function r(e){var t=e.annotation;return!!t&&"image"===t.type}function a(e){var t=e.annotation;return!!t&&i.isTimecodeAnnotation(t)}function s(e){if(e&&o(e)){var t=e.annotation.regions[0];return n.__assign({},t,{page:t.page-1})}}Object.defineProperty(t,"__esModule",{value:!0}),t.isThreadWithDocumentAnnotation=o,t.isThreadWithImageAnnotation=r,t.isThreadWithTimecodeAnnotation=a,t.documentRectangleFromThread=s}),define("modules/clean/react/comments2/enable_disable_option",["require","exports","tslib","react","modules/clean/react/file_action_button","modules/clean/react/file_viewer/more_dropdown/models","modules/clean/react/file_viewer/more_dropdown/more_option_registry"],function(e,t,n,i,o,r,a){"use strict";function s(e,t){var n=function(){e(t())},s=[new r.MoreOption({className:"comments-options-item__disable",fileActionButtonType:o.FileActionButtonType.ENABLE_COMMENTS,component:function(e){return i.createElement("span",null,e.buttonText)},handler:n})];c=new r.MoreOptionGroup({fileActionButtonGroup:o.FileActionButtonGroup.COMMENTS,options:s}),a.moreOptionRegistry.addOption(c)}function l(){c&&(a.moreOptionRegistry.removeOption(c),c=null)}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var c=null;t.addEnableCommentingToOverflow=s,t.removeEnableCommentingFromOverflow=l}),define("modules/clean/react/comments2/position_utils",["require","exports","tslib","external/lodash"],function(e,t,n,i){"use strict";function o(e,t,n,i){var o=t.top+(t.height-n.height)/2,r=t.left+(t.width-n.width)/2;switch(e){case"right":return{direction:e,top:o,left:t.right+i};case"above":return{direction:e,top:t.top-n.height-i,left:r};case"left":return{direction:e,top:o,left:t.left-i-n.width};case"below":return{direction:e,top:t.bottom+i,left:r}}}function r(e,t){var n=t.height,i=t.width;return{top:t.top-e.top,right:t.right-e.left,bottom:t.bottom-e.top,left:t.left-e.left,height:n,width:i}}function a(e,t,n,a,s){void 0===a&&(a=16),void 0===s&&(s=["right","above","left","below"]);var l=r(e,n),c=r(e,t),u=s.map(function(e){return o(e,c,l,a)});return u.find(function(t){var n=t.top,i=t.left;return!(n<0||i<0)&&(i+l.width<e.width&&n+l.height<e.height)})||i.first(u)}function s(e){return i.mapValues(i.pick(e,["top","left"]),function(e){return e+"px"})}function l(e,t,n,i){var o=e-n,r=t-i;return Math.sqrt(o*o+r*r)}function c(e){return{x:e.left+e.width/2,y:e.top+e.height/2}}function u(e,t,n){return e>=t&&e<=n}function d(e,t,n){void 0===n&&(n=1/0);var o=i.pickBy(t,function(t){return u(e.pageY,t.top,t.bottom)&&u(e.pageX,t.left,t.right)&&!(u(e.pageY,t.top+n,t.bottom-n)&&u(e.pageX,t.left+n,t.right-n))});return i.sortBy(i.toPairs(o),function(t){var n=(t[0],t[1]),i=c(n);return l(i.x,i.y,n.left,n.top)-l(i.x,i.y,e.pageX,e.pageY)},["desc"]).map(function(e){return e[0]})}function p(e){for(var t=1/0,n=1/0,i=-(1/0),o=-(1/0),r=0,a=e;r<a.length;r++){var s=a[r],l=s.top,c=s.left,u=s.right,d=s.bottom;t=Math.min(l,t),n=Math.min(c,n),i=Math.max(d,i),o=Math.max(u,o)}return{top:t,left:n,right:o,bottom:i,height:i-t,width:o-n}}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);t.computePositionForElementInContainer=a,t.convertPositionToCssStyle=s,t.getRankedElementsForMousePosition=d,t.getBoundingClientRectOfRects=p}),define("modules/clean/react/comments2/transforms",["require","exports","tslib","external/lodash","modules/core/exception","modules/core/user_i18n"],function(e,t,n,i,o,r){"use strict";function a(e,t){return e[".tag"]===t}function s(e,t){return n.__assign({},e,{page:t})}function l(e){return"image"===e.type?{type:"rnd",regions:[e.region]}:"highlight"===e.regionType?{type:"highlight",regions:e.regions}:{type:"rnd",regions:e.regions}}function c(e,t){var n=e.type,i=e.regions;return void 0===t?{type:"image",region:i[0]}:{type:"document",regionType:"rnd"===n?"rectangle":"highlight",regions:i.map(function(e){return s(e,t)})}}function u(e){if(a(e,"video"))return{type:"video",time:e.time};if(a(e,"audio"))return{type:"audio",time:e.time};if(a(e,"document"))return{type:"document",regionType:e.region_type[".tag"],label:e.label,regions:e.regions};if(a(e,"image"))return{type:"image",region:e.region,label:e.label};throw new Error("Attempted to convert an annotation type that does not yet exist.")}function d(e,t){var n=t.timestamp?new Date(t.timestamp):void 0;return{isCurrent:e.ns_id===t.ns_id&&e.sjid===t.sjid,revision:{nsId:t.ns_id,sjId:t.sjid},timestamp:n}}function p(e,t,n,i){return{author:n[e.author_id],content:{metadata:w(e.metadata),text:e.content},deleted:e.deleted,id:e.id,threadId:t,timestamp:new Date(e.timestamp),revisionInfo:e.revision?d(i,e.revision):{isCurrent:!0},userPermissions:{canDelete:e.permissions.can_delete,canEdit:e.permissions.can_edit}}}function m(e){return{id:e.dbx_account_id,email:e.email,name:{display:e.name,initials:r.getInitials(e.name),public:r.getShortName(e.name)},photoUrl:e.photo_url||e.avatar_url}}function f(e){return{id:e.account_id,name:{display:e.display_name,initials:r.getInitials(e.display_name),public:r.getShortName(e.display_name)},photoUrl:e.photo_circle_url}}function h(e){var t=e.format[".tag"];if("other"===t)throw new Error('"other" is not a valid format block');return{location:e.location,style:t,type:"style"}}function _(e){return"video"===e.type?{".tag":"video",time:e.time}:"audio"===e.type?{".tag":"audio",time:e.time}:"document"===e.type?{".tag":"document",regions:e.regions,region_type:{".tag":e.regionType}}:{".tag":"image",region:n.__assign({},e.region,{page:1})}}function v(e){var t=e.annotation,n=e.content,i=e.stream;return{annotation_data:t?_(t):void 0,content:n.text,metadata:y(n.metadata),revision:S(i)}}function g(e,t){if(!t.length)return{metadata:[],text:e};for(var n=[],i=[],o=0,a=0,s=t;a<s.length;a++){var l=s[a],c=void 0,u=void 0;"accountId"in l?(c=r.getShortName(l.displayName),u={type:"id",identifier:l.accountId}):(c=l.email,u={type:"email",identifier:l.email}),c&&(c="@"+c,n.push(c),i.push({location:{start:o,end:o+c.length},type:"mention",user:u}),o+=c.length+1)}return n.push(e),{text:n.join(" "),metadata:i}}function y(e){return{formatting:e.filter(function(e){return"style"===e.type}).map(function(e){return{format:{".tag":e.style},location:e.location}}),mentions:e.filter(function(e){return"mention"===e.type}).map(function(e){return{user:{type:{".tag":e.user.type},identifier:e.user.identifier},location:e.location}})}}function b(e){var t=e.user.type[".tag"];if("other"===t)throw new Error('"other" is not a valid user type');var n={identifier:e.user.identifier,type:t};return{location:e.location,type:"mention",user:n}}function w(e){var t=e.formatting.map(h).concat(e.mentions.map(b));if(e.sticker){var n=C(e.sticker);n?t.push(n):o.reportStack("received comment sticker metadata without the sticker url filled in. Dropping sticker metadata from this comment")}return t}function C(e){if(e.url)return{type:"sticker",id:e.id,url:e.url}}function S(e){return"file"===e.type?{ns_id:e.ns_id,sjid:e.sjid}:void 0}function E(e,t,n){var i=e.comments.map(function(i){return p(i,e.id,t,n)});return{annotation:e.annotation_data?u(e.annotation_data):void 0,comments:i,id:e.id,read:e.read,resolved:e.resolved,timestamp:i[0].timestamp}}function A(e,t,n){var o=e.map(function(e){return E(e,t,n)});return i.keyBy(o,"id")}function T(e){return{id:e.id,name:{display:e.display_name,initials:e.initials,public:e.public_name},photoUrl:e.photo_url}}function P(e){var t=e.map(T);return i.keyBy(t,"id")}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),o=n.__importStar(o),r=n.__importStar(r),t.rectangleToDocumentRectangle=s,t.numberedAnnotationToIInteractionAnnotation=l,t.iInteractionAnnotationToNumberedAnnotation=c,t.annotationToIAnnotation=u,t.revisionInfoToIRevisionInfo=d,t.commentToIComment=p,t.contactToIMentionUser=m,t.dbxUserToIUser=f,t.iAnnotationToAnnotation=_,t.iCommentContentToUserSubmittedComment=v,t.sharingTextAndUsersToICommentContent=g,t.iCommentMetadataToUserSubmittedMetadata=y,t.metadataToIMetadata=w,t.streamToRevision=S,t.threadToIThread=E,t.threadsToIThreadMap=A,t.userToIUser=T,t.usersToIUserMap=P}),define("modules/clean/react/comments2/util",["require","exports","tslib","external/lodash","modules/core/browser_detection","modules/constants/comments2","modules/core/browser_detection"],function(e,t,n,i,o,r,a){"use strict";function s(e){return function(t,n){return void 0===t||void 0===n?t===n:e(t,n)}}function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return s(function(t,n){return e.every(function(e){return t[e]===n[e]})})}function c(e,t){void 0===e&&(e=1e3),void 0===t&&(t=3e5);var n,i=0;return{resetBackoff:function(){i=0,clearTimeout(n)},backoff:function(o){return n=setTimeout(o,Math.random()*Math.min(e*(Math.pow(2,i++)-1),t))}}}function u(e,t){for(var n=0,o=e;n<o.length;n++){var r=o[n],a=i.find(r.comments,{id:t});if(a)return{comment:a,thread:r}}return null}function d(e){var t=e.annotation;if(m(t))return{playerCurrentTime:t.time,annotationMayBeOffscreen:!1}}function p(){return!a.msie}function m(e){return void 0!==e&&("audio"===e.type||"video"===e.type)}function f(){return!r.COMMENTS2_DISABLE_BOLT}function h(){return r.COMMENTS2_UNSUBSCRIBE_BOLT_ON_UPDATE}function _(){return r.COMMENTS2_UPSELL_EXPERIMENT}function v(e,t,n){return t<=e&&e<=n}function g(e,t,n){var i=e.x+e.width,o=e.y+e.height,r=function(e,t){return e<t?e:1/0};if(v(t.x,e.x,i)&&v(t.y,e.y,o)){var a=16/n.width,s=16/n.height;return Math.min(r(Math.min(t.x-e.x,i-t.x),a),r(Math.min(t.y-e.y,o-t.y),s))}return 1/0}function y(e,t,n){return S(t,function(t){return C(t,e,n)})}function b(){return r.COMMENTS2_SHOW_EDITOR_FOR_GUESTS}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);t.createBackoff=c,t.isUserSame=l("id"),t.isStreamSame=l("type","id"),t.isContextSame=s(function(e,n){return t.isStreamSame(e.stream,n.stream)&&t.isUserSame(e.viewer,n.viewer)}),t.findCommentThread=u,t.getAnnotationInfoForThread=d,t.isComments2Mobile=o.is_mobile_or_tablet,t.canShowUnreadPill=p,t.isTimecodeAnnotation=m,t.useBolt=f,t.unsubscribeBoltOnUpdate=h,t.inUpsellExperiment=_;var w=function(e){return"image"===e.annotation.type?[e.annotation.region]:e.annotation.regions},C=function(e,t,n){return Math.min.apply(Math,w(e).map(function(e){return g(e,t,n)}))},S=function(e,t){return e.reduce(function(e,n){var i=e.minRank,o=e.minElem,r=t(n);return i<=r?{minRank:i,minElem:o}:{minRank:r,minElem:n}},{minRank:1/0,minElem:void 0}).minElem};t.getThreadForNumberedAnnotationAtPoint=y,t.showEditorForGuests=b}),define("modules/clean/react/comments2/video_annotations/annotation_helper",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){function t(e){return null!=e?Math.round(100*e):0}function n(e){return null!=e?e/100:0}e.unitConvertSecondsToDomainObjectTime=t,e.unitConvertDomainObjectTimeToSeconds=n})(t.VideoAnnotationHelper||(t.VideoAnnotationHelper={}))}),define("modules/clean/react/comments2/video_annotations/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventTypes={PAUSE:"PAUSE",SEEK_POSITION_AND_PAUSE:"SEEK_POSITION_AND_PAUSE"}}),define("modules/clean/react/comments2/video_annotations/video_preview_event_emitter",["require","exports","tslib","external/eventemitter3"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.videoPreviewEventEmitter=new i.default}),define("modules/clean/react/css_timing",["require","exports","modules/clean/react/css","modules/clean/js_client_stopwatch"],function(e,t,n,i){"use strict";function o(e,t,o){void 0===o&&(o=[]);var r=e.displayName||"UnnamedComponent",a=function(){return i.JSStopwatch.startSpan("requireCssWithComponent_"+r)},s=function(){return i.JSStopwatch.endSpan("requireCssWithComponent_"+r)};return n.requireCssWithComponent(e,t,o,{onWillLoadCss:a,onCssResponse:s})}Object.defineProperty(t,"__esModule",{value:!0}),t.requireCssWithComponent=o}),define("modules/clean/react/file_action_button",["require","exports","tslib","react","external/prop-types","modules/clean/react/bubble_menu","modules/clean/react/file_action_button_type","modules/clean/react/file_action_button_group"],function(e,t,n,i,o,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importStar(o),t.FileActionButtonType=a.FileActionButtonType,t.FileActionButtonGroup=s.FileActionButtonGroup;var l=i.default.createElement,c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return l(r.BubbleMenuItem,{onClick:this.props.callback,closeFunc:this.props.closeFunc,className:this.props.className},a.getFileActionButtonText(this.props.type))},t.displayName="FileActionButton",t.propTypes={type:o.string.isRequired,callback:o.func.isRequired,closeFunc:o.func,className:o.string},t.defaultProps={closeFunc:null},t})(i.default.Component);t.FileActionButton=c}),define("modules/clean/react/file_action_button_group",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e.COMMENTS="COMMENTS",e.WATERMARKING="WATERMARKING"})(t.FileActionButtonGroup||(t.FileActionButtonGroup={}))}),define("modules/clean/react/file_action_button_type",["require","exports","modules/core/i18n"],function(e,t,n){"use strict";function i(e){return e&&a[e]?a[e]:null}Object.defineProperty(t,"__esModule",{value:!0});var o;t.FileActionButtonType={COMMENT:"COMMENT",COPY:"COPY",DELETE:"DELETE",DOWNLOAD:"DOWNLOAD",MOVE:"MOVE",OPEN:"OPEN",PREVIOUS_VERSIONS:"PREVIOUS_VERSIONS",REMOVE_LINK:"REMOVE_LINK",RENAME:"RENAME",SHARE:"SHARE",ENABLE_COMMENTS:"ENABLE_COMMENTS",DISABLE_COMMENTS:"DISABLE_COMMENTS",SHOW_RESOLVED_COMMENTS:"SHOW_RESOLVED_COMMENTS",HIDE_RESOLVED_COMMENTS:"HIDE_RESOLVED_COMMENTS",SUBSCRIBE:"SUBSCRIBE",SUBSCRIBE_TO_NOTIFICATIONS:"SUBSCRIBE_TO_NOTIFICATIONS",UNSUBSCRIBE:"UNSUBSCRIBE",UNSUBSCRIBE_FROM_NOTIFICATIONS:"UNSUBSCRIBE_FROM_NOTIFICATIONS",ENABLE_WATERMARKING:"ENABLE_WATERMARKING",REMOVE_WATERMARKING:"REMOVE_WATERMARKING"};var r=function(){return{comment:"BUTTON"}},a=(o={},o[t.FileActionButtonType.COMMENT]=n._("Comment",r()),o[t.FileActionButtonType.COPY]=n._("Copy…",r()),o[t.FileActionButtonType.DELETE]=n._("Delete…",r()),o[t.FileActionButtonType.DOWNLOAD]=n._("Download",r()),o[t.FileActionButtonType.MOVE]=n._("Move…",r()),o[t.FileActionButtonType.OPEN]=n._("Open",r()),o[t.FileActionButtonType.PREVIOUS_VERSIONS]=n._("Version history",r()),o[t.FileActionButtonType.REMOVE_LINK]=n._("Remove link",r()),o[t.FileActionButtonType.RENAME]=n._("Rename",r()),o[t.FileActionButtonType.SHARE]=n._("Share",r()),o[t.FileActionButtonType.ENABLE_COMMENTS]=n._("Enable comments",r()),o[t.FileActionButtonType.DISABLE_COMMENTS]=n._("Disable comments",r()),o[t.FileActionButtonType.SHOW_RESOLVED_COMMENTS]=n._("Show resolved comments",r()),
o[t.FileActionButtonType.HIDE_RESOLVED_COMMENTS]=n._("Hide resolved comments",r()),o[t.FileActionButtonType.SUBSCRIBE]=n._("Subscribe",r()),o[t.FileActionButtonType.SUBSCRIBE_TO_NOTIFICATIONS]=n._("Subscribe to notifications",r()),o[t.FileActionButtonType.UNSUBSCRIBE]=n._("Unsubscribe",r()),o[t.FileActionButtonType.UNSUBSCRIBE_FROM_NOTIFICATIONS]=n._("Unsubscribe from notifications",r()),o[t.FileActionButtonType.ENABLE_WATERMARKING]=n._("Enable watermarking",r()),o[t.FileActionButtonType.REMOVE_WATERMARKING]=n._("Remove watermarking",r()),o);t.getFileActionButtonText=i}),define("modules/clean/react/file_comments/logger",["require","exports","tslib","modules/clean/ajax","modules/clean/annotations/annotation","modules/core/exception"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),r=n.__importStar(r);var a=(function(){function e(){this.disabled=!1}return e.prototype.set_disabled=function(e){return this.disabled=e},e.prototype.log_event=function(e,t,n,o,a,s,l,c,u){if(void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=null),!this.disabled)return r.assert(e,"event_type not provided"),r.assert(t,"file_activity_key not provided"),i.SilentBackgroundRequest({url:"/file_activity/client_log",type:"POST",data:{event_type:e,file_activity_key:t,comment_activity_key:n,client_origin_type:o,activity_context:s,annotation_type:l,annotation_subtype:c,annotation_page:u},subject_user:a})},e.prototype.log_annotation_event=function(e,t,n,i,r,a){void 0===a&&(a=null);var s,l,c;if(null!=a){var u=o.Annotation.createAnnotationFromDict(a);c=u.type,l=u.subtype,s=u.getFirstPdfPage()}return this.log_event(e,t,n,null,i,r,c,l,s)},e})(),s=new a;t.default=s});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};define("modules/clean/react/file_metadata/component/loadable_metadata_details",["require","exports","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadableMetadataDetails=n.Loadable({loader:function(){return i.waitForTTI().then(function(){return new Promise(function(t,n){e(["modules/clean/react/file_metadata/component/metadata_details"],t,n)}).then(__importStar).then(function(e){return e.MetadataDetails})})}})}),define("modules/clean/react/file_sidebar/base_comments_tab",["require","exports","tslib","react","external/react-redux","modules/clean/file_store/utils","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/store"],function(e,t,n,i,o,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.streamFromProps=function(e){var t=e.currentFile,n=t.bytes,i=t.file_id,o=t.ns_id,a=t.sjid,s=e.sharedLinkInfo;return{id:i,linkUrl:s?s.url:void 0,ns_id:o,sjid:a,type:"file",fq_path:"fq_path"in e.currentFile?e.currentFile.fq_path:void 0,isVersionHistoryMode:e.isVersionHistoryMode,bytes:n,filename:r.getFilename(e.currentFile)}};var l=(function(e){function r(n){var i=e.call(this,n)||this;return i.clearContext=function(){i.store.dispatch(a.Actions.setFileContext())},i.setContext=function(e){i.store.dispatch(a.Actions.setFileContext({stream:t.streamFromProps(e),viewer:e.user}))},i.store=s.getStoreForComments2(),i}return n.__extends(r,e),r.prototype.componentDidMount=function(){this.setContext(this.props)},r.prototype.componentWillUnmount=function(){this.clearContext()},r.prototype.componentWillUpdate=function(e){this.setContext(e)},r.prototype.render=function(){return this.store?i.default.createElement(o.Provider,{store:this.store},this.props.content()):null},r})(i.default.Component);t.BaseCommentsTab=l}),define("modules/clean/react/file_sidebar/constants",["require","exports","tslib","external/prop-types"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),t.STORE_KEY="fileSidebarStore",t.STORE_SHAPE=i.shape({dispatch:i.func.isRequired,getState:i.func.isRequired,subscribe:i.func.isRequired})}),define("modules/clean/react/file_sidebar/file_sidebar",["require","exports","tslib","react","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.FileSidebar=o.Loadable({loader:function(){return r.waitForTTI().then(function(){return new Promise(function(t,n){e(["modules/clean/react/file_sidebar/file_sidebar_component"],t,n)}).then(n.__importStar).then(function(e){return e.FileSidebar})})},loading:i.default.createElement("div",{className:"file-sidebar"})})}),define("modules/clean/react/file_sidebar/file_sidebar_connect",["require","exports","tslib","react","external/react-redux","modules/clean/react/file_sidebar/constants","hoist-non-react-statics"],function(e,t,n,i,o,r,a){"use strict";function s(e,t){var s=t?o.connect(e,t):o.connect(e);return function(e){var t,o=s(e),l=(function(e){function a(t,n){var i=e.call(this,t,n)||this;return i.state={store:n.fileSidebarStore},i}return n.__extends(a,e),a.prototype.componentWillReceiveProps=function(e,t){this.setState({store:t.fileSidebarStore})},a.prototype.render=function(){if(!this.state.store)return null;var e=n.__assign({},this.props,{store:this.state.store});return i.default.createElement(o,n.__assign({},e))},a.displayName="FileSidebar"+o.displayName,a.WrappedComponent=o,a.contextTypes=(t={},t[r.STORE_KEY]=r.STORE_SHAPE,t),a})(i.default.Component);return a.default(l,o)}}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importStar(o),a=n.__importDefault(a),t.fileSidebarConnect=s}),define("modules/clean/react/file_sidebar/file_sidebar_logger",["require","exports","tslib","modules/clean/ajax","modules/clean/viewer","modules/clean/api_v2/user_client","modules/clean/api_v2/noauth_client","modules/clean/react/file_viewer/models"],function(e,t,n,i,o,r,a,s){"use strict";function l(e,t){var n=s.FileViewerSession.currentSession,o=s.FilePreviewSession.currentSession;if(o&&n){var r={event_name:e,file_viewer_session_id:n.id,file_preview_session_id:o.id,file_ns_id:o.file.ns_id,file_sjid:o.file.sjid,extra:JSON.stringify(t)};i.SilentBackgroundRequest({url:"/log/file_sidebar",data:r})}}function c(e){l("sidebar_tab_selected",e)}function u(e){l("sidebar_opened",e)}function d(e){l("sidebar_closed",e)}function p(e){l("activity_stream_interactivity",e)}function m(e){l("file_view_activity_expanded",e)}function f(e,t){_({event:"get_stream_timing",int_value:e,bool_value:t})}function h(e){_({event:"load_sidebar_timing",int_value:e})}function _(e){var t=o.Viewer.get_viewer().get_user_ids(),n=t.length?t[0]:null;n?(new r.UserApiV2Client).ns("file_activity_stream").rpc("log_event",e,{subjectUserId:n}):(new a.NoAuthApiV2Client).ns("file_activity_stream").rpc("logged_out/log_event",e,{})}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),t.logSidebarTabSelected=c,t.logSidebarOpened=u,t.logSidebarClosed=d,t.logActivityStreamInteractivity=p,t.logFileViewActivityCardExpanded=m,t.logGetActivityStreamTiming=f,t.logLoadSidebarTiming=h}),define("modules/clean/react/file_sidebar/file_sidebar_provider",["require","exports","tslib","react","external/prop-types","modules/clean/react/file_sidebar/constants","modules/constants/file_activity_stream","modules/clean/react/file_sidebar/store/instance"],function(e,t,n,i,o,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importStar(o),a=n.__importStar(a);var l,c=(function(e){function t(t){var n=e.call(this,t)||this;return a.IS_ON?n.state={loaded:!0,store:s.store}:n.state={loaded:!1},n}return n.__extends(t,e),t.prototype.getChildContext=function(){var e;return e={},e[r.STORE_KEY]=this.state.store,e},t.prototype.componentWillUnmount=function(){var e=this.state.store;e&&e.dispatch({type:"::RESET"})},t.prototype.render=function(){return i.default.Children.only(this.props.children)},t.propTypes={children:o.element.isRequired},t.childContextTypes=(l={},l[r.STORE_KEY]=r.STORE_SHAPE,l),t})(i.default.Component);t.FileSidebarProvider=c}),define("modules/clean/react/file_sidebar/store/app/reducer",["require","exports","tslib"],function(e,t,n){"use strict";function i(e,i){switch(void 0===e&&(e=t.INITIAL_STATE),i.type){case"APP_SET_STATE":var o=i.hideComments,r=i.hidePageChrome;return n.__assign({},e,{hideComments:o,hidePageChrome:r})}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.INITIAL_STATE={hideComments:!1,hidePageChrome:!1},t.reducer=i}),define("modules/clean/react/file_sidebar/store/comments_adapter",["require","exports","tslib","modules/clean/comments/store"],function(e,t,n,i){"use strict";function o(){var e=i.default.state;return{enabled:i.default.isCommentingEnabled(),canEnable:i.default.canEnableComments(),commentCount:e.activity&&e.activity.comment_activities&&e.activity.comment_activities.length||0,initialized:i.default.isStoreInitialized(),ready:i.default.isFileActivityReady(),unreadCommentCount:i.default.unreadCommentCount()}}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.getCommentingState=o}),define("modules/clean/react/file_sidebar/store/file_activity/actions",["require","exports","tslib","modules/clean/react/file_sidebar/store/file_activity/selectors","modules/clean/react/file_sidebar/store/file_activity/api","modules/clean/react/file_sidebar/file_sidebar_logger"],function(e,t,n,i,o,r){"use strict";function a(e){return{type:"FILE_ACTIVITY|RECEIVE_STREAM_ERROR",error:e}}function s(e,t){return{type:"FILE_ACTIVITY|RECEIVE_FILE_ACTIVITY",activities:e,enabled:t}}function l(e,t){return{type:"FILE_ACTIVITY|LOADING_START",userId:e,file:t}}function c(e){return{type:"FILE_ACTIVITY|LOADING_END",state:e}}function u(){return{type:"FILE_ACTIVITY|RESET"}}function d(){return{type:"FILE_ACTIVITY|RESET_FILE_STATE"}}function p(e,t){return(e.file?e.file.file_id:-1)!==(t.file?t.file.file_id:-1)||e.userId!==t.userId}function m(e,n){return function(o,u){if(p({file:n,userId:e},i.getContext(u()))){var m=t.api.create(e);o(d()),o(l(e,n));var h=Date.now(),_=++f,v=n.file_id;return m.getActivityStream(v).then(function(t){var a=t.enabled,l=t.activity_group;r.logGetActivityStreamTiming(Date.now()-h,!0),p({file:n,userId:e},i.getContext(u()))||o(s(l,a))}).catch(function(e){r.logGetActivityStreamTiming(Date.now()-h,!1),_===f&&o(a(e))}).then(function(){_===f&&o(c(i.getState(u())))})}}}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),t.api={create:function(e){return new o.FileActivityStreamApi(e)}},t.receiveStreamError=a,t.receiveFileActivity=s,t.loadingStart=l,t.loadingEnd=c,t.reset=u,t.resetFileState=d;var f=0;t.getActivityStream=m}),define("modules/clean/react/file_sidebar/store/file_activity/activity_sorted_set",["require","exports","tslib","modules/clean/react/file_sidebar/store/file_activity/sorted_set"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(n){return void 0===n&&(n=[]),e.call(this,n,t.compare,t.equals)||this}return n.__extends(t,e),t.compare=function(e,t){return e.id===t.id?0:t.timestamp.getTime()-e.timestamp.getTime()},t.equals=function(e,t){return e.id===t.id},t})(i.SortedSet);t.ActivitySortedSet=o}),define("modules/clean/react/file_sidebar/store/file_activity/api",["require","exports","tslib","external/lodash","modules/clean/api_v2/user_client"],function(e,t,n,i,o){"use strict";function r(e,t,n,i){return".tag"===t?0===i?["type",n]:n in e?n:[null,n]:n}function a(e,t,n,i){return"string"==typeof n&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z$/.test(n)?new Date(n):n}function s(e,t,n){return void 0===n&&(n=0),Array.isArray(e)?e.map(function(e){return s(e,t,n+1)}):i.isObject(e)?Object.keys(e).reduce(function(o,r){var a=e[r];if(Array.isArray(a)||i.isObject(a))o[r]=s(a,t,n+1);else{var l=t(e,r,a,n);if(Array.isArray(l)){if(null===l[0])return l[1];o[l[0]]=l[1]}else o[r]=l}return o},{}):t(null,"",e,n)}function l(e){return s(s(e,r),a)}function c(e){return n.__assign({},l(e.activities[0]),{groupActivities:e.activities.map(l),isGroup:!0})}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),t.parseActivity=l,t.parseGroupActivity=c;var u=(function(){function e(e){this.userId=e,this.client=new o.UserApiV2Client}return e.prototype.getActivityStream=function(e){return this.client.ns("file_activity_stream").rpc("get_activity_stream",{file_path_or_id:e},{subjectUserId:this.userId}).then(function(e){return{enabled:e.enabled,activity_group:(e.activity_group||[]).map(c)}})},e})();t.FileActivityStreamApi=u}),define("modules/clean/react/file_sidebar/store/file_activity/reducer",["require","exports","tslib","modules/clean/react/file_sidebar/store/file_activity/activity_sorted_set","modules/constants/file_activity_stream"],function(e,t,n,i,o){"use strict";function r(e){return e.filter(function(e){switch(e.type){case"file_settings_change":return o.IS_FILE_SETTINGS_CHANGE_CARD_ON;case"shared_link_change":return o.IS_SHARED_LINK_CHANGE_CARD_ON;case"view":return o.IS_VIEW_CARD_ON;default:return!0}})}function a(e){return r(e).map(function(e){return e.isGroup?n.__assign({},e,{groupActivities:r(e.groupActivities)}):e})}function s(e){return e.map(function(e){return e.isGroup&&1===e.groupActivities.length?e.groupActivities[0]:e})}function l(e,o){switch(void 0===e&&(e=t.INITIAL_STATE),o.type){case"FILE_ACTIVITY|RESET":return n.__assign({},t.INITIAL_STATE);case"FILE_ACTIVITY|RESET_FILE_STATE":return n.__assign({},e,{activities:t.INITIAL_STATE.activities});case"FILE_ACTIVITY|LOADING_START":return n.__assign({},e,{activities:n.__assign({},e.activities,{error:void 0,loading:!0}),userId:o.userId,file:o.file});case"FILE_ACTIVITY|LOADING_END":return n.__assign({},e,{activities:n.__assign({},e.activities,{loaded:!0,loading:!1})});case"FILE_ACTIVITY|RECEIVE_FILE_ACTIVITY":var r=a(o.activities);r=s(r);var l=o.enabled,c=l?new i.ActivitySortedSet(e.activities.value.concat(r)).toArray():[];return n.__assign({},e,{activities:n.__assign({},e.activities,{value:c}),enabled:o.enabled});case"FILE_ACTIVITY|RECEIVE_STREAM_ERROR":return n.__assign({},e,{activities:n.__assign({},e.activities,{error:o.error})})}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.INITIAL_STATE={activities:{error:void 0,loaded:!1,loading:!1,value:[]},enabled:!1,userId:-1},t.filterActivitiesBasedOnStormcrows=r,t.filterGroupActivitiesBasedOnStormcrows=a,t.ungroupSingleActivityGroups=s,t.reducer=l}),define("modules/clean/react/file_sidebar/store/file_activity/selectors",["require","exports"],function(e,t){"use strict";function n(e){return e.fileActivity}function i(e){return n(e).activities.value}function o(e){return n(e).activities}function r(e){return i(e).length}function a(e){return n(e).file}function s(e){return n(e).userId}function l(e){return{file:a(e),userId:s(e)}}function c(e){return n(e).enabled}Object.defineProperty(t,"__esModule",{value:!0}),t.getState=n,t.getActivities=i,t.getActivitiesMetadata=o,t.getVisibleActivityCount=r,t.getFile=a,t.getUserId=s,t.getContext=l,t.isActivityEnabled=c}),define("modules/clean/react/file_sidebar/store/file_activity/sorted_set",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e,t,n){void 0===e&&(e=[]),this.items=[],this.compare=t,this.equals=n,this.add(e)}return e.prototype.add=function(e){var t=this;Array.isArray(e)||(e=[e]);var n=this.items.concat(e);return n.sort(this.compare),this.items=n.filter(function(e,n,i){return 0===n||!t.equals(e,i[n-1])}),this},e.prototype.toArray=function(){return Array.prototype.slice.call(this.items)},e})();t.SortedSet=n}),define("modules/clean/react/file_sidebar/store/instance",["require","exports","tslib","external/redux","modules/clean/react/file_sidebar/store/app/reducer","modules/clean/react/file_sidebar/store/file_activity/reducer","modules/clean/react/file_sidebar/store/sidebar/reducer","modules/clean/comments/events","modules/clean/comments/store","modules/clean/react/file_sidebar/store/sidebar/actions","modules/clean/react/file_sidebar/store/comments_adapter","modules/clean/react/file_sidebar/store/middleware/thunk","modules/clean/react/file_sidebar/store/middleware/reactor","modules/clean/react/file_sidebar/store/sidebar/reactors","modules/clean/redux/unsupported","modules/clean/redux/devtools"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m,f,h){"use strict";function _(e,t){return"::RESET"===t.type&&(e=void 0),y(e,t)}function v(){return f.createStore(_,h.composeEnhancersWithDevTools(i.applyMiddleware(d.thunk(),p.reactor(m.reactors))))}function g(){t.store.dispatch(c.setCommentingState(u.getCommentingState()))}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),l=n.__importDefault(l),c=n.__importStar(c);var y=i.combineReducers({app:o.reducer,fileActivity:r.reducer,sidebar:a.reducer});t.store=v(),l.default.listen(g),g(),s.CommentsEvents.on("reveal-comment-in-pane",function(){t.store.dispatch(c.open("annotation_select")),t.store.dispatch(c.selectTab("comments"))})}),define("modules/clean/react/file_sidebar/store/middleware/reactor",["require","exports","modules/clean/shallow_equal"],function(e,t,n){"use strict";function i(e){return"function"==typeof e.changes}function o(e){return"function"==typeof e.changesIn}function r(e){return"function"==typeof e.changesFrom&&"function"==typeof e.changesTo}function a(){function e(e,t,n){void 0===n&&(n=s);var l;if(i(e))l=function(t,n){return{changed:e.changes(t,n)}};else if(o(e))l=function(t,i){var o=e.changesIn(t),r=e.changesIn(i);return{prevValue:o,nextValue:r,changed:!n(o,r)}};else{if(!r(e))throw new Error;l=function(t,n){var i=e.changesFrom(t),o=e.changesTo(n);return{changed:i&&o}}}a.push({checkForChange:l,onChange:t})}for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var a=[],l=0,c=t;l<c.length;l++){(0,c[l])(e)}return function(e){var t=e.getState;return function(e){return function(n){for(var i=t(),o=e(n),r=t(),s=0,l=a;s<l.length;s++){var c=l[s],u=c.checkForChange(i,r),d=u.prevValue,p=u.nextValue;u.changed&&c.onChange({nextValue:p,prevValue:d,nextState:r,prevState:i})}return o}}}}Object.defineProperty(t,"__esModule",{value:!0});var s=function(e,t){return n.shallowEqual(e,t)};t.reactor=a}),define("modules/clean/react/file_sidebar/store/middleware/thunk",["require","exports"],function(e,t){"use strict";function n(){return function(e){var t=e.dispatch,n=e.getState;return function(e){return function(i){return"function"==typeof i?i(t,n):e(i)}}}}Object.defineProperty(t,"__esModule",{value:!0}),t.thunk=n}),define("modules/clean/react/file_sidebar/store/sidebar/actions",["require","exports","tslib","modules/clean/react/file_sidebar/store/sidebar/helpers","modules/clean/react/file_sidebar/store/sidebar/selectors","modules/clean/react/file_sidebar/store/file_activity/selectors","modules/clean/file_activity/api","modules/clean/react/file_sidebar/store/comments_adapter","modules/clean/react/file_sidebar/file_sidebar_logger","modules/clean/react/file_sidebar/store/sidebar/types","modules/clean/comments/store","file-viewer/core","modules/clean/react/file_viewer/exp_controller_mode"],function(e,t,n,i,o,r,a,s,l,c,u,d,p){"use strict";function m(){return{type:c.ActionType.SidebarReset}}function f(e){return function(n,i){var r=i(),a=o.getSidebarContext(r).user;o.getSidebarState(r).open||t.LegacyCommentsStoreAction.setStickyOpen(!0,a?a.id:null),n({type:c.ActionType.SidebarOpen,payload:{reason:e}})}}function h(){return function(e,n){var i=n(),a=o.getSidebarContext(i).user;o.getSidebarState(i).open&&(t.LegacyCommentsStoreAction.setStickyOpen(!1,a?a.id:null),e({type:c.ActionType.SidebarClose}),l.logSidebarClosed({num_comments:o.getTabState(i,"comments").extra.commentCount,num_events:r.getVisibleActivityCount(i),viewing_user_id:a?a.id:null}))}}function _(){return function(e,t){var n=t();e(o.getSidebarState(n).open?h():f("toggle_button"))}}function v(){return function(e){e(f("toggle_button_after_transition"))}}function g(e){return{type:c.ActionType.SidebarSelectTab,payload:{tabName:e}}}function y(){return{type:c.ActionType.SidebarSetThirdPartyBlueDotOnboardState}}function b(e){return function(t,n){var r=n(),a=o.getSidebarContext(r);i.isContextChanged(a,e)&&(t({type:c.ActionType.SidebarOpenFile,payload:e}),t(S(s.getCommentingState())))}}function w(){return{type:c.ActionType.SidebarSetComments2DisabledState}}function C(e){return{type:c.ActionType.SidebarSetComments2ShownState,payload:e}}function S(e){return{type:c.ActionType.SidebarSetCommentState,payload:e}}function E(e,t){t?a.setCommentingPaneVisibility({actorId:t,shouldShow:e}):a.setSessionCommentingPaneVisibility({shouldShow:e})}function A(e){var t=!1,n="comments";return p.isFiles2ControllerExperiment2On()?e===d.FileViewerMode.Documentation?(t=p.shouldSidebarBeOpenForExperiment2(),n="metadata"):(t=!0,n="comments"):(t=!0,n=e===d.FileViewerMode.Documentation?"metadata":"comments"),{type:c.ActionType.SidebarOverrideInitialState,payload:{open:t,tab:n}}}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),o=n.__importStar(o),r=n.__importStar(r),a=n.__importStar(a),u=n.__importDefault(u),t.reset=m,t.open=f,t.close=h,t.toggle=_,t.completeToggleOpen=v,t.selectTab=g,t.thirdpartyBlueDotOnboard=y,t.openFile=b,t.setComments2DisabledState=w,t.setComments2ShownState=C,t.setCommentingState=S,t.LegacyCommentsStoreAction={showComments:function(){setTimeout(function(){u.default.onShowComments()})},hideComments:function(){setTimeout(function(){u.default.onHideComments()})},setStickyOpen:function(e,t){E(e,t)}},t.OverrideInitialState=A}),define("modules/clean/react/file_sidebar/store/sidebar/helpers",["require","exports","modules/clean/file_store/utils"],function(e,t,n){"use strict";function i(e,t){return!e&&!t||!!e&&!!t&&n.areFilesEqual(e,t)}function o(e,t){return!e&&!t||!!e&&!!t&&e.id===t.id}function r(e,t){return!i(e.file,t.file)||!o(e.user,t.user)}Object.defineProperty(t,"__esModule",{value:!0}),t.isFileSame=i,t.isUserSame=o,t.isContextChanged=r}),define("modules/clean/react/file_sidebar/store/sidebar/reactors",["require","exports","tslib","external/lodash","modules/clean/react/file_sidebar/file_sidebar_logger","modules/clean/react/file_sidebar/store/sidebar/selectors","modules/clean/react/file_sidebar/store/file_activity/selectors"],function(e,t,n,i,o,r,a){"use strict";function s(e){var t=r.getSidebarState(e),n=t.open,i=t.ready;return n&&i}function l(e){return!s(e)}function c(e){return i.values(r.getTabsState(e)).every(function(e){return e.ready})}function u(e){return!c(e)}function d(e){var t=r.getSidebarContext(e);return(t.file?t.file.file_id:-1)+":"+(t.user?t.user.id:-1)}function p(e){var t=r.getSidebarContext(e).user;o.logSidebarOpened({reason:r.getOpenReason(e),num_comments:r.getTabState(e,"comments").extra.commentCount,num_events:a.getVisibleActivityCount(e),viewing_user_id:t?t.id:null})}function m(e){e({changesFrom:l,changesTo:s},function(e){p(e.nextState)}),e({changes:function(e,t){if(s(e)&&s(t)){var n=t.sidebar.tabs,i=e.sidebar.tabs;return!(i.activity.ready&&i.comments.ready)&&n.activity.ready&&n.comments.ready}return!1}},function(e){p(e.nextState)});var t=-1,n="";e({changes:function(e,t){return d(e)!==d(t)}},function(e){var i=e.nextState;t=Date.now(),n=d(i)}),e({changesFrom:u,changesTo:c},function(e){n===d(e.prevState)&&o.logLoadSidebarTiming(Date.now()-t)})}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),r=n.__importStar(r),a=n.__importStar(a),t.reactors=m}),define("modules/clean/react/file_sidebar/store/sidebar/reducer",["require","exports","tslib","modules/constants/comments_panel","modules/clean/react/file_sidebar/store/sidebar/types","modules/clean/react/file_sidebar/store/sidebar/actions"],function(e,t,n,i,o,r){"use strict";function a(e,i){var r;switch(i.type){case o.ActionType.SidebarOverrideInitialState:var a=i.payload,s=a.open,l=a.tab;return n.__assign({},e,{open:s,activeTab:l,tabs:n.__assign({},e.tabs,(r={},r[l]=n.__assign({},e.tabs[l],{show:!0}),r)),hasFiles2ExpOverride:!0});case o.ActionType.SidebarReset:return n.__assign({},t.INITIAL_STATE,{open:e.open});case o.ActionType.SidebarOpen:return n.__assign({},e,{open:!0,openReason:i.payload.reason});case o.ActionType.SidebarClose:return n.__assign({},e,{open:!1,openReason:void 0});case o.ActionType.SidebarSelectTab:return n.__assign({},e,{activeTab:i.payload.tabName});case o.ActionType.SidebarSetThirdPartyBlueDotOnboardState:return n.__assign({},e,{thirdpartyBlueDotOnboarded:!0});case o.ActionType.SidebarOpenFile:var c=i.payload,u=c.file,d=c.isVersionHistoryMode,p=c.user;return n.__assign({},e,{openReason:void 0,context:{file:u,isVersionHistoryMode:d,user:p},tabs:{activity:{ready:!p,show:d===!1&&e.tabs.activity.show,count:0},comments:{ready:!1,show:!1,count:0,extra:{commentCount:0}},metadata:{ready:!1,show:!0}}});case"FILE_ACTIVITY|LOADING_END":return n.__assign({},e,{tabs:n.__assign({},e.tabs,{activity:{ready:!0,show:e.context.isVersionHistoryMode===!1&&i.state.enabled,count:0}})});case o.ActionType.SidebarSetComments2DisabledState:return n.__assign({},e,{tabs:n.__assign({},e.tabs,{comments:{ready:!0,show:!1,count:0,extra:{commentCount:0,version:2}}})});case o.ActionType.SidebarSetComments2ShownState:return n.__assign({},e,{activeTab:e.hasFiles2ExpOverride?e.activeTab:"comments",tabs:n.__assign({},e.tabs,{comments:{ready:!0,show:!e.hasFiles2ExpOverride||e.tabs.comments.show,count:0,extra:{commentCount:i.payload.commentCount,version:2}}})});case o.ActionType.SidebarSetCommentState:if(e.tabs.comments.extra&&2===e.tabs.comments.extra.version)return e;var m=i.payload,f=m.enabled,h=m.canEnable,_=m.commentCount,v=m.initialized,g=m.ready,y=m.unreadCommentCount,b=m.version,w=e.tabs.comments.ready,C=e.tabs.comments.show,S=w||v&&g,E=!S||!w&&S&&(f||h)||C;return n.__assign({},e,{tabs:n.__assign({},e.tabs,{comments:{ready:S,show:E,count:y,extra:{commentCount:_,version:b}}})})}return e}function s(e,n){void 0===e&&(e=t.INITIAL_STATE);var i=a(e,n);return i.ready=e.ready||i.tabs.activity.ready&&i.tabs.comments.ready,e.ready||!i.ready||e.hasFiles2ExpOverride||(i.tabs.comments.show&&!i.tabs.activity.show?i.activeTab="comments":!i.tabs.comments.show&&i.tabs.activity.show&&(i.activeTab="activity"),i.tabs.comments.show&&i.tabs.comments.count>0&&(i.open=!0,i.openReason=i.openReason||"unread_comments",i.activeTab="comments"),i.tabs.comments.show&&i.tabs.comments.extra&&2===i.tabs.comments.extra.version&&i.tabs.comments.extra.commentCount>0&&(i.open=!0,i.openReason=i.openReason||"comments2_unresolved_threads",i.activeTab="comments"),"comments"===i.activeTab?r.LegacyCommentsStoreAction.showComments():r.LegacyCommentsStoreAction.hideComments()),i.ready&&i.open&&!i.openReason&&(i.openReason="sticky_state"),!i.open||"comments"!==i.activeTab||"toggle_button"===i.openReason||e.open&&"toggle_button"!==e.openReason&&"comments"===e.activeTab?!e.open||"comments"!==e.activeTab||i.open&&"comments"===i.activeTab||r.LegacyCommentsStoreAction.hideComments():r.LegacyCommentsStoreAction.showComments(),i}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var l=i.SHOW_COMMENTS_PANEL||!1;t.INITIAL_STATE={activeTab:"comments",open:l,openReason:void 0,ready:!1,context:{file:void 0,isVersionHistoryMode:void 0,user:void 0},tabs:{activity:{ready:!1,show:!1,count:0},comments:{ready:!1,show:!1,count:0,extra:{commentCount:0}},metadata:{ready:!1,show:!1}},hasFiles2ExpOverride:!1,thirdpartyBlueDotOnboarded:!1},t.reducer=s}),define("modules/clean/react/file_sidebar/store/sidebar/selectors",["require","exports"],function(e,t){"use strict";function n(e){return e.sidebar}function i(e){var t=n(e);return{activeTab:t.activeTab,open:t.open,openReason:t.openReason,ready:t.ready}}function o(e){return n(e).openReason}function r(e){return n(e).context}function a(e){return n(e).tabs}function s(e,t){return a(e)[t]}function l(e){return n(e).thirdpartyBlueDotOnboarded}Object.defineProperty(t,"__esModule",{value:!0}),t.getState=n,t.getSidebarState=i,t.getOpenReason=o,t.getSidebarContext=r,t.getTabsState=a,t.getTabState=s,t.getThirdPartyBlueDotOnboardedState=l}),define("modules/clean/react/file_sidebar/store/sidebar/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e.SidebarOpen="SIDEBAR|OPEN",e.SidebarReset="SIDEBAR|RESET",e.SidebarClose="SIDEBAR|CLOSE",e.SidebarSelectTab="SIDEBAR|SELECT_TAB",e.SidebarOpenFile="SIDEBAR|OPEN_FILE",e.SidebarToggle="SIDEBAR|TOGGLE",e.SidebarSetCommentState="SIDEBAR|SET_COMMENTING_STATE",e.SidebarSetComments2DisabledState="SIDEBAR|SET_COMMENTS2_DISABLED_STATE",e.SidebarSetComments2ShownState="SIDEBAR|SET_COMMENTS2_SHOWN_STATE",e.SidebarSetThirdPartyBlueDotOnboardState="SIDEBAR|SET_THIRDPARTY_BLUEDOT_ONBOARDED_STATE",e.SidebarOverrideInitialState="SIDEBAR|OVERRIDE_INITIAL_STATE"})(t.ActionType||(t.ActionType={}))}),define("modules/clean/react/file_viewer/actionable",["require","exports","tslib","react","modules/clean/file_store/utils","modules/clean/react/open_in_app/button","modules/clean/react/share_download/button","modules/clean/react/extensions/client","modules/clean/react/app_actions/app_actions_menu","modules/clean/react/app_actions/data/types","modules/clean/react/file_viewer/open_button/open_button"],function(e,t,n,i,o,r,a,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.Actionable=function(e){var t,n=e.allowOpenInApp,d=e.extensionsConfig,p=e.variant,m=e.location,f=e.sizeClass,h=e.user,_=e.userActionContext;return o.isSharedFile(e.file)?(t=e.file,n&&t.open_in_app_data?i.default.createElement(r.OpenInAppButton,{urls:t.open_in_app_data,userActionContext:_}):i.default.createElement(a.ShareDownloadButton,{copyable:t,importance:p,location:m,sharedLinkInfo:e.sharedLinkInfo,shareToken:e.shareToken,sharePermission:e.sharePermission,user:h})):h?(t=e.file,d.displayState===s.DisplayState.ENABLED?i.default.createElement(l.ExtensionsMenu,{file:t,extensionsConfig:d,user:h,showAsButtonIfDownloadOnly:!0,triggerType:c.TriggerType.PrimaryButton,telemetryContext:{surface:"previews"},onPresentInZoom:function(){}}):i.default.createElement(u.OpenButton,{file:t,user:h,justifyRight:!1,location:m,buttonVariant:p,sizeClass:f})):null}}),define("modules/clean/react/file_viewer/app_download_interstitial/file_preview_app_download_interstitial",["require","exports","tslib","react","modules/clean/analytics","modules/clean/react/file_viewer/constants","modules/clean/file_store/utils","modules/clean/react/file_viewer/models","modules/clean/react/previews/constants","modules/clean/web_timing_logger","modules/clean/react/file_viewer/app_download_interstitial/app_download_interstitial"],function(e,t,n,i,o,r,a,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i);var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onContinue=function(){t.log(r.UserAction.AppDownloadInterstitialContinue),"function"==typeof t.props.onContinue&&t.props.onContinue()},t.onClose=function(){t.log(r.UserAction.AppDownloadInterstitialClose),"function"==typeof t.props.onClose&&t.props.onClose()},t.onAppDownload=function(){t.log(r.UserAction.AppDownloadInterstitialInstall)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){c.mark_time_to_interactive(),this.setupLogger(),this.filePreviewSession.markPrimaryEvent(),this.log(r.UserAction.AppDownloadInterstitialView)},t.prototype.componentWillReceiveProps=function(e){e.file.ns_id===this.props.file.ns_id&&e.file.sjid===this.props.file.sjid&&e.fileViewerSession===this.props.fileViewerSession||this.setupLogger(e)},t.prototype.setupLogger=function(e){void 0===e&&(e=this.props);var t=this.props,n=t.file,i=t.fileViewerSession,o=t.previewType,r=t.previewSourceAction,a=void 0===r?l.PreviewSourceAction.Visit:r,c=t.previewSourceContext,u=void 0===c?l.PreviewSourceContext.SharedLinkFile:c
;i&&(this.filePreviewSession=new s.FilePreviewSession({file:n,previewType:o,fileViewerSession:i,sourceAction:a,sourceContext:u}))},t.prototype.log=function(e){var t=this.props,n=t.fileViewerSession,i=t.file;this.filePreviewSession&&n&&i.ns_id&&i.sjid&&o.MobileFilePreviewLogger.log(e,n.id,this.filePreviewSession.id,i.ns_id,i.sjid,{context:r.UserActionContext.AppDownloadInterstitial})},t.prototype.render=function(){var e=this.props,t=e.file,o=e.sharedLinkInfo,r=n.__rest(e,["file","sharedLinkInfo"]);return i.default.createElement(u.AppDownloadInterstitial,n.__assign({fileOrFolderName:a.getFilename(t),open_in_app_data:t.open_in_app_data,onContinue:this.onContinue,onAppDownload:this.onAppDownload,ownerName:o.ownerName,ownerTeamName:o.ownerTeamName,onClose:this.onClose},r))},t})(i.default.PureComponent);t.FilePreviewAppDownloadInterstitial=d}),define("modules/clean/react/file_viewer/exp_file_viewer_upsell_banner",["require","exports","tslib","react","modules/clean/react/css","modules/constants/payments","modules/core/i18n","modules/clean/react_format"],function(e,t,n,i,o,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),r=n.__importStar(r);var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=r.OUT_OF_SPACE_URL+"?oqa=oq_fp";return i.default.createElement("div",{className:"fileviewer-upsell-banner"},s.reactFormat(a._("Get more space to add more files to your Dropbox. <a>Upgrade now.</a>"),{a:i.default.createElement("a",{href:e})}))},t})(i.default.Component);t.ExpFileViewerUpsellBannerV2=o.requireCssWithComponent(l,["/static/css/exp_file_preview_upsell-vflhhQSQ0.css"])}),define("modules/clean/react/file_viewer/file_preview",["require","exports","tslib","external/classnames","react","external/lodash","file-viewer/core","modules/clean/previews/constants","modules/clean/previews/data/preview_type_util","modules/clean/previews/util","modules/clean/previews/util","modules/clean/react/async/loadable","modules/clean/cloud_docs/event_logging","modules/clean/cloud_docs/types","modules/clean/file_store/utils","modules/clean/react/comments2/data/types","modules/clean/react/file_viewer/utils","modules/clean/react/previews/constants","file-viewer/core","modules/clean/react/previews/loading_indicator","modules/clean/react/previews/error/preview_error","modules/clean/react/previews/preview_html","modules/clean/react/previews/preview_image","modules/clean/react/previews/preview_linkfile","modules/clean/react/previews/video/preview_video","modules/clean/react/previews/preview_pdf_loadable","modules/clean/react/previews/preview_ppt_loadable","modules/clean/react/previews/archive/preview_archive_loadable","modules/core/i18n","modules/core/browser","modules/clean/react/file_viewer/file_preview_logging_manager","modules/clean/referrer_cleansing_redirect","modules/clean/redux/types","modules/clean/previews/data/util","modules/clean/react/snackbar"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m,f,h,_,v,g,y,b,w,C,S,E,A,T,P,I,k,x,M,O,F,R){"use strict";function D(e){var t=e.file,i=e.sourceAction,r=e.sourceContext,a=e.previewApiData;return o.default.createElement(x.FilePreviewSessionManager,{file:t,previewType:l.getPreviewType(a.data),sourceAction:i,sourceContext:r,render:function(t){return o.default.createElement(j,n.__assign({},e,{filePreviewSession:t}))}})}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importDefault(o),r=n.__importStar(r),l=n.__importStar(l),c=n.__importStar(c),k=n.__importStar(k),M=n.__importStar(M);var L=d.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/preview_image_zoom"],t,n)}).then(n.__importStar).then(function(e){return e.PreviewImageZoom})}}),N=d.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/limited_preview_message"],t,n)}).then(n.__importStar).then(function(e){return e.LimitedPreviewMessage})}}),B=k.get_uri().getQuery(),U=B.forceRivieraException,V=B.forceTestPdf,H=B.forceTestExcelHtml,j=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={hasError:!1},t.shouldDisableDownload=function(){return!!t.props.sharePermission&&!t.props.sharePermission.canViewContextMenuRoles.length},t.onContextMenu=function(e){t.shouldDisableDownload()&&e.preventDefault()},t.onCopy=function(e){t.props.sharePermission&&0===t.props.sharePermission.canDownloadRoles.length&&e.preventDefault()},t.showLoadingIndicator=function(){return o.default.createElement(y.LoadingIndicator,{className:"loading-indicator"})},t.getErrorMessage=function(e,t,n){if(n&&"sketch"===f.getExtension(n)&&e===v.ErrorType.LoadError&&t===g.RivieraStatus.UnsupportedFormat)return I._("This file can’t be previewed. Previews are               only available for files created in Sketch v43 and up.")},t.triggerError=function(e,n){t.setState({hasError:!0,errorType:e,rivieraStatusCode:n})},t}return n.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){r.isEqual(e.file,this.props.file)||this.setState({hasError:!1,errorType:void 0})},t.prototype.componentDidMount=function(){window.setTimeout(_.cleanupPrerenderPreview)},t.prototype.renderImagePreview=function(e){var t=this.props.file,i=f.getExtension(t);if(this.props.isFullscreen)return o.default.createElement(L,{thumbnailUrlTmpl:e.thumbnail_url_tmpl,fileCount:this.props.count,fileIndex:this.props.index,onError:this.triggerError,onFlipNext:this.props.onNext,onFlipPrevious:this.props.onPrevious,filePreviewSession:this.props.filePreviewSession,contextMenuDisabled:this.shouldDisableDownload(),fileExtension:i,fileId:this.props.file.file_id||"",fileName:f.getFilename(this.props.file),setRenderStatusSuccess:this.props.setRenderStatusSuccess});var r={"preview-url":e.thumbnail_url_tmpl,"file-extension":i,comments2AnnotationsEnabled:this.props.enableComments2Annotations,isFullscreen:this.props.isFullscreen,shouldDisplayToolbar:this.props.shouldDisplayToolbar&&!c.isLimitedPreview(t,s.PreviewType.Image),index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onError:this.triggerError,onNext:this.props.onNext,filePreviewSession:this.props.filePreviewSession,contextMenuDisabled:this.shouldDisableDownload(),nsId:this.props.file.ns_id,sjId:this.props.file.sjid,fileName:f.getFilename(this.props.file),sizeClass:this.props.sizeClass,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sharePermission:this.props.sharePermission};return o.default.createElement(C.PreviewImage,n.__assign({},r))},Object.defineProperty(t.prototype,"shouldShowActionables",{get:function(){return this.props.areActionablesEnabled&&!f.isArchiveFile(this.props.file)},enumerable:!0,configurable:!0}),t.prototype.renderVideoPreview=function(e){var t=this.props,n=t.file,i=t.hidePageChrome;return o.default.createElement(E.PreviewVideo,{title:f.getFilenameWithoutExtension(n),fileExtension:f.getExtension(n),previewUrl:e.transcode_url,separateResolutionUrls:e.transcode_urls_separate_resolutions,thumbnailUrlTmpl:e.poster_url_tmpl,videoMetadataUrl:e.metadata_url,videoContainer:e.container,shouldFocusOnReady:this.props.shouldFocusOnReady,filePreviewSession:this.props.filePreviewSession,onError:this.triggerError,sourceContext:this.props.sourceContext,vttThumbnailsUrl:e.thumb_scrubber_vtt_url,setRenderStatusSuccess:this.props.setRenderStatusSuccess,user:this.props.user,hidePageChrome:i})},t.prototype.renderLinkfilePreview=function(e){var t=this.props.file,n={url:e.url,authenticated:!!e.authenticated};return o.default.createElement(S.PreviewLinkfile,{filename:f.getFilename(t),data:n,source:e.authenticated?"browse":"sharedLink",filePreviewSession:this.props.filePreviewSession,setRenderStatusSuccess:this.props.setRenderStatusSuccess})},t.prototype.renderPDFPreview=function(e){var t=this.props,i=t.enableComments2Annotations,r=t.file,a=t.filePreviewSession,s=t.invalidateFrameMessenger,l=t.isFullscreen,c=t.isSidebarOpen,d=t.location,p=t.setRenderStatusSuccess,m=t.sizeClass,_=e.image_url_tmpl,v=e.refresh_url,g=e.text_url_tmpl;if(!_||!g)return this.renderUnsupportedErrorPreview();var y=i===h.Comments2AnnotationsMode.SpectrumComponents,b=f.getExtension(r),w={autoprintUrl:e.autoprint_url,revisionId:F.buildRevisionId(r.ns_id,r.sjid),fileExtension:b,filePreviewSession:a,imageUrlTmpl:e.image_url_tmpl,isArchiveFile:!1,isFullscreen:l,isSidebarOpen:c,onError:this.triggerError,useCanned:!!V,refreshUrl:v||"",location:d,shouldDisableAnnotations:y,sizeClass:m,textUrlTmpl:e.text_url_tmpl,invalidateFrameMessenger:s,setRenderStatusSuccess:p,comments2AnnotationsEnabled:i};return u.isPptExtension(b)?o.default.createElement(T.PreviewPPTLoadable,n.__assign({},w)):o.default.createElement(A.PreviewPDFLoadable,n.__assign({},w))},t.prototype.getCommonHtmlPreviewProps=function(){var e=this.props.file,t=f.getExtension(e);return{count:this.props.count,fileExtension:t,filePreviewSession:this.props.filePreviewSession,filename:f.getFilename(e),index:this.props.index,isFullscreen:this.props.isFullscreen,onClickNext:this.props.onNext,onClickPrevious:this.props.onPrevious,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sharePermission:this.props.sharePermission,sizeClass:this.props.sizeClass}},t.prototype.renderExcelPreview=function(){var e=this.props.previewApiData.data.preview_url;return e?o.default.createElement(w.PreviewHTML,n.__assign({src:e,isExcel:!0,forceRivieraException:Array.isArray(U)?U[0]:"",forceTestExcelHtml:!!H,usesFrameMessenger:!0},this.getCommonHtmlPreviewProps())):this.renderUnsupportedErrorPreview()},t.prototype.renderHtmlifiedPreview=function(e){var t=e.htmlified_link,i=e.uses_frame_messenger;return t?o.default.createElement(w.PreviewHTML,n.__assign({src:t,isExcel:!1,usesFrameMessenger:i},this.getCommonHtmlPreviewProps())):this.renderUnsupportedErrorPreview()},t.prototype.renderRawHtmlPreview=function(){var e=this.props.previewApiData.data.direct_blockserver_link;return e?o.default.createElement(w.PreviewHTML,n.__assign({src:e,isExcel:!1,usesFrameMessenger:!1},this.getCommonHtmlPreviewProps())):this.renderUnsupportedErrorPreview()},t.prototype.renderAudioPreview=function(e){var t=this.props.file;return o.default.createElement(E.PreviewVideo,{title:f.getFilenameWithoutExtension(t),fileExtension:f.getExtension(t),previewUrl:e.transcode_url,videoContainer:e.container,filePreviewSession:this.props.filePreviewSession,shouldFocusOnReady:this.props.shouldFocusOnReady,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sourceContext:this.props.sourceContext,isAudio:!0,bytes:t.bytes,waveformUrl:e.waveform_url,user:this.props.user})},t.prototype.renderArchivePreview=function(){return o.default.createElement(P.PreviewArchiveLoadable,{rootFile:this.props.file,previewUrl:this.props.previewApiData.data.preview_url,fileSubpath:this.props.fileSubpath,filePreviewSession:this.props.filePreviewSession,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sharedLinkUrl:this.props.sharedLinkUrl,user:this.props.user})},t.prototype.renderCloudDocPreview=function(e){if(this.props.user&&this.props.file.file_id){var t={".tag":"path_or_id",path_or_id:this.props.file.file_id};p.logUserAction(this.props.user.id,m.PreviewAction,t)}if(!this.props.showCloudDocPreview&&e.exit_url)return M.redirect(e.exit_url),null;var n=this.props.file,i=f.getExtension(n);return["gdoc","gslides"].includes(i)?this.renderPDFPreview(e):["gsheet"].includes(i)?this.renderExcelPreview():this.renderUnsupportedErrorPreview()},t.prototype.renderUnsupportedErrorPreview=function(){return this.renderErrorPreview(v.ErrorType.SupportError)},t.prototype.renderErrorPreview=function(e){var t=this.state.rivieraStatusCode,n=this.props,i=n.count,r=n.extensionsConfig,c=n.file,u=n.previewApiData,d=n.filePreviewSession,p=n.index,m=n.isFullscreen,h=n.isMobileUserAgent,_=n.maxFilenameEmLength,g=n.mode,y=n.onNext,w=n.onPrevious,C=n.sharedLinkInfo,S=n.sharePermission,E=n.shareToken,A=n.user,T=l.getPreviewType(u.data),P=this.props.shouldDisplayToolbar&&!f.isArchiveFile(c)&&T===s.PreviewType.Image,I=e;return g===a.FileViewerMode.Watermarking&&(R.Snackbar.close(),I=v.ErrorType.WatermarkingError),o.default.createElement(b.PreviewError,{file:c,extensionsConfig:r,preview:u.data,maxFilenameEmLength:_,filePreviewSession:d,errorType:I,user:A,areActionablesEnabled:this.shouldShowActionables,sharedLinkInfo:C,shareToken:E,sharePermission:S,shouldDisplayToolbar:P,index:p,isFullscreen:m,isMobileUserAgent:h,count:i,onPrevious:w,onNext:y,message:this.getErrorMessage(e,t,c),sizeClass:this.props.sizeClass})},t.prototype.getPreviewTypeWhitelist=function(){return this.props.previewTypeWhitelist||c.VALID_PREVIEW_TYPES},t.prototype.choosePreview=function(){var e=this.props,t=e.file,n=e.previewApiData,i=this.getPreviewTypeWhitelist(),o=this.validateFile(t,n);if(o)return o;if(n.status===O.ApiClientStatus.Request)return this.showLoadingIndicator();if(n.status===O.ApiClientStatus.Error)return this.renderErrorPreview(v.ErrorType.ExtensionError);if(!n.data||!n.data.content)return this.renderErrorPreview(v.ErrorType.ExtensionError);var r=n.data.content,a=l.getPreviewType(n.data);if(c.isEmptyFile(t)&&a!==s.PreviewType.CloudDoc)return this.renderErrorPreview(v.ErrorType.EmptyFileError);if(null!=i&&!i.includes(a))return this.renderErrorPreview(v.ErrorType.ExtensionError);switch(a){case s.PreviewType.Video:return this.renderVideoPreview(r);case s.PreviewType.Audio:return this.renderAudioPreview(r);case s.PreviewType.Archive:return this.renderArchivePreview();case s.PreviewType.Image:return this.renderImagePreview(r);case s.PreviewType.SsrDoc:return this.renderPDFPreview(r);case s.PreviewType.Linkfile:return this.renderLinkfilePreview(r);case s.PreviewType.CloudDoc:return this.renderCloudDocPreview(r);case s.PreviewType.Excel:return this.renderExcelPreview();case s.PreviewType.RawHTML:return this.renderRawHtmlPreview();case s.PreviewType.HTML:return this.renderHtmlifiedPreview(r);case s.PreviewType.Restricted:return this.renderErrorPreview(v.ErrorType.ExtensionError)}},t.prototype.validateFile=function(e,t){return e.is_dir&&!c.isSupportedBundleFile(e)?this.renderErrorPreview(v.ErrorType.ExtensionError):null!=e.ns_id||f.isArchiveFile(e)?f.isSymLink(e)?this.renderErrorPreview(v.ErrorType.SymLinkError):t?c.filesizeSupported(e,l.getPreviewType(t.data))?void 0:this.renderErrorPreview(v.ErrorType.FileSizeError):this.renderErrorPreview(v.ErrorType.ExtensionError):this.renderErrorPreview(v.ErrorType.PendingUploadError)},t.prototype.render=function(){var e=this.props,t=e.file,n=e.previewApiData,r=e.sharedLinkInfo,a=e.shareToken,s=e.sharePermission,u=e.sizeClass,d=e.user,p=this.state,m=p.errorType;return p.hasError?this.renderErrorPreview(m):o.default.createElement("div",{className:i.default({"flex-preview-container":!0,"no-download":s&&0===s.canViewContextMenuRoles.length}),onContextMenu:this.onContextMenu,onCopy:this.onCopy},f.isArchiveFile(t)?null:o.default.createElement(x.FilePreviewPaasLoggerManager,{file:t}),this.choosePreview(),n&&c.isLimitedPreview(t,l.getPreviewType(n.data))?o.default.createElement(N,{extension:f.getExtension(t),file:t,sharedLinkInfo:r,shareToken:a,sharePermission:s,shouldShowActionables:this.shouldShowActionables,sizeClass:u,user:d}):null)},t.defaultProps={areActionablesEnabled:!0,isFullscreen:!1,sharePermission:null,setRenderStatusSuccess:r.noop,user:null},t})(o.default.Component);t.FilePreview=j,t.FilePreviewWithLogging=D}),define("modules/clean/react/file_viewer/file_preview_logging_manager",["require","exports","tslib","react","modules/clean/loggers/file_preview_logger","modules/clean/loggers/file_viewer_logger","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/previews/constants","modules/clean/react/previews/frame_messenger_host","external/lodash"],function(e,t,n,i,o,r,a,s,l,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),r=n.__importStar(r),d=n.__importStar(d);var p=(function(e){function t(t){var n=e.call(this,t)||this;n.setUpFilePreviewLogger=function(e){n.teardownFilePreviewLogger(),n.filePreviewTimelineLogger=new o.FilePreviewTimelineLogger(e),n.filePreviewTimelineLogger.listenTo(s.filePreviewEventEmitter),n.filePreviewUserActionLogger=new o.FilePreviewUserActionLogger,n.filePreviewUserActionLogger.listenTo(s.filePreviewEventEmitter),n.filePreviewModeLogger=new o.FilePreviewModeLogger,n.filePreviewModeLogger.listenTo(s.filePreviewEventEmitter)},n.teardownFilePreviewLogger=function(){null!=n.filePreviewTimelineLogger&&n.filePreviewTimelineLogger.unlistenTo(s.filePreviewEventEmitter),null!=n.filePreviewUserActionLogger&&n.filePreviewUserActionLogger.unlistenTo(s.filePreviewEventEmitter),null!=n.filePreviewModeLogger&&n.filePreviewModeLogger.unlistenTo(s.filePreviewEventEmitter)},n.logPreviewSessionEnded=function(e){void 0===e&&(e=c.PreviewSessionEndReason.Unknown);var t={min_page_width_ratio:"",max_page_width_ratio:"",session_end_reason:e};n.state.filePreviewSession.recordEvent(a.EventType.FilePreviewSessionEnded,t)},n.getNewFilePreviewSession=function(e){var t=e.file,i=e.previewType,o=e.sourceAction,r=e.sourceContext,s=new l.FilePreviewSession({file:t,previewType:i,fileViewerSession:l.FileViewerSession.currentSession,sourceAction:o,sourceContext:r});return l.FilePreviewSession.currentSession=s,n.setUpFilePreviewLogger(s.id),s.recordEvent(a.EventType.FilePreviewAttemptStarted),s},n.windowCloseHandler=function(){n.logPreviewSessionEnded(c.PreviewSessionEndReason.BeforeUnload)};var i=n.getNewFilePreviewSession(n.props);return n.state={filePreviewSession:i},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){window.addEventListener("beforeunload",this.windowCloseHandler)},t.prototype.componentWillUnmount=function(){this.logPreviewSessionEnded(c.PreviewSessionEndReason.Unmount),this.teardownFilePreviewLogger(),window.removeEventListener("beforeunload",this.windowCloseHandler)},t.prototype.componentWillReceiveProps=function(e){if(!d.isEqual(e.file,this.props.file)){this.logPreviewSessionEnded(c.PreviewSessionEndReason.NewFile);var t=this.getNewFilePreviewSession(e);this.setState({filePreviewSession:t})}},t.prototype.render=function(){return this.props.render(this.state.filePreviewSession)},t})(i.default.Component);t.FilePreviewSessionManager=p;var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onFrameMessage=function(e){var n=t.props.file,i=e.action,o=e.parameters;"pagerendered"===i&&r.logPageRendered(n,o)},t.startLogger=function(){t.frameMessenger=new u.PreviewFrameMessengerHost,t.frameMessenger.configureChildMessaging(".react-file-viewer__preview iframe",t.onFrameMessage,["pagerendered"]),t.frameMessenger.startListening()},t.stopLogger=function(){t.frameMessenger.stopListening()},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.startLogger()},t.prototype.componentWillUnmount=function(){this.stopLogger()},t.prototype.render=function(){return null},t})(i.default.Component);t.FilePreviewPaasLoggerManager=m}),define("modules/clean/react/file_viewer/file_viewer",["require","exports","tslib","external/classnames","external/keymaster","react","external/lodash","external/react-dom","external/react-redux","modules/clean/react/comments2/components/mobile_web_comments","modules/clean/react/comments2/util","modules/clean/analytics","modules/clean/loggers/file_viewer_logger","modules/clean/previews/constants","modules/clean/previews/data/preview_type_util","modules/clean/react/comments2/data/selectors","file-viewer/modes","file-viewer/core","modules/clean/react/file_sidebar/file_sidebar","modules/clean/react/file_sidebar/file_sidebar_provider","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/app_download_interstitial/file_preview_app_download_interstitial","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/data/store","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/file_viewer/exp_file_viewer_upsell_banner","modules/clean/react/file_viewer/file_preview","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/file_viewer/location_utils","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer_sidebar/sidebar","modules/clean/react/file_viewer/title_bar","modules/clean/react/watermarking/controller","modules/clean/react/watermarking/utils","modules/clean/previews/data/preview_type_util","modules/clean/react/keyboard_binding/keyboard_binding_provider","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/keycode","modules/clean/react/location/with_location","modules/clean/react/modal","modules/clean/react/open_in_app/banner","modules/clean/react/previews/constants","modules/clean/react/previews/fidelity_survey/fidelity_survey","modules/clean/react/size_class/constants","modules/clean/react/size_class/size_class","modules/clean/web_timing_logger","modules/constants/file_activity_stream","modules/constants/file_viewer","modules/constants/python","modules/core/browser_detection","modules/core/dom","modules/clean/react/file_viewer/data/selectors","modules/clean/previews/data/selectors","modules/clean/react/css","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/utils","modules/clean/file_store/utils","modules/clean/react/file_viewer/open_in_paper","modules/clean/react/search_success_banner/constants","modules/clean/react/search_success_banner/search_success_banner","modules/clean/react/search_success_banner/util","modules/clean/sharing/constants","modules/clean/react/file_viewer/exp_controller_mode","modules/clean/react/file_viewer_sidebar/panes/documentation_pane","modules/clean/react/file_viewer_sidebar/panes/metadata_pane","modules/clean/react/file_viewer_sidebar/panes/commenting_pane","modules/clean/react/file_viewer_sidebar/panes/loadable_activity_pane"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m,f,h,_,v,g,y,b,w,C,S,E,A,T,P,I,k,x,M,O,F,R,D,L,N,B,U,V,H,j,q,K,z,W,G,Y,Z,X,Q,J,$,ee,te,ne,ie,oe,re,ae,se,le,ce,ue,de,pe,me){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importDefault(o),r=n.__importDefault(r),a=n.__importStar(a),s=n.__importStar(s),p=n.__importStar(p),f=n.__importStar(f),W=n.__importStar(W),G=n.__importStar(G),Z=n.__importStar(Z),Q=n.__importStar(Q);var fe="",he="",_e=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={modeClassnames:""},t.previewSourceAction=t.props.initialPreviewSourceAction,t.previewSourceContext=t.props.initialPreviewSourceContext,t.loadModeControllerExperiment=function(){var e=t.props,n=e.file,i=e.sharedLinkInfo,o=e.user;ce.isFiles2ControllerExperimentOn()&&t.props.fetchControllerModeAction({path:n.fq_path,shared_link_url:i&&i.url,experiment_variant:Y.FILES_2_CONTROLLER_EXPERIMENT},o)},t.focusInViewer=function(){if(!ne.modalIsUp()&&!t.props.shouldFocusCommentInput){var e=s.findDOMNode(t).querySelector(".button-primary");if(e)e.focus();else{var n=Q.getTabbableElementsIn(".react-file-viewer");n.length&&n[0].focus()}}},t.setupKeymaster=function(){fe=o.default.getScope(),o.default.setScope("fileviewer")},t.cleanupKeymaster=function(){o.default.clearScope("fileviewer"),o.default.setScope(fe)},t.shouldShowOpenInAppBanner=function(){var e=t.props,n=e.hidePageChrome,i=e.isMobileUserAgent;return!n&&(i||X.is_mobile_or_tablet())},t.openInAppBannerOnClick=function(){b.logUserAction(te.UserAction.OpenInApp,te.UserActionContext.OpenInAppBanner)},t.registerSidebarPanesFn=function(e){var n;return n={},n[v.SidebarPaneId.Documentation]=r.default.createElement(ue.DocumentationPane,{key:"documentation-pane",file:t.props.file,user:t.props.user,isSharedLink:!!t.props.sharedLinkInfo,maxFilenameEmLength:te.SizeClassFilenameLengthMap[t.props.sizeClass],isVersionHistoryMode:!!t.props.isVersionHistoryMode}),n[v.SidebarPaneId.Metadata]=r.default.createElement(de.MetadataPane,{key:"metadata-pane",file:t.props.file,user:t.props.user,sharedLinkInfo:t.props.sharedLinkInfo,previewType:t.previewType}),n[v.SidebarPaneId.Comments]=r.default.createElement(pe.CommentingPane,{key:"commenting-pane",currentFile:t.props.file,isVersionHistoryMode:!!t.props.isVersionHistoryMode,sharedLinkInfo:t.props.sharedLinkInfo,user:t.props.user}),n[v.SidebarPaneId.Activity]=r.default.createElement(me.LoadableActivityPane,{key:"activity-pane",file:t.props.file,user:t.props.user,isVersionHistoryMode:!!t.props.isVersionHistoryMode}),n},t.renderSidebarControlsFn=function(e){var i=[r.default.createElement(_.DocumentationControl,n.__assign({key:"documentation-control"},e)),r.default.createElement(_.CommentControl,n.__assign({key:"comment-control"},e))],o=t.props,a=o.file,s=o.user;return F.allowWatermark(a,s)&&i.push(r.default.createElement(_.WatermarkControl,n.__assign({key:"watermarking-control"},e))),i},t.onInterstitialClose=function(){t.props.onAppDownloadInterstitialDismissed()},t.onInterstitialContinue=function(){t.props.onAppDownloadInterstitialDismissed()},t.getKeyboardBindings=a.memoize(function(e){return e?[N.hydrateKeyboardBinding({keyboardEventCriteria:{which:B.KeyCode.ESC},callback:function(){return E.exitFullScreen(te.UserActionContext.Keyboard)}})]:[N.hydrateKeyboardBinding({keyboardEventCriteria:{which:B.KeyCode.F},callback:function(){return E.enterFullScreen(te.UserActionContext.Keyboard)}}),N.hydrateKeyboardBinding({keyboardEventCriteria:{which:B.KeyCode.ESC},callback:function(e){t.shouldIgnoreEscape(e)||null==t.props.onCloseViewer||t.props.onCloseViewer()}})]}),t}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.setUpLogging()},t.prototype.componentDidMount=function(){var e=this.props,t=e.file,n=e.fetchShowOverQuotaUpsell,i=e.onComponentDidMount,o=e.user;null!=i&&i(),this.setDocumentTitle(ie.getFilename(t),!0),Q.scroll_lock_document(),p.start(),this.logView(),n(o),this.loadModeControllerExperiment()},t.prototype.componentWillUpdate=function(e){var t=e.file;t!==this.props.file&&(this.setDocumentTitle(ie.getFilename(t)),this.previewSourceAction=j.PreviewSourceAction.Click,this.previewSourceContext=j.PreviewSourceContext.FileViewer),o.default.setScope("fileviewer"),e.mode!==this.props.mode&&this.setState({modeClassnames:"state-"+this.props.mode+"-out state-"+e.mode+"-in"})},t.prototype.componentDidUpdate=function(e){ie.areFilesEqual(e.file,this.props.file)||this.logView(),e.previewApiData&&R.isImage(e.previewApiData.data)&&this.props.previewApiData&&!R.isImage(this.props.previewApiData.data)&&E.exitFullScreen()},t.prototype.componentWillUnmount=function(){se.resetSearchSuccessBannerSettings(),this.unsetDocumentTitle(),Q.scroll_unlock_document(),null!=this.props.onComponentWillUnmount&&this.props.onComponentWillUnmount(),V.Modal.close()},Object.defineProperty(t.prototype,"fileSubpath",{get:function(){return I.getFileSubpath(this.props.location)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"previewType",{get:function(){return this.props.previewApiData&&f.getPreviewType(this.props.previewApiData.data)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isViewingFileSubpath",{get:function(){return f.isArchive(this.props.previewApiData.data)&&!!this.fileSubpath},enumerable:!0,configurable:!0}),t.prototype.shouldSuppressPassInfo=function(){return null==this.props.file.ns_id},t.prototype.setUpLogging=function(){if(k.FileViewerSession.currentSession=new k.FileViewerSession,this.props.fileViewTarget===Z.FileViewTargetType.SHARED_CONTENT_LINK){var e=W.start_time(),t=(new Date).getTime(),n=le.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE;this.props.user&&d.ShareTibEventLogger.log(this.props.user.id,"PREVIEW_RENDER",n,{timing:t-e,containing_ns_id:this.props.file.ns_id,sjid:this.props.file.sjid})}},t.prototype.isDownloadDisabled=function(){return!(!this.props.sharePermission||!this.props.sharePermission.canDownloadRoles)&&0===this.props.sharePermission.canDownloadRoles.length},t.prototype.shouldShowAppDownloadInterstitial=function(){return!this.props.appDownloadInterstitialDismissed&&this.props.file.open_in_app_data},t.prototype.shouldIgnoreEscape=function(e){var t=document.querySelector(".vjs-fullscreen");return Q.focus_in_input()||Q.is_input(e.target)||document.querySelector(".annotation-bubble")||this.props.isFullscreen||this.fileSubpath||t},t.prototype.setDocumentTitle=function(e,t){void 0===t&&(t=!1),t&&(he=document.title),document.title=e},t.prototype.unsetDocumentTitle=function(){""!==he&&(document.title=he)},t.prototype.logView=function(){null===this.props.file.ns_id||ne.getSourceContext()===j.PreviewSourceContext.SharedLinkCollection||this.props.hidePageChrome||p.logView(this.props.file,this.props.user,this.props.fileViewTarget,this.props.fileViewOrigin,this.props.fileViewAction,null!=this.props.sharedLinkInfo?this.props.sharedLinkInfo.url:void 0,this.isDownloadDisabled())},t.prototype.isImagePreviewAnnotationEnabled=function(){return!(this.props.sizeClass===K.SizeClass.Small||this.props.hidePageChrome)},t.prototype.renderFlippableControls=function(){if(!this.props.isFullscreen&&!this.isImagePreviewAnnotationEnabled()&&null!=this.props.fileIndex&&![m.PreviewType.Video,m.PreviewType.Audio].includes(this.previewType)&&this.props.mode!==v.FileViewerMode.Watermarking)return r.default.createElement(P.FlippableControls,{index:""+(this.props.fileIndex+1),numFlippableFiles:this.props.fileCount,onNext:this.props.onFlipNext,onPrevious:this.props.onFlipPrevious})},t.prototype.renderFilePreview=function(){return r.default.createElement("div",{className:"react-file-viewer__preview react-file-preview"},r.default.createElement("div",{className:"flex-preview-container"},this.maybeRenderFidelitySurvey(),this.renderSearchSuccessBanner(),this.shouldShowOpenInAppBanner()&&r.default.createElement(H.OpenInAppBanner,{urls:this.props.file.open_in_app_data,onClick:this.openInAppBannerOnClick}),r.default.createElement(T.FilePreviewWithLogging,{areActionablesEnabled:!this.props.hidePageChrome&&null!=this.props.file.ns_id,count:this.props.fileCount,enableComments2Annotations:this.props.enableComments2Annotations,extensionsConfig:this.props.extensionsConfig,file:this.props.file,previewApiData:this.props.previewApiData,fileSubpath:this.fileSubpath,index:this.props.fileIndex,isFullscreen:this.props.isFullscreen,isMobileUserAgent:this.props.isMobileUserAgent,isSidebarOpen:this.props.isSidebarOpen,maxFilenameEmLength:te.SizeClassFilenameLengthMap[this.props.sizeClass],onNext:this.props.onFlipNext,onPrevious:this.props.onFlipPrevious,sharedLinkInfo:this.props.sharedLinkInfo,location:this.props.location,sharePermission:this.props.sharePermission,shareToken:this.props.shareToken,shouldFocusOnReady:!this.props.hidePageChrome,sourceAction:this.previewSourceAction,sourceContext:this.previewSourceContext,sharedLinkUrl:null!=this.props.sharedLinkInfo?this.props.sharedLinkInfo.url:void 0,setRenderStatusSuccess:this.props.setRenderStatusSuccessForCurrentFile,shouldDisplayToolbar:this.isImagePreviewAnnotationEnabled(),sizeClass:this.props.sizeClass,user:this.props.user,mode:this.props.mode,showCloudDocPreview:this.props.showCloudDocPreview}),this.renderFlippableControls()))},t.prototype.shouldRenderSidebar=function(){return!(this.props.sizeClass!==K.SizeClass.Large||this.props.isFullscreen||this.props.hidePageChrome||X.is_mobile_or_tablet()||this.isViewingFileSubpath||null==this.props.file.ns_id||[m.PreviewType.CloudDoc].includes(this.previewType)||this.props.mode===v.FileViewerMode.Watermarking)},t.prototype.renderLegacySidebar=function(){return r.default.createElement(g.FileSidebar,{activityContext:this.props.activityContext,currentFile:this.props.file,previewType:this.previewType,headerComponent:this.props.sidebarHeaderComponent,
commentsDisabledOnFile:!!this.props.hideComments,isVersionHistoryMode:!!this.props.isVersionHistoryMode,sharedLinkInfo:this.props.sharedLinkInfo,shouldInitiallyFocusInput:!!this.props.shouldFocusCommentInput,user:this.props.user,mode:this.props.mode})},t.prototype.renderSidebar=function(){return this.shouldRenderSidebar()?ne.isFiles2Enabled()?r.default.createElement(x.Sidebar,{registerSidebarPanesFn:this.registerSidebarPanesFn,renderSidebarControlsFn:this.renderSidebarControlsFn}):this.renderLegacySidebar():null},t.prototype.renderMobileComments=function(){var e=this.props,t=e.file,n=e.sharedLinkInfo,i=e.sizeClass,o=e.user;return this.props.isFullscreen||this.isViewingFileSubpath||!u.isComments2Mobile()?null:r.default.createElement(c.MobileWebComments,{currentFile:t,previewType:this.previewType,sharedLinkInfo:n,user:o,sizeClass:i})},t.prototype.renderTitleBar=function(){return this.props.isFullscreen||this.props.hidePageChrome&&!f.isArchive(this.props.previewApiData.data)?null:r.default.createElement("div",{className:"react-file-viewer__title-bar"},r.default.createElement(M.TitleBar,{canClose:this.props.canClose,canRestoreRevision:this.props.canRestoreRevision,closeUrl:this.props.titleBarCloseUrl,file:this.props.file,fileSubpath:this.fileSubpath,fileViewAction:this.props.fileViewAction,fileViewOrigin:this.props.fileViewOrigin,hidePageChrome:this.props.hidePageChrome,isSeenStatesEnabled:!this.shouldSuppressPassInfo(),isVersionHistoryMode:this.props.isVersionHistoryMode,isViewingFileSubpath:this.isViewingFileSubpath,maxFilenameEmLength:te.SizeClassFilenameLengthMap[this.props.sizeClass],onClose:this.props.onCloseViewer,onMount:this.focusInViewer,onRestoreRevision:this.props.onRestoreRevision,previewApiData:this.props.previewApiData,sharedLinkInfo:this.props.sharedLinkInfo,sharePermission:this.props.sharePermission,shareToken:this.props.shareToken,sizeClass:this.props.sizeClass,user:this.props.user||null}),this.renderUpsellBanner())},t.prototype.shouldAllowFileDonation=function(){return null==this.props.sharedLinkInfo&&(null==this.props.user||this.props.user.home_ns_id===this.props.file.ns_id)},t.prototype.renderSearchSuccessBanner=function(){var e=this.props,t=e.user,n=e.hidePageChrome,i=e.renderStatus,o=e.sizeClass;return t&&ne.shouldShowSearchSuccessBanner({renderStatus:i,hidePageChrome:n,sizeClass:o})&&se.getSearchSuccessBannerVisibility()?r.default.createElement(ae.SearchSuccessBanner,{user:this.props.user,displayContext:re.SearchSuccessDisplayContext.PREVIEW}):null},t.prototype.maybeRenderFidelitySurvey=function(){var e=this.props,t=e.file,n=e.hidePageChrome,i=e.renderStatus,o=e.sizeClass;return ne.canShowFidelitySurvey({file:t,sizeClass:o,hidePageChrome:n,renderStatus:i})?r.default.createElement(q.FidelitySurvey,{allowFileDonation:this.shouldAllowFileDonation(),file:t}):null},t.prototype.renderUpsellBanner=function(){return this.props.showOverQuotaUpsell?r.default.createElement(A.ExpFileViewerUpsellBannerV2,null):null},t.prototype.render=function(){var e=this.props,t=e.className,n=e.file,o=e.enableComments2Annotations,a=e.hidePageChrome,s=e.isFullscreen,l=e.sharePermission,c=e.sharedLinkInfo,d=e.sizeClass,p=e.transparentBackground,f=e.user,h=ie.getFilename(n),_=this.previewType;return this.shouldShowAppDownloadInterstitial()?r.default.createElement("div",{"aria-label":h},r.default.createElement(w.FilePreviewAppDownloadInterstitial,{sharedLinkInfo:c,file:n,previewType:_,fileViewerSession:k.FileViewerSession.currentSession,previewSourceAction:this.previewSourceAction,previewSourceContext:this.previewSourceContext,onClose:this.onInterstitialClose,onContinue:this.onInterstitialContinue})):r.default.createElement(D.KeyboardBindingProvider,{onDestroy:this.cleanupKeymaster,onSetup:this.setupKeymaster},r.default.createElement(ve,{ns_id:n.ns_id},r.default.createElement("div",{"aria-label":h,className:i.default("react-file-viewer",t,this.state.modeClassnames,{"no-background":p&&!s}),role:"dialog"},r.default.createElement(L.KeyboardBindingConnector,{keyboardBindings:this.getKeyboardBindings(s)}),this.renderTitleBar(),d!==K.SizeClass.Large||s||a?null:r.default.createElement(oe.OpenInPaperBanner,{currentFile:n,sharedLinkInfo:c,sharePermission:l,user:f}),r.default.createElement("div",{className:i.default("react-file-viewer__content","comments2",{"comments2-mobile-web":u.isComments2Mobile(),"comments2-annotation-enabled":o,"video-audio":this.previewType===m.PreviewType.Video||this.previewType===m.PreviewType.Audio}),"data-preview-type":_},this.renderFilePreview(),this.renderSidebar(),this.renderMobileComments(),F.allowWatermark(n,f)?r.default.createElement(O.WatermarkingController,{file:n,user:f}):null))))},t.defaultProps={canClose:!1,canRestoreRevision:!1,className:"",hideComments:!1,hidePageChrome:!1,isVersionHistoryMode:!1,forceFileUnlocked:!1,oref:Z.OREF_CONSTANTS.BROWSE_UNKNOWN,shouldFocusCommentInput:!1,sizeClass:K.SizeClass.Large,fileCount:0,showCloudDocPreview:!1},t})(r.default.Component);t._FileViewer=_e;var ve=function(e){var t=e.children,n=e.ns_id;return G.IS_ON&&null!=n?r.default.createElement(y.FileSidebarProvider,null,t):r.default.createElement(r.default.Fragment,null,t)},ge=function(e){return null!=e.file?r.default.createElement(_e,n.__assign({},e)):r.default.createElement("div",null)},ye=U.withLocation(ge),be=z.withSizeClass(ye,{isResponsiveEnabled:ne.isResponsiveEnabled,responsiveClassName:te.ResponsiveClassName}),we=l.connect(function(e,t){var n=J.getAppDownloadInterstitial(e);void 0===n&&t&&(n=t.appDownloadInterstitialDismissed);var i=J.getActiveFile(e);return{appDownloadInterstitialDismissed:n,file:i,mode:J.getMode(e),isFullscreen:J.getIsFullScreen(e),isSidebarOpen:J.getIsSidebarOpen(e),renderStatus:J.getRenderStatusForCurrentFile(e),showOverQuotaUpsell:J.getShowOverQuotaUpsell(e),previewApiData:$.getApiDataForFile(e,i),enableComments2Annotations:h.getComments2AnnotationsMode(e),extensionsConfig:J.getExtensionsConfig(e)}},{onAppDownloadInterstitialDismissed:C.dismissAppDownloadInterstitial,fetchShowOverQuotaUpsell:C.fetchShowOverQuotaUpsell,setRenderStatusSuccessForCurrentFile:C.setRenderStatusSuccessForCurrentFile,fetchControllerModeAction:C.fetchControllerModeAction})(be),Ce=S.getStoreForFileViewer(),Se=function(e){return r.default.createElement(l.Provider,{store:Ce},r.default.createElement(we,n.__assign({},e)))},Ee=["/static/css/preview_flexbox_layout-vflt34eP7.css","/static/css/react_file_viewer-vflfEFYcz.css","/static/css/react_title_bar-vfl0jJnEK.css","/static/css/spectrum/index.web-vflfgiEch.css","/static/js/file-viewer/index.web-vflts9xSG.css"],Ae=ee.requireCssWithComponent(Se,Ee);t.FileViewer=Ae}),define("modules/clean/react/file_viewer/flippable_controls",["require","exports","tslib","react","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i);var a=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handlePreviousClick=function(){t.props.onPrevious&&t.props.onPrevious()},t.handleNextClick=function(){t.props.onNext&&t.props.onNext()},t}return n.__extends(t,e),t.prototype.getNavText=function(){return r._("%(cur_file_num)s of %(num_total_files)s").format({cur_file_num:this.props.index,num_total_files:this.props.numFlippableFiles})},t.prototype.render=function(){if(this.props.numFlippableFiles<=1)return null;var e=r._("Flip left",{comment:"Flip to the previous file in a series of files when previewing files on the web"}),t=r._("Flip right",{comment:"Flip to the next file in a series of files when previewing files on the web"});return i.default.createElement("div",{className:"react-file-viewer__controls"},i.default.createElement("button",{className:"nav-control",onClick:this.handlePreviousClick},i.default.createElement(o.Sprite,{group:"web",name:"s_flip_left",alt:e})),i.default.createElement("div",{className:"nav-text"},this.getNavText()),i.default.createElement("button",{className:"nav-control",onClick:this.handleNextClick},i.default.createElement(o.Sprite,{group:"web",name:"s_flip_right",alt:t})))},t})(i.default.Component);t.FlippableControls=a}),define("modules/clean/react/file_viewer/full_screen_helpers",["require","exports","modules/clean/react/file_viewer/data/store","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants"],function(e,t,n,i,o,r){"use strict";function a(e){document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("MSFullscreenChange",e),document.addEventListener("mozfullscreenchange",e)}function s(e){document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e),document.removeEventListener("mozfullscreenchange",e)}function l(e){window.addEventListener("popstate",e)}function c(e){window.removeEventListener("popstate",e)}function u(){var e=document.body;null!=e.requestFullscreen?e.requestFullscreen():null!=e.msRequestFullscreen?e.msRequestFullscreen():null!=e.mozRequestFullScreen?e.mozRequestFullScreen():null!=e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function d(){var e=document;e.exitFullscreen?e.exitFullscreen():e.msExitFullscreen?e.msExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen&&e.webkitExitFullscreen()}function p(){S.dispatch(i.openFullScreen())}function m(){S.dispatch(i.closeFullScreen())}function f(){w()||y(r.UserActionContext.Browser)}function h(){y(r.UserActionContext.Browser)}function _(){a(f),l(h)}function v(){s(f),c(h)}function g(e){p(),u(),_(),e&&o.logUserAction(r.UserAction.ToggleFullscreenOn,e)}function y(e){v(),m(),d(),e&&o.logUserAction(r.UserAction.ToggleFullscreenOff,e)}function b(){var e=document.body;return e.requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen}function w(){var e=document;return null!=e.fullScreen?e.fullScreen:null!=e.webkitIsFullScreen?e.webkitIsFullScreen:null!=e.mozFullScreen?e.mozFullScreen:null!=e.msFullscreenElement||null!=e.fullscreenElement}function C(e,t){return e||w()?y(t):g(t)}Object.defineProperty(t,"__esModule",{value:!0});var S=n.getStoreForFileViewer();t.enterFullScreen=g,t.exitFullScreen=y,t.browserSupportFullScreen=b,t.isBrowserFullScreen=w,t.toggleFullScreen=C}),define("modules/clean/react/file_viewer/more_dropdown/models",["require","exports","tslib","external/lodash"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var o=(function(){function e(){}return e.prototype.equals=function(e){return i.isEqual(this,e)},e})(),r=(function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this;return n.className=t.className||null,n.fileActionButtonType=t.fileActionButtonType||null,n.handler=t.handler||i.noop,n.component=t.component||null,n.sortWeight=t.sortWeight||0,n}return n.__extends(t,e),t})(o);t.MoreOption=r;var a=(function(e){function t(t){var n=e.call(this)||this;return n.fileActionButtonGroup=t.fileActionButtonGroup,n.options=t.options||[],n.sortWeight=t.sortWeight||0,n}return n.__extends(t,e),t})(o);t.MoreOptionGroup=a}),define("modules/clean/react/file_viewer/more_dropdown/more_option_registry",["require","exports","tslib","external/lodash","modules/clean/react/file_viewer/more_dropdown/models"],function(e,t,n,i,o){"use strict";function r(e,t){return e.filter(function(e){return e!==t})}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var a=(function(){function e(){this.listeners=[]}return e.prototype.emitChange=function(){return this.listeners.forEach(function(e){return e()})},e.prototype.addListener=function(e){var t=this;return this.listeners.push(e),function(){var n=t.listeners.indexOf(e);n>-1&&t.listeners.splice(n,1)}},e.prototype.removeListeners=function(){this.listeners=[]},e})(),s=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.options=[],t}return n.__extends(t,e),t.prototype.isValidMoreOption=function(e){return null!=e.fileActionButtonType},t.prototype.isValidMoreOptionGroup=function(e){var t=this,n=e.options;return n.length&&n.every(function(e){return t.isValidMoreOption(e)})},t.prototype.isValidOption=function(e){return e instanceof o.MoreOption&&this.isValidMoreOption(e)||e instanceof o.MoreOptionGroup&&this.isValidMoreOptionGroup(e)},t.prototype.reset=function(){this.options=[],this.removeListeners()},t.prototype.getOptionItems=function(){return i.sortBy(this.options.slice(),function(e){return e.sortWeight})},t.prototype.addOption=function(e){if(!this.isValidOption(e))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");this.options=this.options.concat([e]),this.emitChange()},t.prototype.removeOption=function(e){if(null!=e&&!this.isValidOption(e))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");var t=this.options.length;this.options=r(this.options,e),this.options.length<t&&this.emitChange()},t.prototype.replaceOption=function(e,t){if(null==t)throw new Error("Please provide option to replace it with. Otherwise use removeOption");if(!this.isValidOption(e)||!this.isValidOption(t))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");if(!e.equals(t)){var n=!1;this.options=this.options.map(function(i){return i===e?(n=!0,t):i}),n&&this.emitChange()}},t})(a);t.MoreOptionRegistry=s,t.moreOptionRegistry=new s});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};define("modules/clean/react/file_viewer/open_button/open_button",["require","exports","modules/clean/react/async/loadable"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenButton=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/file_viewer/open_button/open_button_component"],t,n)}).then(__importStar).then(function(e){return e.OpenButton})}})}),define("modules/clean/react/file_viewer/open_in_paper",["require","exports","tslib","react","modules/clean/react/async/loadable","modules/clean/react/file_viewer/utils","modules/constants/file_viewer"],function(e,t,n,i,o,r,a){"use strict";function s(){return"VARIANT_A"===a.OPEN_IN_PAPER_VARIANT}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),a=n.__importStar(a);var l=o.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/paper/open_in_paper_banner"],t,n)}).then(n.__importStar).then(function(e){return e.OpenInPaperBanner})}});t.OpenInPaperBanner=function(e){var t=e.currentFile,n=e.sharedLinkInfo,o=e.sharePermission,a=e.user;return s()&&r.canUserUsePaper(a)&&r.canDownloadFile(n,o)?i.default.createElement(l,{file:t,sharedLink:n.url,source:null!=n?"shared_file_actions":"mounted_file_actions"}):null}}),define("modules/clean/react/file_viewer/title_bar",["require","exports","tslib","react","modules/clean/react/async/loadable"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.TitleBar=o.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/file_viewer/title_bar_components"],t,n)}).then(n.__importStar).then(function(e){return e.ConnectedTitleBar})},loading:i.default.createElement("div",{className:"react-title-bar"})})}),define("modules/clean/react/file_viewer/title_utils",["require","exports","modules/constants/python","modules/clean/filepath","modules/clean/file_store/utils","modules/core/i18n"],function(e,t,n,i,o,r){"use strict";function a(e){var t=e.file,a=e.fileViewAction,s=e.fileViewOrigin;return e.isVersionHistoryMode?r._("Version history"):s===n.FileViewOriginType.RECENTS?r._("Recents"):s===n.FileViewOriginType.HOME?r._("Home"):s!==n.FileViewOriginType.PHOTOS&&a!==n.FileViewActionType.SEARCH&&o.isBrowseFile(t)&&t.fq_path?i.filename(i.parent_dir(t.fq_path)):void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.closeButtonTitle=function(e){var t=a(e);return!e.sharedLinkInfo&&t?r._("Back to %(folder)s").format({folder:t}):r._("Close")},t.customLogoUrl=function(e){return e?e.ownerTeamLogo:void 0};var s=[".pdf",".jpg",".jpeg",".png",".bmp"];t.fileIsWatermarkable=function(e){return o.isBrowseFile(e)&&!e.read_only&&s.includes(e.ext.toLowerCase())}}),define("modules/clean/react/file_viewer/utils",["require","exports","tslib","modules/clean/activity/constants","modules/clean/ajax","modules/core/browser","modules/clean/previews/constants","modules/clean/react/file_viewer/constants","modules/clean/previews/data/preview_type_util","modules/constants/file_viewer","modules/core/uri","modules/clean/react/previews/constants","modules/constants/python","modules/clean/react/previews/image_helpers","modules/clean/react/file_viewer/constants","modules/clean/react/size_class/constants","modules/clean/previews/api"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m,f,h,_){"use strict";function v(e,t){o.SilentBackgroundRequest({url:"/ow/get_available_tooltips",dataType:"json",success:function(e){return t(e)},subject_user:e})}function g(e,t){for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];for(var o in i)if(i.hasOwnProperty(o)){var r=i[o],a=r.extensions;if(a.indexOf(t)>-1)return{vendor:n,application:o}}}return null}function y(e,t,n){"acrobat_or_reader"===n?o.SilentBackgroundRequest({url:"/ow/log_adobe_tooltip_impression",data:{app_name:n,extension:e},subject_user:t}):o.SilentBackgroundRequest({url:"/ow/msft/log_tooltip_impression",data:{app_type:n,extension:e},subject_user:t})}function b(e,t){if(e===s.SplitButtonActionLocation.Main){if(t===s.FileViewerPane.TitleBar)return s.UserActionContext.TitleBarMain;if(t===s.FileViewerPane.PreviewContent)return s.UserActionContext.PreviewContentMain}else if(e===s.SplitButtonActionLocation.Split){if(t===s.FileViewerPane.TitleBar)return s.UserActionContext.TitleBarSplitButton;if(t===s.FileViewerPane.PreviewContent)return s.UserActionContext.PreviewContentSplitButton}return s.UserActionContext.Unknown}function w(){for(var e=!1,t=document.getElementsByClassName("db-modal-wrapper"),n=0;!e&&n<t.length;n++){e="none"!==window.getComputedStyle(t[n]).display}return e}function C(){var e=document.querySelectorAll(".prerender-preview");Array.prototype.forEach.call(e,function(e){e.style.display="none"})}function S(){return new u.URI({path:"/login",query:{cont:r.get_href()}}).toString()}function E(e,t){if([i.ActivityContext.BROWSE_FILE_VIEWER,i.ActivityContext.SHARED_LINK_VIEW,i.ActivityContext.SHARED_CONTENT_LINK_VIEW].indexOf(e)>=0)switch(t){case a.PreviewType.Image:return s.FileViewerInterfaceType.Window;case a.PreviewType.SsrDoc:return s.FileViewerInterfaceType.Frame}}function A(e){return!e}function T(e,t){return A(e)||t&&t.canDownloadRoles.length>0}function P(e){return null!=e&&!e.is_paper_disabled}function I(e){var t=e.file,n=e.renderStatus,i=e.hidePageChrome,o=e.sizeClass;return!!t&&(n===f.PreviewRenderStatus.Succeeded&&(!i&&o!==h.SizeClass.Small))}function k(e){switch(e){case p.FileViewTargetType.SHARED_LINK:return i.ActivityContext.SHARED_LINK_VIEW;case p.FileViewTargetType.SHARED_CONTENT_LINK:return i.ActivityContext.SHARED_CONTENT_LINK_VIEW;default:return i.ActivityContext.BROWSE_FILE_VIEWER}}function x(){var e=r.get_uri().path;return/^\/(home|work|personal|search)/.test(e)?d.PreviewSourceContext.Browse:/^\/h$/.test(e)?d.PreviewSourceContext.Home:/^\/(s|scl\/fi)\//.test(e)?d.PreviewSourceContext.SharedLinkFile:/^\/(sh|scl\/fo)\//.test(e)?d.PreviewSourceContext.SharedLinkFolder:/^\/sc\//.test(e)?d.PreviewSourceContext.SharedLinkCollection:/^\/history/.test(e)?d.PreviewSourceContext.VersionHistory:void 0}function M(){switch(x()){case d.PreviewSourceContext.SharedLinkFile:case d.PreviewSourceContext.SharedLinkFolder:return d.PreviewSourceAction.Visit;default:return d.PreviewSourceAction.Click}}function O(e,t){if(0!==e.length){var n=[];[0,1,2,3,4,5,6,-1,-2].forEach(function(i){var o=(t+i+e.length)%e.length;n.indexOf(o)===-1&&n.push(o)}),n.forEach(function(t){if(e.length>t&&l.isImage(e[t])){var n=e[t];if(n){var i=n.content,o=i.thumbnail_url_tmpl||n.preview_url;o&&m.preloadResponsiveImage(o)}}})}}function F(e){var t=e.renderStatus,n=e.hidePageChrome,i=e.sizeClass;return t===f.PreviewRenderStatus.Succeeded&&!n&&i!==h.SizeClass.Small}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),r=n.__importStar(r),m=n.__importStar(m),t.TooltipHelpers={fetchTooltipInfo:v,getVendorAndApplication:g,logImpression:y},t.getSplitButtonUserActionContext=b,t.modalIsUp=w,t.cleanupPrerenderPreview=C,t.getSharedLinkLoginUrl=S,t.sharedLinkLoginUrl=S(),t.getFileViewerInterfaceType=E,t.isMountedFile=A,t.canDownloadFile=T,t.canUserUsePaper=P,t.canShowFidelitySurvey=I,t.getActivityContext=k,t.getSourceContext=x,t.getSourceAction=M,t.preloadImages=O,t.shouldShowSearchSuccessBanner=F,t.fetchRivieraStatusCode=function(e,t,n){void 0===n&&(n=function(){});var i=new XMLHttpRequest;return i.open("GET",e),i.withCredentials=!0,i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE){var e=_.getParsedDropboxMetadataHeader(i);e.rivieraStatusCode?t(e.rivieraStatusCode):n()}},i.send(),i},t.isResponsiveEnabled=function(){return x()!==d.PreviewSourceContext.VersionHistory},t.isFiles2Enabled=function(){return"M2"===c.PREVIEWS_FILES_2||"M3"===c.PREVIEWS_FILES_2},t.isFiles2M3Enabled=function(){return"M3"===c.PREVIEWS_FILES_2}}),define("modules/clean/react/file_viewer_sidebar/panes/commenting_pane",["require","exports","tslib","react","file-viewer/modes","modules/clean/react/async/loadable"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i);var a=r.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/file_viewer_sidebar/panes/commenting_pane_contents"],t,n)}).then(n.__importStar).then(function(e){return e.CommentingPaneContents})}});t.CommentingPane=function(e){return i.default.createElement(o.Pane,null,i.default.createElement(a,n.__assign({},e)))}}),define("modules/clean/react/file_viewer_sidebar/panes/documentation_pane",["require","exports","tslib","react","file-viewer/modes","file-viewer/core","modules/clean/em_string","modules/clean/file_store/utils","modules/clean/previews/util","modules/clean/display_format","modules/clean/react/css","modules/clean/react/file_viewer_sidebar/panes/strings","spectrum/icon_arrow","spectrum/icon_action","spectrum/colorized_icon","modules/clean/react/file_viewer/data/actions","external/react-redux","modules/clean/previews/util","modules/clean/react/file_viewer_sidebar/panes/file_activity_section"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m,f,h,_,v,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.UnconnectedDocumentationPaneComponent=function(e){var t=e.file,n=e.user,u=e.maxFilenameEmLength,h=e.isSharedLink,_=e.isVersionHistoryMode,y=a.Emstring.em_snippet(s.getFilename(t),u),b=d.DocumentationPaneStrings.lastModified+" "+l.getCompactLowerCaseDateTimeString(t),w=function(){return e.pushSidebarPane(r.SidebarPaneId.Metadata)},C=function(){return e.pushSidebarPane(r.SidebarPaneId.Activity)};return i.default.createElement(o.Pane,null,i.default.createElement("div",{className:"documentation-pane"},i.default.createElement("div",{className:"documentation-pane__title"},y),i.default.createElement("div",{className:"documentation-pane__section"},i.default.createElement("button",{className:"documentation-pane__section-title",onClick:w},d.DocumentationPaneStrings.details,i.default.createElement("span",{className:"documentation-pane__arrow-right-icon"},i.default.createElement(f.ColorizedIcon,null,i.default.createElement(p.IconArrow,{name:"right",viewBox:"7 7 8 10",width:"8",height:"10"})))),i.default.createElement("ul",null,!!t.ts&&i.default.createElement("li",null,b),!!t.bytes&&i.default.createElement("li",null,c.format_bytes(t.bytes)),!!n&&!h&&i.default.createElement("li",null,i.default.createElement("a",{className:"documentation-pane__prev-versions-link",href:v.getVersionHistoryUrl(t,n).toString()},d.DocumentationPaneStrings.seePreviousVersions,i.default.createElement("span",{className:"documentation-pane__open-in-app-icon"},i.default.createElement(f.ColorizedIcon,null,i.default.createElement(m.IconAction,{name:"open-in-app",viewBox:"8 7 16 16",width:"16",height:"16"}))))))),i.default.createElement(g.ConnectedFileActivitySection,{file:t,user:n,isVersionHistoryMode:_,title:d.DocumentationPaneStrings.activity,pushActivityPaneHandler:C})))};var y={pushSidebarPane:h.pushSidebarPane};t.ConnectedDocumentationPaneComponent=_.connect(null,y)(t.UnconnectedDocumentationPaneComponent),t.DocumentationPane=u.requireCssWithComponent(t.ConnectedDocumentationPaneComponent,["/static/css/file_viewer_sidebar/documentation_pane-vflNIgtFy.css"])}),define("modules/clean/react/file_viewer_sidebar/panes/file_activity_section",["require","exports","tslib","react","modules/clean/react/file_sidebar/store/file_activity/actions","modules/clean/react/file_sidebar/file_sidebar_connect","modules/clean/react/file_sidebar/store/sidebar/helpers","modules/clean/react/file_sidebar/store/file_activity/selectors","spectrum/icon_arrow","spectrum/colorized_icon"],function(e,t,n,i,o,r,a,s,l,c){"use strict";function u(e){return{isFileActivityEnabled:s.isActivityEnabled(e)}}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importStar(o),a=n.__importStar(a),s=n.__importStar(s);var d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.notifyStore(this.props)},t.prototype.componentWillReceiveProps=function(e){var t={file:this.props.file,isVersionHistoryMode:this.props.isVersionHistoryMode,user:this.props.user},n={file:e.file,isVersionHistoryMode:e.isVersionHistoryMode,user:e.user};a.isContextChanged(t,n)&&this.notifyStore(e)},t.prototype.componentWillUnmount=function(){this.props.dispatch(o.reset())},t.prototype.notifyStore=function(e){e.user&&this.props.dispatch(o.getActivityStream(e.user.id,e.file))},t.prototype.render=function(){return this.props.isVersionHistoryMode||!this.props.isFileActivityEnabled?null:i.default.createElement("div",{className:"documentation-pane__section"},i.default.createElement("button",{className:"documentation-pane__section-title",onClick:this.props.pushActivityPaneHandler},this.props.title,i.default.createElement("span",{className:"documentation-pane__arrow-right-icon"},i.default.createElement(c.ColorizedIcon,null,i.default.createElement(l.IconArrow,{name:"right",viewBox:"7 7 8 10",width:"8",height:"10"})))))},t})(i.default.Component);t.UnconnectedFileActivitySection=d,t.ConnectedFileActivitySection=r.fileSidebarConnect(u)(d)});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};define("modules/clean/react/file_viewer_sidebar/panes/loadable_activity_pane",["require","exports","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadableActivityPane=n.Loadable({loader:function(){return i.waitForTTI().then(function(){return new Promise(function(t,n){e(["modules/clean/react/file_viewer_sidebar/panes/activity_pane"],t,n)}).then(__importStar).then(function(e){return e.ActivityPane})})}})}),define("modules/clean/react/file_viewer_sidebar/panes/metadata_pane",["require","exports","tslib","react","file-viewer/modes","file-viewer/core","modules/clean/react/file_metadata/component/loadable_metadata_details","modules/clean/react/css","modules/clean/react/file_viewer_sidebar/panes/strings","modules/clean/react/file_viewer_sidebar/panes/pane_title","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer_sidebar/utils","external/react-redux","modules/clean/react/file_viewer/data/selectors"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.UnconnectedMetadataPaneComponent=function(e){var t=d.isSidebarOpen(e.sidebar)&&d.isSidebarPaneIdAtTopOfStack(r.SidebarPaneId.Metadata,e.sidebar);return i.default.createElement(o.Pane,null,i.default.createElement("div",{className:"metadata-pane"},i.default.createElement(c.PaneTitle,{title:l.MetadataPaneStrings.details,onClick:e.popSidebarPane}),i.default.createElement(a.LoadableMetadataDetails,{file:e.file,user:e.user,sharedLinkInfo:e.sharedLinkInfo,isActiveTab:t,previewType:e.previewType})))};var f=function(e){return{sidebar:m.getSidebar(e)}},h={popSidebarPane:u.popSidebarPane};t.ConnectedMetadataPaneComponent=p.connect(f,h)(t.UnconnectedMetadataPaneComponent),t.MetadataPane=s.requireCssWithComponent(t.ConnectedMetadataPaneComponent,["/static/css/file_viewer_sidebar/metadata_pane-vflvxtuZ-.css"])}),define("modules/clean/react/file_viewer_sidebar/panes/pane_title",["require","exports","tslib","react","modules/clean/react/css","spectrum/icon_arrow","spectrum/colorized_icon"],function(e,t,n,i,o,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.PaneTitleComponent=function(e){return e.onClick?i.default.createElement("button",{className:"pane-title",onClick:e.onClick},i.default.createElement("span",{className:"pane-title__arrow-right-icon"},i.default.createElement(a.ColorizedIcon,null,i.default.createElement(r.IconArrow,{name:"right",viewBox:"7 7 8 10",width:"8",height:"10"}))),i.default.createElement("span",{className:"pane-title__title-text"},e.title)):i.default.createElement("span",{className:"pane-title__title-text"},e.title)},t.PaneTitle=o.requireCssWithComponent(t.PaneTitleComponent,["/static/css/file_viewer_sidebar/pane_title-vflA7SlqQ.css"])}),define("modules/clean/react/file_viewer_sidebar/panes/strings",["require","exports","modules/core/i18n"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentationPaneStrings={details:n._("Details",{comment:"Section header on the file preview sidebar shown on top of the section listing general file metadata."}),activity:n._("Activity",{comment:"Section header on the file preview sidebar shown on top of the section listing the latest file activity"}),seePreviousVersions:n._("see previous versions",{comment:"Text for outbound link from the file preview sidebar to take the user to the version history page showing the list of versions/revisions of the current file."}),lastModified:n._("Last modified",{comment:'Text preppended to the modified time of a file as a localized string, e.g., "Last modified just now", "Last modified today, 9:14am" or "Last modified 8/10/19, 9:14am"'})},t.MetadataPaneStrings={details:n._("Details",{comment:"Title of the content pane displaying file metadata (e.g., upload date, file size, filetype-specific metadata) on the file preview sidebar."})},t.ActivityPaneStrings={details:n._("Activity",{comment:"Title of the content pane displaying list of latest file activity on the file preview sidebar."})}}),define("modules/clean/react/file_viewer_sidebar/sidebar",["require","exports","tslib","react","external/react-redux","file-viewer/modes","file-viewer/core","file-viewer/strings","modules/clean/react/file_viewer_sidebar/utils","modules/clean/react/file_viewer/data/selectors"],function(e,t,n,i,o,r,a,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i);var u=a.createMetaserverFormatters("en",s.strings,a.createI18nCache());t.UnconnectedSidebar=function(e){var t=e.handleSidebarDispatch,o=n.__rest(e,["handleSidebarDispatch"]);return i.default.createElement(r.Sidebar,n.__assign({intl:u,dispatch:t,fileViewerId:"dummy"},o))},t.Sidebar=o.connect(function(e){return{fileViewerUiData:{currentMode:c.getMode(e),sidebar:c.getSidebar(e)}}},function(e){return{handleSidebarDispatch:l.createSidebarDispatchHandler(e)}})(t.UnconnectedSidebar)}),
define("modules/clean/react/file_viewer_sidebar/utils",["require","exports","file-viewer/core","modules/clean/react/file_viewer/data/actions","file-viewer/core"],function(e,t,n,i,o){"use strict";function r(e){return e.type===n.Action.SidebarControlClick}function a(e){return e.type===n.Action.SetSidebarVisibility}Object.defineProperty(t,"__esModule",{value:!0});var s,l=(s={},s[o.SidebarControlId.Documentation]=function(e){e(i.changeMode(o.FileViewerMode.Documentation))},s[o.SidebarControlId.Comments]=function(e){e(i.changeMode(o.FileViewerMode.Commenting))},s[o.SidebarControlId.Watermark]=function(e){e(i.changeMode(o.FileViewerMode.Watermarking))},s);t.createSidebarDispatchHandler=function(e){return function(t){if(r(t)){return(0,l[t.payload.controlId])(e,t)}if(a(t))return e(i.setSidebarVisibility(t.payload.visibility))}},t.isSidebarOpen=function(e){return e.visibility===o.SidebarVisibility.Open},t.isSidebarPaneIdAtTopOfStack=function(e,t){var n=t.paneStack;return n.length>0&&n[n.length-1]===e}}),define("modules/clean/react/keyboard_binding/keyboard_binding",["require","exports","tslib","external/lodash","modules/clean/keycode"],function(e,t,n,i,o){"use strict";function r(e){return n.__assign({},t.genericKeyboardEventCriteria,{which:e})}function a(e){return n.__assign({},b,{which:e})}function s(e){return{keyboardEventCriteria:n.__assign({},t.genericKeyboardEventCriteria,e.keyboardEventCriteria),callback:null!=e.callback?e.callback:w}}function l(e){return{altKey:!!e.altKey,ctrlKey:!!e.ctrlKey,metaKey:!!e.metaKey,shiftKey:!!e.shiftKey,which:e.which||e.keyCode}}function c(e){return{altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,which:e.which||e.keyCode}}function u(e){return n.__assign({},e,{keyCode:null!=e.keyCode?e.keyCode:e.which})}function d(e,t){var n,i;return[(n={which:e},n[t]=!0,n),(i={which:e},i[t]=!1,i)]}function p(e){return function(t){return d(t,e)}}function m(e){return i.flatten(e.map(p("shiftKey")))}function f(e,t){return e.map(function(e){return s({keyboardEventCriteria:e,callback:t})})}function h(e){return f(C,e)}function _(e){return f(S,e)}function v(e){return f(E,e)}function g(e){return void 0!==e.preventDefault}function y(e){return function(t){e(),g(t)&&t.preventDefault()}}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),t.genericKeyboardEventCriteria={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,which:0};var b={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,which:0};t.SimpleKeyboardEventKeys=Object.keys(b),t.KeyboardEventCriteriaKeys=Object.keys(t.genericKeyboardEventCriteria),t.generateUnmodifiedKeyboardEventCriteria=r,t.generateUnmodifiedSimpleKeyboardEvent=a;var w=function(){};t.hydrateKeyboardBinding=s,t.getKeyboardEventCriteria=l,t.getSimpleKeyboardEvent=c,t.addLegacyPropertiesToSimpleKeyboardEvent=u;var C=m([o.KeyCode.EQUALS,o.KeyCode.PLUS_EQUALS_FF,o.KeyCode.PLUS_CHROME,o.KeyCode.PLUS_EQUALS_FF_GERMAN]),S=m([o.KeyCode.MINUS_FF_MAC,o.KeyCode.MINUS_FF,o.KeyCode.MINUS_CHROME]),E=[{which:o.KeyCode.P},{which:o.KeyCode.P,ctrlKey:!0},{which:o.KeyCode.P,metaKey:!0}];t.getEqualsKeyBindings=h,t.getMinusKeyBindings=_,t.getPrintKeyBindings=v,t.isKeyboardEvent=g,t.withPreventDefault=y}),define("modules/clean/react/keyboard_binding/keyboard_binding_connector",["require","exports","tslib","react","modules/clean/react/keyboard_binding/keyboard_binding_provider"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i);var r=(function(e){function t(t,n){var i=e.call(this,t,n)||this;if(!n.registerKeyBindings||!n.unregisterKeyBindings)throw new Error("KeyboardBindingConnector must be a child of a KeyboardBindingProvider");return i}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.registrationIdentifier=this.context.registerKeyBindings(this.props.keyboardBindings),this.context.registerAllKeyCallback(this.registrationIdentifier,this.props.allKeyCallback)},t.prototype.componentWillReceiveProps=function(e){this.props.keyboardBindings!==e.keyboardBindings&&this.context.updateKeyBindings(this.registrationIdentifier,e.keyboardBindings),this.props.allKeyCallback!==e.allKeyCallback&&this.context.registerAllKeyCallback(this.registrationIdentifier,e.allKeyCallback)},t.prototype.componentWillUnmount=function(){this.context.unregisterKeyBindings(this.registrationIdentifier)},t.prototype.render=function(){return null},t.contextTypes=o.KeyboardBindingProviderContextTypes,t})(i.default.Component);t.KeyboardBindingConnector=r}),define("modules/clean/react/keyboard_binding/keyboard_binding_provider",["require","exports","tslib","react","external/prop-types","modules/clean/callback_chain/callback_chain","modules/clean/keycode","modules/clean/react/keyboard_binding/keyboard_binding"],function(e,t,n,i,o,r,a,s){"use strict";function l(e){var t=s.getKeyboardEventCriteria(e),n="";return s.KeyboardEventCriteriaKeys.forEach(function(e){n+=e+":"+t[e]+","}),n}function c(e){return e.reduce(function(e,t){return t.reduce(function(e,t){var n=t.keyboardEventCriteria,i=t.callback,o=l(n);return e[o]=e[o]||[],e[o].push(i),e},e)},{})}function u(e){var t=s.addLegacyPropertiesToSimpleKeyboardEvent(e);new r.CallbackChain(p).run(t)}function d(e){var t=e.target||e.srcElement;if(!t)return!0;var n=t.tagName,i=e.which,o="INPUT"===n||"SELECT"===n||"TEXTAREA"===n,r=["submit","button"].indexOf(t.type)!==-1,s=t.hasAttribute&&t.hasAttribute("contenteditable")&&"false"!==t.getAttribute("contenteditable").toLowerCase();return!(o&&!r||s)||(i===a.KeyCode.ESC||i===a.KeyCode.TAB)}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importStar(o),t.KeyboardBindingProviderContextTypes={registerAllKeyCallback:o.func,registerKeyBindings:o.func,unregisterKeyBindings:o.func,updateKeyBindings:o.func};var p=[];t.noop=function(e){};var m=(function(e){function o(n){var i=e.call(this,n)||this;return i.registrationIdentifier=0,i.registeredBindings=[],i.keyboardBindingsByCriteria={},i.allKeyHandlers=[],i.registerKeyBindings=function(e){var n=i.registrationIdentifier++;return i.updateKeyBindings(n,e),i.allKeyHandlers[n]||(i.allKeyHandlers[n]=t.noop),n},i.registerAllKeyCallback=function(e,n){i.allKeyHandlers[e]=null!=n?n:t.noop},i.unregisterKeyBindings=function(e){i.updateKeyBindings(e,[]),i.allKeyHandlers[e]=t.noop},i.updateKeyBindings=function(e,t){i.registeredBindings[e]=null!=t?t:[],i.keyboardBindingsByCriteria=c(i.registeredBindings)},i.onKeyDown=function(e){if(d(e)){var t=i.getCallbacksForKey(e);new r.CallbackChain(t).run(e)}},i.allKeyHandlers=[],i.registeredBindings=[],i}return n.__extends(o,e),o.prototype.componentDidMount=function(){document.addEventListener("keydown",this.onKeyDown),this.providerIdentifier=p.length,p.push(this.onKeyDown),this.props.onSetup&&this.props.onSetup()},o.prototype.componentWillUnmount=function(){document.removeEventListener("keydown",this.onKeyDown),p[this.providerIdentifier]=t.noop,this.props.onDestroy&&this.props.onDestroy()},o.prototype.getChildContext=function(){return{registerAllKeyCallback:this.registerAllKeyCallback,registerKeyBindings:this.registerKeyBindings,unregisterKeyBindings:this.unregisterKeyBindings,updateKeyBindings:this.updateKeyBindings}},o.prototype.getCallbacksForKey=function(e){var t=l(e);return(this.keyboardBindingsByCriteria[t]||[]).concat(this.allKeyHandlers)},o.prototype.render=function(){return i.default.Children.only(this.props.children)},o.childContextTypes=t.KeyboardBindingProviderContextTypes,o})(i.default.Component);t.KeyboardBindingProvider=m,t.getIndexForkeyboardBindingsByCriteria=l,t.generateKeyboardBindingsByCriteriaFromKeyboardBindings=c,t.simulateKeyEvent=u}),define("modules/clean/react/open_in_app/button",["require","exports","tslib","react","spectrum/button","modules/clean/open_in_app/actions","modules/core/i18n","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants"],function(e,t,n,i,o,r,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i);var c=(function(e){function t(t){var n=e.call(this,t)||this;return n.handleClick=function(){s.logUserAction(l.UserAction.OpenInApp,n.props.userActionContext),r.openInApp(n.props.urls,{onAppNeeded:function(){return n.setState({showInstallAppText:!0})},onAppInstalled:function(){return n.setState({showInstallAppText:!1})}})},n.state={showInstallAppText:!1},n}return n.__extends(t,e),t.prototype.componentWillUnmount=function(){r.cleanUp()},t.prototype.render=function(){return i.default.createElement(o.Button,{className:"control__button open-in-app-button",variant:"primary",onClick:this.handleClick},this.state.showInstallAppText?a._("Install app?"):a._("Open in app"))},t})(i.default.Component);t.OpenInAppButton=c});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};define("modules/clean/react/previews/archive/preview_archive_loadable",["require","exports","modules/clean/react/async/loadable"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewArchiveLoadable=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/archive/preview_archive"],t,n)}).then(__importStar).then(function(e){return e.PreviewArchive})}})}),define("modules/clean/react/previews/error/file_info",["require","exports","tslib","react","modules/clean/display_format"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.PreviewErrorFileInfo=function(e){var t=e.bytes,n=e.filename;return i.default.createElement("div",{className:"preview-error__info"},n,void 0!==t?i.default.createElement("span",null,i.default.createElement("span",{className:"bottom-dot"}," · "),o.format_bytes(t)):null)}}),define("modules/clean/react/previews/error/fullscreen_view",["require","exports","tslib","react","modules/clean/react/css","modules/clean/react/file_viewer/actionable","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/previews/error/file_info","modules/clean/react/previews/error/message","modules/clean/react/previews/preview_zoom_container"],function(e,t,n,i,o,r,a,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i);var d=function(e){var t=e.allowOpenInApp,n=e.areActionablesEnabled,o=e.count,d=e.errorType,p=e.extensionsConfig,m=e.file,f=e.filename,h=e.index,_=e.message,v=e.onNext,g=e.onPrevious,y=e.preview,b=e.sharedLinkInfo,w=e.shareToken,C=e.sharePermission,S=e.user;return i.default.createElement(u.PreviewZoomContainer,{fileCount:o,fileIndex:h,onClose:s.exitFullScreen,onFlipNext:v,onFlipPrevious:g,renderZoomControls:!1},i.default.createElement("div",{className:"preview-error--fullscreen fullscreen"},i.default.createElement(c.PreviewErrorMessage,{file:m,preview:y,errorType:d,message:_}),i.default.createElement(l.PreviewErrorFileInfo,{bytes:m.bytes,filename:f}),n?i.default.createElement(r.Actionable,{allowOpenInApp:!!t,extensionsConfig:p,file:m,variant:"primary",location:a.FileViewerPane.PreviewContent,sharedLinkInfo:b,shareToken:w,sharePermission:C,user:S,userActionContext:a.UserActionContext.PreviewContentMain}):null))},p=o.requireCssWithComponent(d,["/static/css/preview_image-vfldTvbvq.css","/static/css/preview_error-vflcybjC2.css"]);t.PreviewErrorFullscreenView=p}),define("modules/clean/react/previews/error/image",["require","exports","tslib","react","modules/clean/react/image","modules/clean/react/previews/constants","modules/clean/static_urls"],function(e,t,n,i,o,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.PreviewErrorImage=function(e){var t,n=e.errorType;switch(n){case r.ErrorType.PendingUploadError:t=i.default.createElement(o.Image,{src:a.static_url("/static/js/file-viewer/img/error/file_uploading_1x-vflRuLSg0.png"),srcHiRes:a.static_url("/static/js/file-viewer/img/error/file_uploading_2x-vflKOdrWj.png")});break;case r.ErrorType.ExtensionError:t=i.default.createElement(o.Image,{src:a.static_url("/static/js/file-viewer/img/error/filetype_not_supported_1x-vflmIVODZ.png"),srcHiRes:a.static_url("/static/js/file-viewer/img/error/filetype_not_supported_2x-vflE8HW8X.png")});break;case r.ErrorType.FileSizeError:t=i.default.createElement(o.Image,{src:a.static_url("/static/js/file-viewer/img/error/file_too_large_1x-vflDGNPuo.png"),srcHiRes:a.static_url("/static/js/file-viewer/img/error/file_too_large_2x-vfl-r0UPt.png")});break;case r.ErrorType.PasswordProtectedError:t=i.default.createElement(o.Image,{src:a.static_url("/static/js/file-viewer/img/error/password_protected_1x-vflnFAKjt.png"),srcHiRes:a.static_url("/static/js/file-viewer/img/error/password_protected_2x-vflnBXZ1k.png")});break;case r.ErrorType.NeedFlashError:case r.ErrorType.SymLinkError:case r.ErrorType.EmptyFileError:case r.ErrorType.WatermarkingError:case r.ErrorType.LoadError:default:t=i.default.createElement(o.Image,{src:a.static_url("/static/js/file-viewer/img/error/unavailable_1x-vflG2AHMd.png"),srcHiRes:a.static_url("/static/js/file-viewer/img/error/unavailable_2x-vflGPrE5d.png")})}return i.default.createElement("div",{className:"u-mar-bottom-s preview-error__image"},t)}}),define("modules/clean/react/previews/error/message",["require","exports","tslib","react","modules/clean/file_store/utils","modules/clean/react/previews/constants","modules/clean/react_format","modules/core/i18n","modules/clean/previews/data/preview_type_util","modules/clean/previews/util"],function(e,t,n,i,o,r,a,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),l=n.__importStar(l),t.PreviewErrorMessage=function(e){var t,n=e.file?o.getExtension(e.file):void 0;if(e.message)t=e.message;else switch(e.errorType){case r.ErrorType.PendingUploadError:t=s._("File is uploading...");break;case r.ErrorType.EmptyFileError:t=s._("Empty files can’t be previewed");break;case r.ErrorType.ExtensionError:if(!e.file)throw new Error("Extension error requires a file prop");if(n){var u=o.isArchiveFile(e.file)&&e.preview?s._("<span>.%(extension)s</span> files can’t be previewed from an archive file.",{comment:"Like '.exe files can’t be previewed from an archive file'"}):s._("<span>.%(extension)s</span> files can’t be previewed.",{comment:"Like '.exe files can’t be previewed'"});t=a.reactFormat(u,{span:i.default.createElement("span",{className:"preview-error__message--bold"}),extension:n})}else t=s._("This file cannot be previewed. Please check to see if your file extension is correct.");break;case r.ErrorType.FileSizeError:var d=l.getPreviewType(e.preview),p=n&&d?c.getFileSizeLimit(n,d):void 0;t=p?a.reactFormat(s._("This file is too big to preview. <br /> The maximum file size for <span>.%(extension)s</span> is <span>%(limit)s MB</span>"),{br:i.default.createElement("br",null),span:i.default.createElement("span",{className:"preview-error__message--bold"}),extension:n,limit:p/1024}):s._("This file is too big to preview.");break;case r.ErrorType.PasswordProtectedError:t=n?a.reactFormat(s._("This <span>.%(extension)s</span> file is password-protected."),{span:i.default.createElement("span",{className:"preview-error__message--bold"}),extension:n}):s._("This file is password-protected.");break;case r.ErrorType.NeedFlashError:t=a.reactFormat(s._("Install <a>Adobe Flash Player</a> to preview this video."),{a:i.default.createElement("a",{href:"https://get.adobe.com/flashplayer/"})});break;case r.ErrorType.SymLinkError:t=s._("SymLink files cannot be previewed.");break;case r.ErrorType.WatermarkingError:t=s._("This file could not be watermarked.");break;case r.ErrorType.LoadError:default:t=n?a.reactFormat(s._("<span>.%(extension)s</span> files are supported but something went wrong."),{span:i.default.createElement("span",{className:"preview-error__message--bold"}),extension:n}):s._("This file can’t be previewed")}return i.default.createElement("div",{className:"preview-error__message"},t)}}),define("modules/clean/react/previews/error/preview_error",["require","exports","tslib","react","modules/clean/em_string","modules/clean/previews/pending_upload_watcher","modules/clean/react/css","modules/clean/file_store/utils","modules/clean/react/file_viewer/constants","modules/clean/react/previews/constants","modules/clean/react/previews/error/fullscreen_view","modules/clean/react/previews/error/view","modules/clean/stormcrow/stormcrow_exposure_logger","modules/clean/web_timing_logger","modules/constants/file_viewer","modules/clean/react/async/loadable"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m,f,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),m=n.__importStar(m),f=n.__importStar(f);var _=h.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/file_viewer/exp_autocad_preview_upsell"],t,n)}).then(n.__importStar).then(function(e){return e.AutocadPreviewUpsell})}}),v=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentDidMount=function(){if(m.set_tti_exclusion_flow("failed previews not included"),m.mark_time_to_view(),m.mark_time_to_interactive(),this.logPreviewSupportDenied(),this.props.errorType===c.ErrorType.PendingUploadError&&this.props.shareToken){new r.PendingUploadWatcher(this.props.shareToken.linkType,this.props.shareToken.linkKey,this.props.shareToken.secureHash).startPolling()}if(this.props.user&&this.props.errorType===c.ErrorType.SupportError&&"dwg"===s.getExtension(this.props.file)){(new p.StormcrowExposureLogger).logExposure("sharegrowth_skyscraper",f.SHAREGROWTH_SKYSCRAPER)}},Object.defineProperty(t.prototype,"allowOpenInApp",{get:function(){return!!this.props.file.open_in_app_data&&!this.props.isMobileUserAgent},enumerable:!0,configurable:!0}),t.prototype.logPreviewSupportDenied=function(){this.props.errorType!==c.ErrorType.LoadError&&this.props.errorType!==c.ErrorType.PendingUploadError&&this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(l.EventType.FilePreviewSupportDenied,{errorType:this.props.errorType})},t.prototype.render=function(){var e=o.Emstring.em_snippet(s.getFilename(this.props.file),this.props.maxFilenameEmLength);return this.props.user&&this.props.errorType===c.ErrorType.SupportError&&"dwg"===s.getExtension(this.props.file)&&"V1"===f.SHAREGROWTH_SKYSCRAPER?i.default.createElement(_,n.__assign({},this.props,{allowOpenInApp:this.allowOpenInApp,filename:e,sharegrowthSkyscraper:f.SHAREGROWTH_SKYSCRAPER,user:this.props.user})):this.props.isFullscreen?i.default.createElement(u.PreviewErrorFullscreenView,n.__assign({},this.props,{allowOpenInApp:this.allowOpenInApp,filename:e})):i.default.createElement(d.PreviewErrorView,n.__assign({},this.props,{allowOpenInApp:this.allowOpenInApp,filename:e}))},t.defaultProps={areActionablesEnabled:!0,isFullscreen:!1},t})(i.default.Component);t._PreviewError=v;var g=a.requireCssWithComponent(v,["/static/css/preview_error-vflcybjC2.css"]);t.PreviewError=g}),define("modules/clean/react/previews/error/view",["require","exports","tslib","external/classnames","react","modules/clean/react/previews/preview_toolbar","modules/clean/file_store/utils","modules/clean/react/file_viewer/actionable","modules/clean/react/file_viewer/constants","modules/clean/react/previews/constants","modules/clean/react/previews/error/file_info","modules/clean/react/previews/error/image","modules/clean/react/previews/error/message","modules/core/i18n","modules/clean/react/previews/toolbar_flip_buttons"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importDefault(o),t.PreviewErrorView=function(e){var t=e.areActionablesEnabled,n=e.allowOpenInApp,m=e.count,_=e.errorType,v=e.extensionsConfig,g=e.file,y=e.filename,b=e.index,w=e.message,C=e.onNext,S=e.onPrevious,E=e.preview,A=e.sharedLinkInfo,T=e.shareToken,P=e.sharePermission,I=e.shouldDisplayToolbar,k=e.sizeClass,x=e.user;return o.default.createElement("div",{className:i.default({"preview-content":!0,"preview-content--center":!0,"preview-error":!0,"has-toolbar":I})},o.default.createElement("div",{className:"preview-error__wrapper"},o.default.createElement("div",{className:"preview-error__content"},o.default.createElement(d.PreviewErrorImage,{errorType:_}),o.default.createElement(p.PreviewErrorMessage,{file:g,preview:E,errorType:_,message:w}),o.default.createElement(u.PreviewErrorFileInfo,{filename:y,bytes:g.bytes}),t?o.default.createElement(s.Actionable,{allowOpenInApp:!!n,extensionsConfig:v,file:g,variant:"primary",location:l.FileViewerPane.PreviewContent,sharedLinkInfo:A,shareToken:T,sharePermission:P,user:x,userActionContext:l.UserActionContext.PreviewContentMain,sizeClass:k}):null,_!==c.ErrorType.ExtensionError||a.isArchiveFile(g)?null:o.default.createElement(h,null)),I&&null!=b&&null!=m?o.default.createElement("div",{className:"preview-toolbar-container"},o.default.createElement(r.PreviewToolbar,{isFullscreen:!1},o.default.createElement(f.ToolbarFlipButtons,{index:b,count:m,onClickPrevious:S,onClickNext:C}))):null))};var h=function(){return o.default.createElement("div",{className:"preview-error__help-link"},o.default.createElement("a",{href:l.UnsupportedExtensionHelpLink,target:"_blank",rel:"noopener\n    noreferrer"},m._("Learn more.")))}}),define("modules/clean/react/previews/fidelity_survey/fidelity_survey",["require","exports","tslib","modules/clean/react/async/loadable","modules/clean/web_timing_logger","modules/constants/file_viewer","react"],function(e,t,n,i,o,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importDefault(a),t.LoadableFidelitySurvey=i.Loadable({loader:function(){return o.waitForTTI().then(function(){return new Promise(function(t,n){e(["modules/clean/react/previews/fidelity_survey/fidelity_survey_component"],t,n)}).then(n.__importStar).then(function(e){return e.FidelitySurvey})})}});var s=(function(e){function i(t){var n=e.call(this,t)||this;return n.shouldLoad=100*Math.random()<r.PREVIEW_FIDELITY_SURVEY_PROBABILITY,n}return n.__extends(i,e),i.prototype.render=function(){var e=this.props,n=e.allowFileDonation,i=e.file;return this.shouldLoad&&i?a.default.createElement(t.LoadableFidelitySurvey,{allowFileDonation:n,file:i}):null},i})(a.default.Component);t.FidelitySurvey=s}),define("modules/clean/react/previews/frame_messenger_host",["require","exports","tslib","modules/clean/frame_messenger/frame_messenger_host"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){var t=["www.dropboxstatic.com","cf.dropboxstatic.com","cfl.dropboxstatic.com","www.dropbox.com","dl-web.dropbox.com","dl.dropboxusercontent.com","previews.dropboxusercontent.com","previews.dropbox.com"],n=t.map(function(e){return"https://"+e});return n.push("null"),n.push(RegExp(".*previews.*.dropboxusercontent.com")),e.call(this,n)||this}return n.__extends(t,e),t})(i.FrameMessengerHost);t.PreviewFrameMessengerHost=o}),define("modules/clean/react/previews/image/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IMAGE_LARGE_PADDING_HEIGHT=148,t.IMAGE_LARGE_PADDING_WIDTH=72,t.IMAGE_PADDING_HEIGHT=50,t.IMAGE_PADDING_WIDTH=0}),define("modules/clean/react/previews/image_helpers",["require","exports","tslib","modules/constants/python","modules/clean/photos/thumbnail_url_util"],function(e,t,n,i,o){"use strict";function r(e,t){var n;return n=t?c.filter(function(e){var n=e[0],i=e[1];return n<=t[0]&&i<=t[1]}):c,n.map(function(t){var n=t[0],r=t[1];return o.thumbnailUrlForSize(e,n,r,i.THUMBNAIL_SIZE_MODE.ABSTRACT)+" "+n+"w"}).join(", ")}function a(e){return o.thumbnailUrlForSize(e,800,600,i.THUMBNAIL_SIZE_MODE.ABSTRACT)}function s(e){return l(a(e),{srcset:r(e),sizes:t.IMG_SIZES_ATTR})}function l(e,t){return new Promise(function(n,i){var o=Date.now(),r=new Image;r.onload=function(){n({started:o,completed:Date.now()})},r.onerror=function(){i({started:o,failed:Date.now()})},t&&(t.srcset&&(r.srcset=t.srcset),t.sizes&&(r.sizes=t.sizes)),r.src=e})}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var c=[[480,320],[640,480],[800,600],[1024,768],[1280,960],[1600,1200],[2048,1536]];t.IMG_SIZES_ATTR="90vw",t.getSrcSet=r,t.getFallbackSrc=a,t.preloadResponsiveImage=s,t.preloadImage=l}),define("modules/clean/react/previews/loading_indicator",["require","exports","tslib","external/classnames","react"],function(e,t,n,i,o){"use strict";function r(e){return o.default.createElement("div",{className:i.default("c-loader",e.className)})}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importDefault(o),t.LoadingIndicator=r}),define("modules/clean/react/previews/preview_html",["require","exports","tslib","react","external/react-dom","file-viewer/core","modules/clean/previews/util","modules/clean/react/file_viewer/constants","modules/clean/react/previews/frame_messenger_host","modules/clean/react/previews/preview_toolbar","modules/clean/react/size_class/constants","modules/clean/web_timing_logger","modules/core/browser_detection","modules/core/uri","modules/clean/react/previews/toolbar_flip_buttons","modules/clean/react/file_viewer/full_screen_helpers","file-viewer/toolbar","file-viewer/strings","file-viewer/core","modules/clean/react/previews/preview_toolbar_button","modules/clean/react/previews/print_helpers","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/keycode","modules/clean/react/previews/preview_toolbar_frame_messenger","modules/clean/react/file_viewer/logging"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m,f,h,_,v,g,y,b,w,C,S,E,A){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importStar(o),d=n.__importStar(d),p=n.__importStar(p);var T,P,I=g.createMetaserverFormatters("en",v.strings,g.createI18nCache()),k=["failed","viewer-ready","idle-mouse","active-mouse","exit-parent-fullscreen","keydown","child-focus","get-keydown-keys-handled-by-parent"];(function(e){e.ClearMouseTracking="clear-mouse-tracking",e.EnableRegionCreation="enable-region-creation",e.EnterFullscreen="enter-fullscreen",e.ExitViewerFullscreen="exit-viewer-fullscreen",e.PageDown="page-down",e.PageUp="page-up",e.SetCurrentPage="set-current-page",e.PreviewToolbarMounted="preview-toolbar-mounted",e.Print="print",e.ScreenDown="screen-down",e.ScreenUp="screen-up",e.ZoomIn="zoom-in",e.ZoomOut="zoom-out"})(P||(P={}));var x=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getIframeProps=function(){var e={title:t.props.filename,name:"preview-content",type:"text/html",src:t.getIframeSrc(),sandbox:"",className:"previewhtml",ref:t.setRefIframe};return t.props.usesFrameMessenger&&(e.sandbox="allow-modals allow-scripts allow-forms"),e},t.handleTrustedMessageFromChild=function(e){switch(e.action){case"failed":t.logFilePreviewEvent(s.EventType.FilePreviewDownloadSucceeded),t.logFilePreviewEvent(s.EventType.FilePreviewRenderFailed);var n=r.RivieraStatus.Unknown;e.parameters&&(n=e.parameters.rivieraStatusCode),t.props.onError&&t.props.onError(a.mapRivieraStatusToErrorType(n));break;case"viewer-ready":t.markWebTiming(),t.logFilePreviewEvent(s.EventType.FilePreviewDownloadSucceeded),t.logFilePreviewEvent(s.EventType.FilePreviewRenderSucceeded),t.props.setRenderStatusSuccess(),t.props.isFullscreen?t.frameMessenger.postMessageToChildren("enter-fullscreen"):t.frameMessenger.postMessageToChildren("exit-viewer-fullscreen"),t.props.sharePermission&&0===t.props.sharePermission.canDownloadRoles.length&&t.frameMessenger.postMessageToChildren("disable-download"),t.shouldIncreaseTabHeightForExcel()&&t.frameMessenger.postMessageToChildren("increase-tab-height");break;case"exit-parent-fullscreen":h.exitFullScreen(s.UserActionContext.Unknown);break;case"get-keydown-keys-handled-by-parent":t.postKeysHandledByParent()}},t.handleIframeLoad=function(){t.logFilePreviewEvent(s.EventType.FilePreviewDownloadSucceeded),t.props.usesFrameMessenger||(t.markWebTiming(),t.logFilePreviewEvent(s.EventType.FilePreviewRenderSucceeded),t.props.setRenderStatusSuccess())},t.handleIframeError=function(){t.logFilePreviewEvent(s.EventType.FilePreviewDownloadFailed)},t.setRefIframe=function(e){t.iframe=e},t.printDocument=function(e){t.frameMessenger.postMessageToChildren(P.Print,{context:e})},t.keyboardBindings=[C.hydrateKeyboardBinding({keyboardEventCriteria:{which:S.KeyCode.P},callback:function(){return t.printDocument(s.UserActionContext.Keyboard)}})],t.handleClickPrevious=A.wrapToolbarActionWithLogging(function(){var e=t.props.onClickPrevious;return e&&e()},s.UserAction.FlipPrevious),t.handleClickNext=A.wrapToolbarActionWithLogging(function(){var e=t.props.onClickNext;return e&&e()},s.UserAction.FlipNext),t}return n.__extends(t,e),t.prototype.getIframeSrc=function(){var e=m.URI.parse(this.props.src);return this.props.isExcel&&(this.props.forceTestExcelHtml?e.updateQuery({canned_file_name:s.CannedTestFilename.ExcelHTML}):"password_protected"===this.props.forceRivieraException?e.updateQuery({canned_exception:"riviera_exception_password"}):"too_big"===this.props.forceRivieraException&&e.updateQuery({canned_exception:"riviera_exception_too_big"})),e.toString()},t.prototype.shouldIncreaseTabHeightForExcel=function(){return this.props.isExcel&&p.is_mobile_or_tablet()},t.prototype.logFilePreviewEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.postKeysHandledByParent=function(){this.frameMessenger.postMessageToChildren("keydown-keys-handled-by-parent",{keycodes:M})},t.prototype.markWebTiming=function(){this.props.filePreviewSession&&this.props.filePreviewSession.markPrimaryEvent(),d.mark_time_to_view(),d.mark_time_to_interactive()},t.prototype.componentDidMount=function(){this.logFilePreviewEvent(s.EventType.FilePreviewSupportConfirmed),this.logFilePreviewEvent(s.EventType.FilePreviewDownloadAttempted),this.props.usesFrameMessenger&&(this.frameMessenger=new l.PreviewFrameMessengerHost,this.frameMessenger.configureChildMessaging("iframe.previewhtml",this.handleTrustedMessageFromChild,k),this.frameMessenger.startListening(),this.postKeysHandledByParent());var e=o.findDOMNode(this.iframe);e.onload=this.handleIframeLoad,e.onerror=this.handleIframeError},t.prototype.componentWillUnmount=function(){this.props.usesFrameMessenger&&this.frameMessenger.stopListening()},t.prototype.render=function(){var e=this,t={};p.iOS&&(t=a.iOSIframeScrollStyles());var o=this.props,r=o.count,l=o.index,d=o.isFullscreen,m=o.isExcel,v=o.sharePermission,g=o.sizeClass,C=o.onClickNext,S=o.onClickPrevious;return i.default.createElement("div",{className:"preview-content",style:t},i.default.createElement("iframe",n.__assign({},this.getIframeProps())),i.default.createElement(c.PreviewToolbar,{elevateToolbar:m,isFullscreen:d,isHidden:g===u.SizeClass.Small,fadeController:function(e){var t=e.fadeIn,n=e.fadeOut;return i.default.createElement(E.PreviewToolbarFrameMessenger,{activeMouse:t,idleMouse:n})}},m?null:i.default.createElement(f.ToolbarFlipButtons,{index:l,count:r,onClickPrevious:S&&this.handleClickPrevious,onClickNext:C&&this.handleClickNext}),i.default.createElement(_.FullScreenButton,{className:"toolbar-button-entry",formatMessage:I.formatMessage,onClick:function(){return h.toggleFullScreen(d,s.UserActionContext.Toolbar)}}),i.default.createElement(y.PreviewToolbarButton,{"data-test":"print",disabled:!b.canPrint(v),spriteGroup:"web",spriteName:"print",tooltip:b.getPrintTooltip(v),onClick:b.canPrint(v)?function(){return e.printDocument(s.UserActionContext.Toolbar)}:function(){}}),i.default.createElement(w.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings})))},t.defaultProps={usesFrameMessenger:!0},t})(i.default.Component);t.PreviewHTML=x;var M=(T={},T[S.KeyCode.ESC]={altKey:!0,ctrlKey:!0,metaKey:!0},T[S.KeyCode.ENTER]={altKey:!0,ctrlKey:!0,metaKey:!0},T[S.KeyCode.SPACE]={altKey:!0,ctrlKey:!0,metaKey:!0},T[S.KeyCode.PAGE_UP]={
altKey:!0,ctrlKey:!0,metaKey:!0},T[S.KeyCode.PAGE_DOWN]={altKey:!0,ctrlKey:!0,metaKey:!0},T[S.KeyCode.LEFT]={altKey:!0,ctrlKey:!0,metaKey:!0},T[S.KeyCode.UP]={altKey:!0,ctrlKey:!0,metaKey:!0},T[S.KeyCode.RIGHT]={altKey:!0,ctrlKey:!0,metaKey:!0},T[S.KeyCode.DOWN]={altKey:!0,ctrlKey:!0,metaKey:!0},T[S.KeyCode.EQUALS]={altKey:!0,ctrlKey:!0,metaKey:!0},T[70]={altKey:!1,ctrlKey:!0,metaKey:!0},T[80]={altKey:!0,ctrlKey:!0,metaKey:!0},T[S.KeyCode.PLUS_EQUALS_FF]={altKey:!0,ctrlKey:!0,metaKey:!0},T[S.KeyCode.MINUS_FF]={altKey:!0,ctrlKey:!0,metaKey:!0},T[S.KeyCode.PLUS_EQUALS_FF_GERMAN]={altKey:!0,ctrlKey:!0,metaKey:!0},T[S.KeyCode.MINUS_FF_MAC]={altKey:!0,ctrlKey:!0,metaKey:!0},T[S.KeyCode.PLUS_CHROME]={altKey:!0,ctrlKey:!0,metaKey:!0},T[S.KeyCode.MINUS_CHROME]={altKey:!0,ctrlKey:!0,metaKey:!0},T)}),define("modules/clean/react/previews/preview_image",["require","exports","tslib","external/classnames","react","modules/core/i18n","external/react-redux","modules/clean/analytics","modules/clean/image_annotations","modules/clean/image_preview_util","modules/clean/photos/thumbnail_url_util","modules/clean/previews/actions","modules/clean/react/comments2/components/annotations/loadable","modules/clean/react/comments2/data/types","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/file_viewer/utils","modules/clean/react/previews/constants","file-viewer/core","modules/clean/react/previews/image_helpers","modules/clean/react/previews/preview_toolbar","modules/clean/react/size_class/constants","modules/clean/web_timing_logger","modules/clean/react/css","spectrum/dimensions","file-viewer/preview_image","file-viewer/strings","modules/clean/file_store/utils","modules/clean/react/previews/toolbar_flip_buttons","file-viewer/components","file-viewer/toolbar","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/keyboard_binding/keyboard_binding","file-viewer/assets-metaserver","modules/clean/react/previews/print_helpers","modules/clean/react/previews/preview_toolbar_button","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/keycode","modules/clean/react/file_viewer/logging","file-viewer/polyfills"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m,f,h,_,v,g,y,b,w,C,S,E,A,T,P,I,k,x,M,O,F,R,D,L,N,B,U,V){"use strict";function H(){}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importDefault(o),c=n.__importDefault(c),d=n.__importStar(d),w=n.__importStar(w),E=n.__importStar(E);var j=b.createMetaserverFormatters("en",I.strings,b.createI18nCache()),q=b.resolveAsset.bind(null,D.assets),K=(function(t){function a(){var e=null!==t&&t.apply(this,arguments)||this;return e.imgLoaded=!1,e.state={},e.logTTI=function(){e.props.filePreviewSession&&e.props.filePreviewSession.markPrimaryEvent(),E.mark_time_to_view(),E.mark_time_to_interactive()},e.logRenderSuccess=function(){e.imgLoaded||(e.imgLoaded=!0,e.logFilePreviewEvent(f.EventType.FilePreviewDownloadSucceeded),e.logFilePreviewEvent(f.EventType.FilePreviewRenderSucceeded),e.imageAnnotations&&e.props.shouldDisplayToolbar&&e.imageAnnotations.onImageLoad(),e.props.setRenderStatusSuccess(),null!=e.props.onLoad&&e.props.onLoad())},e.onImageDoubleClick=function(){e.shouldDisableZoom()&&e.props.sizeClass!==S.SizeClass.Small&&e.openFullscreen()},e.openFullscreen=function(){null!=e.props.isFullscreen&&v.enterFullScreen()},e.logRenderFailure=function(){var t=function(t){var n={};void 0!==t&&(n.rivieraStatusCode=t.toString()),e.logFilePreviewEvent(f.EventType.FilePreviewDownloadFailed,n),e.props.onError&&e.props.onError(y.ErrorType.LoadError,t)};e.rivieraStatusCodeRequest=g.fetchRivieraStatusCode(e.props["preview-url"],t,t)},e.onZoomIn=function(){e.zoomWithMultiplier(1.25)},e.onZoomOut=function(){e.zoomWithMultiplier(.8)},e.onZoomOriginalOrFit=function(){var t=e.state,n=t.scaleFactor,i=t.minScaleFactor;e.setState({scaleFactor:n===i?1:i})},e.onPrint=function(t){d.imagePrint(u.fullSizeUrl(e.props["preview-url"])),h.logUserAction(f.UserAction.Print,t)},e.handleMinScaleFactorChange=function(t){isNaN(t)||e.state.minScaleFactor===t||e.setState({minScaleFactor:t})},e.keyboardBindings=R.getEqualsKeyBindings(V.wrapKeyboardActionWithLogging(e.onZoomIn,f.UserAction.ZoomIn)).concat(R.getMinusKeyBindings(V.wrapKeyboardActionWithLogging(e.onZoomOut,f.UserAction.ZoomOut)),[B.hydrateKeyboardBinding({keyboardEventCriteria:{which:U.KeyCode.P},callback:function(){return e.onPrint(f.UserActionContext.Keyboard)}})]),e.handleClickPrevious=V.wrapToolbarActionWithLogging(function(){var t=e.props.onPrevious;return t&&t()},f.UserAction.FlipPrevious),e.handleClickNext=V.wrapToolbarActionWithLogging(function(){var t=e.props.onNext;return t&&t()},f.UserAction.FlipNext),e.renderLayers=function(t){return function(i){var r=o.default.createElement(P.ImageLayer,n.__assign({},t,i)),a=t.filePreviewUiData.scaleFactor,s=void 0===a?1:a,l=i.originalWidth,c=i.originalHeight,u=l&&c?{width:l*s,height:c*s}:void 0;return e.props.comments2AnnotationsEnabled===m.Comments2AnnotationsMode.SpectrumComponents&&u?[o.default.createElement(p.AnnotationConductorLayer,{layerSize:u},o.default.createElement(p.AnnotationInstructionalTooltipPane,{layerSize:u},r,o.default.createElement(p.AnnotationViewLayer,null)))]:[r]}},e}return n.__extends(a,t),a.prototype.componentWillUnmount=function(){this.rivieraStatusCodeRequest&&this.rivieraStatusCodeRequest.readyState!==XMLHttpRequest.DONE&&this.rivieraStatusCodeRequest.abort(),null!=this.imageAnnotations&&this.imageAnnotations.reset()},a.prototype.componentWillMount=function(){this.logFilePreviewEvent(f.EventType.FilePreviewSupportConfirmed),this.logFilePreviewEvent(f.EventType.FilePreviewDownloadAttempted),this.props.comments2AnnotationsEnabled===m.Comments2AnnotationsMode.Off&&(this.imageAnnotations=new l.ImageAnnotations({comments2AnnotationsEnabled:!1}))},a.prototype.componentDidUpdate=function(e,t){if(this.imageAnnotations)return e.comments2AnnotationsEnabled===m.Comments2AnnotationsMode.Off&&this.props.comments2AnnotationsEnabled===m.Comments2AnnotationsMode.SpectrumComponents?(this.imageAnnotations.reset(),void(this.imageAnnotations=void 0)):void(t.scaleFactor!==this.state.scaleFactor&&this.imageAnnotations.onResize(!1))},a.prototype.componentDidMount=function(){this.logOpen();var t=this.props,i=t.nsId,o=t.sjId,r=i+"_"+o;null!=i&&null!=o&&window._timingData&&window._timingData.img&&window._timingData.img.dl_error_finish&&window._timingData.img.dl_error_finish[r]&&this.logRenderFailure(),new Promise(function(t,n){e(["modules/clean/react/previews/preview_image_zoom"],t,n)}).then(n.__importStar)},a.prototype.componentWillReceiveProps=function(e){if(e["preview-url"]!==this.props["preview-url"]){var t=e.filePreviewSession;this.logFilePreviewEvent(f.EventType.FilePreviewSupportConfirmed,void 0,t),this.logFilePreviewEvent(f.EventType.FilePreviewDownloadAttempted,void 0,t),this.logOpen(),this.imageAnnotations&&this.imageAnnotations.removeAnnotations(),this.setState({scaleFactor:void 0,minScaleFactor:void 0}),this.imgLoaded=!1}},a.prototype.logFilePreviewEvent=function(e,t,n){void 0===t&&(t={}),void 0===n&&(n=this.props.filePreviewSession),null!=n&&n.recordEvent(e,t)},a.prototype.logOpen=function(){s.PreviewActivityLogger.log("open",{file_ext:this.props["file-extension"]})},a.prototype.shouldDisableZoom=function(){var e=this.props,t=e.sizeClass;return e.shouldDisplayToolbar||t===S.SizeClass.Small},a.prototype.zoomWithMultiplier=function(e){var t=this.state.minScaleFactor,n=this.state.scaleFactor||t;if(1!==e&&n){var i=.05*Math.round(n*e/.05);Math.abs(i-n)<.05&&(i+=e>1?.05:-.05),this.setState({scaleFactor:Math.min(Math.max(i,t||0),16)})}},a.prototype.render=function(){var e=this,t=this.props,n=t.count,a=t.index,s=t.onNext,l=t.onPrevious,d=t.shouldDisplayToolbar,p=t.isFlippingEnabled,m=t.isFullscreen,_=t.sharePermission,g=t.contextMenuDisabled,y=t.windowWidth,S=t.windowHeight,E=t.nsId,A=t.sjId,T=t["preview-url"],I=this.state,R=I.scaleFactor,D=I.minScaleFactor,B=R||D;return o.default.createElement("div",{className:i.default("flex-preview-container","image-visible","annotations-visible",c.default.PREVIEW_IMAGE_CONTAINER,{"zoom-disabled":this.shouldDisableZoom(),"has-toolbar":d})},o.default.createElement(P.PreviewImage,{previewMetadata:{content:{".tag":"image",default_src:w.getFallbackSrc(T),src_set:w.getSrcSet(T),full_size_src:u.fullSizeUrl(T),thumbnail_url_tmpl:T}},fileMetadata:{file_id:k.getFileRevisionId({ns_id:E||0,sjid:A||0}),file_name:""},data:void 0,filePreviewUiData:{scaleFactor:R||D||0,currentPageIndex:0,minScaleFactor:D||0,isSidebarOpen:!1,isDocSidebarOpen:!1,currentMode:b.FileViewerMode.Default,sidebar:{visibility:b.SidebarVisibility.Closed,selectedControlId:b.SidebarControlId.Documentation,paneStack:[]}},id:"",intl:j,dispatch:H,config:b.DEFAULT_CONFIG,contextMenuDisabled:!!g,onDoubleClick:this.onImageDoubleClick,onInteractive:this.logTTI,onRenderSucceeded:this.logRenderSuccess,onRenderFailed:this.logRenderFailure,sizerClassName:c.default.PREVIEW_IMAGE,className:i.default(c.default.PREVIEW_IMAGE_WRAPPER,"preview-content"),width:+y,height:+S,layerRenderFn:this.renderLayers,onMinScaleFactorChanged:this.handleMinScaleFactorChange,resolveAsset:q}),o.default.createElement(F.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings}),d&&o.default.createElement(C.PreviewToolbar,{isFullscreen:!!m},p?o.default.createElement(x.ToolbarFlipButtons,{index:a,count:n,onClickPrevious:l&&this.handleClickPrevious,onClickNext:s&&this.handleClickNext}):null,o.default.createElement(M.RapidFire,{callback:this.onZoomOut,onFirstFire:function(){return h.logUserAction(f.UserAction.ZoomOut,f.UserActionContext.Toolbar)},render:function(e,t){return o.default.createElement(O.ZoomOutButton,{className:"toolbar-button-entry",disabled:null!=B&&null!=D&&B<=D,formatMessage:j.formatMessage,onMouseDown:e,onMouseUp:t,onMouseLeave:t})}}),o.default.createElement(O.ZoomToFitButton,{className:"zoom-label toolbar-button-entry",formatMessage:j.formatMessage,formatNumber:r.format_percent,onClick:this.onZoomOriginalOrFit,zoomPercent:B}),o.default.createElement(M.RapidFire,{callback:this.onZoomIn,onFirstFire:function(){return h.logUserAction(f.UserAction.ZoomIn,f.UserActionContext.Toolbar)},render:function(e,t){return o.default.createElement(O.ZoomInButton,{className:"toolbar-button-entry",disabled:null!=B&&B>=16,formatMessage:j.formatMessage,onMouseDown:e,onMouseUp:t,onMouseLeave:t})}}),o.default.createElement(O.FullScreenButton,{className:"toolbar-button-entry",formatMessage:j.formatMessage,onClick:function(){return v.toggleFullScreen(!!m,f.UserActionContext.Toolbar)}}),o.default.createElement(N.PreviewToolbarButton,{"data-test":"print",disabled:!L.canPrint(_),spriteGroup:"web",spriteName:"print",tooltip:L.getPrintTooltip(_),onClick:L.canPrint(_)?function(){return e.onPrint(f.UserActionContext.Toolbar)}:H})))},a})(o.default.Component);t._PreviewImage=K;var z=function(e){return o.default.createElement(T.Dimensions,{className:"flex-preview-container"},function(t){var i=t.width,r=t.height;return o.default.createElement(K,n.__assign({},e,{windowHeight:r,windowWidth:i}))})},W=A.requireCssWithComponent(z,["/static/css/preview_image-vfldTvbvq.css"]),G=a.connect(function(e){return{isFlippingEnabled:_.getIsFlippingEnabled(e)}})(W);t.PreviewImage=G}),define("modules/clean/react/previews/preview_linkfile",["require","exports","tslib","external/classnames","react","modules/clean/ajax","modules/clean/em_string","modules/clean/filepath","modules/clean/react/css_timing","modules/clean/react/file_viewer/constants","modules/clean/referrer_cleansing_redirect","modules/clean/web_timing_logger","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importDefault(o),r=n.__importStar(r),u=n.__importStar(u),d=n.__importStar(d);var f=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={description:null,hadError:!1,link:null,isMounted:!1},t.requestLinkfileData=function(e){t.logFilePreviewEvent(c.EventType.FilePreviewDownloadAttempted);var n={url:e,dataType:"json",success:t.handleLinkDataSuccess,error:t.handleLinkDataError,xhrFields:{withCredentials:!1}};t.props.data.authenticated?(n.xhrFields={withCredentials:!0},r.SilentBackgroundRequest(n)):r.Request(n)},t.handleLinkDataSuccess=function(e){if(null==e.uri)return void t.handleLinkDataError();t.logFilePreviewEvent(c.EventType.FilePreviewDownloadSucceeded),t.markWebTiming(),t.setState({description:e.uri,hadError:!1,link:e.uri}),t.logFilePreviewEvent(c.EventType.FilePreviewRenderSucceeded),t.props.setRenderStatusSuccess()},t.handleLinkDataError=function(){t.logFilePreviewEvent(c.EventType.FilePreviewDownloadFailed),t.markWebTiming(),t.state.isMounted&&t.setState({description:m._("Can’t show link. Something’s wrong with this file."),hadError:!0,link:null})},t.handleClickOpenLinkButton=function(e){if(null!=t.state.link){var n=u.get_redirect_uri(t.state.link);window.open(n.toString(),"_blank")}},t}return n.__extends(t,e),t.prototype.logFilePreviewEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.markWebTiming=function(){d.mark_time_to_view(),d.mark_time_to_interactive()},t.prototype.isFileDataFetched=function(){return null==this.state.description},t.prototype.componentDidMount=function(){this.logFilePreviewEvent(c.EventType.FilePreviewSupportConfirmed),this.state.isMounted=!0,this.requestLinkfileData(this.props.data.url)},t.prototype.componentWillUnmount=function(){this.state.isMounted=!1},t.prototype.render=function(){var e={"preview-linkfile-content":!0,"loading-content":this.isFileDataFetched()},n={"preview-linkfile-button-openlink":!0,"button-primary":!0,"has-link":null!=this.state.link},r="-",l="";null!=this.props.filename&&(r=s.filename_without_extension(this.props.filename),l=s.file_extension(this.props.filename),""!==l&&(l="."+l));var c=t.MAX_DISPLAYED_FILENAME_CHARS-l.length,u=a.Emstring.em_snippet(r,c),d="-";null!=this.state.description&&(d=this.state.description);var f={"preview-linkfile-description":!0,"force-show-all-text":this.state.hadError},h=p.static_url("/static/images/icons128/page_white_linkfile-vfloEntlU.png");return o.default.createElement("div",{className:"flex-preview-container"},o.default.createElement("div",{className:"preview-content preview-content--center"},o.default.createElement("div",{className:"preview-linkfile-box"},o.default.createElement("div",{className:i.default(e)},o.default.createElement("div",{className:"preview-linkfile-icon"},o.default.createElement("img",{src:h,alt:""})),o.default.createElement("div",{className:"preview-linkfile-title"},o.default.createElement("span",{className:"preview-linkfile-filebase"},u),o.default.createElement("span",{className:"preview-linkfile-fileext"},l)),o.default.createElement("div",{className:"preview-linkfile-info"},o.default.createElement("div",{className:i.default(f)},d),o.default.createElement("button",{className:i.default(n),onMouseUp:this.handleClickOpenLinkButton,ref:"openLinkButton"},m._("Open in new tab")))))))},t.SPINNER_FADE_DELAY_MSEC=150,t.MAX_DISPLAYED_FILENAME_CHARS=21,t})(o.default.Component);t._PreviewLinkfile=f;var h=l.requireCssWithComponent(f,["/static/css/preview_linkfile-vflncZdY-.css"]);t.PreviewLinkfile=h}),define("modules/clean/react/previews/preview_pdf_loadable",["require","exports","tslib","react","modules/clean/react/async/loadable","modules/clean/react/css_timing","modules/clean/react/previews/loading_indicator"],function(e,t,n,i,o,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i);var s=o.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/preview_pdf"],t,n)}).then(n.__importStar).then(function(e){return e.PreviewPDF})},loading:function(e){return e.previewThumbnailUrl?i.default.createElement("div",{className:"preview-pdf-ssr"},i.default.createElement("div",{className:"preview-ssr-viewer"},i.default.createElement(a.LoadingIndicator,{className:"loading-indicator"}))):null}}),l=r.requireCssWithComponent(s,["/static/css/preview_pdf-vflYj7tBx.css","/static/css/snackbar-vflLtw9Um.css"]);t.PreviewPDFLoadable=l}),define("modules/clean/react/previews/preview_ppt_loadable",["require","exports","tslib","react","modules/clean/react/async/loadable","modules/clean/react/css_timing","modules/clean/react/previews/loading_indicator"],function(e,t,n,i,o,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i);var s=o.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/preview_ppt"],t,n)}).then(n.__importStar).then(function(e){return e.PreviewPPT})},loading:function(e){return e.previewThumbnailUrl?i.default.createElement("div",{className:"preview-pdf-ssr"},i.default.createElement("div",{className:"preview-ssr-viewer"},i.default.createElement(a.LoadingIndicator,{className:"loading-indicator"}))):null}}),l=r.requireCssWithComponent(s,["/static/css/preview_pdf-vflYj7tBx.css","/static/css/snackbar-vflLtw9Um.css"]);t.PreviewPPTLoadable=l});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};define("modules/clean/react/previews/preview_toolbar",["require","exports","modules/clean/react/async/loadable"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewToolbar=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/preview_toolbar_component"],t,n)}).then(__importStar).then(function(e){return e.PreviewToolbar})}})}),define("modules/clean/react/previews/preview_toolbar_frame_messenger",["require","exports","tslib","react","modules/clean/react/previews/frame_messenger_host","modules/clean/previews/util"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),r=n.__importStar(r);var a=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setupFrameMessenger=function(){t.frameMessenger=new o.PreviewFrameMessengerHost,t.frameMessenger.configureChildMessaging(r.getIframeQuery(),t.handleMessageFromChild,["idle-mouse","active-mouse"]),t.frameMessenger.startListening(),t.frameMessenger.postMessageToChildren("preview-toolbar-mounted")},t.handleMessageFromChild=function(e){switch(e.action){case"idle-mouse":t.props.idleMouse();break;case"active-mouse":t.props.activeMouse()}},t.teardownFrameMessenger=function(){t.frameMessenger.resetOriginsForPosting(),t.frameMessenger.stopListening()},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.setupFrameMessenger()},t.prototype.componentWillUnmount=function(){this.teardownFrameMessenger()},t.prototype.render=function(){return null},t})(i.default.Component);t.PreviewToolbarFrameMessenger=a}),define("modules/clean/react/previews/preview_zoom_container",["require","exports","tslib","external/keymaster","external/classnames","react","external/lodash","jquery","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/core/i18n"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importDefault(o),r=n.__importDefault(r),a=n.__importStar(a),s=n.__importDefault(s);var f="",h="previewzoomcontainer",_=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={controlsHidden:!1},t.flipNext=function(e){void 0===e&&(e=c.UserActionContext.LightboxToolbar),t.props.onFlipNext&&t.props.onFlipNext(),l.logUserAction(c.UserAction.FlipNext,e)},t.flipPrevious=function(e){void 0===e&&(e=c.UserActionContext.LightboxToolbar),t.props.onFlipPrevious&&t.props.onFlipPrevious(),l.logUserAction(c.UserAction.FlipPrevious,e)},t.onClick=function(e){e.target===e.currentTarget&&(e.preventDefault(),t.onCloseFactory({},c.UserActionContext.LightboxFrame))},t.onMouseMove=function(e){0===s.default(e.target).parents(".preview-toolbar-overlay").length?t.startControlsTimer():clearTimeout(t.controlsHideTimer)},t.onCloseFactory=function(e,n){void 0===e&&(e={}),void 0===n&&(n=c.UserActionContext.LightboxCloseButton),l.logUserAction(c.UserAction.ToggleFullscreenOff,n),t.props.onClose()},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;this.flipNext=a.throttle(this.flipNext,100),this.flipPrevious=a.throttle(this.flipPrevious,100),i.default("esc",h,function(){e.onCloseFactory({},c.UserActionContext.Keyboard)}),null!=this.props.onZoomOut&&i.default("space",h,this.props.onZoomOut),f=i.default.getScope(),i.default.setScope(h),this.startControlsTimer()},t.prototype.componentWillUpdate=function(){i.default.setScope(h)},t.prototype.componentWillUnmount=function(){i.default.clearScope(h),i.default.setScope(f),clearTimeout(this.controlsHideTimer)},t.prototype.startControlsTimer=function(){var e=this;this.showControls(),clearTimeout(this.controlsHideTimer),this.controlsHideTimer=setTimeout(function(){e.hideControls()},3e3)},t.prototype.showControls=function(){this.setState({controlsHidden:!1})},t.prototype.hideControls=function(){this.setState({controlsHidden:!0})},t.prototype.renderFlippableControls=function(){return this.props.fileCount?r.default.createElement(u.FlippableControls,{index:""+(this.props.fileIndex+1),numFlippableFiles:this.props.fileCount,onNext:this.flipNext,onPrevious:this.flipPrevious}):null},t.prototype.renderControls=function(){var e=this.props,t=e.renderZoomControls,n=e.scaleFactor,i=o.default("preview-toolbar-container",{hidden:this.state.controlsHidden});return r.default.createElement("div",{className:i,ref:"previewZoomerToolbarContainer"},r.default.createElement("div",{className:"preview-toolbar-overlay-container"},r.default.createElement("div",{className:"preview-toolbar-overlay"},r.default.createElement("div",{className:"preview-toolbar-content"},this.renderFlippableControls(),t?r.default.createElement("div",{className:o.default("toolbar-button-entry","zoom-out",{disabled:this.props.zoomOutDisabled}),onClick:this.props.onZoomOut},r.default.createElement(d.Sprite,{alt:m._("Zoom out"),group:"web",name:"zoomout"})):null,t?r.default.createElement("div",{className:"toolbar-button-entry",ref:"zoomLabelContainer",onClick:this.props.onViewActualSize},r.default.createElement(p.TitleBubble,{content:m._("View actual size"),position:p.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},r.default.createElement("span",null,Math.floor(100*(n||0)),"%"))):null,t?r.default.createElement("div",{className:o.default("toolbar-button-entry","zoom-in",{disabled:this.props.zoomInDisabled}),onClick:this.props.onZoomIn},r.default.createElement(d.Sprite,{alt:m._("Zoom in"),group:"web",name:"zoom"})):null))))},t.prototype.renderClose=function(){var e=o.default("preview-zoomer-close",{hidden:this.state.controlsHidden});return r.default.createElement("span",null,r.default.createElement("button",{"aria-label":m._("Close"),className:e,onClick:this.onCloseFactory,ref:"previewZoomerClose"},r.default.createElement(d.Sprite,{alt:m._("Close"),group:"web",name:"xclose"})))},t.prototype.render=function(){var e=o.default("preview-zoomer-container",{"zoomer-drag-disabled":this.props.dragDisabled});return r.default.createElement("div",{className:e,onClick:this.onClick,onMouseMove:this.onMouseMove,ref:"previewZoomerContainer"},this.props.children,this.renderClose(),this.renderControls())},t.defaultProps={dragDisabled:!0,zoomInDisabled:!0,zoomOutDisabled:!0},t})(r.default.Component);t.PreviewZoomContainer=_}),define("modules/clean/react/previews/print_helpers",["require","exports","modules/core/i18n"],function(e,t,n){"use strict";function i(e){return!(e&&e.canPrintRoles&&0===e.canPrintRoles.length)}function o(e){return i(e)?n._("Print"):n._("Printing is turned off for this file.")}Object.defineProperty(t,"__esModule",{value:!0}),t.canPrint=i,t.getPrintTooltip=o}),define("modules/clean/react/previews/toolbar_flip_buttons",["require","exports","tslib","react","external/lodash","external/classnames","file-viewer/core","file-viewer/strings","file-viewer/toolbar","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants"],function(e,t,n,i,o,r,a,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importStar(o),r=n.__importDefault(r);var d=a.createMetaserverFormatters("en",s.strings,a.createI18nCache());t.ToolbarFlipButtons=function(e){var t=e.className,n=e.count,a=e.index,s=e.onClickNext,p=void 0===s?o.noop:s,m=e.onClickPrevious,f=void 0===m?o.noop:m;return null==n||null==a||n<1?null:i.default.createElement(l.ToolbarFlipButtons,{buttonClassName:"toolbar-button-entry",className:r.default("flip-buttons","image-toolbar__item",t),count:n,formatMessage:d.formatMessage,index:a,onClickPrevious:c.wrapToolbarActionWithLogging(f,u.UserAction.FlipPrevious),onClickNext:c.wrapToolbarActionWithLogging(p,u.UserAction.FlipNext)})}}),define("modules/clean/react/previews/video/audio_waveform/utils",["require","exports","modules/clean/average_counter"],function(e,t,n){"use strict";function i(e,t,i,o,r){function a(e){return function(){if(e>=t)return void r(l);var c=[],u=Math.ceil(e*s.length/t),d=Math.ceil((e+1)*s.length/t),p=d-u;if(p>i)for(var m=0;m<i;m++){var f=Math.floor(Math.random()*p)+u;c.push(Math.abs(s[f]))}else for(var m=u;m<d;m++){var h=Math.floor(Math.abs(s[m]));c.push(h)}var _=new n.AverageCounter;_.addArray(c),l[e]=_.getAverage(),o()&&setTimeout(a(e+1),0)}}var s=e.getChannelData(0),l=new Array(t);setTimeout(a(0),0)}function o(e,t,i){void 0===i&&(i=1);var o=[];if(0===e.length||t<=0||isNaN(t))return o;for(var r=[],a=0;a<t;a++)r.push(new n.AverageCounter);for(var s=0,l=0,a=0;a<e.length;a++){var c=e[a],u=Math.floor(a*t/e.length),d=r[u];d.add(c),o[u]=d.getAverage(),u!==l&&(s=Math.max(s,o[l]),l=u)}return s=Math.max(s,o[t-1]),o.map(function(e){return e*i/s})}Object.defineProperty(t,"__esModule",{value:!0}),t.buildFromBuffer=i,t.returnWaveform=o}),define("modules/clean/react/previews/video/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e.PlayerRendered="player_rendered",e.FirstClickPlay="first_click_play",e.MediaError="media_error",e.ChangePlaybackRate="change_playback_rate",e.ChangeVideoQuality="change_video_quality",e.ClosePreview="close_preview",e.SeekVideo="seek_video",e.VideoStartsPlaying="video_starts_playing",e.VideoStalled="video_stalled",e.ScrubberThumbnailsLoaded="scrubber_thumbnails_loaded",e.ScrubberThumbnailsFailed="scrubber_thumbnails_failed",e.AudioWaveformLoaded="audio_waveform_loaded",e.AudioWaveformFailed="audio_waveform_failed"})(t.VideoPreviewEvent||(t.VideoPreviewEvent={})),t.HdLabels=["1080p","720p"],t.QualityLabelOrder=t.HdLabels.concat(["480p","360p","240p","256k","192k","128k"]).reverse()}),define("modules/clean/react/previews/video/preview_video",["require","exports","tslib","react","modules/clean/react/previews/video/preview_video_basic","modules/clean/react/previews/video/preview_video_comments2","modules/clean/react/previews/constants"],function(e,t,n,i,o,r,a){"use strict";function s(e){var t=e.sourceContext,s=e.hidePageChrome;return t===a.PreviewSourceContext.EmbeddedSharedLinkFile||s?i.default.createElement(o.PreviewVideoBasic,n.__assign({},e)):i.default.createElement(r.PreviewVideoComments2,n.__assign({},e))}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.PreviewVideoProps=o.PreviewVideoProps,t.PreviewVideo=s}),define("modules/clean/react/previews/video/preview_video_basic",["require","exports","tslib","external/classnames","external/lodash","react","modules/clean/image_size","modules/clean/keycode","modules/clean/loggers/file_preview_logger","modules/clean/loggers/video_preview_logger","modules/clean/previews/util","modules/clean/react/async/loadable","modules/clean/react/css","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/helpers","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/previews/constants","modules/clean/react/previews/video/constants","modules/clean/web_timing_logger","modules/core/browser_detection","modules/core/uri","modules/clean/react/previews/video/utils","modules/clean/react/file_viewer/data/actions","external/react-redux"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m,f,h,_,v,g,y,b,w,C,S,E,A){"use strict";function T(e){return C.URI.parse(e).updateQuery({size:a.imageBestFitSize(window.innerWidth,window.innerHeight),size_mode:"2"}).toString()}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),o=n.__importStar(o),r=n.__importDefault(r),b=n.__importStar(b),t.AsyncVideoPlayer=d.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/video/video_player"],t,n)}).then(n.__importStar).then(function(e){return e.VideoPlayer})}});var P=(function(e){function a(t){var n=e.call(this,t)||this;return n.lastPlaybackRate=1,n.checkRenderSucceeded=function(e){"hls"===n.props.videoContainer&&!e&&o.every(n.successFlags)&&n.markRenderSucceeded()},n.onEmbed=function(){n.logFilePreviewTimelineEvent(m.EventType.FilePreviewSupportConfirmed),n.logFilePreviewTimelineEvent(m.EventType.FilePreviewDownloadAttempted)},n.onLoadedMetadata=function(e){void 0===e&&(e=0),n.videoLogger.populateVideoDuration(e)},n.onCanPlay=function(){n.markRenderSucceeded()},n.onReady=function(e){void 0===e&&(e=!1),n.logFilePreviewTimelineEvent(m.EventType.FilePreviewDownloadSucceeded),n.successFlags.playerReady=!0,n.checkRenderSucceeded(e),n.props.filePreviewSession&&n.props.filePreviewSession.markPrimaryEvent(),b.mark_time_to_view(),b.mark_time_to_interactive(),n.videoLogger.logEvent(y.VideoPreviewEvent.PlayerRendered)},n.logPlay=o.once(function(){n.markRenderSucceeded(),n.videoLogger.logEvent(y.VideoPreviewEvent.FirstClickPlay)}),n.onPlay=function(){var e=n.props.setMediaPlaying;n.logPlay(),e&&e()},n.onPause=function(){var e=n.props.setMediaPaused;e&&e()},n.onStartsPlaying=o.once(function(e){n.videoLogger.logEvent(y.VideoPreviewEvent.VideoStartsPlaying,{play_latency:e.toString()})}),n.onUserInactive=function(e){e!==n.lastPlaybackRate&&(n.lastPlaybackRate=e,n.logUserAction(m.UserAction.VideoPlaybackRateChanged,{playback_rate:e.toString()}))},n.onScrubberThumbnailsLoaded=function(e){e?n.videoLogger.logEvent(y.VideoPreviewEvent.ScrubberThumbnailsLoaded):n.videoLogger.logEvent(y.VideoPreviewEvent.ScrubberThumbnailsFailed)},n.onAudioWaveformLoaded=function(e){void 0===e&&(e=!1),n.successFlags.waveformLoaded=!0,n.checkRenderSucceeded(e),n.videoLogger.logEvent(y.VideoPreviewEvent.AudioWaveformLoaded)},n.onAudioWaveformFailed=function(){n.videoLogger.logEvent(y.VideoPreviewEvent.AudioWaveformFailed)},n.onError=function(e){if(e&&(n.videoLogger.logEvent(y.VideoPreviewEvent.MediaError,{errorCode:e.code?e.code.toString():"",errorMessage:e.message||""}),"needflash"===e.message))return n.logFilePreviewTimelineEvent(m.EventType.FilePreviewSupportDenied),void("function"==typeof n.props.onError&&n.props.onError(g.ErrorType.NeedFlashError));n.logFilePreviewTimelineEvent(m.EventType.FilePreviewDownloadFailed),b.mark_time_to_view(),b.mark_time_to_interactive(),n.props.onError&&n.props.onError(g.ErrorType.LoadError)},n.onPlaybackRateChange=function(e,t){n.videoLogger.logEvent(y.VideoPreviewEvent.ChangePlaybackRate,{old_playback_rate:e.toString(),new_playback_rate:t.toString()})},n.onSeek=function(e,t){n.videoLogger.logEvent(y.VideoPreviewEvent.SeekVideo,{old_video_time:e.toString(),
new_video_time:t.toString()})},n.onStalled=function(e,t){n.videoLogger.logEvent(y.VideoPreviewEvent.VideoStalled,{video_timestamp:e.toString(),playback_rate:t.toString()})},n.onTruncated=function(){f.filePreviewEventEmitter.emit(m.EventType.FilePreviewVideoTruncated),n.videoLogger.setVideoTruncated()},n.onThumbLoad=function(e){void 0===e&&(e=!1),n.successFlags.thumbLoaded=!0,n.checkRenderSucceeded(e)},n.onClose=function(e){n.videoLogger.logEvent(y.VideoPreviewEvent.ClosePreview,{video_time_on_close:e.toString()})},n.onSelectQuality=function(e,t){n.videoLogger.logEvent(y.VideoPreviewEvent.ChangeVideoQuality,{old_video_quality:e,new_video_quality:t})},n.handleKeyPress=function(e){return e.keyCode===s.KeyCode.SPACE&&(n.togglePlayback(),e.preventDefault(),!0)},n.keyboardBindings=[{keyboardEventCriteria:_.generateUnmodifiedKeyboardEventCriteria(s.KeyCode.SPACE),callback:n.handleKeyPress}],n.processGutterClick=function(e){var t=n.props.onGutterClick;t&&e.target===e.currentTarget&&t()},t&&t.isAudio?n.successFlags={playerReady:!1,waveformLoaded:!1}:n.successFlags={playerReady:!1,thumbLoaded:!1},n}return n.__extends(a,e),a.prototype.setUpLoggers=function(){this.teardownLoggers(),this.userActionLogger=new l.FilePreviewUserActionLogger,this.userActionLogger.listenTo(f.filePreviewEventEmitter),this.videoLogger=new c.VideoPreviewLogger(this.props.fileExtension,this.props.filePreviewSession)},a.prototype.teardownLoggers=function(){this.userActionLogger&&(this.userActionLogger.unlistenTo(f.filePreviewEventEmitter),delete this.userActionLogger)},a.prototype.logFilePreviewTimelineEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},a.prototype.logUserAction=function(e,t){f.filePreviewEventEmitter.emit(m.EventType.FilePreviewUserAction,this.props.filePreviewSession,e,m.UserActionContext.VideoPlayer,t)},a.prototype.markRenderSucceeded=function(){this.logFilePreviewTimelineEvent(m.EventType.FilePreviewRenderSucceeded),this.props.setRenderStatusSuccess()},a.prototype.getPlaybackRates=function(){return[.5,1,1.25,1.5,2,4]},a.prototype.componentDidMount=function(){this.setUpLoggers()},a.prototype.componentWillUnmount=function(){this.teardownLoggers()},a.prototype.shouldComponentUpdate=function(e){return h.compareStateAndProps(e,{})},a.prototype.togglePlayback=function(){f.filePreviewEventEmitter.emit(m.EventType.FilePreviewVideoToggled)},a.prototype.render=function(){var e=this.props,o=e.title,a=e.previewUrl,s=e.separateResolutionUrls,l=e.sourceContext,c=e.thumbnailUrlTmpl,d=e.videoMetadataUrl,p=e.videoContainer,m=e.vttThumbnailsUrl,f=e.waveformUrl,h=S.video_type(p),_=l!==g.PreviewSourceContext.EmbeddedSharedLinkFile,y=!1,b=!1,C=0;w.is_mobile_or_tablet()&&(y=!0,b=!0,C=1);var E={preload:"auto",playbackRates:this.getPlaybackRates(),nativeControlsForTouch:b,playsinline:C};null!=c&&(E.poster=u.tagCriticalPathContentRequest(T(c),this.props.filePreviewSession));var A={src:a,separateResolutionSrcs:s,sourceContentType:h,metadataLink:d,title:o,vttThumbnailsUrl:m,waveformUrl:f},P={onLoadedMetadata:this.onLoadedMetadata,onCanPlay:this.onCanPlay,onError:this.onError,onReady:this.onReady,onPlay:this.onPlay,onPause:this.onPause,onStartsPlaying:this.onStartsPlaying,onThumbLoad:this.onThumbLoad,onUserInactive:this.onUserInactive,onScrubberThumbnailsLoaded:this.onScrubberThumbnailsLoaded,onAudioWaveformLoaded:this.onAudioWaveformLoaded,onAudioWaveformFailed:this.onAudioWaveformFailed,onPlaybackRateChange:this.onPlaybackRateChange,onSeek:this.onSeek,onStalled:this.onStalled,onSelectQuality:this.onSelectQuality,onTimeUpdate:this.props.onTimeUpdate},I={videoProps:A,playerCallbacks:P,playerOptions:E,seekPosition:this.props.seekPosition,shouldEnableControls:!this.props.hideControls,noDownload:y,shouldFocusOnReady:this.props.shouldFocusOnReady,onEmbed:this.onEmbed,onTruncated:this.onTruncated,onClose:this.onClose,shouldShowTruncationMessage:_,isAudio:this.props.isAudio,bytes:this.props.bytes,showOnboarding:!!this.props.showOnboarding,playerIntegrationEnabled:!!this.props.playerIntegrationEnabled};return r.default.createElement("div",{className:i.default({"flex-preview-container":!0,"touch-device":w.is_mobile_or_tablet()})},this.props.disableKeyboardShortcuts?null:r.default.createElement(v.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings}),r.default.createElement("div",{className:"preview-content preview-video",onClick:this.processGutterClick},r.default.createElement("div",{className:"preview-video__wrapper"},r.default.createElement("div",{className:i.default({"preview-video__aspect-container":!0,"preview-audio-transcoded":this.props.isAudio})},r.default.createElement("div",{className:"preview-video__container"},r.default.createElement(t.AsyncVideoPlayer,n.__assign({},I)))))))},a})(r.default.Component);t._PreviewVideoBasic=P;var I=A.connect(void 0,{setMediaPlaying:E.setMediaPlaying,setMediaPaused:E.setMediaPaused})(P),k=p.requireCssWithComponent(I,["/static/css/preview_video-vfljF09ZK.css","/static/css/video-js-7-custom-v1-vfl-Mver7.css"]);t.PreviewVideoBasic=k}),define("modules/clean/react/previews/video/preview_video_comments2",["require","exports","tslib","react","external/react-redux","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/store","modules/clean/react/comments2/data/selectors","modules/clean/react/comments2/video_annotations/annotation_helper","modules/clean/react/comments2/video_annotations/constants","modules/clean/react/comments2/video_annotations/video_preview_event_emitter","modules/clean/react/previews/video/preview_video_basic"],function(e,t,n,i,o,r,a,s,l,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i);var p=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.seekToActivatedTimecode()},t.prototype.componentDidUpdate=function(e){e.activatedTimecodeThread!==this.props.activatedTimecodeThread&&this.seekToActivatedTimecode()},t.prototype.seekToActivatedTimecode=function(){var e=this.props.activatedTimecodeThread;if(e){var t=l.VideoAnnotationHelper.unitConvertDomainObjectTimeToSeconds(e.annotation.time);u.videoPreviewEventEmitter.emit(c.EventTypes.SEEK_POSITION_AND_PAUSE,t)}},t.prototype.render=function(){var e=this.props,t=e.onTimeUpdate,o=e.playerIntegrationEnabled;return i.default.createElement(d.PreviewVideoBasic,n.__assign({},this.props,{onTimeUpdate:o?t:void 0}))},t})(i.default.PureComponent);t.PreviewVideoBasicWithPlayerIntegration=p,t.ConnectedPreviewVideoComments2=o.connect(function(e){var t=s.getIsPlayerIntegrationEnabled(e);return{showOnboarding:s.getShowOnboardingOnVideo(e),playerIntegrationEnabled:t,activatedTimecodeThread:t?s.getActivatedTimecodeThread(e):void 0}},{onTimeUpdate:r.Actions.updatePlayerCurrentTime,onGutterClick:r.Actions.deactivateAllThreads})(p);var m=(function(e){function r(t){var n=e.call(this,t)||this;return n.store=a.getStoreForComments2(),n}return n.__extends(r,e),r.prototype.render=function(){return i.default.createElement(o.Provider,{store:this.store},i.default.createElement(t.ConnectedPreviewVideoComments2,n.__assign({},this.props)))},r})(i.default.PureComponent);t.PreviewVideoComments2=m}),define("modules/clean/react/previews/video/utils",["require","exports","tslib","modules/core/browser_detection"],function(e,t,n,i){"use strict";function o(){return i.edge||i.safari}function r(e){return"application/vnd.apple.mpegurl"}function a(e){return e.tech({IWillNotUseThisInPlugins:!0})}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),t.showQualityNativeHls=o;t.video_type=r,t.getTechFromPlayer=a});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};define("modules/clean/react/share_download/button",["require","exports","modules/clean/react/async/loadable"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DownloadSimpleButton=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/share_download/button_component"],t,n)}).then(__importStar).then(function(e){return e.DownloadSimpleButton})}}),t.ShareDownloadButton=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/share_download/button_component"],t,n)}).then(__importStar).then(function(e){return e.ShareDownloadButton})}})}),define("modules/clean/react/watermarking/api",["require","exports","modules/clean/api_v2/user_client"],function(e,t,n){"use strict";function i(e,t,i){var o=new n.UserApiV2Client,r={path:t,overwrite:i};return o.ns("file_viewer").rpc("watermarking/watermark_file",r,{subjectUserId:e})}function o(e,t){var i=new n.UserApiV2Client,o={path:t};return i.ns("file_viewer").rpc("watermarking/preview_watermark",o,{subjectUserId:e})}Object.defineProperty(t,"__esModule",{value:!0}),t.sendWatermarkRequest=i,t.getPreviewWithWatermark=o}),define("modules/clean/react/watermarking/callout",["require","exports","tslib","react","modules/clean/storage","modules/clean/react/bubble_dropdown_v2","modules/clean/react/maestro/callout","modules/core/i18n","modules/clean/react/watermarking/constants"],function(e,t,n,i,o,r,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),t.CALLOUT_DISMISSED_LOCALSTORAGE_KEY="fileviewer_watermarking_callout_dismissed";var c=(function(e){function c(){var n=null!==e&&e.apply(this,arguments)||this;return n.state={hasBeenDismissed:o.LocalStorage.get(t.CALLOUT_DISMISSED_LOCALSTORAGE_KEY)},n.dismissCallout=function(){window.removeEventListener("click",n.dismissCallout),o.LocalStorage.set(t.CALLOUT_DISMISSED_LOCALSTORAGE_KEY,!0),n.setState({hasBeenDismissed:!0})},n}return n.__extends(c,e),c.prototype.componentDidMount=function(){this.state.hasBeenDismissed||window.addEventListener("click",this.dismissCallout)},c.prototype.componentWillUnmount=function(){window.removeEventListener("click",this.dismissCallout)},c.prototype.render=function(){var e=this.props,t=e.targetNode,n=e.parentHasBeenClicked;return this.state.hasBeenDismissed?null:i.default.createElement(a.Callout,{title:s._("The new way to protect your work.",{project:l.WM_I18N_PROJECT}),message:s._("Now you can watermark files right in Dropbox.",{project:l.WM_I18N_PROJECT}),show:!0,onDismiss:this.dismissCallout,targetNode:t,parentHasBeenClicked:n,position:r.BubbleDropdownPositions.BOTTOM_LEFT})},c})(i.default.Component);t.WatermarkingCallout=c}),define("modules/clean/react/watermarking/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WM_I18N_PROJECT="watermarking"}),define("modules/clean/react/watermarking/controller",["require","exports","tslib","react","external/react-redux","modules/clean/previews/data/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/data/selectors","file-viewer/core","modules/clean/react/file_viewer/data/actions","modules/clean/react/watermarking/api","modules/core/i18n","modules/clean/react/snackbar","modules/clean/react/watermarking/constants"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i);var h=(function(e){function t(t){var o=e.call(this,t)||this;return o.handleModeChange=function(){return n.__awaiter(o,void 0,void 0,function(){var e,t,o,s,l,u,h;return n.__generator(this,function(n){switch(n.label){case 0:if(e=this.props,t=e.mode,o=e.changeMode,s=e.setRenderStatusForCurrentFile,l=e.setVirtualPreviewMetadata,!o||!l||!s)return[2];if(t!==c.FileViewerMode.Watermarking)return r.clearVirtualPreviewMetadata(),this.setState({isLoadingWatermark:!1}),[2];s(a.PreviewRenderStatus.Loading),this.setState({isLoadingWatermark:!0}),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,d.getPreviewWithWatermark(this.props.user.id,this.props.file.file_id)];case 2:return u=n.sent(),l(this.props.file,u.preview),[3,4];case 3:return h=n.sent(),o(c.FileViewerMode.Default),m.Snackbar.update(i.default.createElement(m.Snackbar,{variant:"fail",title:p._("Couldn’t enable watermarking. Please reload the page and try again.",{project:f.WM_I18N_PROJECT}),closeButtonText:p._("Close",{project:f.WM_I18N_PROJECT})})),[3,4];case 4:return[2]}})})},o.state={isLoadingWatermark:!1},o}return n.__extends(t,e),t.prototype.componentDidUpdate=function(e){var t=this.props,n=t.isFileRendered,i=t.mode,o=e.isFileRendered,r=e.mode,a=this.state.isLoadingWatermark;i!==r&&this.handleModeChange(),a&&(!o&&n&&(m.Snackbar.close(),this.setState({isLoadingWatermark:!1})),o&&!n&&m.Snackbar.sync(p._("Loading watermarked preview...",{project:f.WM_I18N_PROJECT})))},t.prototype.render=function(){return null},t})(i.default.Component);t._WatermarkingController=h;var _=function(e){return{isFileRendered:l.getRenderStatusForCurrentFile(e)===a.PreviewRenderStatus.Succeeded,mode:l.getMode(e)}},v=o.connect(_,{changeMode:u.changeMode,setRenderStatusForCurrentFile:s.setRenderStatusForCurrentFile,setVirtualPreviewMetadata:r.setVirtualPreviewMetadata})(h);t.WatermarkingController=v}),define("modules/clean/react/watermarking/utils",["require","exports","tslib","modules/clean/react/file_viewer/title_utils","modules/constants/file_viewer"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o),t.allowWatermark=function(e,t){return!!t&&!!o.WATERMARKING_BY_USER_ID&&"ON"===o.WATERMARKING_BY_USER_ID[t.id]&&i.fileIsWatermarkable(e)}}),define("modules/clean/shallow_equal",["require","exports"],function(e,t){"use strict";function n(e,t){return e===t?0!==e||0!==t||1/e===1/t:e!==e&&t!==t}function i(e,t){if(n(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(var a=0;a<i.length;a++)if(!o.call(t,i[a])||!n(e[i[a]],t[i[a]]))return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0});var o=Object.prototype.hasOwnProperty;t.shallowEqual=i}),define("modules/core/type",["require","exports","tslib","external/lodash"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var o=(function(){function e(e,t){if(!i.isString(e)&&!i.isFunction(e))throw new TypeError("First parameter needs to be a string identifying the type");if(!i.isFunction(t))throw new TypeError("Second parameter needs to be a predicate defining the type");i.isFunction(e)?this.getTypeString=e:this.getTypeString=function(){return e},this.predicate=t}return e})();t.Type=o;var r=function(e){if(t.isBasicType(e))return!0;if(e instanceof o)return!0;if(i.isFunction(e))return!0;if(i.isArray(e)){if(1!==e.length)return!1;if(!r(e[0]))return!1}else{if(!(i.isObject(e)&&null==e.prototype&&e.constructor===Object&&Object.keys(e).length>0))return!1;for(var n in e){if(!r(e[n]))return!1}}return!0},a=(function(){var e=new o("undefined",i.isUndefined),t=new o("null",i.isNull),n=new o("Boolean",i.isBoolean),a=new o("Number",i.isNumber),s=new o("String",i.isString),l=new o("Object",function(e){return i.isObject(e)&&!i.isFunction(e)&&!i.isArray(e)}),c=new o("Type",r);return function(i){return void 0===i?e:null===i?t:i===Boolean?n:i===Number?a:i===String?s:i===Object?l:i===o?c:void 0}})();t.isBasicType=function(e){return null!=a(e)},t.firstFailingKeypath=function(e,n,r){if(null==r&&(r=[]),t.isBasicType(e)){if(!a(e).predicate(n))return r}else if(e instanceof o){if(!e.predicate(n))return r}else if(i.isFunction(e)){if(!(n instanceof e))return r}else if(i.isArray(e)){if(t.firstFailingKeypath(Array,n,r))return r;for(var s=0;s<n.length;s++){var l=n[s];if(r.push(s),t.firstFailingKeypath(e[0],l,r))return r;r.pop()}}else{if(t.firstFailingKeypath(Object,n,r))return r;for(var c=Object.keys(e),u=Object.keys(n),d=0,p=Array.from(i.difference(c,u));d<p.length;d++){var m=p[d];if(t.firstFailingKeypath(e[m],void 0,r))return r}for(var f=0,h=Array.from(i.intersection(u,c));f<h.length;f++){var m=h[f];if(r.push(m),t.firstFailingKeypath(e[m],n[m],r))return r;r.pop()}}},t.checkType=function(e,n){return null==t.firstFailingKeypath(e,n)},t.getTypeString=function(e){if(t.isBasicType(e))return a(e).getTypeString();if(e instanceof o)return e.getTypeString();if(i.isFunction(e))return e.name;if(i.isArray(e))return"["+t.getTypeString(e[0])+"]";var n=[];for(var r in e){var s=e[r];n.push(r+": "+t.getTypeString(s))}return"{"+n.join(", ")+"}"}}),define("modules/core/types",["require","exports","tslib","external/lodash","modules/core/type"],function(e,t,n,i,o){"use strict";function r(e,t){var n=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var r=t.apply(this,n),a=o.firstFailingKeypath(e,r);if(null!=a){var s=c(0,a,e,r);throw new TypeError(s)}return r};return t.isTypeChecked&&(n.isTypeChecked=!0),n}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var a=(function(){try{return Boolean(localStorage.production_typechecking)}catch(e){return!1}})(),s=(function(e){function t(t){return e.call(this,o.getTypeString.bind(null,t),o.checkType.bind(null,t))||this}return n.__extends(t,e),t})(o.Type),l=function(e,t){if(o.isBasicType(e));else if(e instanceof o.Type)null!=e.parameter_types&&i.isFunction(t)&&!t.isTypeChecked&&(t=u.apply(void 0,Array.from(e.parameter_types).concat([t])));else if(i.isFunction(e));else if(i.isArray(e))for(var n=0;n<t.length;n++){var r=t[n],a=l(e[0],r);a!==r&&(t=t.slice(),t[n]=a)}else for(var s in e){var c=e[s],d=l(c,t[s]);d!==t[s]&&(t=i.clone(t),t[s]=d)}return t},c=function(e,t,n,r){for(var a,s=0,l=Array.from(t);s<l.length;s++){var c=l[s];r=r[c],n=i.isArray(n)?n[0]:n[c]}return t.length>0&&(a=", key "+t.join(".")),a=null!=a?a:"","Argument "+e+a+": Value "+JSON.stringify(r,null,"  ")+" doesn't match type "+o.getTypeString(n)},u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Math.max(e.length,1),r=e.slice(0,n-1),a=e[n-1],u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=r,u=i.find(r,function(e){return e instanceof s});if(null!=u){var d=n.indexOf(u),p=Math.max(e.length-n.length+1,0),m=[d,1];i.times(p,function(){return m.push(u)}),n=n.slice(),n.splice.apply(n,Array.from(m||[]))}for(var f=0;f<n.length;f++){var h=n[f],_=o.firstFailingKeypath(h,e[f]);if(null!=_){var v=c(f,_,h,e[f]);throw new TypeError(v)}e[f]=l(h,e[f])}return a.apply(this,e)};return u.isTypeChecked=!0,u},d=function(e){if(e instanceof o.Type&&e.isOptional||e instanceof s)return e;var t=function(){return"?"+o.getTypeString(e)},n=function(t){return null==t||o.checkType(e,t)},i=new o.Type(t,n);return e instanceof o.Type&&null!=e.parameter_types&&(i.parameter_types=e.parameter_types),i.isOptional=!0,i},p=function(e){return new s(e)},m={takes:r(Function,u(p(o.Type),Function,u)),returns:r(Function,u(o.Type,Function,r)),Maybe:r(o.Type,u(o.Type,d)),Any:new o.Type("Any",function(e){return!0})};a||(m.takes=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Math.max(e.length,1);return e.slice(0,n-1),e[n-1]},m.returns=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Math.max(e.length,1);return e.slice(0,n-1),e[n-1]}),t.default=m}),define("spectrum_comments/utils/throttle-debounce",["require","exports"],function(e,t){"use strict";function n(e,t){function n(){i=!0,null!==o&&(e.apply(void 0,o),o=null)}var i=!0,o=null;return function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];i?(i=!1,e.apply(void 0,r),setTimeout(n,t)):o=r}}function i(e,t,n){void 0===n&&(n=!1);var i;return function(){for(var o=[],r=0;r<arguments.length;r++)o[r]=arguments[r];var a=this,s=function(){i=void 0,n||e.apply(a,o)},l=n&&void 0===i;void 0!==i&&window.clearTimeout(i),i=window.setTimeout(s,t),l&&e.apply(a,o)}}Object.defineProperty(t,"__esModule",{value:!0}),t.throttle=n,t.debounce=i});
//# sourceMappingURL=pkg-file_viewer.min.js-vflGYKcOH.map